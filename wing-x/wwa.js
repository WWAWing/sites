/*
 WWA Wing
 http://wwawing.com/
 Copyright (c) 1996-2015 NAO
 Copyright (c) 2015 WWA Wing Team
 LICENSE: https://raw.githubusercontent.com/WWAWing/WWAWing/master/LICENSE

 CryptoJS v3.1.2
 code.google.com/p/crypto-js
 (c) 2009-2013 by Jeff Mott. All rights reserved.
 code.google.com/p/crypto-js/wiki/License
*/
var wwa_input;
(function(g){(function(b){b[b.NONE=0]="NONE";b[b.KEYDOWN=1]="KEYDOWN";b[b.KEYPRESS=2]="KEYPRESS";b[b.KEYUP=3]="KEYUP";b[b.KEYPRESS_MESSAGECHANGE=4]="KEYPRESS_MESSAGECHANGE"})(g.KeyState||(g.KeyState={}));var d=g.KeyState;(function(b){b[b.KEY_ENTER=13]="KEY_ENTER";b[b.KEY_SHIFT=16]="KEY_SHIFT";b[b.KEY_ESC=27]="KEY_ESC";b[b.KEY_SPACE=32]="KEY_SPACE";b[b.KEY_LEFT=37]="KEY_LEFT";b[b.KEY_UP=38]="KEY_UP";b[b.KEY_RIGHT=39]="KEY_RIGHT";b[b.KEY_DOWN=40]="KEY_DOWN";b[b.KEY_1=49]="KEY_1";b[b.KEY_2=50]="KEY_2";
b[b.KEY_3=51]="KEY_3";b[b.KEY_A=65]="KEY_A";b[b.KEY_C=67]="KEY_C";b[b.KEY_D=68]="KEY_D";b[b.KEY_E=69]="KEY_E";b[b.KEY_I=73]="KEY_I";b[b.KEY_M=77]="KEY_M";b[b.KEY_N=78]="KEY_N";b[b.KEY_P=80]="KEY_P";b[b.KEY_Q=81]="KEY_Q";b[b.KEY_S=83]="KEY_S";b[b.KEY_W=87]="KEY_W";b[b.KEY_X=88]="KEY_X";b[b.KEY_Y=89]="KEY_Y";b[b.KEY_Z=90]="KEY_Z";b[b.KEY_F1=112]="KEY_F1";b[b.KEY_F3=114]="KEY_F3";b[b.KEY_F4=115]="KEY_F4";b[b.KEY_F5=116]="KEY_F5";b[b.KEY_F6=117]="KEY_F6";b[b.KEY_F7=118]="KEY_F7";b[b.KEY_F8=119]="KEY_F8";
b[b.KEY_F12=123]="KEY_F12"})(g.KeyCode||(g.KeyCode={}));var e=function(){function b(){var k;this._nextKeyState=Array(b.KEY_BUFFER_MAX);this._keyState=Array(b.KEY_BUFFER_MAX);this._prevKeyState=Array(b.KEY_BUFFER_MAX);this._prevKeyStateOnControllable=Array(b.KEY_BUFFER_MAX);this._keyInputContinueFrameNum=Array(b.KEY_BUFFER_MAX);for(k=0;k<b.KEY_BUFFER_MAX;k++)this._nextKeyState[k]=!1,this._keyState[k]=!1,this._prevKeyState[k]=!1,this._prevKeyStateOnControllable[k]=!1,this._keyInputContinueFrameNum[k]=
0}b.prototype.checkHitKey=function(b){b=this.getKeyState(b);return b===d.KEYDOWN||b===d.KEYPRESS};b.prototype.getKeyState=function(b){return this._prevKeyState[b]?this._keyState[b]?d.KEYPRESS:d.KEYUP:this._keyState[b]?d.KEYDOWN:d.NONE};b.prototype.getKeyStateForControllPlayer=function(b){return this._prevKeyStateOnControllable[b]?this._keyState[b]?d.KEYPRESS:d.KEYUP:this._keyState[b]?d.KEYDOWN:d.NONE};b.prototype.getKeyStateForMessageCheck=function(b){return this._prevKeyState[b]?this._keyState[b]?
this._keyInputContinueFrameNum[b]>=wwa_data.WWAConsts.KEYPRESS_MESSAGE_CHANGE_FRAME_NUM?d.KEYPRESS_MESSAGECHANGE:d.KEYPRESS:d.KEYUP:this._keyState[b]?d.KEYDOWN:d.NONE};b.prototype.setPressInfo=function(b){this._nextKeyState[b]=!0;this._keyInputContinueFrameNum[b]=-1};b.prototype.setReleaseInfo=function(b){this._nextKeyState[b]=!1;this._keyInputContinueFrameNum[b]=-1};b.prototype.update=function(){var k;this._prevKeyState=this._keyState.slice();this._keyState=this._nextKeyState.slice();for(k=0;k<b.KEY_BUFFER_MAX;k++)this._keyState[k]&&
this._keyInputContinueFrameNum[k]++};b.prototype.memorizeKeyStateOnControllableFrame=function(){this._prevKeyStateOnControllable=this._keyState.slice()};b.prototype.allClear=function(){var k;this._nextKeyState=Array(b.KEY_BUFFER_MAX);for(k=0;k<b.KEY_BUFFER_MAX;k++)this._nextKeyState[k]=!1};b.KEY_BUFFER_MAX=256;return b}();g.KeyStore=e;(function(b){b[b.NONE=0]="NONE";b[b.MOUSEDOWN=1]="MOUSEDOWN";b[b.MOUSEPRESS=2]="MOUSEPRESS";b[b.MOUSEUP=3]="MOUSEUP"})(g.MouseState||(g.MouseState={}));var b=g.MouseState,
e=function(){function d(){this._nextMouseState=this._mouseState=this._prevMouseState=!1}d.prototype.checkClickMouse=function(d){d=void 0!==d?this.getMouseState(d):this.getMouseState();return d===b.MOUSEDOWN||d===b.MOUSEPRESS};d.prototype.getMouseState=function(d){return void 0!==d&&this._inputDir!==d?b.NONE:this._prevMouseState?this._mouseState?b.MOUSEPRESS:b.MOUSEUP:this._mouseState?b.MOUSEDOWN:b.NONE};d.prototype.getMouseStateForControllPlayer=function(d){return void 0!==d&&this._inputDir!==d?b.NONE:
this._prevMouseStateOnControllable?this._mouseState?b.MOUSEPRESS:b.MOUSEUP:this._mouseState?b.MOUSEDOWN:b.NONE};d.prototype.setPressInfo=function(b,a){this._nextMouseState=!0;this._inputDir=b;this._touchID=a};d.prototype.setReleaseInfo=function(){this._touchID=void 0;this._nextMouseState=!1};d.prototype.memorizeMouseStateOnControllableFrame=function(){this._prevMouseStateOnControllable=this._mouseState};d.prototype.update=function(){this._prevMouseState=this._mouseState;this._mouseState=this._nextMouseState};
d.prototype.clear=function(){this._nextMouseState=!1};d.prototype.getTouchID=function(){return this._touchID};return d}();g.MouseStore=e})(wwa_input||(wwa_input={}));var __extends=this.__extends||function(g,d){function e(){this.constructor=g}for(var b in d)d.hasOwnProperty(b)&&(g[b]=d[b]);e.prototype=d.prototype;g.prototype=new e},wwa_data;
(function(g){var d=function(){function a(a,b){this.strength=a;this.defence=b}a.prototype.add=function(a){this.strength+=a.strength;this.defence+=a.defence;return this};a.prototype.plus=function(b){return new a(this.strength+b.strength,this.defence+b.defence)};a.prototype.minus=function(b){return new a(this.strength-b.strength,this.defence-b.defence)};a.prototype.equals=function(a){return this.strength===a.strength&&this.defence===a.defence};return a}();g.EquipmentStatus=d;d=function(a){function b(m,
c,x,d){this.energy=m;this.gold=d;a.call(this,c,x)}__extends(b,a);b.prototype.add=function(a){a instanceof b&&(this.energy+=a.energy,this.gold+=a.gold);this.strength+=a.strength;this.defence+=a.defence;return this};b.prototype.plus=function(a){return a instanceof b?new b(this.energy+a.energy,this.strength+a.strength,this.defence+a.defence,this.gold+a.gold):new b(this.energy,this.strength+a.strength,this.defence+a.defence,this.gold)};b.prototype.minus=function(a){return a instanceof b?new b(this.energy-
a.energy,this.strength-a.strength,this.defence-a.defence,this.gold-a.gold):new b(this.energy,this.strength-a.strength,this.defence-a.defence,this.gold)};b.prototype.equals=function(a){return this.energy===a.energy&&this.strength===a.strength&&this.defence===a.defence&&this.gold===a.gold};return b}(d);g.Status=d;var e=function(){function a(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.x=a;this.y=b}a.prototype.equals=function(a){return this.x===a.x&&this.y===a.y};a.prototype.substract=function(b){return new a(this.x-
b.x,this.y-b.y)};a.prototype.clone=function(){return new a(this.x,this.y)};a.prototype.convertIntoPosition=function(a){return new b(a,this.x,this.y,0,0)};a.prototype.getDirectionTo=function(a){return this.x<a.x?this.y>a.y?p.RIGHT_UP:this.y===a.y?p.RIGHT:p.RIGHT_DOWN:this.x===a.x?this.y>a.y?p.UP:this.y===a.y?p.NO_DIRECTION:p.DOWN:this.y>a.y?p.LEFT_UP:this.y===a.y?p.LEFT:p.LEFT_DOWN};a.prototype.toString=function(){return"("+this.x+", "+this.y+")"};return a}();g.Coord=e;var b=function(){function a(a,
b,c,d,k){void 0===d&&(d=0);void 0===k&&(k=0);this._wwa=a;if(void 0===this._wwa)throw Error("WWA\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5b58\u5728\u3057\u307e\u305b\u3093. ");a=this._wwa.getMapWidth();if(0>b||b>=a||b>=a-1&&0<d||0>c||c>=a||c>=a-1&&0<k)throw Error("\u7bc4\u56f2\u5916\u306e\u5ea7\u6a19\u3067\u3059!! parts:("+b+", "+c+"), offset:("+d+", "+k+"), mapWidth = "+a);this._partsCoord=new e(b,c);this._offsetCoord=new e(d,k)}a.prototype.getPartsCoord=function(){return this._partsCoord};
a.prototype.getOffsetCoord=function(){return this._offsetCoord};a.prototype.getScreenTopPosition=function(){return new a(this._wwa,Math.floor(this._partsCoord.x/(k.H_PARTS_NUM_IN_WINDOW-1))*(k.H_PARTS_NUM_IN_WINDOW-1),Math.floor(this._partsCoord.y/(k.V_PARTS_NUM_IN_WINDOW-1))*(k.V_PARTS_NUM_IN_WINDOW-1),0,0)};a.prototype.getDefaultCameraPosition=function(){var a=this.getScreenTopPosition(),b=a.getPartsCoord(),c=this._wwa.getMapWidth(),a=a.getPartsCoord().clone();b.x===c-1&&a.x--;b.y===c-1&&a.y--;
return a.convertIntoPosition(this._wwa).getScreenTopPosition()};a.prototype.getNextJustPosition=function(b){if(void 0!==b){var m=this._partsCoord;return new a(this._wwa,m.x+g.vx[b],m.y+g.vy[b],0,0)}b=this._partsCoord.x;m=this._partsCoord.y;0>this._offsetCoord.x?b--:0<this._offsetCoord.x&&b++;0>this._offsetCoord.y?m--:0<this._offsetCoord.y&&m++;return new a(this._wwa,b,m,0,0)};a.prototype.getNextFramePosition=function(b,m,c){var d=this._partsCoord.x,e=this._partsCoord.y;m=this._offsetCoord.x+g.vx[b]*
m;b=this._offsetCoord.y+g.vy[b]*c;0>m&&(c=Math.floor(Math.abs(m)/k.CHIP_SIZE),d-=c,m=(m+c*k.CHIP_SIZE)%k.CHIP_SIZE);0>b&&(c=Math.floor(Math.abs(b)/k.CHIP_SIZE),e-=c,b=(b+c*k.CHIP_SIZE)%k.CHIP_SIZE);m>=k.CHIP_SIZE&&(d+=Math.floor(m/k.CHIP_SIZE),m=(m+k.CHIP_SIZE)%k.CHIP_SIZE);b>=k.CHIP_SIZE&&(e+=Math.floor(b/k.CHIP_SIZE),b=(b+k.CHIP_SIZE)%k.CHIP_SIZE);return new a(this._wwa,d,e,m,b)};a.prototype.isJustPosition=function(){return 0==this._offsetCoord.x&&0==this._offsetCoord.y};a.prototype.isScreenTopPosition=
function(){var a=this.getScreenTopPosition();return this.equals(a)};a.prototype.equals=function(a){return this._partsCoord.equals(a.getPartsCoord())&&this._offsetCoord.equals(a.getOffsetCoord())};a.prototype.isInCameraRange=function(a,b){void 0===b&&(b=!1);var c=a.getPosition()._partsCoord,d=this._partsCoord.x,e=this._partsCoord.y,g=b?1:0;return c.x<=d&&d<c.x+k.H_PARTS_NUM_IN_WINDOW-g&&c.y<=e&&e<c.y+k.V_PARTS_NUM_IN_WINDOW-g};a.prototype.hasLocalGate=function(){return this._wwa.getMapTypeByPosition(this)===
k.MAP_LOCALGATE||this._wwa.getObjectTypeByPosition(this)===k.OBJECT_LOCALGATE};a.prototype.clone=function(){return new a(this._wwa,this._partsCoord.x,this._partsCoord.y,this._offsetCoord.x,this._offsetCoord.y)};return a}();g.Position=b;d=function(){return function(a,b,m){this.destPos=a.clone();this.srcPos=b.clone();this.srcSize=m.clone()}}();g.Face=d;(function(a){a[a.LEFT=0]="LEFT";a[a.RIGHT=1]="RIGHT";a[a.DOWN=2]="DOWN";a[a.UP=3]="UP";a[a.LEFT_DOWN=4]="LEFT_DOWN";a[a.LEFT_UP=5]="LEFT_UP";a[a.RIGHT_DOWN=
6]="RIGHT_DOWN";a[a.RIGHT_UP=7]="RIGHT_UP";a[a.NO_DIRECTION=8]="NO_DIRECTION"})(g.Direction||(g.Direction={}));var p=g.Direction;g.vx=[-1,1,0,0,-1,-1,1,1,0];g.vy=[0,0,1,-1,1,-1,1,-1,0];g.dirToPos=[4,6,2,0];g.dirToKey=[wwa_input.KeyCode.KEY_LEFT,wwa_input.KeyCode.KEY_RIGHT,wwa_input.KeyCode.KEY_DOWN,wwa_input.KeyCode.KEY_UP];(function(a){a[a.YES=0]="YES";a[a.NO=1]="NO";a[a.UNSELECTED=2]="UNSELECTED"})(g.YesNoState||(g.YesNoState={}));(function(a){a[a.MAP=0]="MAP";a[a.OBJECT=1]="OBJECT";a[a.CHOICE_YES=
2]="CHOICE_YES";a[a.CHOICE_NO=3]="CHOICE_NO"})(g.AppearanceTriggerType||(g.AppearanceTriggerType={}));(function(a){a[a.NORMAL=0]="NORMAL";a[a.CAN_USE=1]="CAN_USE";a[a.NOT_DISAPPEAR=2]="NOT_DISAPPEAR"})(g.ItemMode||(g.ItemMode={}));(function(a){a[a.MAP=1]="MAP";a[a.OBJECT=0]="OBJECT"})(g.PartsType||(g.PartsType={}));(function(a){a[a.NONE=0]="NONE";a[a.CALL_BY_MAP_PARTS=1]="CALL_BY_MAP_PARTS";a[a.CALL_BY_OBJECT_PARTS=2]="CALL_BY_OBJECT_PARTS";a[a.CALL_BY_ITEM_USE=3]="CALL_BY_ITEM_USE";a[a.CALL_BY_QUICK_SAVE=
4]="CALL_BY_QUICK_SAVE";a[a.CALL_BY_QUICK_LOAD=5]="CALL_BY_QUICK_LOAD";a[a.CALL_BY_RESTART_GAME=6]="CALL_BY_RESTART_GAME";a[a.CALL_BY_GOTO_WWA=7]="CALL_BY_GOTO_WWA";a[a.CALL_BY_PASSWORD_SAVE=8]="CALL_BY_PASSWORD_SAVE";a[a.CALL_BY_PASSWORD_LOAD=9]="CALL_BY_PASSWORD_LOAD"})(g.ChoiceCallInfo||(g.ChoiceCallInfo={}));(function(a){a[a.QUICK_LOAD=0]="QUICK_LOAD";a[a.QUICK_SAVE=1]="QUICK_SAVE";a[a.RESTART_GAME=2]="RESTART_GAME";a[a.GOTO_WWA=3]="GOTO_WWA"})(g.SidebarButton||(g.SidebarButton={}));(function(a){a[a.UP=
0]="UP";a[a.DOWN=1]="DOWN"})(g.SpeedChange||(g.SpeedChange={}));(function(a){a[a.QUICK_LOAD=0]="QUICK_LOAD";a[a.RESTART_GAME=1]="RESTART_GAME";a[a.PASSWORD=2]="PASSWORD"})(g.LoadType||(g.LoadType={}));(function(a){a[a.STATIC=0]="STATIC";a[a.CHASE_PLAYER=1]="CHASE_PLAYER";a[a.RUN_OUT=2]="RUN_OUT";a[a.HANG_AROUND=3]="HANG_AROUND"})(g.MoveType||(g.MoveType={}));(function(a){a[a.MODE_X=0]="MODE_X";a[a.MODE_Y=1]="MODE_Y";a[a.UNDECIDED=2]="UNDECIDED"})(g.SecondCandidateMoveType||(g.SecondCandidateMoveType=
{}));g.sidebarButtonCellElementID=["cell-load","cell-save","cell-restart","cell-gotowwa"];(function(a){a[a.ASK_LINK=5]="ASK_LINK";a[a.NO_MONEY=6]="NO_MONEY";a[a.NO_ITEM=7]="NO_ITEM";a[a.USE_ITEM=8]="USE_ITEM"})(g.SystemMessage1||(g.SystemMessage1={}));(function(a){a[a.CLICKABLE_ITEM=0]="CLICKABLE_ITEM";a[a.FULL_ITEM=1]="FULL_ITEM";a[a.LOAD_SE=2]="LOAD_SE"})(g.SystemMessage2||(g.SystemMessage2={}));(function(a){a[a.UNDEFINED=0]="UNDEFINED";a[a.IMGPLAYER=1]="IMGPLAYER";a[a.IMGYESNO=2]="IMGYESNO";a[a.HPMAX=
3]="HPMAX";a[a.SAVE=4]="SAVE";a[a.ITEM=5]="ITEM";a[a.DEFAULT=6]="DEFAULT";a[a.OLDMAP=7]="OLDMAP";a[a.PARTS=8]="PARTS";a[a.MOVE=9]="MOVE";a[a.MAP=10]="MAP";a[a.DIRMAP=11]="DIRMAP";a[a.IMGFRAME=12]="IMGFRAME";a[a.IMGBOM=13]="IMGBOM";a[a.DELPLAYER=14]="DELPLAYER";a[a.FACE=15]="FACE";a[a.EFFECT=16]="EFFECT";a[a.GAMEOVER=17]="GAMEOVER";a[a.IMGCLICK=18]="IMGCLICK";a[a.STATUS=19]="STATUS";a[a.EFFITEM=20]="EFFITEM";a[a.COLOR=21]="COLOR";a[a.WAIT=22]="WAIT";a[a.SOUND=23]="SOUND"})(g.MacroType||(g.MacroType=
{}));g.macrotable={"":0,$imgplayer:1,$imgyesno:2,$hpmax:3,$save:4,$item:5,$default:6,$oldmap:7,$parts:8,$move:9,$map:10,$dirmap:11,$imgframe:12,$imgbom:13,$delplayer:14,$face:15,$effect:16,$gameover:17,$imgclick:18,$status:19,$effitem:20,$color:21,$wait:22,$sound:23};(function(a){a[a.ENERGY=0]="ENERGY";a[a.STRENGTH=1]="STRENGTH";a[a.DEFENCE=2]="DEFENCE";a[a.GOLD=3]="GOLD";a[a.MOVES=4]="MOVES"})(g.MacroStatusIndex||(g.MacroStatusIndex={}));(function(a){a[a.ENERGY=0]="ENERGY";a[a.STRENGTH=1]="STRENGTH";
a[a.DEFENCE=2]="DEFENCE";a[a.GOLD=3]="GOLD";a[a.WIDE_CELL_ROW=4]="WIDE_CELL_ROW";a[a.ITEM_BG=5]="ITEM_BG";a[a.MAIN_FRAME=6]="MAIN_FRAME"})(g.MacroImgFrameIndex||(g.MacroImgFrameIndex={}));(function(a){a[a.DECISION=1]="DECISION";a[a.ATTACK=3]="ATTACK";a[a.BGM_LB=70]="BGM_LB";a[a.NO_SOUND=99]="NO_SOUND"})(g.SystemSound||(g.SystemSound={}));g.speedList=[2,5,8,10];g.speedNameList=["\u4f4e\u901f","\u6e96\u4f4e\u901f","\u4e2d\u901f","\u9ad8\u901f"];var k=function(){function a(){}a.VERSION_WWAJS="W3.15-G";
a.WWA_HOME="http://wwajp.com";a.ITEMBOX_SIZE=12;a.MAP_ATR_MAX=60;a.OBJ_ATR_MAX=60;a.OLD_MAP_ATR_MAX=40;a.OLD_OBJ_ATR_MAX=40;a.ATR_TYPE=3;a.ATR_MODE=4;a.ATR_STRING=5;a.ATR_X=6;a.ATR_Y=7;a.ATR_X2=8;a.ATR_Y2=9;a.ATR_ENERGY=10;a.ATR_STRENGTH=11;a.ATR_DEFENCE=12;a.ATR_GOLD=13;a.ATR_ITEM=14;a.ATR_NUMBER=15;a.ATR_JUMP_X=16;a.ATR_MOVE=16;a.ATR_JUMP_Y=17;a.ATR_SOUND=19;a.ATR_APPERANCE_BASE=20;a.REL_ATR_APPERANCE_ID=0;a.REL_ATR_APPERANCE_X=1;a.REL_ATR_APPERANCE_Y=2;a.REL_ATR_APPERANCE_TYPE=3;a.REL_ATR_APPERANCE_UNIT_LENGTH=
4;a.ATR_RANDOM_BASE=10;a.RANDOM_ATR_NUM=10;a.RANDOM_ITERATION_MAX=10;a.MAP_STREET=0;a.MAP_WALL=1;a.MAP_LOCALGATE=2;a.MAP_URLGATE=4;a.OBJECT_NORMAL=0;a.OBJECT_MESSAGE=1;a.OBJECT_URLGATE=2;a.OBJECT_STATUS=3;a.OBJECT_ITEM=4;a.OBJECT_DOOR=5;a.OBJECT_MONSTER=6;a.OBJECT_SCORE=11;a.OBJECT_SELL=14;a.OBJECT_BUY=15;a.OBJECT_RANDOM=16;a.OBJECT_SELECT=17;a.OBJECT_LOCALGATE=18;a.SYSTEM_MESSAGE_NUM=20;a.IMGPOS_DEFAULT_YESNO_X=3;a.IMGPOS_DEFAULT_YESNO_Y=1;a.IMGRELPOS_YESNO_YES_X=0;a.IMGRELPOS_YESNO_NO_X=1;a.IMGRELPOS_YESNO_YESP_X=
2;a.IMGRELPOS_YESNO_NOP_X=3;a.IMGPOS_DEFAULT_PLAYER_X=2;a.IMGPOS_DEFAULT_PLAYER_Y=0;a.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_X=0;a.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_Y=0;a.IMGPOS_DEFAULT_FRAME_X=0;a.IMGPOS_DEFAULT_FRAME_Y=1;a.IMGPOS_DEFAULT_BATTLE_EFFECT_X=3;a.IMGPOS_DEFAULT_BATTLE_EFFECT_Y=3;a.DEFAULT_DISABLE_SAVE=!1;a.DEFAULT_OLDMAP=!1;a.DEFAULT_OBJECT_NO_COLLAPSE=!1;a.SPLASH_SCREEN_DISP_MILLS=100;a.DEFAULT_FRAME_INTERVAL=20;a.GAMEOVER_FRAME_INTERVAL=50;a.YESNO_PRESS_DISP_FRAME_NUM=20;a.CHIP_SIZE=40;
a.MAP_WINDOW_WIDTH=440;a.MAP_WINDOW_HEIGHT=440;a.H_PARTS_NUM_IN_WINDOW=a.MAP_WINDOW_WIDTH/a.CHIP_SIZE;a.V_PARTS_NUM_IN_WINDOW=a.MAP_WINDOW_HEIGHT/a.CHIP_SIZE;a.DEFAULT_SPEED_INDEX=2;a.MIN_SPEED_INDEX=0;a.MAX_SPEED_INDEX=g.speedList.length-1;a.ANIMATION_REP_HALF_FRAME=22;a.PLAYER_LOOKING_AROUND_START_FRAME=4*a.ANIMATION_REP_HALF_FRAME;a.RELATIVE_COORD_BIAS=1E4;a.RELATIVE_COORD_LOWER=a.RELATIVE_COORD_BIAS-1E3;a.PLAYER_COORD=a.RELATIVE_COORD_BIAS-1E3;a.LOCALGATE_PLAYER_WAIT_FRAME=5;a.STATUS_CHANGED_EFFECT_FRAME_NUM=
20;a.PASSABLE_OBJECT=1;a.APPERANCE_PARTS_MIN_INDEX=0;a.APPERANCE_PARTS_MAX_INDEX=9;a.APPERANCE_PARTS_MIN_INDEX_NO=5;a.APPERANCE_PARTS_MAX_INDEX_YES=4;a.FADEOUT_SPEED=8;a.STATUS_MINUS_BORDER=3E4;a.ITEMBOX_IS_FULL=-1;a.BATTLE_INTERVAL_FRAME_NUM=10;a.BATTLE_SPEED_CHANGE_TURN_NUM=40;a.RANDOM_MOVE_ITERATION_NUM=50;a.BATTLE_ESTIMATE_MONSTER_TYPE_MAX=8;a.SOUND_MAX=100;a.ITEM_BORDER_IMG_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAArklEQVRYR+2Y0QqAIAxFt///aENJHwxxuJUSxzeh3S7HXaNpEkly4FIRzba0GEyHeVTN7jqDWvb7V4Y1NLibZIY0NbiL5G3MZLCe / 1fn3XJgJYjB7mgg6O1VCEKwXo79JeklY62nB62kRs9BEIKkeNIDhISQEBJC4k0BBCF4D7D4cV9shf99ixdB + MrM0y3fa3zV05D45GOqhwPMGPkYlccIOEY2VKUN0UNVXxC7ADj7mDi9aFZZAAAAAElFTkSuQmCC";
a.LOAD_STAGE_MAX_EXCEPT_AUDIO=7;a.WWA_STYLE_TAG_ID="wwa-additional-style";a.DEFAULT_FRAME_COLOR_R=255;a.DEFAULT_FRAME_COLOR_G=255;a.DEFAULT_FRAME_COLOR_B=255;a.DEFAULT_FRAMEOUT_COLOR_R=96;a.DEFAULT_FRAMEOUT_COLOR_G=96;a.DEFAULT_FRAMEOUT_COLOR_B=96;a.DEFAULT_STRBACK_COLOR_R=0;a.DEFAULT_STRBACK_COLOR_G=0;a.DEFAULT_STRBACK_COLOR_B=0;a.DEFAULT_STATUS_COLOR_R=0;a.DEFAULT_STATUS_COLOR_G=0;a.DEFAULT_STATUS_COLOR_B=0;a.KEYPRESS_MESSAGE_CHANGE_FRAME_NUM=20;a.WWAP_SERVER="http://wwawing.com/wwap";a.WWAP_SERVER_AUDIO_DIR=
"audio";a.WWAP_SERVER_TITLE_IMG="cover_p.gif";a.WWAP_SERVER_LOADER_NO_WORKER="wwaload.noworker.js";return a}();g.WWAConsts=k;d=function(){return function(){}}();g.LoaderResponse=d;d=function(){return function(){}}();g.LoaderError=d;d=function(){return function(){}}();g.LoaderProgress=d;(function(a){a[a.INIT=0]="INIT";a[a.MAP_LOAD=1]="MAP_LOAD";a[a.OBJ_LOAD=2]="OBJ_LOAD";a[a.MAP_ATTR=3]="MAP_ATTR";a[a.OBJ_ATTR=4]="OBJ_ATTR";a[a.RAND_PARTS=5]="RAND_PARTS";a[a.MESSAGE=6]="MESSAGE";a[a.GAME_INIT=7]="GAME_INIT";
a[a.AUDIO=8]="AUDIO"})(g.LoadStage||(g.LoadStage={}));g.loadMessages="\u30ed\u30fc\u30c9\u306e\u6e96\u5099\u3092\u3057\u3066\u3044\u307e\u3059\u3002;\u80cc\u666f\u30d1\u30fc\u30c4\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002;\u7269\u4f53\u30d1\u30fc\u30c4\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u5c5e\u6027\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u5c5e\u6027\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u30e9\u30f3\u30c0\u30e0\u30d1\u30fc\u30c4\u3092\u7f6e\u63db\u3057\u3066\u3044\u307e\u3059\u3002;\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;Welcome to WWA Wing!".split(";");
(function(a){a[a.COLOR_FRAME=0]="COLOR_FRAME";a[a.COLOR_FRAMEOUT=1]="COLOR_FRAMEOUT";a[a.COLOR_STR=2]="COLOR_STR";a[a.COLOR_STATUS_STR=4]="COLOR_STATUS_STR"})(g.ChangeStyleType||(g.ChangeStyleType={}));(function(a){a[a.MESSAGE_WINDOW=0]="MESSAGE_WINDOW";a[a.SIDEBAR=1]="SIDEBAR"})(g.SelectorType||(g.SelectorType={}));d=function(){return function(){this.checkString=this.checkOriginalMapString=this.statusColorB=this.statusColorG=this.statusColorR=this.fontColorB=this.fontColorG=this.fontColorR=this.frameOutColorB=
this.frameOutColorG=this.frameOutColorR=this.frameColorB=this.frameColorG=this.frameColorR=this.imgClickY=this.imgClickX=this.bgm=this.delPlayerFlag=this.objectNoCollapseDefaultFlag=this.compatibleForOldMapFlag=this.disableSaveFlag=this.clickableItemSignImgPosY=this.clickableItemSignImgPosX=this.playerImgPosY=this.playerImgPosX=this.yesnoImgPosY=this.yesnoImgPosX=this.moves=this.systemMessage=this.mapCGName=this.charCGName=this.worldPassNumber=this.worldName=this.message=this.worldPassword=this.objectAttribute=
this.mapAttribute=this.mapObjectCompressed=this.mapCompressed=this.mapObject=this.map=this.messageNum=this.mapWidth=this.itemBox=this.statusGold=this.statusDefence=this.statusStrength=this.statusEnergy=this.statusEnergyMax=this.isOldMap=this.objPartsMax=this.mapPartsMax=this.playerY=this.playerX=this.gameoverY=this.gameoverX=this.version=void 0}}();g.WWAData=d})(wwa_data||(wwa_data={}));var wwa_parts_player;
(function(g){var d=wwa_data.Direction,e=wwa_data.WWAConsts,b=function(){function a(a){this._position=a}a.prototype.getPosition=function(){return this._position};return a}(),p=function(a){function b(m){a.call(this,m)}__extends(b,a);return b}(b);g.PartsObject=p;b=function(a){function b(m){a.call(this,m)}__extends(b,a);return b}(b);g.PartsMap=b;var k;(function(a){a[a.CONTROLLABLE=0]="CONTROLLABLE";a[a.MOVING=1]="MOVING";a[a.CAMERA_MOVING=2]="CAMERA_MOVING";a[a.MESSAGE_WAITING=3]="MESSAGE_WAITING";a[a.LOCALGATE_JUMPED=
4]="LOCALGATE_JUMPED";a[a.BATTLE=5]="BATTLE";a[a.ESTIMATE_WINDOW_WAITING=6]="ESTIMATE_WINDOW_WAITING";a[a.PASSWORD_WINDOW_WAITING=7]="PASSWORD_WINDOW_WAITING"})(k||(k={}));p=function(a){function b(m,c,x,g,p){this._status=g;this._equipStatus=new wwa_data.EquipmentStatus(0,0);this._itemBox=Array(e.ITEMBOX_SIZE);this._itemBoxElement=Array(e.ITEMBOX_SIZE);this._itemUsingEvent=Array(e.ITEMBOX_SIZE);for(g=0;g<this._itemBox.length;g++)this._itemBox[g]=0,this._itemBoxElement[g]=wwa_util.$qsh("#item"+g+">.item-disp");
this.updateItemBox();this._energyMax=p;this._dir=d.DOWN;this._wwa=m;this._state=k.CONTROLLABLE;this._camera=x;this._isPartsEventExecuted=!1;this._energyValueElement=wwa_util.$qsh("#disp-energy>.status-value-box");this._strengthValueElement=wwa_util.$qsh("#disp-strength>.status-value-box");this._defenceValueElement=wwa_util.$qsh("#disp-defence>.status-value-box");this._goldValueElement=wwa_util.$qsh("#disp-gold>.status-value-box");this._isClickableItemGot=this._isReadyToUseItem=!1;this._moveObjectAutoExecTimer=
this._moveMacroWaitingRemainMoves=this._moves=0;this.updateStatusValueBox();this._afterMoveMacroFlag=this._partsAppeared=!1;this._isPreparedForLookingAround=!0;this._lookingAroundTimer=e.PLAYER_LOOKING_AROUND_START_FRAME;this._speedIndex=e.DEFAULT_SPEED_INDEX;a.call(this,c)}__extends(b,a);b.prototype.move=function(){if(this.isControllable())this.controll(this._dir);else if(this._state===k.CAMERA_MOVING){try{this._camera.move(this._dir)}catch(a){}this._isOnCameraStopPosition()&&(this._state=k.CONTROLLABLE)}else if(this._state===
k.MOVING){try{var b=this._position.getNextFramePosition(this._dir,wwa_data.speedList[this._speedIndex],wwa_data.speedList[this._speedIndex])}catch(a){}b.isJustPosition()&&(this._state=k.CONTROLLABLE,this._moves++,this._isPartsEventExecuted=!1,this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=void 0);this._position=b}};b.prototype.controll=function(a){var c,b;if(this.isControllable()){this._isPreparedForLookingAround=!1;this._dir=a;try{c=this._position.getNextFramePosition(this._dir,wwa_data.speedList[this._speedIndex],
wwa_data.speedList[this._speedIndex]),b=this._position.getNextJustPosition(a)}catch(d){return}if(this._isOnCameraMovingPosition()){if(0!==this._wwa.getMapIdByPosition(b)||this._wwa.isOldMap()||this._wwa.debug)try{this._camera.move(this._dir),this._state=k.CAMERA_MOVING}catch(d){this._state=k.CONTROLLABLE}}else this.canMoveTo(b)?(this._position=c,this._state=k.MOVING,this._wwa.getMapAttributeByPosition(this._position.getNextJustPosition(a),e.ATR_TYPE)!==e.MAP_LOCALGATE&&this._wwa.moveObjects(!0)):
(this._wwa.getMapTypeByPosition(b)===e.MAP_WALL&&this._wwa.checkMap(b.getPartsCoord()),this._wwa.checkObject(b.getPartsCoord()))}};b.prototype.canMoveTo=function(a){if(null===a)return!1;if(this._wwa.debug)return!0;this._wwa.getMapWidth();a.getPartsCoord();a.getOffsetCoord();return 0===this._wwa.getMapIdByPosition(a)&&!this._wwa.isOldMap()||this._wwa.getMapTypeByPosition(a)===e.MAP_WALL?!1:0===this._wwa.getObjectIdByPosition(a)||this._wwa.getObjectTypeByPosition(a)===e.OBJECT_NORMAL&&this._wwa.getObjectAttributeByPosition(a,
e.ATR_MODE)===e.PASSABLE_OBJECT?!0:this._wwa.getObjectTypeByPosition(a)===e.OBJECT_DOOR&&this._wwa.getObjectAttributeByPosition(a,e.ATR_NUMBER)===e.PASSABLE_OBJECT?this.hasItem(this._wwa.getObjectAttributeByPosition(a,e.ATR_ITEM))?!1:!0:!1};b.prototype.isMoving=function(){return this._state==k.MOVING||this._state==k.CAMERA_MOVING};b.prototype._isOnCameraMovingPosition=function(){var a=this._camera.getPosition().getPartsCoord(),c=this.getPosition().getPartsCoord();return c.x-a.x===e.H_PARTS_NUM_IN_WINDOW-
1&&this._dir===d.RIGHT||c.x===a.x&&this._dir===d.LEFT||c.y-a.y===e.V_PARTS_NUM_IN_WINDOW-1&&this._dir===d.DOWN||c.y===a.y&&this._dir===d.UP};b.prototype._isOnCameraStopPosition=function(){var a=this._camera.getPosition().getPartsCoord(),c=this.getPosition().getPartsCoord();return c.x-a.x===e.H_PARTS_NUM_IN_WINDOW-1&&this._dir===d.LEFT||c.x===a.x&&this._dir===d.RIGHT||c.y-a.y===e.V_PARTS_NUM_IN_WINDOW-1&&this._dir===d.UP||c.y===a.y&&this._dir===d.DOWN};b.prototype.isControllable=function(){var a=this._afterMoveMacroFlag;
this._afterMoveMacroFlag=!1;return this._state===k.CONTROLLABLE&&!this._partsAppeared&&(this._wwa.getMapTypeByPosition(this._position)!==e.MAP_LOCALGATE&&this._wwa.getMapTypeByPosition(this._position)!==e.MAP_URLGATE||!this._wwa.isPrevFrameEventExecuted())&&0===this._moveMacroWaitingRemainMoves&&0===this._moveObjectAutoExecTimer&&!a&&this._wwa.canInput()};b.prototype.getCopyOfItemBox=function(){return this._itemBox.slice()};b.prototype.getDir=function(){return this._dir};b.prototype.getEnergyMax=
function(){return this._energyMax};b.prototype.isJumped=function(){return this._state===k.LOCALGATE_JUMPED};b.prototype.setMessageWaiting=function(){this._state=k.MESSAGE_WAITING};b.prototype.isWaitingMessage=function(){return this._state===k.MESSAGE_WAITING};b.prototype.clearMessageWaiting=function(){this._state===k.MESSAGE_WAITING&&(this._state=k.CONTROLLABLE,this._isPartsEventExecuted=!0,this._isPreparedForLookingAround&&(this._lookingAroundTimer=e.PLAYER_LOOKING_AROUND_START_FRAME))};b.prototype.setEstimateWindowWating=
function(){this._state=k.ESTIMATE_WINDOW_WAITING};b.prototype.isWatingEstimateWindow=function(){return this._state===k.ESTIMATE_WINDOW_WAITING};b.prototype.clearEstimateWindowWaiting=function(){this._state===k.ESTIMATE_WINDOW_WAITING&&(this._state=k.CONTROLLABLE)};b.prototype.setPasswordWindowWating=function(){this._state=k.PASSWORD_WINDOW_WAITING};b.prototype.isWaitingPasswordWindow=function(){return this._state===k.PASSWORD_WINDOW_WAITING};b.prototype.clearPasswordWindowWaiting=function(){this._state===
k.PASSWORD_WINDOW_WAITING&&(this._state=k.CONTROLLABLE)};b.prototype.isPartsEventExecuted=function(){return this._isPartsEventExecuted};b.prototype.resetEventExecutionInfo=function(){this._isPartsEventExecuted=!1};b.prototype.getLastExecPartsIDOnSamePosition=function(a){return a===wwa_data.PartsType.MAP?this._samePosLastExecutedMapID:this._samePosLastExecutedObjID};b.prototype.setLastExecInfoOnSamePosition=function(a,c){a===wwa_data.PartsType.MAP?this._samePosLastExecutedMapID=c:this._samePosLastExecutedObjID=
c};b.prototype.processAfterJump=function(){this._state===k.LOCALGATE_JUMPED&&0===--this._jumpWaitFramesRemain&&(this._state=k.CONTROLLABLE)};b.prototype.jumpTo=function(a){var c=this._camera.getPosition();this.getPosition();if(this._position.equals(a))return!1;this._position=a;a.isInCameraRange(this._camera,!0)||this._camera.reset(a);this._state=k.LOCALGATE_JUMPED;this._jumpWaitFramesRemain=e.LOCALGATE_PLAYER_WAIT_FRAME;this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=void 0;a.hasLocalGate()?
this._dir=d.DOWN:a.getPartsCoord().y<=this._wwa.getMapWidth()-2&&a.getNextJustPosition(d.DOWN).hasLocalGate()?this._dir=d.UP:1<=a.getPartsCoord().y&&a.getNextJustPosition(d.UP).hasLocalGate()?this._dir=d.DOWN:a.getPartsCoord().x<=this._wwa.getMapWidth()-2&&a.getNextJustPosition(d.RIGHT).hasLocalGate()?this._dir=d.LEFT:1<=a.getPartsCoord().x&&a.getNextJustPosition(d.LEFT).hasLocalGate()?this._dir=d.RIGHT:this._dir=d.DOWN;this._camera.getPosition().equals(c)||(this._isPreparedForLookingAround=!0,this._lookingAroundTimer=
e.PLAYER_LOOKING_AROUND_START_FRAME);return!0};b.prototype.systemJumpTo=function(a){this._position=a;this._camera.reset(a);this._camera.resetPreviousPosition();this._state=k.LOCALGATE_JUMPED;this._jumpWaitFramesRemain=e.LOCALGATE_PLAYER_WAIT_FRAME;this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=void 0;this._dir=d.DOWN;this._isPreparedForLookingAround=!0;this._lookingAroundTimer=e.PLAYER_LOOKING_AROUND_START_FRAME};b.prototype.addStatusAll=function(a){this._status.add(a);this.isDead()&&
(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox();return this._status};b.prototype.setEnergyMax=function(a){this._energyMax=a;0!==a&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox();return a};b.prototype.setEnergy=function(a){this._status.energy=a;this.isDead()&&(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax));
this.updateStatusValueBox();return a};b.prototype.damage=function(a){this._status.energy=Math.max(0,this._status.energy-a);this.isDead()&&(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox()};b.prototype.setStrength=function(a){return this._status.strength=a};b.prototype.setDefence=function(a){this._status.defence=a;this.updateStatusValueBox();return a};b.prototype.setGold=function(a){this._status.gold=a;this.updateStatusValueBox();
return a};b.prototype.getStatus=function(){return this._status.plus(this._equipStatus)};b.prototype.getStatusWithoutEquipments=function(){return this._status.plus(new wwa_data.EquipmentStatus(0,0))};b.prototype.updateStatusValueBox=function(){var a=this._status.plus(this._equipStatus),c=a.strength,b=a.defence,d=a.gold;this._energyValueElement.textContent=a.energy+"";this._strengthValueElement.textContent=c+"";this._defenceValueElement.textContent=b+"";this._goldValueElement.textContent=d+""};b.prototype.updateItemBox=
function(){for(var a,c,b=0;b<this._itemBoxElement.length;b++)0===this._itemBox[b]?this._itemBoxElement[b].style.backgroundPosition="-40px 0px":(a=this._wwa.getObjectCropXById(this._itemBox[b]),c=this._wwa.getObjectCropYById(this._itemBox[b]),this._itemBoxElement[b].style.backgroundPosition="-"+a+"px -"+c+"px")};b.prototype.isDead=function(){return 0>=this._status.energy};b.prototype.addItem=function(a,c,b){void 0===c&&(c=0);void 0===b&&(b=!1);var d;d=this._wwa.getObjectAttributeById(a,e.ATR_NUMBER);
0===c&&0!==d&&(c=d);if(0===c){if(0===a)return;c=this._getBlankItemPos();if(c===e.ITEMBOX_IS_FULL)throw Error("\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002");this._forceSetItemBox(c,a)}else if(!1===b)if(d=this._itemBox[c-1],this._wwa.getObjectAttributeById(d,e.ATR_NUMBER)!==this._wwa.getObjectAttributeById(a,e.ATR_NUMBER))if(b=this._getBlankItemPos(),b!==e.ITEMBOX_IS_FULL)this._forceSetItemBox(b,d),this._forceSetItemBox(c,a);else throw Error("\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002");
else this._forceSetItemBox(c,a);else this._forceSetItemBox(c,a);this._updateEquipmentStatus();this.updateItemBox()};b.prototype._forceSetItemBox=function(a,b){var d=this,x=wwa_util.$qsh("#item"+(a-1)+">.item-click-border"),k=this._wwa.getObjectAttributeById(b,e.ATR_MODE);this.removeItemByItemPosition(a);this._itemBox[a-1]=b;0!==b&&k!==wwa_data.ItemMode.NORMAL&&(k=this._wwa.getSystemMessageById(wwa_data.SystemMessage2.CLICKABLE_ITEM),this._isClickableItemGot||("BLANK"!==k&&this._wwa.setMessageQueue(""===
k?"\u3053\u306e\u30a2\u30a4\u30c6\u30e0\u306f\u53f3\u306e\u30dc\u30c3\u30af\u30b9\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3053\u3068\u3067\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002\n\u4f7f\u7528\u3067\u304d\u308b\u30a2\u30a4\u30c6\u30e0\u306f\u8272\u67a0\u3067\u56f2\u307e\u308c\u307e\u3059\u3002":k,!1,!0),this._isClickableItemGot=!0),x.style.display="block",function(a){d._itemUsingEvent[a-1]=function(){if(d.isControllable())d._wwa.onselectitem(a)}}(a),x.addEventListener("click",this._itemUsingEvent[a-
1]))};b.prototype._getBlankItemPos=function(){var a;for(a=1;a<this._itemBox.length+1;a++)if(0===this._itemBox[a-1])return a;return e.ITEMBOX_IS_FULL};b.prototype._updateEquipmentStatus=function(){var a,b=new wwa_data.EquipmentStatus(0,0);for(a=0;a<e.ITEMBOX_SIZE;a++)0!==this._itemBox[a]&&(b.strength+=this._wwa.getObjectAttributeById(this._itemBox[a],e.ATR_STRENGTH),b.defence+=this._wwa.getObjectAttributeById(this._itemBox[a],e.ATR_DEFENCE));a=b.minus(this._equipStatus);this._wwa.setStatusChangedEffect(a);
this._equipStatus=b;this.updateStatusValueBox()};b.prototype.hasItem=function(a){for(var b=0;b<e.ITEMBOX_SIZE;b++)if(this._itemBox[b]===a)return!0;return!1};b.prototype.canUseItem=function(a){a=this._itemBox[a-1];return 0===a||this._wwa.getObjectAttributeById(a,e.ATR_MODE)===wwa_data.ItemMode.NORMAL?!1:!0};b.prototype.useItem=function(){var a;a=this._itemBox[this._readyToUseItemPos-1];this._wwa.getObjectAttributeById(a,e.ATR_MODE)!==wwa_data.ItemMode.NOT_DISAPPEAR&&this.removeItemByItemPosition(this._readyToUseItemPos);
var b=wwa_util.$id("item"+(this._readyToUseItemPos-1));setTimeout(function(){b.classList.contains("onpress")&&b.classList.remove("onpress")},e.DEFAULT_FRAME_INTERVAL);this._isReadyToUseItem=!1;this._readyToUseItemPos=void 0;return a};b.prototype.canHaveMoreItems=function(){return this._getBlankItemPos()!==e.ITEMBOX_IS_FULL};b.prototype.removeItemByItemPosition=function(a){var b;0!==this._itemBox[a-1]&&(this._wwa.getObjectAttributeById(this._itemBox[a-1],e.ATR_MODE)!==wwa_data.ItemMode.NORMAL&&(b=
wwa_util.$qsh("#item"+(a-1)+">.item-click-border"),b.removeEventListener("click",this._itemUsingEvent[a-1]),b.style.display="none"),this._itemBox[a-1]=0,this._updateEquipmentStatus(),this.updateItemBox())};b.prototype.removeItemByPartsID=function(a){if(!this.hasItem(a))throw Error("\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3063\u3066\u3044\u306a\u3044");for(var b=0;b<e.ITEMBOX_SIZE;b++)if(this._itemBox[b]===a){this._wwa.getObjectAttributeById(this._itemBox[b],e.ATR_MODE)!==wwa_data.ItemMode.NORMAL&&(a=
wwa_util.$qsh("#item"+b+">.item-click-border"),a.removeEventListener("click",this._itemUsingEvent[b]),a.style.display="none");this._itemBox[b]=0;this._updateEquipmentStatus();this.updateItemBox();break}};b.prototype.clearItemBox=function(){for(var a=1;a<=e.ITEMBOX_SIZE;a++)this.removeItemByItemPosition(a);this._updateEquipmentStatus();this.updateItemBox()};b.prototype.hasGold=function(a){return this._status.gold>=a};b.prototype.payGold=function(a){if(!this.hasGold(a))throw Error("\u304a\u91d1\u304c\u8db3\u308a\u306a\u3044");
this.setGold(this._status.gold-a)};b.prototype.earnGold=function(a){this.setGold(this._status.gold+a)};b.prototype.setPartsAppearedFlag=function(){this._partsAppeared=!0};b.prototype.clearPartsAppearedFlag=function(){this._partsAppeared=!1};b.prototype.isPartsAppearedTime=function(){return!0===this._partsAppeared};b.prototype.startBattleWith=function(a){this._isPlayerTurn=!0;this._battleFrameCounter=e.BATTLE_INTERVAL_FRAME_NUM;this._battleTurnNum=0;this._enemy=a;this._state=k.BATTLE};b.prototype.isFighting=
function(){return this._state===k.BATTLE};b.prototype.isTurn=function(){return this._isPlayerTurn};b.prototype.getTurnNum=function(){return this._battleTurnNum};b.prototype.isBattleStartFrame=function(){return this._battleFrameCounter===e.BATTLE_INTERVAL_FRAME_NUM&&0===this._battleTurnNum};b.prototype.fight=function(){if(!this.isFighting())throw Error("\u30d0\u30c8\u30eb\u304c\u958b\u59cb\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002");0===this._battleTurnNum&&this._battleFrameCounter===e.BATTLE_INTERVAL_FRAME_NUM&&
this._wwa.showMonsterWindow();if(!(0<--this._battleFrameCounter)){this._battleTurnNum++;this._speedIndex===e.MAX_SPEED_INDEX||this._battleTurnNum>e.BATTLE_SPEED_CHANGE_TURN_NUM?(1===this._battleTurnNum&&this._wwa.playSound(wwa_data.SystemSound.ATTACK),this._battleFrameCounter=1):(this._battleFrameCounter=e.BATTLE_INTERVAL_FRAME_NUM,this._wwa.playSound(wwa_data.SystemSound.ATTACK));var a=this.getStatus(),b=this._enemy.status;if(this._isPlayerTurn){if(a.strength>b.defence||a.defence<b.strength){b.energy>
a.strength-b.defence?a.strength>b.defence&&this._enemy.damage(a.strength-b.defence):(this._wwa.playSound(this._wwa.getObjectAttributeById(this._enemy.partsID,e.ATR_SOUND)),this.earnGold(b.gold),this._wwa.setStatusChangedEffect(new wwa_data.Status(0,0,0,b.gold)),0!==this._enemy.item?this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,this._enemy.item,this._enemy.position):this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,0,this._enemy.position),this._wwa.appearParts(this._enemy.position,wwa_data.AppearanceTriggerType.OBJECT,
this._enemy.partsID),this._state=k.CONTROLLABLE,this._wwa.setMessageQueue(this._enemy.message,!1,!1),this._enemy.battleEndProcess(),this._battleTurnNum=0,this._enemy=null);this._isPlayerTurn=!1;return}this._enemy.battleEndProcess();this._wwa.setMessageQueue("\u76f8\u624b\u306e\u9632\u5fa1\u80fd\u529b\u304c\u9ad8\u3059\u304e\u308b\uff01",!1,!0);this._battleTurnNum=0;this._enemy=null}else b.strength>a.defence&&(a.energy>b.strength-a.defence?this.damage(b.strength-a.defence):(this.setEnergy(0),this._enemy.battleEndProcess(),
this._state=k.CONTROLLABLE,this._battleTurnNum=0,this._enemy=null,this._wwa.gameover()));this._isPlayerTurn=!0}};b.prototype.readyToUseItem=function(a){var b;if(!this.canUseItem(a))throw Error("\u30a2\u30a4\u30c6\u30e0\u304c\u306a\u3044\u304b\u3001\u30a2\u30a4\u30c6\u30e0\u304c\u4f7f\u3048\u307e\u305b\u3093\u3002");b=this._itemBox[a-1];this._wwa.getObjectAttributeById(b,e.ATR_STRING);this._wwa.appearParts(this._position.getPartsCoord(),wwa_data.AppearanceTriggerType.OBJECT,b);this._readyToUseItemPos=
a;this._isReadyToUseItem=!0};b.prototype.isReadyToUseItem=function(){return this._isReadyToUseItem};b.prototype.getDrawingCenterPosition=function(){var a=this._position.getPartsCoord(),b=this._position.getOffsetCoord(),d=this._camera.getPosition(),x=d.getPartsCoord(),d=d.getOffsetCoord();return new wwa_data.Coord((a.x-x.x)*e.CHIP_SIZE+b.x-d.x+e.CHIP_SIZE/2,(a.y-x.y)*e.CHIP_SIZE+b.y-d.y+e.CHIP_SIZE/2)};b.prototype.getMoveCount=function(){return this._moves};b.prototype.setMoveCount=function(a){return this._moves=
a};b.prototype.isMoveObjectAutoExecTime=function(){return 0===this._moveObjectAutoExecTimer};b.prototype.setMoveMacroWaiting=function(a){0>a||(this._moveMacroWaitingRemainMoves=a,this._moveObjectAutoExecTimer=0)};b.prototype.resetMoveObjectAutoExecTimer=function(){this._moveObjectAutoExecTimer=e.CHIP_SIZE/wwa_data.speedList[this._speedIndex];this._moveMacroWaitingRemainMoves--};b.prototype.decrementMoveObjectAutoExecTimer=function(){0<=this._moveMacroWaitingRemainMoves&&0<this._moveObjectAutoExecTimer&&
(this._moveObjectAutoExecTimer--,0===this._moveMacroWaitingRemainMoves&&0===this._moveObjectAutoExecTimer&&(this._afterMoveMacroFlag=!0));return 0};b.prototype.isWaitingMoveMacro=function(){return 0!==this._moveMacroWaitingRemainMoves||0!==this._moveObjectAutoExecTimer};b.prototype.decrementLookingAroundTimer=function(){return this._isPreparedForLookingAround&&0<this._lookingAroundTimer?--this._lookingAroundTimer:0};b.prototype.isLookingAround=function(){return this._isPreparedForLookingAround&&0===
this._lookingAroundTimer};b.prototype.getSpeedIndex=function(){return this._speedIndex};b.prototype.speedUp=function(){return this._speedIndex=Math.min(e.MAX_SPEED_INDEX,this._speedIndex+1)};b.prototype.speedDown=function(){return this._speedIndex=Math.max(e.MIN_SPEED_INDEX,this._speedIndex-1)};return b}(p);g.Player=p})(wwa_parts_player||(wwa_parts_player={}));var wwa_camera;
(function(g){var d=wwa_data.WWAConsts,e=function(){function b(b){this._position=null;this.reset(b)}b.prototype.setPlayer=function(b){this._player=b};b.prototype.isResetting=function(){return this._isResetting};b.prototype.getPosition=function(){return this._position};b.prototype.getPreviousPosition=function(){return this._positionPrev};b.prototype.resetPreviousPosition=function(){this._positionPrev=null};b.prototype.move=function(b){var k=wwa_data.speedList[this._player.getSpeedIndex()];this._position=
this._position.getNextFramePosition(b,k*(d.H_PARTS_NUM_IN_WINDOW-1),k*(d.V_PARTS_NUM_IN_WINDOW-1))};b.prototype.getTransitionStepNum=function(){return this._transitionStep};b.prototype.advanceTransitionStepNum=function(){++this._transitionStep;this._transitionStep===wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW&&(this._isResetting=!1,this._transitionStep=0);return this._transitionStep};b.prototype.isFinalStep=function(){if(!1===this._isResetting)throw Error("\u30ea\u30bb\u30c3\u30c8\u4e2d\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002");
return this._transitionStep===wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW-1};b.prototype.reset=function(b){this._positionPrev=this._position;this._position=b.getDefaultCameraPosition();this._transitionStep=0;this._isResetting=!0};return b}();g.Camera=e})(wwa_camera||(wwa_camera={}));var wwa_cgmanager;
(function(g){var d=wwa_data.WWAConsts,e=function(){function b(b,d,a,x){this._isLoaded=!1;this._ctx=b;this._ctxSub=d;this._fileName=a;this._loadCompleteCallBack=x;this._load()}b.prototype._load=function(){var b=this;this._isLoaded||(this._image=new Image,this._image.addEventListener("load",function(){b._loadCompleteCallBack()}),this._image.addEventListener("error",function(){throw Error("Image Load Failed!!\nfile name:"+b._fileName);}),this._image.src=this._fileName,this._isLoaded=!0)};b.prototype.drawCanvas=
function(b,k,a,x,m){void 0===m&&(m=!1);m=m?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");m.drawImage(this._image,d.CHIP_SIZE*b,d.CHIP_SIZE*k,d.CHIP_SIZE,d.CHIP_SIZE,a,x,d.CHIP_SIZE,d.CHIP_SIZE)};b.prototype.drawCanvasWithSize=function(b,k,a,x,m,c,e){void 0===e&&(e=!1);e=e?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");e.drawImage(this._image,d.CHIP_SIZE*b,d.CHIP_SIZE*k,d.CHIP_SIZE*a,d.CHIP_SIZE*x,m,c,d.CHIP_SIZE*a,d.CHIP_SIZE*x)};b.prototype.drawCanvasWithUpperYLimit=
function(b,k,a,x,m,c){void 0===c&&(c=!1);c=c?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");m=Math.max(0,x+d.CHIP_SIZE-m);m>=d.CHIP_SIZE||c.drawImage(this._image,d.CHIP_SIZE*b,d.CHIP_SIZE*k,d.CHIP_SIZE,d.CHIP_SIZE-m,a,x,d.CHIP_SIZE,d.CHIP_SIZE)};b.prototype.drawCanvasWithLowerYLimit=function(b,k,a,x,m,c){void 0===c&&(c=!1);c=c?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");m=Math.max(0,m-x);m>=d.CHIP_SIZE||c.drawImage(this._image,d.CHIP_SIZE*
b,d.CHIP_SIZE*k+m,d.CHIP_SIZE,d.CHIP_SIZE-m,a,x+m,d.CHIP_SIZE,d.CHIP_SIZE)};b.prototype.clearCanvas=function(b,d,a,x,m){void 0===m&&(m=!1);(m?this._ctxSub:this._ctx).clearRect(b,d,a,x)};b.prototype.drawBase=function(b,d,a,x,m){void 0===m&&(m=!1);m=m?this._ctxSub:this._ctx;m.fillStyle="#9E9E9E";m.fillRect(b,d,a,x)};return b}();g.CGManager=e})(wwa_cgmanager||(wwa_cgmanager={}));var wwa_util;
(function(g){g.$id=function(d){return document.getElementById(d)};g.$class=function(d){return document.getElementsByClassName(d)};g.$tag=function(d){return document.getElementsByTagName(d)};g.$qs=function(d){return document.querySelector(d)};g.$qsh=function(d){return document.querySelector(d)};g.$qsAll=function(d){return document.querySelectorAll(d)};g.$localPos=function(d,e){var b,p;b=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft;p=window.pageYOffset||document.body.scrollTop||
document.documentElement.scrollTop;b=d-g.$id("wwa-wrapper").offsetLeft+b;p=e-g.$id("wwa-wrapper").offsetTop+p;return new wwa_data.Coord(b,p)};g.$escapedURI=function(d){return d.match(/^https?:\/\//)||d.match(/^\.\.\//)?d:location.href="./"+d};g.arr2str4save=function(d){var e="";if(d instanceof Array){for(var b=0;b<d.length;b++)e+=g.arr2str4save(d[b])+"/";return e}return d+""}})(wwa_util||(wwa_util={}));var wwa_message;
(function(g){var d=function(){return function(a,b,d,c){this.message=a;this.isSystemMessage=b;this.isEndOfPartsEvent=d;this.macro=c;void 0===this.macro&&(this.macro=[])}}();g.MessageInfo=d;g.strArrayToMessageInfoArray=function(a,b){var m=[];a.forEach(function(a){m.push(new d(a,b))});return m};var e=function(){function a(a,b,c,d,k,e){this._wwa=a;this._triggerPartsID=b;this._triggerPartsType=c;this._triggerPartsPosition=d;this.macroType=k;this.macroArgs=e}a.prototype.execute=function(){try{this.macroType===
wwa_data.MacroType.IMGPLAYER?this._executeImgPlayerMacro():this.macroType===wwa_data.MacroType.IMGYESNO?this._executeImgYesNoMacro():this.macroType===wwa_data.MacroType.HPMAX?this._executeHPMaxMacro():this.macroType===wwa_data.MacroType.SAVE?this._executeSaveMacro():this.macroType===wwa_data.MacroType.ITEM?this._executeItemMacro():this.macroType===wwa_data.MacroType.DEFAULT?this._executeDefaultMacro():this.macroType===wwa_data.MacroType.OLDMAP?this._executeOldMapMacro():this.macroType===wwa_data.MacroType.PARTS?
this._executePartsMacro():this.macroType===wwa_data.MacroType.MOVE?this._executeMoveMacro():this.macroType===wwa_data.MacroType.MAP?this._executeMapMacro():this.macroType===wwa_data.MacroType.DIRMAP?this._executeDirMapMacro():this.macroType===wwa_data.MacroType.IMGFRAME?this._executeImgFrameMacro():this.macroType===wwa_data.MacroType.IMGBOM?this._executeImgBomMacro():this.macroType===wwa_data.MacroType.DELPLAYER?this._executeDelPlayerMacro():this.macroType===wwa_data.MacroType.FACE?this._executeFaceMacro():
this.macroType===wwa_data.MacroType.EFFECT?this._executeEffectMacro():this.macroType===wwa_data.MacroType.GAMEOVER?this._executeGameOverMacro():this.macroType===wwa_data.MacroType.IMGCLICK?this._executeImgClickMacro():this.macroType===wwa_data.MacroType.STATUS?this._executeStatusMacro():this.macroType===wwa_data.MacroType.COLOR?this._executeColorMacro():this.macroType===wwa_data.MacroType.WAIT?this._executeWaitMacro():this.macroType===wwa_data.MacroType.SOUND&&this._executeSoundMacro()}catch(a){}};
a.prototype._concatEmptyArgs=function(a){if(this.macroArgs.length<a){a=Array(a-this.macroArgs.length);for(var b=0;b<a.length;b++)a[b]="";this.macroArgs=this.macroArgs.concat(a)}};a.prototype._parseInt=function(a,b){void 0===b&&(b=0);var c=parseInt(this.macroArgs[a]);return isNaN(c)?b:c};a.prototype._executeImgPlayerMacro=function(){this._concatEmptyArgs(2);var a=this._parseInt(0),b=this._parseInt(1);this._wwa.setPlayerImgCoord(new wwa_data.Coord(a,b))};a.prototype._executeImgYesNoMacro=function(){this._concatEmptyArgs(2);
var a=this._parseInt(0),b=this._parseInt(1);this._wwa.setYesNoImgCoord(new wwa_data.Coord(a,b))};a.prototype._executeHPMaxMacro=function(){this._concatEmptyArgs(1);var a=Math.max(0,this._parseInt(0));this._wwa.setPlayerEnergyMax(a)};a.prototype._executeSaveMacro=function(){this._concatEmptyArgs(1);var a=!!this._parseInt(0);this._wwa.disableSave(a)};a.prototype._executeItemMacro=function(){this._concatEmptyArgs(2);var a=this._parseInt(0),b=this._parseInt(1);this._wwa.setPlayerGetItem(a,b)};a.prototype._executeDefaultMacro=
function(){this._concatEmptyArgs(1);var a=!!this._parseInt(0);this._wwa.setObjectNotCollapseOnPartsOnPlayer(a)};a.prototype._executeOldMapMacro=function(){this._concatEmptyArgs(1);var a=!!this._parseInt(0);this._wwa.setOldMap(a)};a.prototype._executePartsMacro=function(){this._concatEmptyArgs(4);var a=this._parseInt(0),b=this._parseInt(1),c=this._parseInt(2,wwa_data.PartsType.OBJECT),d=this._parseInt(3);if(c!==wwa_data.PartsType.OBJECT&&c!==wwa_data.PartsType.MAP)throw Error("\u30d1\u30fc\u30c4\u7a2e\u5225\u304c\u4e0d\u660e\u3067\u3059");
0!==d&&1!==d&&(d=1);if(0>a||0>b)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(c===wwa_data.PartsType.OBJECT){if(a>=this._wwa.getObjectPartsNum()||b>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");}else if(a>=this._wwa.getMapPartsNum()||b>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");this._wwa.replaceParts(a,b,c,!!d)};a.prototype._executeMoveMacro=function(){this._concatEmptyArgs(1);
var a=this._parseInt(0);this._wwa.setMoveMacroWaitingToPlayer(a)};a.prototype._executeMapMacro=function(){this._concatEmptyArgs(4);var a=this._parseInt(0),b=this.macroArgs[1],c=this.macroArgs[2],d=this._parseInt(3,wwa_data.PartsType.OBJECT);if(0>a)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(d===wwa_data.PartsType.OBJECT){if(a>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");}else if(a>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");
this._wwa.appearPartsEval(this._triggerPartsPosition,b,c,a,d)};a.prototype._executeDirMapMacro=function(){this._concatEmptyArgs(3);var a=this._parseInt(0),b=this._parseInt(1),c=this._parseInt(2,wwa_data.PartsType.OBJECT);if(isNaN(a)||isNaN(b)||isNaN(c))throw Error("\u5f15\u6570\u304c\u6574\u6570\u3067\u306f\u3042\u308a\u307e\u305b\u3093");if(0>a)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(c===wwa_data.PartsType.OBJECT){if(a>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");
}else if(a>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");this._wwa.appearPartsByDirection(b,a,c)};a.prototype._executeImgFrameMacro=function(){this._concatEmptyArgs(3);var a=this._parseInt(0),b=this._parseInt(1),c=this._parseInt(2),d=b*wwa_data.WWAConsts.CHIP_SIZE,k=c*wwa_data.WWAConsts.CHIP_SIZE;if(0>b||0>c)throw Error("\u5ea7\u6a19\u306f\u6b63\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");if(a===wwa_data.MacroImgFrameIndex.ENERGY)wwa_util.$qsh("#disp-energy>.status-icon").style.backgroundPosition=
"-"+d+"px -"+k+"px";else if(a===wwa_data.MacroImgFrameIndex.STRENGTH)wwa_util.$qsh("#disp-strength>.status-icon").style.backgroundPosition="-"+d+"px -"+k+"px";else if(a===wwa_data.MacroImgFrameIndex.DEFENCE)wwa_util.$qsh("#disp-defence>.status-icon").style.backgroundPosition="-"+d+"px -"+k+"px";else if(a===wwa_data.MacroImgFrameIndex.GOLD)wwa_util.$qsh("#disp-gold>.status-icon").style.backgroundPosition="-"+d+"px -"+k+"px";else if(a===wwa_data.MacroImgFrameIndex.WIDE_CELL_ROW)Array.prototype.forEach.call(wwa_util.$qsAll("div.wide-cell-row"),
function(a){a.style.backgroundPosition="-"+d+"px -"+k+"px"});else if(a===wwa_data.MacroImgFrameIndex.ITEM_BG)Array.prototype.forEach.call(wwa_util.$qsAll("div.item-cell"),function(a){a.style.backgroundPosition="-"+d+"px -"+k+"px"});else if(a===wwa_data.MacroImgFrameIndex.MAIN_FRAME)this._wwa.setFrameCoord(new wwa_data.Coord(b,c));else throw Error("\u7a2e\u5225\u304c\u4e0d\u6b63\u3067\u3059\u3002");};a.prototype._executeImgBomMacro=function(){this._concatEmptyArgs(2);var a=this._parseInt(0),b=this._parseInt(1);
if(0>a||0>b)throw Error("\u5ea7\u6a19\u306f\u6b63\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");this._wwa.setBattleEffectCoord(new wwa_data.Coord(a,b))};a.prototype._executeDelPlayerMacro=function(){this._concatEmptyArgs(1);var a=parseInt(this.macroArgs[0]);this._wwa.setDelPlayer(!!a)};a.prototype._executeFaceMacro=function(){this._concatEmptyArgs(6);var a=this._parseInt(0),b=this._parseInt(1),c=this._parseInt(2),d=this._parseInt(3),k=this._parseInt(4),e=this._parseInt(5);if(0>
a||0>b||0>c||0>d||0>k||0>e)throw Error("\u5404\u5f15\u6570\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");a=new wwa_data.Face(new wwa_data.Coord(a,b),new wwa_data.Coord(c,d),new wwa_data.Coord(k,e));this._wwa.addFace(a)};a.prototype._executeEffectMacro=function(){this._concatEmptyArgs(1);var a=this._parseInt(0);if(0>a)throw Error("\u5f85\u3061\u6642\u9593\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");
0===a&&this._wwa.stopEffect();for(var b=[],c=1;c<this.macroArgs.length;c+=2){var d=this._parseInt(c),k=0;if(0>d)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");if(c+1===this.macroArgs.length)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u3067\u3001Y\u5ea7\u6a19\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002");k=this._parseInt(c+
1);if(0>k)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");b.push(new wwa_data.Coord(d,k))}this._wwa.setEffect(a,b)};a.prototype._executeGameOverMacro=function(){this._concatEmptyArgs(2);var a=this._parseInt(0),b=this._parseInt(1);if(0>a||a>=this._wwa.getMapWidth()||0>b||b>=this._wwa.getMapWidth())throw Error("\u30de\u30c3\u30d7\u306e\u7bc4\u56f2\u5916\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059!");
this._wwa.setGameOverPosition(new wwa_data.Coord(a,b))};a.prototype._executeImgClickMacro=function(){this._concatEmptyArgs(2);if(1>this.macroArgs.length)throw Error("\u5f15\u6570\u304c\u5c11\u306a\u3059\u304e\u307e\u3059");var a=this._parseInt(0),b=this._parseInt(1);if(0>a||0>b)throw Error("\u5f15\u6570\u304c0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306f\u3042\u308a\u307e\u305b\u3093");this._wwa.setImgClick(new wwa_data.Coord(a,b))};a.prototype._executeStatusMacro=function(){this._concatEmptyArgs(2);
var a=this._parseInt(0),b=this._parseInt(1);if(0>a||4<a)throw Error("\u30b9\u30c6\u30fc\u30bf\u30b9\u7a2e\u5225\u304c\u7bc4\u56f2\u5916\u3067\u3059\u3002");this._wwa.setPlayerStatus(a,b)};a.prototype._executeColorMacro=function(){this._concatEmptyArgs(4);var a=this._parseInt(0),b=this._parseInt(1),c=this._parseInt(2),d=this._parseInt(3);if(0>a||5<a)throw Error("\u7a2e\u5225\u306f0\u304b\u30895\u307e\u3067\u3067\u3059");if(0>b||255<b||0>c||255<c||0>d||255<d)throw Error("\u8272\u304c\u7bc4\u56f2\u5916\u3067\u3059");
this._wwa.changeStyleRule(a,b,c,d)};a.prototype._executeWaitMacro=function(){throw Error("Not implemented!");};a.prototype._executeSoundMacro=function(){this._concatEmptyArgs(1);var a=parseInt(this.macroArgs[0]);this._wwa.playSound(a)};return a}();g.Macro=e;g.parseMacro=function(a,b,d,c,k){k=k.match(/^\$([a-zA-Z_][a-zA-Z0-9_]*)\=(.*)$/);if(null===k||3!==k.length)throw Error("\u30de\u30af\u30ed\u3067\u306f\u3042\u308a\u307e\u305b\u3093");var g=wwa_data.macrotable["$"+k[1].toLowerCase()];return void 0===
g?new e(a,b,d,c,wwa_data.MacroType.UNDEFINED,k[2].split(",")):new e(a,b,d,c,g,k[2].split(",").map(function(a){return a.trim()}))};var b=function(){function a(a,b,c,d,k,e,l){this._wwa=a;this._coord=b;this._width=c;this._height=d;this._isVisible=k;this._parentElement=e;this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.borderWidth="2px";this._element.style.borderStyle="solid";this._element.style.borderRadius="10px";this._element.classList.add("wwa-message-window");
this._element.style.zIndex=l+"";this._element.style.left=this._coord.x+"px";this._element.style.top=this._coord.y+"px";this._element.style.width=this._width+"px";this._element.style.height=this._height+"px";this._parentElement.appendChild(this._element)}a.prototype.update=function(a){};a.prototype.show=function(){this._isVisible=!0;this._element.style.display="block";this.update()};a.prototype.hide=function(){this._isVisible=!1;this._element.style.display="none";this.update()};a.prototype.isVisible=
function(){return this._isVisible};return a}(),p=function(a){function b(d,c,k,e,g,l,p){a.call(this,d,new wwa_data.Coord(c.x,c.y),k,e,g,l,201);this._cgFileName=p;this._monsterBox=document.createElement("div");this._monsterBox.style.width=wwa_data.WWAConsts.CHIP_SIZE+"px";this._monsterBox.style.height=wwa_data.WWAConsts.CHIP_SIZE+"px";this._monsterBox.style.position="absolute";this._monsterBox.style.left="10px";this._monsterBox.style.top="10px";this._monsterBox.style.backgroundImage="url("+this._cgFileName.replace("(",
"\\(").replace(")","\\)")+")";this._monsterBox.style.backgroundPosition="0 0";this._element.appendChild(this._monsterBox);this._energyBox=document.createElement("div");this._energyBox.style.position="absolute";this._energyBox.style.left="80px";this._energyBox.style.top="10px";this._energyBox.textContent="\u751f\u547d\u529b 0";this._element.appendChild(this._energyBox);this._strengthBox=document.createElement("div");this._strengthBox.style.position="absolute";this._strengthBox.style.left="80px";this._strengthBox.style.top=
"30px";this._strengthBox.textContent="\u653b\u6483\u529b 0";this._element.appendChild(this._strengthBox);this._defenceBox=document.createElement("div");this._defenceBox.style.position="absolute";this._defenceBox.style.left="180px";this._defenceBox.style.top="30px";this._defenceBox.textContent="\u9632\u5fa1\u529b 0";this._element.appendChild(this._defenceBox);this._element.style.display=this._isVisible?"block":"none"}__extends(b,a);b.prototype.update=function(a){void 0!==a&&(this._monsterBox.style.backgroundPosition=
"-"+a.imgCoord.x+"px -"+a.imgCoord.y+"px",this._energyBox.textContent="\u751f\u547d\u529b "+a.status.energy,this._strengthBox.textContent="\u653b\u6483\u529b "+a.status.strength,this._defenceBox.textContent="\u9632\u5fa1\u529b "+a.status.defence)};return b}(b);g.MosterWindow=p;b=function(a){function b(d,c,k,e){a.call(this,d,new wwa_data.Coord(c.x,c.y),340,30,k,e,202);this._element.style.textAlign="center";this._element.style.display=this._isVisible?"block":"none";this.update(0)}__extends(b,a);b.prototype.update=
function(a){void 0!==a&&(this._element.textContent="Score: "+a)};return b}(b);g.ScoreWindow=b;(function(a){a[a.TOP=0]="TOP";a[a.CENTER=1]="CENTER";a[a.BOTTOM=2]="BOTTOM";a[a.SCORE=3]="SCORE"})(g.Positioning||(g.Positioning={}));var k=g.Positioning,b=function(){function a(a,b,c,d,k,e,l,g,v,f){var w=this,y=l.replace("(","\\(").replace(")","\\)");this._wwa=a;this._cgFileName=l;this._x=b;this._y=c;this._width=d;this._height=k;this._message=e;this._isVisible=g;this._isYesno=v;this._element=document.createElement("div");
this._element.style.position="absolute";this._element.style.borderWidth="2px";this._element.style.borderStyle="solid";this._element.style.borderRadius="10px";this._element.classList.add("wwa-message-window");this._element.style.zIndex="400";this._msgWrapperElement=document.createElement("div");this._msgWrapperElement.style.padding="7px";this._msgWrapperElement.style.margin="0";this._msgWrapperElement.style.textAlign="left";this._msgWrapperElement.style.wordWrap="break-word";this._element.appendChild(this._msgWrapperElement);
this._dummyElement=document.createElement("div");this._dummyElement.style.display="none";this._dummyElement.style.padding="0";this._dummyElement.style.margin="0";this._dummyElement.style.height="55px";this._element.appendChild(this._dummyElement);this._ynWrapperElement=document.createElement("div");this._ynWrapperElement.style.padding="0";this._ynWrapperElement.style.margin="0";this._ynWrapperElement.style.position="absolute";this._ynWrapperElement.style.left="246px";this._ynWrapperElement.style.bottom=
"10px";this._ynWrapperElement.style.width="80px";this._ynWrapperElement.style.height="40px";this._ynWrapperElement.style.zIndex="10";this._element.appendChild(this._ynWrapperElement);this._parentElement=f;this._parentElement.appendChild(this._element);this._divYesElement=document.createElement("div");this._divYesElement.style.padding="0";this._divYesElement.style.margin="0";this._divYesElement.style.cssFloat="left";this._divYesElement.style.width="40px";this._divYesElement.style.height="40px";this._divYesElement.style.background=
"url("+y+")";this._divYesElement.onclick=function(){w._isInputDisable||(a.setYesNoInput(wwa_data.YesNoState.YES),w.update())};this._divYesElement.style.cursor="pointer";this._divNoElement=document.createElement("div");this._divNoElement.style.padding="0";this._divNoElement.style.margin="0";this._divNoElement.style.cssFloat="left";this._divNoElement.style.width="40px";this._divNoElement.style.height="40px";this._divNoElement.style.background="url("+y+")";this._divNoElement.onclick=function(){w._isInputDisable||
(a.setYesNoInput(wwa_data.YesNoState.NO),w.update())};this._divNoElement.style.cursor="pointer";this._ynWrapperElement.appendChild(this._divYesElement);this._ynWrapperElement.appendChild(this._divNoElement);w._isInputDisable=!1;this.update()}a.prototype.setPosition=function(a,b,c,d){this._x=a;this._y=b;this._width=c;this._height=d;this.update()};a.prototype.setPositionByPlayerPosition=function(a,b,c,d,k){d=d.getPartsCoord().substract(k.getPartsCoord()).y;this.setPositionEasy(a?g.Positioning.BOTTOM:
b?g.Positioning.SCORE:c?g.Positioning.CENTER:d>=Math.ceil(wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW/2)?g.Positioning.TOP:g.Positioning.BOTTOM)};a.prototype.setPositionEasy=function(a){var b=Math.floor(this._element.clientHeight/2);a===k.CENTER?(this._y=wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/2-b,this.update()):a===k.TOP?(this._y=Math.max(20,wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/4-b)+10,this.update()):a===k.BOTTOM?(this._y=Math.min(wwa_data.WWAConsts.MAP_WINDOW_HEIGHT-20-this._element.clientHeight,3*wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/
4-b),this.update()):a===k.SCORE&&(this._y=80,this.update())};a.prototype.setMessage=function(a){this._message=a;this.update()};a.prototype.setYesNoChoice=function(a){this._isInputDisable=!1;this._isYesno=a;this.update();return this._isYesno};a.prototype.isYesNoChoice=function(){return this._isYesno};a.prototype.setInputDisable=function(){this._isInputDisable=!0};a.prototype.isInputDisable=function(){return this._isInputDisable};a.prototype.show=function(){this._isVisible=!0;this.update()};a.prototype.hide=
function(){this._isVisible=!1;this.update()};a.prototype.isVisible=function(){return this._isVisible};a.prototype.update=function(){var a=this._wwa.getYesNoImgCoord();this._isYesno?(this._wwa.getYesNoState()===wwa_data.YesNoState.YES?(this._divYesElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YESP_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NO_X)*wwa_data.WWAConsts.CHIP_SIZE+
"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px"):this._wwa.getYesNoState()===wwa_data.YesNoState.NO?(this._divYesElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YES_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NOP_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px"):(this._divYesElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YES_X)*
wwa_data.WWAConsts.CHIP_SIZE+"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NO_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px"),this._ynWrapperElement.style.display="block"):this._ynWrapperElement.style.display="none";this._msgWrapperElement.textContent="";for(var a=this._message.split("\n"),b=0;b<a.length;b++){var c=document.createElement("span");c.textContent=a[b];this._msgWrapperElement.appendChild(c);
this._msgWrapperElement.appendChild(document.createElement("br"))}this._isVisible?(this._element.style.left=this._x+"px",this._element.style.top=this._y+"px"):(this._element.style.left="-999999px",this._element.style.top="-999999px");this._element.style.width=this._width+"px";this._element.style.minHeight=this._height+"px";this._dummyElement.style.display=this._isYesno?"block":"none"};return a}();g.MessageWindow=b})(wwa_message||(wwa_message={}));var wwa_monster;
(function(g){var d=function(){function d(b,e,k,a,g,m,c){this._partsID=b;this._position=e;this._imgCoord=k;this._status=a;this._message=g;this._item=m;this._battleEndCallback=c}Object.defineProperty(d.prototype,"partsID",{get:function(){return this._partsID},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"imgCoord",{get:function(){return this._imgCoord},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"item",{get:function(){return this._item},enumerable:!0,configurable:!0});d.prototype.damage=function(b){this._status.energy=Math.max(0,this._status.energy-b)};d.prototype.battleEndProcess=function(){this._battleEndCallback()};
return d}();g.Monster=d})(wwa_monster||(wwa_monster={}));var wwa_motion;
(function(g){var d=function(){function b(b,d,a,e,g){this._player=b;this._objectID=d;this._srcPos=a;this._destPos=e;this._dir=g;this._currentPos=this._srcPos.clone()}b.prototype.update=function(){var b=this._player.getSpeedIndex();return this._currentPos=this._currentPos.getNextFramePosition(this._dir,wwa_data.speedList[b],wwa_data.speedList[b])};Object.defineProperty(b.prototype,"isAchievedDestination",{get:function(){return this._currentPos.equals(this._destPos)},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"currentPosition",{get:function(){return this._currentPos},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"beforePosition",{get:function(){return this._srcPos},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"destination",{get:function(){return this._destPos},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"objID",{get:function(){return this._objectID},enumerable:!0,configurable:!0});return b}();g.ObjectMovingData=
d;var e=function(){function b(b,d){this._wwa=b;this._player=d;this.clear()}b.prototype.add=function(b,k,a,e){this._queue.push(new d(this._player,b,k,a,e))};b.prototype.update=function(){for(var b=[],d=[],a=0;a<this._queue.length;a++)this._queue[a].update(),this._queue[a].isAchievedDestination?(b.push(this._queue[a]),this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,0,this._queue[a].beforePosition.getPartsCoord()),this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,this._queue[a].objID,this._queue[a].destination.getPartsCoord())):
d.push(this._queue[a]);this._queue=d;return b};b.prototype.clear=function(){this._queue=[]};Object.defineProperty(b.prototype,"objectMovingData",{get:function(){return this.objectMovingData},enumerable:!0,configurable:!0});b.prototype.getOffsetByBeforePartsCoord=function(b){var d=this._queue.filter(function(a){return a.beforePosition.getPartsCoord().equals(b)});return 0===d.length?null:d[0].currentPosition.getOffsetCoord()};return b}();g.ObjectMovingDataManager=e})(wwa_motion||(wwa_motion={}));var wwa_estimate_battle;
(function(g){var d=function(){function b(d,a,e){this.id=d;this.imgFileName=a;this.parent=e;this.elem=document.createElement("div");this.elem.classList.add("est");this.elem.setAttribute("id","wwa-est-"+d);this.imgElem=document.createElement("div");this.imgElem.classList.add("est-img-wrapper");this.imgElem.style.backgroundImage="url("+this.imgFileName.replace("(","\\(").replace(")","\\)")+")";this.statusElem=document.createElement("div");this.statusElem.classList.add("est-status-wrapper");this.energyElem=
document.createElement("div");this.energyElem.classList.add("est-energy");this.energyDispElem=document.createElement("span");this.energyDispElem.classList.add("est-energy-disp");this.energyElem.appendChild(this.energyDispElem);this.statusElem.appendChild(this.energyElem);this.strengthElem=document.createElement("div");this.strengthElem.classList.add("est-strength");this.strengthDispElem=document.createElement("span");this.strengthDispElem.classList.add("est-strength-disp");this.strengthElem.appendChild(this.strengthDispElem);
this.statusElem.appendChild(this.strengthElem);this.defenceElem=document.createElement("div");this.defenceElem.classList.add("est-defence");this.defenceDispElem=document.createElement("span");this.defenceDispElem.classList.add("est-defence-disp");this.defenceElem.appendChild(this.defenceDispElem);this.statusElem.appendChild(this.defenceElem);this.damageElem=document.createElement("div");this.damageElem.classList.add("est-damage");this.damageDispElem=document.createElement("span");this.damageDispElem.classList.add("est-damage-disp");
this.damageElem.appendChild(this.damageDispElem);this.statusElem.appendChild(this.damageElem);this.elem.appendChild(this.imgElem);this.elem.appendChild(this.statusElem)}b.prototype.hide=function(){this.elem.style.display="none"};b.prototype.show=function(){this.elem.style.display="block"};b.prototype.setResult=function(b,a,d){this.imgElem.style.backgroundPosition="-"+b.x+"px -"+b.y+"px";this.energyDispElem.textContent="\u751f\u547d\u529b "+a.energy;this.strengthDispElem.textContent="\u653b\u6483\u529b "+
a.strength;this.defenceDispElem.textContent="\u9632\u5fa1\u529b "+a.defence;this.damageDispElem.textContent=d.isNoEffect?"\u653b\u6483\u7121\u52b9":d.isOverMaxTurn?"\u9577\u671f\u6226\u304c\u4e88\u60f3\u3055\u308c\u307e\u3059":"\u4e88\u60f3\u30c0\u30e1\u30fc\u30b8 "+d.damage};return b}(),e=function(){function e(b,a,g){var m=this;this._wwa=b;this._imgFileName=a;this._parent=g;this._element=document.createElement("div");this._element.setAttribute("id","wwa-battle-estimate");this._element.style.display=
"none";this._edes=[];for(a=0;a<wwa_data.WWAConsts.BATTLE_ESTIMATE_MONSTER_TYPE_MAX;a++)b=new d(a,this._imgFileName,this._element),this._edes.push(b),this._element.appendChild(b.elem);this._element.addEventListener("click",function(){m._wwa.hideBattleEstimateWindow()});this._parent.appendChild(this._element)}e.prototype.update=function(d,a){for(var e=0;e<wwa_data.WWAConsts.BATTLE_ESTIMATE_MONSTER_TYPE_MAX;e++)if(e>=a.length)this._edes[e].hide();else{var g=this._wwa.getObjectAttributeById(a[e],wwa_data.WWAConsts.ATR_X),
c=this._wwa.getObjectAttributeById(a[e],wwa_data.WWAConsts.ATR_Y),g=new wwa_data.Coord(g,c),c=this._wwa.getObjectAttributeById(a[e],wwa_data.WWAConsts.ATR_ENERGY),p=this._wwa.getObjectAttributeById(a[e],wwa_data.WWAConsts.ATR_STRENGTH),B=this._wwa.getObjectAttributeById(a[e],wwa_data.WWAConsts.ATR_DEFENCE),c=new wwa_data.Status(c,p,B,0);a:{var p=c.energy,B=d.strength-c.defence,C=Math.max(0,c.strength-d.defence),l=0,A=0;if(0<B)for(;;){l++;p-=B;if(0>=p){p=new b(!1,!1,A);break a}A+=C;if(1E4<l){p=new b(!1,
!0,0);break a}}else p=new b(!0,!1,0)}this._edes[e].setResult(g,c,p);this._edes[e].show()}};e.prototype.show=function(){this._element.style.display="block"};e.prototype.hide=function(){this._element.style.display="none"};return e}();g.BattleEstimateWindow=e;var b=function(){return function(b,d,a){this.isNoEffect=b;this.isOverMaxTurn=d;this.damage=a}}()})(wwa_estimate_battle||(wwa_estimate_battle={}));var wwa_inject_html;
(function(g){g.inject=function(d,e){var b=document.createElement("style");b.type="text/css";b.setAttribute("id",wwa_data.WWAConsts.WWA_STYLE_TAG_ID);wwa_util.$tag("head")[0].appendChild(b);d.innerHTML='            <canvas id="wwa-map" class="wwa-canvas" width="440" height="440">                \u3053\u306e\u30d6\u30e9\u30a6\u30b6\u306f\u3001Canvas\u8981\u7d20\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u305b\u3093\u3002            </canvas>            <canvas id="wwa-map-sub" class="wwa-canvas" width="440" height="440"></canvas>            <div id="wwa-sidebar">                <div class="wide-cell-row" id="disp-energy"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="wide-cell-row" id="disp-strength"><div class="status-icon"></div><div class="status-value-box"> 0 </div></div>                <div class="wide-cell-row" id="disp-defence"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="wide-cell-row" id="disp-gold"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="item-cell" id="item0"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item1"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item2"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item3"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item4"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item5"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item6"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item7"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item8"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item9"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item10"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item11"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="wide-cell-row" id="cell-load">Password</div><div class="wide-button" id="button-load"></div>                <div class="wide-cell-row" id="cell-save">Quick Save</div><div class="wide-button" id="button-save"></div>                <div class="wide-cell-row" id="cell-restart">Restart Game</div><div class="wide-button" id="button-restart"></div>                <div class="wide-cell-row" id="cell-gotowwa">Go to WWA</div><div class="wide-button" id="button-gotowwa"></div>            </div>            <div id="wwa-controller"></div>            <div id="wwa-fader"></div>            <div id="wwa-cover">                 <div id="version"></div>                 <div id="progress-message-container">\u958b\u59cb\u3057\u3066\u3044\u307e\u3059...</div>                 <div id="progress-bar-bg"></div>                 <div id="progress-bar" class="progress-bar"></div>                 <div id="progress-bar-audio" class="progress-bar"></div>                 <div id="progress-disp">---</div>            </div>            <div id="wwa-audio-wrapper"></div>    ';
b=document.createElement("img");b.src=e;wwa_util.$id("wwa-cover").appendChild(b)}})(wwa_inject_html||(wwa_inject_html={}));var wwa_psave;(function(g){var d;g.getPressData=function(){return d};g.createSavePassword=function(e){if(void 0===d||null===d)d=new Uint8Array(e.mapWidth*e.mapWidth*4);return""}})(wwa_psave||(wwa_psave={}));var wwa_password_window;
(function(g){(function(b){b[b.SAVE=0]="SAVE";b[b.LOAD=1]="LOAD"})(g.Mode||(g.Mode={}));var d=g.Mode,e=function(){function b(b,e){var a=this;this._wwa=b;this._parent=e;this._element=document.createElement("div");this._element.setAttribute("id","wwa-password-window");this._element.style.display="none";this._descriptionElement=document.createElement("div");this._descriptionElement.classList.add("wwa-password-description");this._passwordBoxElement=document.createElement("textarea");this._passwordBoxElement.setAttribute("cols",
"50");this._passwordBoxElement.setAttribute("rows","16");this._passwordBoxElement.addEventListener("focus",function(b){a._passwordBoxElement.select()});this._buttonWrapperElement=document.createElement("div");this._okButtonElement=document.createElement("button");this._okButtonElement.textContent="OK";this._okButtonElement.addEventListener("click",function(){a._wwa.hidePasswordWindow()});this._cancelButtonElement=document.createElement("button");this._cancelButtonElement.textContent="\u30ad\u30e3\u30f3\u30bb\u30eb";
this._cancelButtonElement.addEventListener("click",function(){a._wwa.hidePasswordWindow(!0)});this._buttonWrapperElement.appendChild(this._okButtonElement);this._buttonWrapperElement.appendChild(this._cancelButtonElement);this._mode=d.LOAD;this._element.appendChild(this._descriptionElement);this._element.appendChild(this._passwordBoxElement);this._element.appendChild(this._buttonWrapperElement);this._parent.appendChild(this._element);this.update()}Object.defineProperty(b.prototype,"mode",{get:function(){return this._mode},
set:function(b){this._mode=b;b===d.LOAD&&(this.password="")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"password",{get:function(){return this._passwordBoxElement.value},set:function(b){this._passwordBoxElement.value=b},enumerable:!0,configurable:!0});b.prototype.show=function(b){void 0!==b&&(this.mode=b);this._isVisible=!0;this.update()};b.prototype.hide=function(){this._isVisible=!1;this.update()};b.prototype.update=function(){var b="";if(this._mode===d.LOAD){b="\u4e0b\u306e\u30dc\u30c3\u30af\u30b9\u306b\u524d\u56de\u306e\u30d7\u30ec\u30a4\u3067\u53d6\u5f97\u3057\u305f\n\u5fa9\u5e30\u7528\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u30c6\u30ad\u30b9\u30c8\u306f\u3001Ctrl+C\u3067\u30b3\u30d4\u30fc\u3001Ctrl+V\u3067\u8cbc\u308a\u4ed8\u3051\u3067\u304d\u307e\u3059\u3002\n\u73fe\u5728\u3001Java\u7248WWA\u3067\u53d6\u5f97\u3057\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3054\u5229\u7528\u306b\u306a\u308c\u307e\u305b\u3093\u3002\n\u4f5c\u6210\u8005\u304c\u30de\u30c3\u30d7\u306e\u5185\u5bb9\u3092\u5909\u66f4\u3057\u305f\u5834\u5408\u306f\n\u305d\u308c\u4ee5\u524d\u306b\u53d6\u5f97\u3057\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u4f7f\u3048\u306a\u304f\u306a\u308a\u307e\u3059\u3002";
try{this._passwordBoxElement.removeAttribute("readonly")}catch(e){}this._cancelButtonElement.style.display="inline"}else b="\u4e0b\u8a18\u30c6\u30ad\u30b9\u30c8\u304c\u30c7\u30fc\u30bf\u5fa9\u5e30\u7528\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u30b3\u30d4\u30fc\u3057\u3066\u30e1\u30e2\u5e33\u306a\u3069\u306e\u30c6\u30ad\u30b9\u30c8\u30a8\u30c7\u30a3\u30bf\u306b\u8cbc\u308a\u4ed8\u3051\u3066\n\u4fdd\u5b58\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u30dc\u30c3\u30af\u30b9\u3092\u30af\u30ea\u30c3\u30af\u3067\u5168\u4f53\u3092\u9078\u629e\u3001\n\u300cCtrl+C\u300d\u3067\u30b3\u30d4\u30fc\u3001\u300cCtrl+V\u300d\u3067\u8cbc\u308a\u4ed8\u3051\u3067\u304d\u307e\u3059\u3002\n\u901a\u5e38\u6570\u4e07\u6587\u5b57\u7a0b\u5ea6\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u3054\u6ce8\u610f\u304f\u3060\u3055\u3044\u3002",
this._passwordBoxElement.setAttribute("readonly","readonly"),this._cancelButtonElement.style.display="none";b=b.split("\n");this._descriptionElement.textContent="";for(var g=0;g<b.length;g++){var a=document.createElement("span");a.textContent=b[g];this._descriptionElement.appendChild(a);this._descriptionElement.appendChild(document.createElement("br"))}this._element.style.display=this._isVisible?"block":"none"};return b}();g.PasswordWindow=e})(wwa_password_window||(wwa_password_window={}));
var postMessage_noWorker=function(g){},wwa_main;
(function(g){function d(a,b,c){var n=new wwa_data.LoaderProgress;n.current=a;n.total=b;n.stage=c;return n}function e(){void 0===window.wwap_mode&&(wwap_mode=!1);Array.prototype.forEach.call(l.$qsAll("a.wwa-copyright"),function(a){a.addEventListener("click",function(){v=!0})});window.addEventListener("beforeunload",function(a){if(v)return v=!1,a.returnValue="\u3053\u306e\u30da\u30fc\u30b8\u3092\u96e2\u308c\u307e\u3059\u304b\uff1f"});var a=wwap_mode?c.WWAP_SERVER+"/"+c.WWAP_SERVER_TITLE_IMG:l.$id("wwa-wrapper").getAttribute("data-wwa-title-img");
wwa_inject_html.inject(l.$id("wwa-wrapper"),null===a?"cover.gif":a);var a=l.$id("wwa-wrapper").getAttribute("data-wwa-mapdata"),b=l.$id("wwa-wrapper").getAttribute("data-wwa-loader"),y=l.$id("wwa-wrapper").getAttribute("data-wwa-audio-dir"),n=!0;l.$id("wwa-wrapper").getAttribute("data-wwa-urlgate-enable").match(/^false$/i)&&(n=!1);new A(a,b,n,y)}var b=wwa_input.KeyCode,p=wwa_input.KeyState,k=wwa_input.KeyStore,a=wwa_input.MouseState,x=wwa_input.MouseStore,m=wwa_cgmanager.CGManager,c=wwa_data.WWAConsts,
z=wwa_data.Coord,B=wwa_data.Position,C=wwa_camera.Camera,l=wwa_util;g.getProgress=d;var A=function(){function f(a,y,n,D){var h=this;void 0===n&&(n=!1);void 0===D&&(D="");try{l.$id("version").textContent="WWA Wing Ver."+c.VERSION_WWAJS}catch(f){}this._isURLGateEnable=n;this._animationCounter=this._mainCallCounter=0;this._statusPressCounter=new wwa_data.Status(0,0,0,0);D?"/"!==D[D.length-1]&&(D+="/"):D="./audio/";this._audioDirectory=D;var e=(new Date).getTime();location.href.match(/^file/)&&alert("\u3010\u8b66\u544a\u3011\u76f4\u63a5HTML\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u3044\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u6b63\u5e38\u306b\u52d5\u4f5c\u3057\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u306e\u78ba\u8a8d\u3092\u884c\u3046\u5834\u5408\u306b\u306f\u540c\u68b1\u306e\u300cWWA Debugger\u300d\u3092\u3054\u5229\u7528\u304f\u3060\u3055\u3044\u3002");
if(void 0===window.audiojs)alert("Audio.js\u306e\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\n\u30d5\u30a9\u30eb\u30c0"+this._audioDirectory+"\u306e\u4e2d\u306baudio.min.js\u306f\u914d\u7f6e\u3055\u308c\u3066\u3044\u307e\u3059\u304b\uff1f \n\u30d5\u30a9\u30eb\u30c0\u3092\u5909\u66f4\u3055\u308c\u308b\u5834\u5408\u306b\u306f data-wwa-audio-dir \u5c5e\u6027\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044");else if(this._loadHandler=function(a){if(null!==a.data.error&&void 0!==
a.data.error)alert("\u4e0b\u8a18\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002: \n"+a.data.error.message);else if(null!==a.data.progress&&void 0!==a.data.progress)h._setProgressBar(a.data.progress);else{h._wwaData=a.data.wwaData;h.initCSSRule();h._setProgressBar(d(0,4,wwa_data.LoadStage.GAME_INIT));a=new Image;a.src=h._wwaData.mapCGName;a.addEventListener("error",function(){alert("\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u300c"+h._wwaData.mapCGName+"\u300d\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u7ba1\u7406\u8005\u306e\u65b9\u3078: \u30c7\u30fc\u30bf\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u308b\u304b\u3001\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044\u3002")});
h._restartData=JSON.parse(JSON.stringify(h._wwaData));var w=h._wwaData.mapCGName.replace("(","\\(").replace(")","\\)");Array.prototype.forEach.call(l.$qsAll("div.item-cell"),function(a){a.style.backgroundPosition="-40px -80px";a.style.backgroundImage="url("+w+")"});Array.prototype.forEach.call(l.$qsAll("div.wide-cell-row"),function(a){a.style.backgroundPosition="-160px -120px";a.style.backgroundImage="url("+w+")"});Array.prototype.forEach.call(l.$qsAll(".item-cell>.item-click-border"),function(a){a.style.backgroundImage=
"url('"+c.ITEM_BORDER_IMG_DATA_URL+"')";a.style.backgroundPosition="0 0";a.style.display="none";a.style.cursor="pointer"});Array.prototype.forEach.call(l.$qsAll(".item-cell>.item-disp"),function(a){a.style.backgroundImage="url("+w+")"});a=l.$qsh("#disp-energy>.status-icon");a.style.backgroundPosition="-120px -80px";a.style.backgroundImage="url("+w+")";a=l.$qsh("#disp-strength>.status-icon");a.style.backgroundPosition="-160px -80px";a.style.backgroundImage="url("+w+")";a=l.$qsh("#disp-defence>.status-icon");
a.style.backgroundPosition="-200px -80px";a.style.backgroundImage="url("+w+")";a=l.$qsh("#disp-gold>.status-icon");a.style.backgroundPosition="-240px -80px";a.style.backgroundImage="url("+w+")";h._setProgressBar(d(1,4,wwa_data.LoadStage.GAME_INIT));h._replaceAllRandomObjects();a=(new Date).getTime();console.log("Loading Complete!"+(a-e)+"ms");h._cvs=l.$id("wwa-map");h._cvsSub=l.$id("wwa-map-sub");a=h._cvs.getContext("2d");var y=h._cvsSub.getContext("2d");a.fillStyle="rgba( 255, 255, 255, 0.5)";a.fillRect(0,
0,440,440);var n=new B(h,h._wwaData.playerX,h._wwaData.playerY);h._camera=new C(n);var D=new wwa_data.Status(h._wwaData.statusEnergy,h._wwaData.statusStrength,h._wwaData.statusDefence,h._wwaData.statusGold);h._player=new wwa_parts_player.Player(h,n,h._camera,D,h._wwaData.statusEnergyMax);h._objectMovingDataManager=new wwa_motion.ObjectMovingDataManager(h,h._player);h._camera.setPlayer(h._player);h._keyStore=new k;h._mouseStore=new x;h._messageQueue=[];h._yesNoJudge=wwa_data.YesNoState.UNSELECTED;
h._yesNoJudgeInNextFrame=wwa_data.YesNoState.UNSELECTED;h._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE;h._prevFrameEventExected=!1;h._lastMessage=new wwa_message.MessageInfo("",!1,!1,[]);h._execMacroListInNextFrame=[];h._passwordLoadExecInNextFrame=!1;h._setProgressBar(d(2,4,wwa_data.LoadStage.GAME_INIT));window.addEventListener("keydown",function(a){h._keyStore.setPressInfo(a.keyCode);a.keyCode===b.KEY_F5?a.preventDefault():h._player.isWaitingMessage()?a.keyCode!==b.KEY_DOWN&&a.keyCode!==b.KEY_LEFT&&
a.keyCode!==b.KEY_RIGHT&&a.keyCode!==b.KEY_UP&&a.keyCode!==b.KEY_SHIFT&&a.keyCode!==b.KEY_ENTER&&a.keyCode!==b.KEY_ESC&&a.keyCode!==b.KEY_SPACE||a.preventDefault():h._player.isWaitingPasswordWindow()||a.keyCode!==b.KEY_DOWN&&a.keyCode!==b.KEY_LEFT&&a.keyCode!==b.KEY_RIGHT&&a.keyCode!==b.KEY_UP&&a.keyCode!==b.KEY_SHIFT&&a.keyCode!==b.KEY_ENTER&&a.keyCode!==b.KEY_1&&a.keyCode!==b.KEY_2&&a.keyCode!==b.KEY_3&&a.keyCode!==b.KEY_A&&a.keyCode!==b.KEY_C&&a.keyCode!==b.KEY_D&&a.keyCode!==b.KEY_E&&a.keyCode!==
b.KEY_M&&a.keyCode!==b.KEY_N&&a.keyCode!==b.KEY_Q&&a.keyCode!==b.KEY_S&&a.keyCode!==b.KEY_W&&a.keyCode!==b.KEY_X&&a.keyCode!==b.KEY_Y&&a.keyCode!==b.KEY_Z&&a.keyCode!==b.KEY_ESC&&a.keyCode!==b.KEY_F1&&a.keyCode!==b.KEY_F3&&a.keyCode!==b.KEY_F4&&a.keyCode!==b.KEY_F6&&a.keyCode!==b.KEY_F7&&a.keyCode!==b.KEY_F8&&a.keyCode!==b.KEY_F12&&a.keyCode!==b.KEY_SPACE||a.preventDefault()});window.addEventListener("keyup",function(a){h._keyStore.setReleaseInfo(a.keyCode);if(a.keyCode===b.KEY_F5)a.preventDefault();
else if(a.keyCode===b.KEY_DOWN||a.keyCode===b.KEY_LEFT||a.keyCode===b.KEY_RIGHT||a.keyCode===b.KEY_UP||a.keyCode===b.KEY_SHIFT||a.keyCode===b.KEY_ENTER||a.keyCode===b.KEY_1||a.keyCode===b.KEY_2||a.keyCode===b.KEY_3||a.keyCode===b.KEY_A||a.keyCode===b.KEY_C||a.keyCode===b.KEY_D||a.keyCode===b.KEY_E||a.keyCode===b.KEY_M||a.keyCode===b.KEY_N||a.keyCode===b.KEY_Q||a.keyCode===b.KEY_S||a.keyCode===b.KEY_W||a.keyCode===b.KEY_X||a.keyCode===b.KEY_Y||a.keyCode===b.KEY_Z||a.keyCode===b.KEY_ESC||a.keyCode===
b.KEY_F1||a.keyCode===b.KEY_F3||a.keyCode===b.KEY_F4||a.keyCode===b.KEY_F6||a.keyCode===b.KEY_F7||a.keyCode===b.KEY_F8||a.keyCode===b.KEY_F12||a.keyCode===b.KEY_SPACE)h._player.isWaitingMessage()||h._player.isWaitingPasswordWindow()||a.preventDefault()});window.addEventListener("blur",function(a){h._keyStore.allClear();h._mouseStore.clear()});window.addEventListener("contextmenu",function(a){h._keyStore.allClear();h._mouseStore.clear()});window.addEventListener("devicemotion",function(a){h._accX=
a.accelerationIncludingGravity.x;h._accY=a.accelerationIncludingGravity.y});window.addEventListener("help",function(a){a.preventDefault()});h._wwaWrapperElement=wwa_util.$id("wwa-wrapper");h._mouseControllerElement=wwa_util.$id("wwa-controller");h._mouseControllerElement.addEventListener("mousedown",function(a){if(1===a.which){if(h._mouseStore.getMouseState()===wwa_input.MouseState.NONE){var b=wwa_util.$localPos(a.clientX,a.clientY),w=h._player.getDrawingCenterPosition(),b=b.substract(w),w=Math.abs(b.x),
c=Math.abs(b.y),y;0<b.y&&c>w?y=wwa_data.Direction.DOWN:0>b.y&&c>w?y=wwa_data.Direction.UP:0<b.x&&c<w?y=wwa_data.Direction.RIGHT:0>b.x&&c<w&&(y=wwa_data.Direction.LEFT);h._mouseStore.setPressInfo(y)}a.preventDefault()}});h._mouseControllerElement.addEventListener("mouseleave",function(a){h._mouseStore.clear()});h._mouseControllerElement.addEventListener("mouseup",function(a){1===a.which&&(h._mouseStore.setReleaseInfo(),a.preventDefault())});window.TouchEvent&&(h._mouseControllerElement.addEventListener("touchstart",
function(a){if(h._mouseStore.getMouseState()!==wwa_input.MouseState.NONE)a.preventDefault();else{var b=wwa_util.$localPos(a.changedTouches[0].clientX,a.changedTouches[0].clientY),w=h._player.getDrawingCenterPosition(),b=b.substract(w),w=Math.abs(b.x),c=Math.abs(b.y),y;0<b.y&&c>w?y=wwa_data.Direction.DOWN:0>b.y&&c>w?y=wwa_data.Direction.UP:0<b.x&&c<w?y=wwa_data.Direction.RIGHT:0>b.x&&c<w&&(y=wwa_data.Direction.LEFT);h._mouseStore.setPressInfo(y,a.changedTouches[0].identifier);a.cancelable&&a.preventDefault()}}),
h._mouseControllerElement.addEventListener("touchend",function(a){for(var b=0;b<a.changedTouches.length;b++)if(h._mouseStore.getTouchID()===a.changedTouches[b].identifier){h._mouseStore.setReleaseInfo();a.preventDefault();break}}),h._mouseControllerElement.addEventListener("touchcancel",function(a){for(var b=0;b<a.changedTouches.length;b++)if(h._mouseStore.getTouchID()===a.changedTouches[b].identifier){h._mouseStore.setReleaseInfo();a.preventDefault();break}}));l.$id("button-load").addEventListener("click",
function(){if(h._player.isControllable())h.onselectbutton(wwa_data.SidebarButton.QUICK_LOAD)});l.$id("button-save").addEventListener("click",function(){if(h._player.isControllable())h.onselectbutton(wwa_data.SidebarButton.QUICK_SAVE)});l.$id("button-restart").addEventListener("click",function(){if(h._player.isControllable())h.onselectbutton(wwa_data.SidebarButton.RESTART_GAME)});l.$id("button-gotowwa").addEventListener("click",function(){if(h._player.isControllable())h.onselectbutton(wwa_data.SidebarButton.GOTO_WWA)});
Array.prototype.forEach.call(l.$qsAll(".wide-cell-row"),function(a){a.addEventListener("click",function(){h._displayHelp()})});h._frameCoord=new z(c.IMGPOS_DEFAULT_FRAME_X,c.IMGPOS_DEFAULT_YESNO_Y);h._battleEffectCoord=new z(c.IMGPOS_DEFAULT_BATTLE_EFFECT_X,c.IMGPOS_DEFAULT_BATTLE_EFFECT_Y);h._battleEstimateWindow=new wwa_estimate_battle.BattleEstimateWindow(h,h._wwaData.mapCGName,wwa_util.$id("wwa-wrapper"));h._passwordWindow=new wwa_password_window.PasswordWindow(h,wwa_util.$id("wwa-wrapper"));
h._messageWindow=new wwa_message.MessageWindow(h,50,180,340,0,"",h._wwaData.mapCGName,!1,!0,l.$id("wwa-wrapper"));h._monsterWindow=new wwa_message.MosterWindow(h,new z(50,180),340,60,!1,l.$id("wwa-wrapper"),h._wwaData.mapCGName);h._scoreWindow=new wwa_message.ScoreWindow(h,new z(50,50),!1,l.$id("wwa-wrapper"));h._setProgressBar(d(3,4,wwa_data.LoadStage.GAME_INIT));h._isLoadedSound=!1;h._temporaryInputDisable=!1;h._paintSkipByDoorOpen=!1;h._clearFacesInNextFrame=!1;h._useConsole=!1;h.clearFaces();
h._cgManager=new m(a,y,h._wwaData.mapCGName,function(){if("ON"===h._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE])h._isLoadedSound=!0,h.setMessageQueue("\u30b2\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\u753b\u9762\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u203biOS, Android\u7aef\u672b\u3067\u306f\u3001\u97f3\u697d\u306f\u518d\u751f\u3055\u308c\u306a\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002",!1,!0),h.loadSound(),setTimeout(h.soundCheckCaller,
c.DEFAULT_FRAME_INTERVAL,h);else if("OFF"===h._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE])h._isLoadedSound=!1,h.setMessageQueue("\u30b2\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\u753b\u9762\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002",!1,!0),h.openGameWindow();else{h._messageWindow.setMessage((""===h._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE]?"\u52b9\u679c\u97f3\u30fb\uff22\uff27\uff2d\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9\u3057\u307e\u3059\u304b\uff1f":
h._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE])+"\n\u203biOS, Android\u7aef\u672b\u3067\u306f\u3001\u9078\u629e\u306b\u95a2\u308f\u3089\u305a\u97f3\u697d\u304c\u518d\u751f\u3055\u308c\u306a\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002");h._messageWindow.show();h._setProgressBar(d(4,4,wwa_data.LoadStage.GAME_INIT));var a=setInterval(function(){h._keyStore.update();if(h._yesNoJudgeInNextFrame===wwa_data.YesNoState.UNSELECTED)if(h._keyStore.getKeyState(b.KEY_ENTER)===p.KEYDOWN||h._keyStore.getKeyState(b.KEY_Y)===
p.KEYDOWN)h._yesNoJudgeInNextFrame=wwa_data.YesNoState.YES;else if(h._keyStore.getKeyState(b.KEY_N)===p.KEYDOWN||h._keyStore.getKeyState(b.KEY_ESC)===p.KEYDOWN)h._yesNoJudgeInNextFrame=wwa_data.YesNoState.NO;h._yesNoJudgeInNextFrame===wwa_data.YesNoState.YES?(clearInterval(a),h._messageWindow.update(),h._yesNoJudge=h._yesNoJudgeInNextFrame,h._messageWindow.setInputDisable(),setTimeout(function(){h._messageWindow.update();setTimeout(function(){h._messageWindow.hide();h._yesNoJudge=wwa_data.YesNoState.UNSELECTED;
h._yesNoJudgeInNextFrame=wwa_data.YesNoState.UNSELECTED;h._isLoadedSound=!0;h.loadSound();setTimeout(h.soundCheckCaller,c.DEFAULT_FRAME_INTERVAL,h)},c.YESNO_PRESS_DISP_FRAME_NUM*c.DEFAULT_FRAME_INTERVAL)},c.DEFAULT_FRAME_INTERVAL)):h._yesNoJudgeInNextFrame===wwa_data.YesNoState.NO&&(clearInterval(a),h._messageWindow.update(),h._yesNoJudge=h._yesNoJudgeInNextFrame,h._messageWindow.setInputDisable(),setTimeout(function(){h._messageWindow.update();setTimeout(function(){h._messageWindow.hide();h._yesNoJudge=
wwa_data.YesNoState.UNSELECTED;h._yesNoJudgeInNextFrame=wwa_data.YesNoState.UNSELECTED;h._isLoadedSound=!1;h.openGameWindow()},c.YESNO_PRESS_DISP_FRAME_NUM*c.DEFAULT_FRAME_INTERVAL)},c.DEFAULT_FRAME_INTERVAL))},c.DEFAULT_FRAME_INTERVAL)}})}},wwap_mode||void 0===Worker){if(external_script_inject_mode){if(y=document.getElementById("wwaloader-ex"),!y.src.match(/^http:\/\/wwawing\.com/)&&!y.src.match(/^http:\/\/www\.wwawing\.com/))throw Error("SCRIPT ORIGIN ERROR");}else y=document.createElement("script"),
y.src=wwap_mode?c.WWAP_SERVER+"/"+c.WWAP_SERVER_LOADER_NO_WORKER:"wwaload.noworker.js",document.getElementsByTagName("head")[0].appendChild(y);var g=this;postMessage_noWorker=function(a){g._loadHandler(a)};try{loader_start({data:{fileName:a+"?date="+e}})}catch(f){y.onload=function(){loader_start({data:{fileName:a+"?date="+e}})}}}else try{var v=new Worker(y+"?date="+e);v.postMessage({fileName:a+"?date="+e});v.addEventListener("message",this._loadHandler)}catch(f){alert("\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u306e\u30ed\u30fc\u30c9\u6642\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002:\nWebWorker\u306e\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"+
f.message)}}f.prototype._setProgressBar=function(a){a.stage<=c.LOAD_STAGE_MAX_EXCEPT_AUDIO?(wwa_util.$id("progress-message-container").textContent=a.stage===c.LOAD_STAGE_MAX_EXCEPT_AUDIO?"World Name: "+this._wwaData.worldName:wwa_data.loadMessages[a.stage],wwa_util.$id("progress-bar").style.width=(1*a.stage+a.current/a.total*1)/(c.LOAD_STAGE_MAX_EXCEPT_AUDIO+1)*c.MAP_WINDOW_WIDTH+"px",wwa_util.$id("progress-disp").textContent=((1*a.stage+a.current/a.total*1)/(c.LOAD_STAGE_MAX_EXCEPT_AUDIO+1)*100).toFixed(2)+
"%"):(wwa_util.$id("progress-message-container").textContent="\u52b9\u679c\u97f3/BGM\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002(\u30b9\u30da\u30fc\u30b9\u30ad\u30fc\u3067\u30b9\u30ad\u30c3\u30d7\uff09",wwa_util.$id("progress-bar-audio").style.width=a.current*c.MAP_WINDOW_WIDTH/a.total+"px",wwa_util.$id("progress-disp").textContent=(a.current/a.total*100).toFixed(2)+"%")};f.prototype.createAudioJSInstance=function(a,b){if(0!==a&&void 0===this._audioJSInstances[a]&&a!==wwa_data.SystemSound.NO_SOUND){var n=
wwap_mode?c.WWAP_SERVER+"/"+c.WWAP_SERVER_AUDIO_DIR+"/"+a+".mp3":this._audioDirectory+a+".mp3",d=new Audio(n);d.preload="auto";a>=wwa_data.SystemSound.BGM_LB&&(d.loop=!0);l.$id("wwa-audio-wrapper").appendChild(d);this._audioJSInstances[a]=audiojs.create(d);a<wwa_data.SystemSound.BGM_LB&&(n=new Audio(n),n.preload="auto",l.$id("wwa-audio-wrapper").appendChild(n),this._audioJSInstancesSub[a]=audiojs.create(n))}};f.prototype.loadSound=function(){this._audioJSInstances=Array(c.SOUND_MAX+1);this._audioJSInstancesSub=
Array(c.SOUND_MAX+1);this.createAudioJSInstance(wwa_data.SystemSound.DECISION);this.createAudioJSInstance(wwa_data.SystemSound.ATTACK);for(var a=1;a<this._wwaData.mapPartsMax;a++){var b=this._wwaData.mapAttribute[a][c.ATR_SOUND];this.createAudioJSInstance(b)}for(a=1;a<this._wwaData.objPartsMax;a++)this._wwaData.objectAttribute[a][c.ATR_TYPE]!==c.OBJECT_RANDOM&&(b=this._wwaData.objectAttribute[a][c.ATR_SOUND],this.createAudioJSInstance(b));this._wwaData.bgm=0;this._soundLoadSkipFlag=!1};f.prototype.checkAllSoundLoaded=
function(){var a=0,b=0;this._keyStore.update();this._keyStore.getKeyState(wwa_input.KeyCode.KEY_SPACE)===wwa_input.KeyState.KEYDOWN&&(this._soundLoadSkipFlag=!0);for(var n=1;n<=c.SOUND_MAX;n++)void 0===this._audioJSInstances[n]||this._audioJSInstances[n].wrapper.classList.contains("error")||(b++,this._audioJSInstances[n].wrapper.classList.contains("loading")||a++);a<b&&!this._soundLoadSkipFlag?(this._setProgressBar(d(a,b,wwa_data.LoadStage.AUDIO)),setTimeout(this.soundCheckCaller,c.DEFAULT_FRAME_INTERVAL,
this)):(this._setProgressBar(d(c.SOUND_MAX,c.SOUND_MAX,wwa_data.LoadStage.AUDIO)),this.openGameWindow())};f.prototype.playSound=function(a){var b=this;if(this._isLoadedSound){if(0>a||a>c.SOUND_MAX)throw Error("\u30b5\u30a6\u30f3\u30c9\u756a\u53f7\u304c\u7bc4\u56f2\u5916\u3067\u3059\u3002");if(!(a>=wwa_data.SystemSound.BGM_LB&&this._wwaData.bgm===a)&&((a===wwa_data.SystemSound.NO_SOUND||a>=wwa_data.SystemSound.BGM_LB)&&0!==this._wwaData.bgm&&(this._audioJSInstances[this._wwaData.bgm].wrapper.classList.contains("loading")||
this._audioJSInstances[this._wwaData.bgm].pause(),this._wwaData.bgm=0),0!==a&&a!==wwa_data.SystemSound.NO_SOUND))if(this._audioJSInstances[a].wrapper.classList.contains("loading")){if(a>=wwa_data.SystemSound.BGM_LB){var n=function(a,w){var c=setInterval(function(){w._wwaData.bgm===a?w._audioJSInstances[a].wrapper.classList.contains("loading")||(b._audioJSInstances[a].skipTo(0),b._audioJSInstances[a].play(),b._wwaData.bgm=a,clearInterval(c)):(clearInterval(c),w._wwaData.bgm!==wwa_data.SystemSound.NO_SOUND&&
n(w._wwaData.bgm,w))},4)};n(a,this)}this._wwaData.bgm=a}else 0===a||this._audioJSInstances[a].wrapper.classList.contains("error")||(a>=wwa_data.SystemSound.BGM_LB?(this._audioJSInstances[a].skipTo(0),this._audioJSInstances[a].play(),this._wwaData.bgm=a):this._nextSoundIsSub?(this._audioJSInstancesSub[a].skipTo(0),this._audioJSInstancesSub[a].play(),this._nextSoundIsSub=!1):(this._audioJSInstances[a].skipTo(0),this._audioJSInstances[a].play(),this._nextSoundIsSub=!0))}};f.prototype.openGameWindow=
function(){var a=this,b=this._player.getPosition();l.$id("wwa-cover").style.opacity="0";0!==this.getObjectIdByPosition(b)&&this._player.setPartsAppearedFlag();setTimeout(function(){l.$id("wwa-wrapper").removeChild(l.$id("wwa-cover"));a._main()},c.SPLASH_SCREEN_DISP_MILLS)};f.prototype.mainCaller=function(a){a._main()};f.prototype.soundCheckCaller=function(a){a.checkAllSoundLoaded()};f.prototype.onselectitem=function(a){if(this._player.canUseItem(a))if(wwa_util.$id("item"+(a-1)).classList.add("onpress"),
this.playSound(wwa_data.SystemSound.DECISION),"BLANK"===this._wwaData.message[wwa_data.SystemMessage1.USE_ITEM]){this._player.readyToUseItem(a);a=this._player.useItem();var b=this.getObjectAttributeById(a,c.ATR_STRING);this.setMessageQueue(this.getMessageById(b),!1,!1,a,wwa_data.PartsType.OBJECT,this._player.getPosition().getPartsCoord())}else this.setMessageQueue(""===this._wwaData.message[wwa_data.SystemMessage1.USE_ITEM]?"\u3053\u306e\u30a2\u30a4\u30c6\u30e0\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b?":
this._wwaData.message[wwa_data.SystemMessage1.USE_ITEM],!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_ITEM_USE,this._yesNoUseItemPos=a};f.prototype.onselectbutton=function(a,b){void 0===b&&(b=!1);var c=wwa_util.$id(wwa_data.sidebarButtonCellElementID[a]);this.playSound(wwa_data.SystemSound.DECISION);c.classList.add("onpress");if(a===wwa_data.SidebarButton.QUICK_LOAD)if(void 0===this._quickSaveData||b)this.onpasswordloadcalled();else this.setMessageQueue("\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u304b\uff1f\n\u2192\uff2e\uff4f\u3067\u30c7\u30fc\u30bf\u5fa9\u5e30\u7528\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\n\u3000\u5165\u529b\u9078\u629e\u304c\u3067\u304d\u307e\u3059\u3002",
!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_QUICK_LOAD;else a===wwa_data.SidebarButton.QUICK_SAVE?this._wwaData.disableSaveFlag?this.setMessageQueue("\u3053\u3053\u3067\u306f\u30bb\u30fc\u30d6\u6a5f\u80fd\u306f\n\u4f7f\u7528\u3067\u304d\u307e\u305b\u3093\u3002",!1,!0):(this.setMessageQueue("\u30c7\u30fc\u30bf\u306e\u4e00\u6642\u4fdd\u5b58\u3092\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f\n\u2192\uff2e\uff4f\u3067\u30c7\u30fc\u30bf\u5fa9\u5e30\u7528\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\n\u3000\u8868\u793a\u9078\u629e\u304c\u3067\u304d\u307e\u3059\u3002",
!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_QUICK_SAVE):a===wwa_data.SidebarButton.RESTART_GAME?(this.setMessageQueue("\u521d\u3081\u304b\u3089\u30b9\u30bf\u30fc\u30c8\u3057\u306a\u304a\u3057\u307e\u3059\u304b\uff1f",!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_RESTART_GAME):a===wwa_data.SidebarButton.GOTO_WWA&&(this.setMessageQueue("\uff37\uff37\uff21\u306e\u516c\u5f0f\u30b5\u30a4\u30c8\u3092\u958b\u304d\u307e\u3059\u304b\uff1f",!0,!0),this._yesNoChoiceCallInfo=
wwa_data.ChoiceCallInfo.CALL_BY_GOTO_WWA)};f.prototype.onpasswordloadcalled=function(){wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.add("onpress");this.setMessageQueue("\u30c7\u30fc\u30bf\u5fa9\u5e30\u7528\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u307e\u3059\u304b\uff1f",!0,!0);this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_LOAD};f.prototype.onpasswordsavecalled=function(){wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.add("onpress");
this._wwaData.disableSaveFlag?this.setMessageQueue("\u3053\u3053\u3067\u306f\u30bb\u30fc\u30d6\u6a5f\u80fd\u306f\n\u4f7f\u7528\u3067\u304d\u307e\u305b\u3093\u3002",!1,!0):(this.setMessageQueue("\u30c7\u30fc\u30bf\u5fa9\u5e30\u7528\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8868\u793a\u3057\u307e\u3059\u304b\uff1f",!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_SAVE)};f.prototype.onchangespeed=function(a){a=a===wwa_data.SpeedChange.UP?this._player.speedUp():this._player.speedDown();
this.setMessageQueue("\u79fb\u52d5\u901f\u5ea6\u3092\u3010"+wwa_data.speedNameList[a]+"\u3011\u306b\u5207\u308a\u66ff\u3048\u307e\u3057\u305f\u3002\n"+(a===c.MAX_SPEED_INDEX?"\u6226\u95d8\u3082\u901f\u304f\u306a\u308a\u307e\u3059\u3002\n":"")+"("+(c.MAX_SPEED_INDEX+1)+"\u6bb5\u968e\u4e2d"+(a+1)+"\uff09 \u901f\u5ea6\u3092\u843d\u3068\u3059\u306b\u306fI\u30ad\u30fc, \u901f\u5ea6\u3092\u4e0a\u3052\u308b\u306b\u306fP\u30ad\u30fc\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002",!1,!0)};f.prototype._main=
function(){var w=this;this._temporaryInputDisable=!1;this._waitTimeInCurrentFrame=c.DEFAULT_FRAME_INTERVAL;this._stopUpdateByLoadFlag=!1;5<=this._accX&&5>this._accXPrev&&this._keyStore.setPressInfo(b.KEY_LEFT);5>this._accX&&5<=this._accXPrev&&this._keyStore.setReleaseInfo(b.KEY_LEFT);-5>=this._accX&&-5<this._accXPrev&&this._keyStore.setPressInfo(b.KEY_RIGHT);-5<this._accX&&-5>=this._accXPrev&&this._keyStore.setReleaseInfo(b.KEY_RIGHT);5<=this._accY&&5>this._accYPrev&&this._keyStore.setPressInfo(b.KEY_DOWN);
5>this._accY&&5<=this._accYPrev&&this._keyStore.setReleaseInfo(b.KEY_DOWN);-5>=this._accY&&-5<this._accYPrev&&this._keyStore.setPressInfo(b.KEY_UP);-5<this._accY&&-5>=this._accYPrev&&this._keyStore.setReleaseInfo(b.KEY_UP);this._accXPrev=this._accX;this._accYPrev=this._accY;this._keyStore.update();this._mouseStore.update();void 0!==this._yesNoJudgeInNextFrame&&(this._yesNoJudge=this._yesNoJudgeInNextFrame,this._yesNoJudgeInNextFrame=void 0);this._clearFacesInNextFrame&&(this.clearFaces(),this._clearFacesInNextFrame=
!1);for(var y=0;y<this._execMacroListInNextFrame.length;y++)this._execMacroListInNextFrame[y].execute();""===this._lastMessage.message&&this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0);this._execMacroListInNextFrame=[];this._player.getPosition();y=this._player.getDir();if(this._player.isControllable()){if(this._keyStore.getKeyStateForControllPlayer(b.KEY_LEFT)===wwa_input.KeyState.KEYDOWN||
this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.LEFT)===wwa_input.MouseState.MOUSEDOWN)this._player.controll(wwa_data.Direction.LEFT),this._objectMovingDataManager.update();else if(this._keyStore.getKeyStateForControllPlayer(b.KEY_UP)===wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.UP)===wwa_input.MouseState.MOUSEDOWN)this._player.controll(wwa_data.Direction.UP),this._objectMovingDataManager.update();else if(this._keyStore.getKeyStateForControllPlayer(b.KEY_RIGHT)===
wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.RIGHT)===wwa_input.MouseState.MOUSEDOWN)this._player.controll(wwa_data.Direction.RIGHT),this._objectMovingDataManager.update();else if(this._keyStore.getKeyStateForControllPlayer(b.KEY_DOWN)===wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.DOWN)===wwa_input.MouseState.MOUSEDOWN)this._player.controll(wwa_data.Direction.DOWN),this._objectMovingDataManager.update();
else if(this._keyStore.checkHitKey(wwa_data.dirToKey[y]))this._player.controll(y),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_LEFT)||this._mouseStore.checkClickMouse(wwa_data.Direction.LEFT))this._player.controll(wwa_data.Direction.LEFT),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_UP)||this._mouseStore.checkClickMouse(wwa_data.Direction.UP))this._player.controll(wwa_data.Direction.UP),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_RIGHT)||
this._mouseStore.checkClickMouse(wwa_data.Direction.RIGHT))this._player.controll(wwa_data.Direction.RIGHT),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_DOWN)||this._mouseStore.checkClickMouse(wwa_data.Direction.DOWN))this._player.controll(wwa_data.Direction.DOWN),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_LEFT)||this._mouseStore.checkClickMouse(wwa_data.Direction.LEFT))this._player.controll(wwa_data.Direction.LEFT),this._objectMovingDataManager.update();
else if(this._keyStore.checkHitKey(b.KEY_UP)||this._mouseStore.checkClickMouse(wwa_data.Direction.UP))this._player.controll(wwa_data.Direction.UP),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_RIGHT)||this._mouseStore.checkClickMouse(wwa_data.Direction.RIGHT))this._player.controll(wwa_data.Direction.RIGHT),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_DOWN)||this._mouseStore.checkClickMouse(wwa_data.Direction.DOWN))this._player.controll(wwa_data.Direction.DOWN),
this._objectMovingDataManager.update();else if(this._keyStore.getKeyState(b.KEY_1)===wwa_input.KeyState.KEYDOWN)this.onselectitem(1);else if(this._keyStore.getKeyState(b.KEY_2)===wwa_input.KeyState.KEYDOWN)this.onselectitem(2);else if(this._keyStore.getKeyState(b.KEY_3)===wwa_input.KeyState.KEYDOWN)this.onselectitem(3);else if(this._keyStore.getKeyState(b.KEY_Q)===wwa_input.KeyState.KEYDOWN)this.onselectitem(4);else if(this._keyStore.getKeyState(b.KEY_W)===wwa_input.KeyState.KEYDOWN)this.onselectitem(5);
else if(this._keyStore.getKeyState(b.KEY_E)===wwa_input.KeyState.KEYDOWN)this.onselectitem(6);else if(this._keyStore.getKeyState(b.KEY_A)===wwa_input.KeyState.KEYDOWN)this.onselectitem(7);else if(this._keyStore.getKeyState(b.KEY_S)===wwa_input.KeyState.KEYDOWN)this.onselectitem(8);else if(this._keyStore.getKeyState(b.KEY_D)===wwa_input.KeyState.KEYDOWN)this.onselectitem(9);else if(this._keyStore.getKeyState(b.KEY_Z)===wwa_input.KeyState.KEYDOWN)this.onselectitem(10);else if(this._keyStore.getKeyState(b.KEY_X)===
wwa_input.KeyState.KEYDOWN)this.onselectitem(11);else if(this._keyStore.getKeyState(b.KEY_C)===wwa_input.KeyState.KEYDOWN)this.onselectitem(12);else if(this._keyStore.getKeyState(b.KEY_I))this.onchangespeed(wwa_data.SpeedChange.DOWN);else if(this._keyStore.checkHitKey(b.KEY_P))this.onchangespeed(wwa_data.SpeedChange.UP);else if(this._keyStore.getKeyState(b.KEY_F1)===wwa_input.KeyState.KEYDOWN||this._keyStore.getKeyState(b.KEY_M)===wwa_input.KeyState.KEYDOWN)this.launchBattleEstimateWindow();else if(this._keyStore.checkHitKey(b.KEY_F3))this.playSound(wwa_data.SystemSound.DECISION),
this.onselectbutton(wwa_data.SidebarButton.QUICK_LOAD,!0);else if(this._keyStore.checkHitKey(b.KEY_F4))this.playSound(wwa_data.SystemSound.DECISION),this.onpasswordsavecalled();else if(this._keyStore.checkHitKey(b.KEY_F5))this.onselectbutton(wwa_data.SidebarButton.QUICK_LOAD);else if(this._keyStore.checkHitKey(b.KEY_F6))this.onselectbutton(wwa_data.SidebarButton.QUICK_SAVE);else if(this._keyStore.checkHitKey(b.KEY_F7))this.onselectbutton(wwa_data.SidebarButton.RESTART_GAME);else if(this._keyStore.checkHitKey(b.KEY_F8))this.onselectbutton(wwa_data.SidebarButton.GOTO_WWA);
else this._keyStore.checkHitKey(b.KEY_F12)&&this._displayHelp();this._keyStore.memorizeKeyStateOnControllableFrame();this._mouseStore.memorizeMouseStateOnControllableFrame()}else if(this._player.isJumped())this._camera.isResetting()||this._player.processAfterJump();else if(this._player.isMoving())this._player.move(),this._objectMovingDataManager.update();else if(this._player.isWaitingMessage())if(this._messageWindow.isVisible()||this._messageWindow.show(),!this._messageWindow.isYesNoChoice()){var y=
this._keyStore.getKeyStateForMessageCheck(b.KEY_ENTER),n=this._keyStore.getKeyStateForMessageCheck(b.KEY_SPACE),d=this._keyStore.getKeyStateForMessageCheck(b.KEY_ESC);if(y===p.KEYDOWN||y===p.KEYPRESS_MESSAGECHANGE||n===p.KEYDOWN||n===p.KEYPRESS_MESSAGECHANGE||d===p.KEYDOWN||d===p.KEYPRESS_MESSAGECHANGE||this._mouseStore.getMouseState()===a.MOUSEDOWN){for(y=0;y<wwa_data.sidebarButtonCellElementID.length;y++)n=wwa_util.$id(wwa_data.sidebarButtonCellElementID[y]),n.classList.contains("onpress")&&n.classList.remove("onpress");
this._setNextMessage()}}else{if(!this._messageWindow.isInputDisable()){if(this._yesNoJudge===wwa_data.YesNoState.UNSELECTED)if(this._keyStore.getKeyState(b.KEY_ENTER)===p.KEYDOWN||this._keyStore.getKeyState(b.KEY_Y)===p.KEYDOWN)this._yesNoJudge=wwa_data.YesNoState.YES;else if(this._keyStore.getKeyState(b.KEY_N)===p.KEYDOWN||this._keyStore.getKeyState(b.KEY_ESC)===p.KEYDOWN)this._yesNoJudge=wwa_data.YesNoState.NO;this._yesNoJudge===wwa_data.YesNoState.YES?(this.playSound(wwa_data.SystemSound.DECISION),
this._yesNoDispCounter=c.YESNO_PRESS_DISP_FRAME_NUM,this._messageWindow.setInputDisable(),this._messageWindow.update()):this._yesNoJudge===wwa_data.YesNoState.NO&&(this.playSound(wwa_data.SystemSound.DECISION),this._yesNoDispCounter=c.YESNO_PRESS_DISP_FRAME_NUM,this._messageWindow.setInputDisable(),this._messageWindow.update())}}else this._player.isWatingEstimateWindow()?this._keyStore.getKeyState(b.KEY_ENTER)!==p.KEYDOWN&&this._keyStore.getKeyState(b.KEY_SPACE)!==p.KEYDOWN||this.hideBattleEstimateWindow():
this._player.isFighting()?(this._player.fight(),this._monsterWindow.update(this._monster)):this._player.isWaitingMoveMacro()&&(this._player.isMoveObjectAutoExecTime()&&(this.moveObjects(!1),this._player.resetMoveObjectAutoExecTimer()),this._objectMovingDataManager.update());this._prevFrameEventExected=!1;this._player.getPosition().isJustPosition()&&this._camera.getPosition().isScreenTopPosition()&&(this._player.isJumped()||this._player.isWaitingMessage()||this._player.isWaitingMoveMacro()||this._player.isFighting()||
(this._player.isPartsAppearedTime()&&this._player.clearPartsAppearedFlag(),this._replaceRandomObjectsInScreen(),(y=this.checkMap())||this.checkObject(),this._prevFrameEventExected=y),this._player.isWaitingMessage()&&this._messageWindow.isYesNoChoice()&&this._yesNoJudge!==wwa_data.YesNoState.UNSELECTED&&!this._player.isWaitingMoveMacro()&&!this._player.isFighting()&&this._execChoiceWindowRunningEvent());this._passwordLoadExecInNextFrame&&(this._stopUpdateByLoadFlag=!0,this._loadType=wwa_data.LoadType.PASSWORD,
this._player.clearPasswordWindowWaiting(),this._passwordLoadExecInNextFrame=!1);this._drawAll();this._mainCallCounter++;this._mainCallCounter%=1E9;this._animationCounter=(this._animationCounter+1)%(2*c.ANIMATION_REP_HALF_FRAME);this._camera.isResetting()&&this._camera.advanceTransitionStepNum();this._player.isWaitingMessage()||(this._player.decrementLookingAroundTimer(),0<this._statusPressCounter.energy&&0===--this._statusPressCounter.energy&&wwa_util.$id("disp-energy").classList.remove("onpress"),
0<this._statusPressCounter.strength&&0===--this._statusPressCounter.strength&&wwa_util.$id("disp-strength").classList.remove("onpress"),0<this._statusPressCounter.defence&&0===--this._statusPressCounter.defence&&wwa_util.$id("disp-defence").classList.remove("onpress"),0<this._statusPressCounter.gold&&0===--this._statusPressCounter.gold&&wwa_util.$id("disp-gold").classList.remove("onpress"));this._player.isWaitingMoveMacro()&&this._player.decrementMoveObjectAutoExecTimer();this._stopUpdateByLoadFlag?
this._fadeout(function(){w._loadType===wwa_data.LoadType.QUICK_LOAD?w._quickLoad():w._loadType===wwa_data.LoadType.RESTART_GAME?w._restartGame():w._loadType===wwa_data.LoadType.PASSWORD&&(w._applyQuickLoad(w._passwordSaveExtractData),w._passwordSaveExtractData=void 0);setTimeout(w.mainCaller,w._waitTimeInCurrentFrame,w)}):setTimeout(this.mainCaller,this._waitTimeInCurrentFrame,this)};f.prototype._drawAll=function(){var a=this._camera.getPosition().getPartsCoord(),b=this._camera.getPosition().getOffsetCoord(),
n=c.MAP_WINDOW_HEIGHT,d;d=this._player.getPosition().getPartsCoord();if(this._paintSkipByDoorOpen)this._paintSkipByDoorOpen=!1;else{this._cgManager.clearCanvas(0,0,c.MAP_WINDOW_WIDTH,c.MAP_WINDOW_HEIGHT);this._cgManager.drawBase(0,0,c.MAP_WINDOW_WIDTH,c.MAP_WINDOW_HEIGHT);if(this._camera.isResetting()){if(null!==this._camera.getPreviousPosition())var h=this._camera.getPreviousPosition().getPartsCoord(),f=this._camera.getPreviousPosition().getOffsetCoord();n=this._camera.getTransitionStepNum()*c.CHIP_SIZE;
this._drawMap(h,f,n,!0);this._drawPlayer(h,f,n,!0);this._drawObjects(h,f,n,!0);if(this._camera.isFinalStep())var e=255,g=setInterval(function(){var a=wwa_util.$id("wwa-fader");e-=3*c.FADEOUT_SPEED;0>=e?(clearInterval(g),a.style.backgroundColor="transparent",a.removeAttribute("style"),a.style.display="none"):a.style.opacity=e/255+""},20)}this._drawMap(a,b,n);this._drawPlayer(a,b,n);this._drawObjects(a,b,n);this._player.isFighting()&&!this._player.isBattleStartFrame()&&(n=this._player.isTurn()?this._monster.position.x:
d.x,d=this._player.isTurn()?this._monster.position.y:d.y,this._cgManager.drawCanvas(this._battleEffectCoord.x,this._battleEffectCoord.y,c.CHIP_SIZE*(n-a.x)-b.x,c.CHIP_SIZE*(d-a.y)-b.y,!1));this._drawEffect();this._drawFaces();this._drawFrame()}};f.prototype._drawMap=function(a,b,n,d){void 0===d&&(d=!1);if(void 0!==a)for(var h=Math.min(this._wwaData.mapWidth-1,a.x+c.H_PARTS_NUM_IN_WINDOW),f=Math.max(0,a.y-1),e=Math.min(this._wwaData.mapWidth-1,a.y+c.V_PARTS_NUM_IN_WINDOW),g=Math.max(0,a.x-1);g<=h;g++)for(var k=
f;k<=e;k++){var l=this._wwaData.map[k][g],v=this._wwaData.mapAttribute[l][c.ATR_X]/c.CHIP_SIZE,l=this._wwaData.mapAttribute[l][c.ATR_Y]/c.CHIP_SIZE,A=c.CHIP_SIZE*(g-a.x)-b.x,m=c.CHIP_SIZE*(k-a.y)-b.y;d?this._cgManager.drawCanvasWithLowerYLimit(v,l,A,m,n):this._cgManager.drawCanvasWithUpperYLimit(v,l,A,m,n)}};f.prototype._drawPlayer=function(a,b,n,d){void 0===d&&(d=!1);if(void 0!==a&&!this._wwaData.delPlayerFlag){var h=this._player.getPosition().getPartsCoord(),f=this._player.getPosition().getOffsetCoord(),
e=wwa_data.dirToPos[this._player.getDir()],g=(h.x-a.x)*c.CHIP_SIZE+f.x-b.x;a=(h.y-a.y)*c.CHIP_SIZE+f.y-b.y;b=this._player.getDir();h=[2,3,4,5,0,1,6,7];f=this._player.isLookingAround()&&!this._player.isWaitingMessage()?this._wwaData.playerImgPosX+h[Math.floor(this._mainCallCounter%64/8)]:(b===wwa_data.Direction.LEFT||b===wwa_data.Direction.RIGHT)&&Math.abs(f.x)>Math.floor(c.CHIP_SIZE/2)||(b===wwa_data.Direction.UP||b===wwa_data.Direction.DOWN)&&Math.abs(f.y)>Math.floor(c.CHIP_SIZE/2)?this._wwaData.playerImgPosX+
e+1:this._wwaData.playerImgPosX+e;d?this._cgManager.drawCanvasWithLowerYLimit(f,this._wwaData.playerImgPosY,g,a,n):this._cgManager.drawCanvasWithUpperYLimit(f,this._wwaData.playerImgPosY,g,a,n)}};f.prototype._drawObjects=function(a,b,n,d){void 0===d&&(d=!1);if(void 0!==a)for(var h=Math.min(this._wwaData.mapWidth-1,a.x+c.H_PARTS_NUM_IN_WINDOW),f=Math.max(0,a.y-1),e=Math.min(this._wwaData.mapWidth-1,a.y+c.V_PARTS_NUM_IN_WINDOW),g,l=Math.max(0,a.x-1);l<=h;l++)for(var k=f;k<=e;k++)if(!(this._player.isFighting()&&
this._player.isTurn()&&this._player.getPosition().getPartsCoord().equals(this._monster.position)&&(new wwa_data.Coord(l,k)).equals(this._monster.position))){var v=this._wwaData.mapObject[k][l];g=new z(0,0);if(this._wwaData.objectAttribute[v][c.ATR_MOVE]!==wwa_data.MoveType.STATIC){var A=this._objectMovingDataManager.getOffsetByBeforePartsCoord(new z(l,k));null!==A&&(g=A)}var m=this._animationCounter>c.ANIMATION_REP_HALF_FRAME||0===this._wwaData.objectAttribute[v][c.ATR_X2]&&0===this._wwaData.objectAttribute[v][c.ATR_Y2],
A=this._wwaData.objectAttribute[v][m?c.ATR_X:c.ATR_X2]/c.CHIP_SIZE,m=this._wwaData.objectAttribute[v][m?c.ATR_Y:c.ATR_Y2]/c.CHIP_SIZE,q=c.CHIP_SIZE*(l-a.x)+g.x-b.x;g=c.CHIP_SIZE*(k-a.y)+g.y-b.y;var p=this._wwaData.objectAttribute[v][c.ATR_TYPE],r=this._wwaData.objectAttribute[v][c.ATR_NUMBER];0===v||this._checkNoDrawObject(new z(l,k),p,r)||(d?this._cgManager.drawCanvasWithLowerYLimit(A,m,q,g,n):this._cgManager.drawCanvasWithUpperYLimit(A,m,q,g,n))}};f.prototype._drawEffect=function(){if(0!==this._wwaData.effectCoords.length)for(var a=
Math.floor(this._mainCallCounter%(this._wwaData.effectCoords.length*this._wwaData.effectWaits)/this._wwaData.effectWaits),b=0;b<c.V_PARTS_NUM_IN_WINDOW;b++)for(var n=0;n<c.H_PARTS_NUM_IN_WINDOW;n++)this._cgManager.drawCanvas(this._wwaData.effectCoords[a].x,this._wwaData.effectCoords[a].y,n*c.CHIP_SIZE,b*c.CHIP_SIZE,!1)};f.prototype._drawFaces=function(){for(var a=0;a<this._faces.length;a++)this._cgManager.drawCanvasWithSize(this._faces[a].srcPos.x,this._faces[a].srcPos.y,this._faces[a].srcSize.x,
this._faces[a].srcSize.y,this._faces[a].destPos.x,this._faces[a].destPos.y,!1)};f.prototype._drawFrame=function(){this._cgManager.drawCanvas(this._frameCoord.x,this._frameCoord.y,0,0,!1);this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y,c.MAP_WINDOW_WIDTH-c.CHIP_SIZE,0,!1);this._cgManager.drawCanvas(this._frameCoord.x,this._frameCoord.y+2,0,c.MAP_WINDOW_HEIGHT-c.CHIP_SIZE,!1);this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y+2,c.MAP_WINDOW_WIDTH-c.CHIP_SIZE,c.MAP_WINDOW_HEIGHT-
c.CHIP_SIZE,!1);for(var a=1;a<c.H_PARTS_NUM_IN_WINDOW-1;a++)this._cgManager.drawCanvas(this._frameCoord.x+1,this._frameCoord.y,c.CHIP_SIZE*a,0,!1),this._cgManager.drawCanvas(this._frameCoord.x+1,this._frameCoord.y+2,c.CHIP_SIZE*a,c.MAP_WINDOW_HEIGHT-c.CHIP_SIZE,!1);for(a=1;a<c.V_PARTS_NUM_IN_WINDOW-1;a++)this._cgManager.drawCanvas(this._frameCoord.x,this._frameCoord.y+1,0,c.CHIP_SIZE*a,!1),this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y+1,c.MAP_WINDOW_WIDTH-c.CHIP_SIZE,c.CHIP_SIZE*
a,!1)};f.prototype._checkNoDrawObject=function(a,b,n){var d=this._player.getPosition(),h=d.getPartsCoord();return!d.isJustPosition()||h.x!==a.x||h.y!==a.y||this._wwaData.objectNoCollapseDefaultFlag?!1:b===c.OBJECT_DOOR&&0===n?!0:b===c.OBJECT_STATUS||b===c.OBJECT_MESSAGE||b===c.OBJECT_ITEM||b===c.OBJECT_SELL||b===c.OBJECT_BUY||b===c.OBJECT_SELL||b===c.OBJECT_LOCALGATE};f.prototype.getMapWidth=function(){if(void 0===this._wwaData)throw Error("\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u304c\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093");
return this._wwaData.mapWidth};f.prototype.getMapIdByPosition=function(a){a=a.getPartsCoord();return this._wwaData.map[a.y][a.x]};f.prototype.getObjectIdByPosition=function(a){a=a.getPartsCoord();return this._wwaData.mapObject[a.y][a.x]};f.prototype.getMapTypeByPosition=function(a){a=a.getPartsCoord();return this._wwaData.mapAttribute[this._wwaData.map[a.y][a.x]][c.ATR_TYPE]};f.prototype.getObjectTypeByPosition=function(a){a=a.getPartsCoord();return this._wwaData.objectAttribute[this._wwaData.mapObject[a.y][a.x]][c.ATR_TYPE]};
f.prototype.getMapAttributeByPosition=function(a,b){var c=a.getPartsCoord();return this._wwaData.mapAttribute[this._wwaData.map[c.y][c.x]][b]};f.prototype.isCurrentPosMapPartsIncludingMessage=function(a){return 0!==this.getMapAttributeByPosition(a,c.ATR_STRING)};f.prototype.getObjectAttributeByPosition=function(a,b){var c=a.getPartsCoord();return this._wwaData.objectAttribute[this._wwaData.mapObject[c.y][c.x]][b]};f.prototype.getMapAttributeById=function(a,b){return this._wwaData.mapAttribute[a][b]};
f.prototype.getObjectAttributeById=function(a,b){return this._wwaData.objectAttribute[a][b]};f.prototype.getObjectCropXById=function(a){return this._wwaData.objectAttribute[a][c.ATR_X]};f.prototype.getObjectCropYById=function(a){return this._wwaData.objectAttribute[a][c.ATR_Y]};f.prototype.getMessageById=function(a){return this._wwaData.message[a]};f.prototype.getSystemMessageById=function(a){return this._wwaData.systemMessage[a]};f.prototype.checkMap=function(a){var b=this._player.getPosition().getPartsCoord();
a=void 0!==a&&null!==a?a:b;var n=this._wwaData.map[a.y][a.x],d=this._wwaData.mapAttribute[n][c.ATR_TYPE],b=a.x===b.x&&a.y===b.y,h=!1;if(b&&this._player.getLastExecPartsIDOnSamePosition(wwa_data.PartsType.MAP)===n)return!1;d===c.MAP_STREET?h=this._execMapStreetEvent(a,n,d):d===c.MAP_WALL?h=this._execMapWallEvent(a,n,d):d===c.MAP_LOCALGATE?h=this._execMapLocalGateEvent(a,n,d):d===c.MAP_URLGATE&&(h=this._execMapUrlGateEvent(a,n,d));b&&!this._player.isJumped()&&this._player.setLastExecInfoOnSamePosition(wwa_data.PartsType.MAP,
n);return h};f.prototype.checkObject=function(a){var b=this._player.getPosition().getPartsCoord();a=void 0!==a&&null!==a?a:b;var n=this._wwaData.mapObject[a.y][a.x],d=this._wwaData.objectAttribute[n][c.ATR_TYPE],b=a.x===b.x&&a.y===b.y;b&&this._player.getLastExecPartsIDOnSamePosition(wwa_data.PartsType.OBJECT)===n||(d===c.OBJECT_NORMAL?this._execObjectNormalEvent(a,n,d):d===c.OBJECT_MESSAGE?this._execObjectMessageEvent(a,n,d):d===c.OBJECT_MONSTER?this._execObjectMonsterEvent(a,n,d):d===c.OBJECT_ITEM?
this._execObjectItemEvent(a,n,d):d===c.OBJECT_DOOR?this._execObjectDoorEvent(a,n,d):d===c.OBJECT_STATUS?this._execObjectStatusEvent(a,n,d):d===c.OBJECT_BUY?this._execObjectBuyEvent(a,n,d):d===c.OBJECT_SELL?this._execObjectSellEvent(a,n,d):d===c.OBJECT_URLGATE?this._execObjectUrlGateEvent(a,n,d):d===c.OBJECT_SCORE?this._execObjectScoreEvent(a,n,d):d===c.OBJECT_SELECT?this._execObjectYesNoChoiceEvent(a,n,d):d===c.OBJECT_LOCALGATE&&this._execObjectLocalGateEvent(a,n,d),b&&!this._player.isJumped()&&this._player.setLastExecInfoOnSamePosition(wwa_data.PartsType.OBJECT,
n))};f.prototype._execMapStreetEvent=function(a,b,d){d=this._wwaData.mapAttribute[b][c.ATR_ITEM];if(0!==d&&!this._player.hasItem(d))return!1;this.appearParts(a,wwa_data.AppearanceTriggerType.MAP);d=this._wwaData.mapAttribute[b][c.ATR_STRING];var f=this._wwaData.message[d];this._waitTimeInCurrentFrame+=100*this._wwaData.mapAttribute[b][c.ATR_NUMBER];this._temporaryInputDisable=!0;a=this.setMessageQueue(f,!1,!1,b,wwa_data.PartsType.MAP,a.clone());this.playSound(this._wwaData.mapAttribute[b][c.ATR_SOUND]);
return 0!==d&&a};f.prototype._execMapWallEvent=function(a,b,d){d=this.getObjectIdByPosition(a.convertIntoPosition(this));var f=this.getObjectAttributeById(d,c.ATR_TYPE);0!==d&&f!==c.OBJECT_NORMAL&&(f!==c.OBJECT_DOOR||this._player.hasItem(this.getObjectAttributeById(d,c.ATR_ITEM))&&this.getObjectAttributeById(f,c.ATR_MODE)!==c.PASSABLE_OBJECT)||(this.appearParts(a,wwa_data.AppearanceTriggerType.MAP),this.setMessageQueue(this._wwaData.message[this._wwaData.mapAttribute[b][c.ATR_STRING]],!1,!1,b,wwa_data.PartsType.MAP,
a.clone()),this.playSound(this._wwaData.mapAttribute[b][c.ATR_SOUND]));return!1};f.prototype._execMapLocalGateEvent=function(a,b,d){d=this._player.getPosition().getPartsCoord();var f=this._wwaData.mapAttribute[b][c.ATR_JUMP_X],h=this._wwaData.mapAttribute[b][c.ATR_JUMP_Y];f>c.RELATIVE_COORD_LOWER&&(f=a.x+f-c.RELATIVE_COORD_BIAS);h>c.RELATIVE_COORD_LOWER&&(h=a.y+h-c.RELATIVE_COORD_BIAS);this.appearParts(a,wwa_data.AppearanceTriggerType.MAP);return 0<=f&&0<=h&&f<this._wwaData.mapWidth&&h<this._wwaData.mapWidth&&
(f!==d.x||h!==d.y)?(this._player.jumpTo(new B(this,f,h,0,0)),this.playSound(this._wwaData.mapAttribute[b][c.ATR_SOUND]),!0):!1};f.prototype._execMapUrlGateEvent=function(a,b,d){d=this._wwaData.mapAttribute[b][c.ATR_STRING];if(!this._isURLGateEnable)return!0;if("BLANK"===this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK])location.href=wwa_util.$escapedURI(this._wwaData.message[d].split(/\s/g)[0]);else return this.setMessageQueue(""===this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK]?"\u4ed6\u306e\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f":
this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK],!0,!0),this._yesNoChoicePartsCoord=a,this._yesNoChoicePartsID=b,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_MAP_PARTS,this._yesNoURL=this._wwaData.message[d].split(/\s/g)[0],!0};f.prototype._execObjectNormalEvent=function(a,b,c){};f.prototype._execObjectMessageEvent=function(a,b,d){d=this._wwaData.message[this._wwaData.objectAttribute[b][c.ATR_STRING]];var f=this._player.getPosition().getPartsCoord(),h=this._wwaData.objectAttribute[b][c.ATR_SOUND];
a.x!==f.x||a.y!==f.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(d,!1,!1,b,wwa_data.PartsType.OBJECT,a);this._waitTimeInCurrentFrame+=100*this._wwaData.objectAttribute[b][c.ATR_NUMBER];this._temporaryInputDisable=!0;this.appearParts(a,wwa_data.AppearanceTriggerType.OBJECT,b);this.playSound(h)};f.prototype._execObjectStatusEvent=function(a,b,d){d=new wwa_data.Status(this._wwaData.objectAttribute[b][c.ATR_ENERGY],this._wwaData.objectAttribute[b][c.ATR_STRENGTH],
this._wwaData.objectAttribute[b][c.ATR_DEFENCE],this._wwaData.objectAttribute[b][c.ATR_GOLD]);var f=this._wwaData.message[this._wwaData.objectAttribute[b][c.ATR_STRING]],h=this._player.getStatusWithoutEquipments();d.strength>c.STATUS_MINUS_BORDER&&h.strength<d.strength-c.STATUS_MINUS_BORDER||d.defence>c.STATUS_MINUS_BORDER&&h.defence<d.defence-c.STATUS_MINUS_BORDER||d.gold>c.STATUS_MINUS_BORDER&&h.gold<d.gold-c.STATUS_MINUS_BORDER?(this._wwaData.mapObject[a.y][a.x]=0,this._keyStore.allClear(),this._mouseStore.clear()):
(d.energy=d.energy>c.STATUS_MINUS_BORDER?c.STATUS_MINUS_BORDER-d.energy:d.energy,d.strength=d.strength>c.STATUS_MINUS_BORDER?c.STATUS_MINUS_BORDER-d.strength:d.strength,d.defence=d.defence>c.STATUS_MINUS_BORDER?c.STATUS_MINUS_BORDER-d.defence:d.defence,d.gold=d.gold>c.STATUS_MINUS_BORDER?c.STATUS_MINUS_BORDER-d.gold:d.gold,this._player.addStatusAll(d),this.setStatusChangedEffect(d),this._player.isDead()&&0!==this._wwaData.objectAttribute[b][c.ATR_ENERGY]?this.gameover():(this.setMessageQueue(f,!1,
!1,b,wwa_data.PartsType.OBJECT,a.clone()),this._wwaData.mapObject[a.y][a.x]=0,this.appearParts(a,wwa_data.AppearanceTriggerType.OBJECT,b),this.playSound(this._wwaData.objectAttribute[b][c.ATR_SOUND])))};f.prototype._execObjectMonsterEvent=function(a,b,d){var f=this;d=new wwa_data.Coord(this._wwaData.objectAttribute[b][c.ATR_X],this._wwaData.objectAttribute[b][c.ATR_Y]);var h=new wwa_data.Status(this._wwaData.objectAttribute[b][c.ATR_ENERGY],this._wwaData.objectAttribute[b][c.ATR_STRENGTH],this._wwaData.objectAttribute[b][c.ATR_DEFENCE],
this._wwaData.objectAttribute[b][c.ATR_GOLD]);this._monster=new wwa_monster.Monster(b,a,d,h,this._wwaData.message[this._wwaData.objectAttribute[b][c.ATR_STRING]],this._wwaData.objectAttribute[b][c.ATR_ITEM],function(){f._monsterWindow.hide()});this._player.startBattleWith(this._monster)};f.prototype._execObjectBuyEvent=function(a,b,d){d=this._wwaData.message[this._wwaData.objectAttribute[b][c.ATR_STRING]];var f=this._player.getPosition().getPartsCoord();a.x!==f.x||a.y!==f.y||this._wwaData.objectNoCollapseDefaultFlag||
(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(d,!0,!1,b,wwa_data.PartsType.OBJECT,a.clone());this._yesNoChoicePartsCoord=a;this._yesNoChoicePartsID=b;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS;this.playSound(this._wwaData.objectAttribute[b][c.ATR_SOUND])};f.prototype._execObjectSellEvent=function(a,b,d){d=this._wwaData.message[this._wwaData.objectAttribute[b][c.ATR_STRING]];var f=this._player.getPosition().getPartsCoord();a.x!==f.x||a.y!==f.y||this._wwaData.objectNoCollapseDefaultFlag||
(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(d,!0,!1,b,wwa_data.PartsType.OBJECT,a.clone());this._yesNoChoicePartsCoord=a;this._yesNoChoicePartsID=b;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS;this.playSound(this._wwaData.objectAttribute[b][c.ATR_SOUND])};f.prototype._execObjectItemEvent=function(a,b,d){d=this._wwaData.message[this._wwaData.objectAttribute[b][c.ATR_STRING]];try{this._player.addItem(b,this._wwaData.objectAttribute[b][c.ATR_NUMBER]),this._wwaData.mapObject[a.y][a.x]=
0,0===this._wwaData.objectAttribute[b][c.ATR_MODE]&&(this.setMessageQueue(d,!1,!1,b,wwa_data.PartsType.OBJECT,a.clone()),this.appearParts(a,wwa_data.AppearanceTriggerType.OBJECT,b))}catch(f){"BLANK"!==this._wwaData.systemMessage[wwa_data.SystemMessage2.FULL_ITEM]&&this.setMessageQueue(""===this._wwaData.systemMessage[wwa_data.SystemMessage2.FULL_ITEM]?"\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002":this._wwaData.systemMessage[wwa_data.SystemMessage2.FULL_ITEM],
!1,!0)}this.playSound(this._wwaData.objectAttribute[b][c.ATR_SOUND])};f.prototype._execObjectDoorEvent=function(a,b,d){d=this._wwaData.objectAttribute[b][c.ATR_ITEM];var f=this._wwaData.message[this._wwaData.objectAttribute[b][c.ATR_STRING]];this._player.hasItem(d)&&(0===this._wwaData.objectAttribute[b][c.ATR_MODE]&&this._player.removeItemByPartsID(d),this.playSound(this._wwaData.objectAttribute[b][c.ATR_SOUND]),this.setMessageQueue(f,!1,!1,b,wwa_data.PartsType.OBJECT,a.clone()),this._wwaData.mapObject[a.y][a.x]=
0,this.appearParts(a,wwa_data.AppearanceTriggerType.OBJECT,b),this._paintSkipByDoorOpen=!0)};f.prototype._execObjectYesNoChoiceEvent=function(a,b,d){d=this._wwaData.message[this._wwaData.objectAttribute[b][c.ATR_STRING]];var f=this._player.getPosition().getPartsCoord();a.x!==f.x||a.y!==f.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(d,!0,!1,b,wwa_data.PartsType.OBJECT,a.clone());this._yesNoChoicePartsCoord=a;this._yesNoChoicePartsID=b;this._yesNoChoiceCallInfo=
wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS;this.playSound(this._wwaData.objectAttribute[b][c.ATR_SOUND])};f.prototype._execObjectLocalGateEvent=function(a,b,d){d=this._player.getPosition().getPartsCoord();a.x!==d.x||a.y!==d.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);var f=this._wwaData.objectAttribute[b][c.ATR_JUMP_X],h=this._wwaData.objectAttribute[b][c.ATR_JUMP_Y];f>c.RELATIVE_COORD_LOWER&&(f=d.x+f-c.RELATIVE_COORD_BIAS);h>c.RELATIVE_COORD_LOWER&&(h=d.y+
h-c.RELATIVE_COORD_BIAS);this.appearParts(a,wwa_data.AppearanceTriggerType.OBJECT,b);0<=f&&0<=h&&f<this._wwaData.mapWidth&&h<this._wwaData.mapWidth&&(f!==d.x||h!==d.y)&&(this._player.jumpTo(new B(this,f,h,0,0)),this.playSound(this._wwaData.objectAttribute[b][c.ATR_SOUND]))};f.prototype._execObjectUrlGateEvent=function(a,b,d){d=this._wwaData.objectAttribute[b][c.ATR_STRING];this._isURLGateEnable&&("BLANK"===this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK]?location.href=wwa_util.$escapedURI(this._wwaData.message[d].split(/\s/g)[0]):
(this.setMessageQueue(""===this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK]?"\u4ed6\u306e\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f":this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK],!0,!0),this._yesNoChoicePartsCoord=a,this._yesNoChoicePartsID=b,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS,this._yesNoURL=this._wwaData.message[d].split(/\s/g)[0]))};f.prototype._execObjectScoreEvent=function(a,
b,d){a=this._wwaData.objectAttribute[b][c.ATR_STRING];this._player.getPosition().getPartsCoord();d=this._player.getStatus();var f;f=0+this._wwaData.objectAttribute[b][c.ATR_ENERGY]*d.energy;f+=this._wwaData.objectAttribute[b][c.ATR_STRENGTH]*d.strength;f+=this._wwaData.objectAttribute[b][c.ATR_DEFENCE]*d.defence;f+=this._wwaData.objectAttribute[b][c.ATR_GOLD]*d.gold;this._scoreWindow.update(f);this._scoreWindow.show();this.setMessageQueue(0===a?"\u30b9\u30b3\u30a2\u3092\u8868\u793a\u3057\u307e\u3059\u3002":
this._wwaData.message[a],!1,!1);this.playSound(this._wwaData.objectAttribute[b][c.ATR_SOUND])};f.prototype._execChoiceWindowRunningEvent=function(){var a;if(0===--this._yesNoDispCounter)if(this._yesNoJudge===wwa_data.YesNoState.YES){if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_MAP_PARTS)a=this._wwaData.mapAttribute[this._yesNoChoicePartsID][c.ATR_TYPE],a===c.MAP_URLGATE&&(location.href=wwa_util.$escapedURI(this._yesNoURL));else if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS)if(a=
this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_TYPE],a===c.OBJECT_BUY)this._player.hasItem(this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_ITEM])?(this._player.removeItemByPartsID(this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_ITEM]),a=this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_GOLD],this._player.earnGold(a),this.setStatusChangedEffect(new wwa_data.Status(0,0,0,a)),this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.OBJECT,
this._yesNoChoicePartsID)):"BLANK"!==this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]&&this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]?"\u30a2\u30a4\u30c6\u30e0\u3092\u3082\u3063\u3066\u3044\u306a\u3044\u3002":this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM],!0));else if(a===c.OBJECT_SELL)if(this._player.hasGold(this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_GOLD]))if(this._player.canHaveMoreItems()||0===this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_ITEM]){0!==
this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_ITEM]&&this._player.addItem(this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_ITEM]);a=new wwa_data.Status(this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_ENERGY],this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_STRENGTH],this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_DEFENCE],-this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_GOLD]);this._player.getStatusWithoutEquipments();
a.energy=a.energy>c.STATUS_MINUS_BORDER?c.STATUS_MINUS_BORDER-a.energy:a.energy;this.setStatusChangedEffect(a);this._player.addStatusAll(a);if(this._player.isDead()&&0!==this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_ENERGY]){this.gameover();return}this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.OBJECT,this._yesNoChoicePartsID)}else"BLANK"!==this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]&&this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]?
"\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002":this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM],!0));else"BLANK"!==this._wwaData.message[wwa_data.SystemMessage1.NO_MONEY]&&this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[wwa_data.SystemMessage1.NO_MONEY]?"\u6240\u6301\u91d1\u304c\u8db3\u308a\u306a\u3044\u3002":this._wwaData.message[wwa_data.SystemMessage1.NO_MONEY],!0));else a===c.OBJECT_SELECT?this.appearParts(this._yesNoChoicePartsCoord,
wwa_data.AppearanceTriggerType.CHOICE_YES,this._yesNoChoicePartsID):a===c.OBJECT_URLGATE&&(location.href=wwa_util.$escapedURI(this._yesNoURL));else this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_ITEM_USE?this._player.readyToUseItem(this._yesNoUseItemPos):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_LOAD?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.remove("onpress"),this._stopUpdateByLoadFlag=!0,this._loadType=wwa_data.LoadType.QUICK_LOAD):
this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_SAVE?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.remove("onpress"),this._quickSave()):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_RESTART_GAME?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.RESTART_GAME]).classList.remove("onpress"),this._stopUpdateByLoadFlag=!0,this._loadType=wwa_data.LoadType.RESTART_GAME):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_GOTO_WWA?
(location.href=wwa_util.$escapedURI(c.WWA_HOME),wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.GOTO_WWA]).classList.remove("onpress")):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_LOAD?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.remove("onpress"),this._player.setPasswordWindowWating(),this._passwordWindow.show(wwa_password_window.Mode.LOAD)):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_SAVE&&
(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.remove("onpress"),this._player.setPasswordWindowWating(),this._passwordWindow.password=this._quickSave(!0),this._passwordWindow.show(wwa_password_window.Mode.SAVE));this._yesNoJudge=wwa_data.YesNoState.UNSELECTED;this._setNextMessage();this._yesNoUseItemPos=this._yesNoChoicePartsID=this._yesNoChoicePartsCoord=void 0;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE;this._messageWindow.setYesNoChoice(!1)}else if(this._yesNoJudge===
wwa_data.YesNoState.NO){if(this._yesNoChoiceCallInfo!==wwa_data.ChoiceCallInfo.CALL_BY_MAP_PARTS)if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS)a=this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_TYPE],a!==c.OBJECT_BUY&&a!==c.OBJECT_SELL&&a===c.OBJECT_SELECT&&this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.CHOICE_NO,this._yesNoChoicePartsID);else if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_ITEM_USE)wwa_util.$id("item"+
(this._yesNoUseItemPos-1)).classList.remove("onpress");else{if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_LOAD){this._yesNoJudge=wwa_data.YesNoState.UNSELECTED;this.onpasswordloadcalled();return}if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_SAVE){this._yesNoJudge=wwa_data.YesNoState.UNSELECTED;this.onpasswordsavecalled();return}this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_RESTART_GAME?wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.RESTART_GAME]).classList.remove("onpress"):
this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_GOTO_WWA?wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.GOTO_WWA]).classList.remove("onpress"):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_LOAD?wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.remove("onpress"):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_SAVE&&wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.remove("onpress")}this._yesNoJudge=
wwa_data.YesNoState.UNSELECTED;this._setNextMessage();this._yesNoUseItemPos=this._yesNoChoicePartsID=this._yesNoChoicePartsCoord=void 0;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE;this._messageWindow.setYesNoChoice(!1)}};f.prototype.setMessageQueue=function(a,b,c,d,h,f,e){void 0===d&&(d=0);void 0===h&&(h=wwa_data.PartsType.OBJECT);void 0===f&&(f=new z(0,0));void 0===e&&(e=!1);this._messageQueue=this._messageQueue.concat(this.getMessageQueueByRawMessage(a,d,h,f));this._lastMessage.isEndOfPartsEvent&&
void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0);if(0!==this._messageQueue.length){a=this._messageQueue.shift();for(d=0;d<a.macro.length;d++)this._execMacroListInNextFrame.push(a.macro[d]);this._lastMessage=a;if(""!==a.message)return this._messageWindow.setMessage(a.message),this._messageWindow.setYesNoChoice(b),this._messageWindow.setPositionByPlayerPosition(0!==this._faces.length,this._scoreWindow.isVisible(),
c,this._player.getPosition(),this._camera.getPosition()),this._player.setMessageWaiting(),!0;0===this._messageQueue.length?this._hideMessageWindow(e):this._setNextMessage()}return!1};f.prototype.getMessageQueueByRawMessage=function(a,b,c,d,h){void 0===h&&(h=!1);var f=a.split(/\n\<c\>/i)[0].split(/\<c\>/i)[0].replace(/\n\<p\>\n/ig,"<P>").replace(/\n\<p\>/ig,"<P>").replace(/\<p\>\n/ig,"<P>").replace(/\<p\>/ig,"<P>");a=[];if(""!==f)for(var f=f.split(/\<p\>/ig),e=0;e<f.length;e++){for(var g=f[e].split("\n"),
l=[],k=[],v=0;v<g.length;v++){var A=g[v].match(/(\$(?:[a-zA-Z_][a-zA-Z0-9_]*)\=(?:.*))/);null!==A&&2<=A.length?(A=wwa_message.parseMacro(this,b,c,d,A[1]),k.push(A)):g[v].match(/^\$/)||l.push(g[v])}a.push(new wwa_message.MessageInfo(l.join("\n"),h,e===f.length-1,k))}return a};f.prototype.appearParts=function(a,b,d){void 0===d&&(d=0);var f=b===wwa_data.AppearanceTriggerType.CHOICE_NO?c.APPERANCE_PARTS_MIN_INDEX_NO:c.APPERANCE_PARTS_MIN_INDEX,h=b===wwa_data.AppearanceTriggerType.CHOICE_YES?c.APPERANCE_PARTS_MAX_INDEX_YES:
c.APPERANCE_PARTS_MAX_INDEX,e,g,l,k;b===wwa_data.AppearanceTriggerType.MAP?(d=0===d?this._wwaData.map[a.y][a.x]:d,b=wwa_data.PartsType.MAP):(d=0===d?this._wwaData.mapObject[a.y][a.x]:d,b=wwa_data.PartsType.OBJECT);for(;f<=h;f++)if(g=c.ATR_APPERANCE_BASE+f*c.REL_ATR_APPERANCE_UNIT_LENGTH,e=g+c.REL_ATR_APPERANCE_ID,l=g+c.REL_ATR_APPERANCE_X,k=g+c.REL_ATR_APPERANCE_Y,g+=c.REL_ATR_APPERANCE_TYPE,e=b===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[d][e]:this._wwaData.objectAttribute[d][e],g=b===wwa_data.PartsType.MAP?
this._wwaData.mapAttribute[d][g]:this._wwaData.objectAttribute[d][g],l=b===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[d][l]:this._wwaData.objectAttribute[d][l],k=b===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[d][k]:this._wwaData.objectAttribute[d][k],l===c.PLAYER_COORD?(l=this._player.getPosition().getPartsCoord().x,this._player.resetEventExecutionInfo()):l>c.RELATIVE_COORD_LOWER&&(l=a.x+l-c.RELATIVE_COORD_BIAS),k===c.PLAYER_COORD?(k=this._player.getPosition().getPartsCoord().y,this._player.resetEventExecutionInfo()):
k>c.RELATIVE_COORD_LOWER&&(k=a.y+k-c.RELATIVE_COORD_BIAS),0!==l||0!==k)try{if(new wwa_data.Position(this,l,k,0,0),g===wwa_data.PartsType.MAP){if(e>=this._wwaData.mapPartsMax)throw Error("\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.map[k][l]=e}else{if(e>=this._wwaData.objPartsMax)throw Error("\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.mapObject[k][l]=
e;this._replaceRandomObject(new z(l,k));l===this._player.getPosition().getPartsCoord().x&&k===this._player.getPosition().getPartsCoord().y&&this._player.setPartsAppearedFlag()}}catch(v){}};f.prototype.appearPartsByDirection=function(a,b,c){var d=this._player.getPosition().getPartsCoord(),f=this._player.getDir(),e=wwa_data.vx[f],f=wwa_data.vy[f];this.appearPartsEval(d,(0<=e?"+":"-")+Math.abs(e)*a,(0<=f?"+":"-")+Math.abs(f)*a,b,c)};f.prototype.appearPartsEval=function(a,b,c,d,f){var e=this._player.getPosition().getPartsCoord();
if("P"===b||"p"===b)b=e.x;else if("+"===b[0])b=a.x+parseInt(b.substr(1));else if("-"===b[0])b=a.x-parseInt(b.substr(1));else if(b=parseInt(b),isNaN(b))throw Error("\u5ea7\u6a19\u3068\u3057\u3066\u89e3\u91c8\u3067\u304d\u306a\u3044\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002");if("P"===c||"p"===c)a=e.y;else if("+"===c[0])a=a.y+parseInt(c.substr(1));else if("-"===c[0])a=a.y-parseInt(c.substr(1));else if(a=parseInt(c),isNaN(a))throw Error("\u5ea7\u6a19\u3068\u3057\u3066\u89e3\u91c8\u3067\u304d\u306a\u3044\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002");
try{if(new wwa_data.Position(this,b,a,0,0),f===wwa_data.PartsType.MAP){if(d>=this._wwaData.mapPartsMax)throw Error("\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.map[a][b]=d}else{if(d>=this._wwaData.objPartsMax)throw Error("\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.mapObject[a][b]=d;this._replaceRandomObject(new z(b,a));b===this._player.getPosition().getPartsCoord().x&&
a===this._player.getPosition().getPartsCoord().y&&this._player.setPartsAppearedFlag()}}catch(g){}};f.prototype._replaceRandomObject=function(a){var b=this._wwaData.mapObject[a.y][a.x],d;if(this._wwaData.objectAttribute[b][c.ATR_TYPE]===c.OBJECT_RANDOM){for(var f=0;f<c.RANDOM_ITERATION_MAX;f++){d=Math.floor(10*Math.random());d=this._wwaData.objectAttribute[b][c.ATR_RANDOM_BASE+d];if(d>=this._wwaData.objPartsMax){d=0;break}if(this._wwaData.objectAttribute[d][c.ATR_TYPE]!==c.OBJECT_RANDOM)break;b=d}this._wwaData.mapObject[a.y][a.x]=
d}};f.prototype._replaceRandomObjectsInScreen=function(){for(var a=this._camera.getPosition().getPartsCoord(),b=Math.min(this._wwaData.mapWidth-1,a.x+c.H_PARTS_NUM_IN_WINDOW),d=Math.max(0,a.y-1),f=Math.min(this._wwaData.mapWidth-1,a.y+c.V_PARTS_NUM_IN_WINDOW),a=Math.max(0,a.x-1);a<=b;a++)for(var h=d;h<=f;h++)this._replaceRandomObject(new z(a,h))};f.prototype._replaceAllRandomObjects=function(){for(var a=0;a<this._wwaData.mapWidth;a++)for(var b=0;b<this._wwaData.mapWidth;b++)this._replaceRandomObject(new z(a,
b))};f.prototype.gameover=function(){var a=this._wwaData.gameoverX,b=this._wwaData.gameoverY;this._messageWindow.isVisible()&&(this._yesNoJudge=wwa_data.YesNoState.UNSELECTED,this._messageQueue=[],this._messageWindow.hide(),this._yesNoUseItemPos=this._yesNoChoicePartsID=this._yesNoChoicePartsCoord=void 0,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE,this._messageWindow.setYesNoChoice(!1));this._waitTimeInCurrentFrame=c.GAMEOVER_FRAME_INTERVAL;this._temporaryInputDisable=!0;this._player.jumpTo(new B(this,
a,b,0,0))};f.prototype.setYesNoInput=function(a){this._yesNoJudgeInNextFrame=a};f.prototype.getYesNoState=function(){return void 0!==this._yesNoJudgeInNextFrame?this._yesNoJudgeInNextFrame:this._yesNoJudge};f.prototype.setStatusChangedEffect=function(a){0!==a.strength&&(wwa_util.$id("disp-strength").classList.add("onpress"),this._statusPressCounter.strength=c.STATUS_CHANGED_EFFECT_FRAME_NUM);0!==a.defence&&(wwa_util.$id("disp-defence").classList.add("onpress"),this._statusPressCounter.defence=c.STATUS_CHANGED_EFFECT_FRAME_NUM);
a instanceof wwa_data.Status&&(0!==a.energy&&(wwa_util.$id("disp-energy").classList.add("onpress"),this._statusPressCounter.energy=c.STATUS_CHANGED_EFFECT_FRAME_NUM),0!==a.gold&&(wwa_util.$id("disp-gold").classList.add("onpress"),this._statusPressCounter.gold=c.STATUS_CHANGED_EFFECT_FRAME_NUM))};f.prototype.setPartsOnPosition=function(a,b,c){a===wwa_data.PartsType.MAP?(b>=this._wwaData.mapPartsMax&&(this._wwaData.map[c.y][c.x]=0),this._wwaData.map[c.y][c.x]=b):(b>=this._wwaData.objPartsMax&&(this._wwaData.mapObject[c.y][c.x]=
0),this._wwaData.mapObject[c.y][c.x]=b)};f.prototype._countSamePartsLength=function(a,b){var c;for(c=b+1;c<a.length&&a[c]===a[c-1];c++);return c-b};f.prototype._compressMap=function(a){for(var b=[],c=0;c<a.length;c++){b[c]=[];for(var d=0;d<a[c].length;){var f=this._countSamePartsLength(a[c],d);b[c].push([a[c][d],f]);d+=f}}return b};f.prototype._decompressMap=function(a){for(var b=[],c=0;c<a.length;c++){b[c]=[];for(var d=0;d<a[c].length;d++)for(var f=a[c][d][1],e=0;e<f;e++)b[c].push(a[c][d][0])}return b};
f.prototype._generateMapDataHash=function(a){for(var b="A",c=0,d=0,f=0,f=0;f<a.map.length;f++){for(d=0;d<a.map[f].length;)c=this._countSamePartsLength(a.map[f],d),b+=a.map[f][d]+"|"+c+"/",d+=c;for(d=0;d<a.mapObject[f].length;)c=this._countSamePartsLength(a.mapObject[f],d),b+=a.mapObject[f][d]+"|"+c+"/",d+=c}for(c=0;c<a.mapAttribute.length;c++)for(d=0;d<a.mapAttribute[c].length;d++)b+=a.mapAttribute[c][d]+"/";for(c=0;c<a.objectAttribute.length;c++)for(d=0;d<a.objectAttribute[c].length;d++)b+=a.objectAttribute[c][d]+
"/";return CryptoJS.MD5(b+"Z").toString()};f.prototype._generateSaveDataHash=function(a){var b=this._generateMapDataHash(a),c=[],d;for(d in a)"map"!==d&&"mapObject"!==d&&"mapCompressed"!==d&&"mapObjectCompressed"!==d&&"mapAttribute"!==d&&"objectAttribute"!==d&&"checkString"!==d&&c.push(d);c.sort();for(d=0;d<c.length;d++)b+=wwa_util.arr2str4save(a[c[d]]);return CryptoJS.MD5(b).toString()};f.prototype._quickSave=function(a){void 0===a&&(a=!1);var b=JSON.parse(JSON.stringify(this._wwaData)),c=this._player.getPosition().getPartsCoord(),
d=this._player.getStatusWithoutEquipments();b.itemBox=this._player.getCopyOfItemBox();b.playerX=c.x;b.playerY=c.y;b.statusEnergyMax=this._player.getEnergyMax();b.statusEnergy=d.energy;b.statusStrength=d.strength;b.statusDefence=d.defence;b.statusGold=d.gold;b.moves=this._player.getMoveCount();a&&(b.checkOriginalMapString=this._generateMapDataHash(this._restartData),b.mapCompressed=this._compressMap(b.map),b.mapObjectCompressed=this._compressMap(b.mapObject),b.checkString=this._generateSaveDataHash(b),
b.map=void 0,b.mapObject=void 0);b.message=void 0;b.mapAttribute=void 0;b.objectAttribute=void 0;if(a)return a=JSON.stringify(b),CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(a),"^ /"+(231*this._wwaData.worldPassNumber+8310+b.checkOriginalMapString)+"P+>A[]").toString();this._quickSaveData=b;l.$id("cell-load").textContent="Quick Load";return""};f.prototype._decodePassword=function(a){var b=this._generateMapDataHash(this._restartData);try{var c=CryptoJS.AES.decrypt(a,"^ /"+(231*this._wwaData.worldPassNumber+
8310+b)+"P+>A[]").toString(CryptoJS.enc.Utf8)}catch(d){throw Error("\u30c7\u30fc\u30bf\u304c\u7834\u640d\u3057\u3066\u3044\u307e\u3059\u3002\n"+d.message);}var f;try{f=JSON.parse(c)}catch(d){throw Error("\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u4ee5\u5916\u306e\u3082\u306e\u304c\u6697\u53f7\u5316\u3055\u308c\u305f\u304b\u3001\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u306b\u4f55\u304b\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\nJSON PARSE FAILED");}return f};f.prototype._quickLoad=
function(a,b,c){void 0===a&&(a=!1);void 0===b&&(b=null);void 0===c&&(c=!0);if(!a&&void 0===this._quickSaveData&&null===b)throw Error("\u30bb\u30fc\u30d6\u30c7\u30fc\u30bf\u304c\u3042\u308a\u307e\u305b\u3093\u3002");a=null!==b?this._decodePassword(b):JSON.parse(JSON.stringify(a?this._restartData:this._quickSaveData));a.message=JSON.parse(JSON.stringify(this._restartData.message));a.mapAttribute=JSON.parse(JSON.stringify(this._restartData.mapAttribute));a.objectAttribute=JSON.parse(JSON.stringify(this._restartData.objectAttribute));
void 0===a.map&&(a.map=this._decompressMap(a.mapCompressed),a.mapCompressed=void 0);void 0===a.mapObject&&(a.mapObject=this._decompressMap(a.mapObjectCompressed),a.mapObjectCompressed=void 0);if(null!==b){b=this._generateSaveDataHash(a);if(a.checkString!==b)throw Error("\u30c7\u30fc\u30bf\u304c\u58ca\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\nInvalid hash (ALL DATA)= "+a.checkString+" "+this._generateSaveDataHash(a));b=this._generateMapDataHash(this._restartData);if(a.checkOriginalMapString!==
b)throw Error("\u7ba1\u7406\u8005\u306b\u3088\u3063\u3066\u30de\u30c3\u30d7\u304c\u5909\u66f4\u3055\u308c\u305f\u3088\u3046\u3067\u3059\u3002\nInvalid hash (ORIGINAL MAP)= "+a.checkString+" "+this._generateSaveDataHash(a));console.log("Valid Password!")}c&&this._applyQuickLoad(a);return a};f.prototype._applyQuickLoad=function(a){this._player.setEnergyMax(a.statusEnergyMax);this._player.setEnergy(a.statusEnergy);this._player.setStrength(a.statusStrength);this._player.setDefence(a.statusDefence);this._player.setGold(a.statusGold);
this._player.setMoveCount(a.moves);this._player.clearItemBox();for(var b=0;b<a.itemBox.length;b++)this._player.addItem(a.itemBox[b],b+1,!0);this._player.systemJumpTo(new wwa_data.Position(this,a.playerX,a.playerY,0,0));0===a.bgm?this.playSound(wwa_data.SystemSound.NO_SOUND):this.playSound(a.bgm);this.setImgClick(new z(a.imgClickX,a.imgClickY));0!==this.getObjectIdByPosition(this._player.getPosition())&&this._player.setPartsAppearedFlag();this._wwaData=a;this._replaceAllRandomObjects();this.updateCSSRule()};
f.prototype._restartGame=function(){this._quickLoad(!0)};f.prototype._fadeout=function(a){var b=0,d=c.MAP_WINDOW_WIDTH,f=c.FADEOUT_SPEED,h=wwa_util.$id("wwa-fader");h.style.display="block";var e=setInterval(function(){b+=f;d-=2*f;0>=d||2*b>c.MAP_WINDOW_WIDTH?(h.removeAttribute("style"),h.style.display="block",h.style.borderWidth="0",h.style.width=c.MAP_WINDOW_WIDTH+"px",h.style.height=c.MAP_WINDOW_HEIGHT+"px",h.style.backgroundColor="#808080",clearInterval(e),a()):(h.style.width=d+"px",h.style.height=
d+"px",h.style.borderWidth=b+"px")},20)};f.prototype.moveObjects=function(a){var b=this._camera.getPosition();this._player.getPosition();b.getPartsCoord();var d=b.getPartsCoord().x,b=b.getPartsCoord().y,f,h,e;if(this.getMapAttributeByPosition(this._player.getPosition(),c.ATR_TYPE)!==c.MAP_LOCALGATE&&this.getObjectAttributeByPosition(this._player.getPosition(),c.ATR_TYPE)!==c.OBJECT_LOCALGATE){f=Array(c.V_PARTS_NUM_IN_WINDOW+2);this.hoge=Array(c.V_PARTS_NUM_IN_WINDOW+2);for(e=-1;e<=c.V_PARTS_NUM_IN_WINDOW;e++)for(f[e+
1]=Array(c.H_PARTS_NUM_IN_WINDOW+2),this.hoge[e+1]=Array(c.H_PARTS_NUM_IN_WINDOW+2),h=-1;h<=c.H_PARTS_NUM_IN_WINDOW;h++)if(0>b+e||b+e>=this._wwaData.mapWidth||0>d+h||d+h>=this._wwaData.mapWidth)f[e+1][h+1]=0,this.hoge[e+1][h+1]=0;else{try{var g=new B(this,d+h,b+e,0,0),l=g.getPartsCoord()}catch(k){f[e+1][h+1]=0;this.hoge[e+1][h+1]=0;continue}f[e+1][h+1]=this._wwaData.mapObject[l.y][l.x];this.hoge[e+1][h+1]=-this._wwaData.mapObject[l.y][l.x]}for(h=-1;h<=c.H_PARTS_NUM_IN_WINDOW;h++)if(!(0>d+h||d+h>=
this._wwaData.mapWidth))for(e=-1;e<=c.V_PARTS_NUM_IN_WINDOW;e++)if(!(0>b+e||b+e>=this._wwaData.mapWidth)){try{g=new B(this,d+h,b+e,0,0),l=g.getPartsCoord()}catch(k){continue}var v=this._wwaData.mapObject[l.y][l.x];if(0!==v&&this._wwaData.objectAttribute[v][c.ATR_MOVE]!==wwa_data.MoveType.STATIC&&this._wwaData.objectAttribute[v][c.ATR_TYPE]!==c.OBJECT_LOCALGATE&&this._wwaData.objectAttribute[v][c.ATR_TYPE]!==c.OBJECT_RANDOM){var A=this._wwaData.objectAttribute[v][c.ATR_MOVE];if(A!==wwa_data.MoveType.HANG_AROUND){var m=
this._getCandidateCoord(a,g,A),p=new z(m.x,l.y),C=new z(l.x,m.y),q=null;this._objectCanMoveTo(a,m,f)?this._setObjectsInNextFrame(l,m,d,b,f,v):(q=this._getSecondCandidateMoveMode(a,l,m,p,C,this._wwaData.objectAttribute[v][c.ATR_TYPE]===c.OBJECT_MONSTER,f),q===wwa_data.SecondCandidateMoveType.MODE_X?this._setObjectsInNextFrame(l,p,d,b,f,v):q===wwa_data.SecondCandidateMoveType.MODE_Y?this._setObjectsInNextFrame(l,C,d,b,f,v):(q=this._getThirdCandidate(a,g,m,A,f),null!==q?this._setObjectsInNextFrame(l,
q,d,b,f,v):(A=this._getRandomMoveCoord(a,g,f),this._setObjectsInNextFrame(l,A,d,b,f,v))))}else A=this._getRandomMoveCoord(a,g,f),this._setObjectsInNextFrame(l,A,d,b,f,v)}}}};f.prototype._getCandidateCoord=function(a,b,c){b=b.getPartsCoord();this._player.getPosition().getOffsetCoord();this._player.getPosition().getPartsCoord();try{var d=a?this._player.getPosition().getNextJustPosition().getPartsCoord():this._player.getPosition().getPartsCoord()}catch(f){throw Error("\u4e88\u671f\u305b\u306c\u65b9\u5411\u3078\u306e\u79fb\u52d5\u306e\u3088\u3046\u3067\u3059\u3002");
}a=b.clone();var h=0,e=0;c===wwa_data.MoveType.CHASE_PLAYER?(h=b.x>d.x?1:b.x<d.x?-1:0,e=b.y>d.y?1:b.y<d.y?-1:0):c===wwa_data.MoveType.RUN_OUT&&(h=b.x>d.x?-1:b.x<d.x?1:0,e=b.y>d.y?-1:b.y<d.y?1:0);a.x-=h;a.y-=e;a.x=Math.min(this._wwaData.mapWidth-1,Math.max(0,a.x));a.y=Math.min(this._wwaData.mapWidth-1,Math.max(0,a.y));return a};f.prototype._getSecondCandidateMoveMode=function(a,b,c,d,f,e,g){return!a||(this._player.getDir()!==wwa_data.Direction.UP&&this._player.getDir()!==wwa_data.Direction.DOWN||!e)&&
(this._player.getDir()!==wwa_data.Direction.LEFT&&this._player.getDir()!==wwa_data.Direction.RIGHT||e)?this._objectCanMoveTo(a,d,g)?wwa_data.SecondCandidateMoveType.MODE_X:this._objectCanMoveTo(a,f,g)?wwa_data.SecondCandidateMoveType.MODE_Y:wwa_data.SecondCandidateMoveType.UNDECIDED:this._objectCanMoveTo(a,f,g)?wwa_data.SecondCandidateMoveType.MODE_Y:this._objectCanMoveTo(a,d,g)?wwa_data.SecondCandidateMoveType.MODE_X:wwa_data.SecondCandidateMoveType.UNDECIDED};f.prototype._getThirdCandidate=function(a,
b,c,d,f){d=d===wwa_data.MoveType.CHASE_PLAYER?1:d===wwa_data.MoveType.RUN_OUT?-1:0;var e=a?this._player.getPosition().getNextJustPosition().getPartsCoord():this._player.getPosition().getPartsCoord();b=b.getPartsCoord();var g;if(e.x!==b.x){g=new z(c.x,b.y+1*d);if(this._objectCanMoveTo(a,g,f))return g;g=new z(c.x,b.y-1*d);if(this._objectCanMoveTo(a,g,f))return g;g=new z(b.x,b.y+1*d);if(this._objectCanMoveTo(a,g,f))return g;g=new z(b.x,b.y-1*d);if(this._objectCanMoveTo(a,g,f))return g}if(e.y!==b.y){g=
new z(b.x+1*d,c.y);if(this._objectCanMoveTo(a,g,f))return g;g=new z(b.x-1*d,c.y);if(this._objectCanMoveTo(a,g,f))return g;g=new z(b.x+1*d,b.y);if(this._objectCanMoveTo(a,g,f))return g;g=new z(b.x-1*d,b.y);if(this._objectCanMoveTo(a,g,f))return g}return null};f.prototype._getRandomMoveCoord=function(a,b,d){b=b.getPartsCoord();for(var f=b.clone(),h=0;h<c.RANDOM_MOVE_ITERATION_NUM;h++){var e=Math.floor(8*Math.random());f.x=b.x+wwa_data.vx[e];f.y=b.y+wwa_data.vy[e];if(this._objectCanMoveTo(a,f,d))return f}return b};
f.prototype.isPrevFrameEventExecuted=function(){return this._prevFrameEventExected};f.prototype._objectCanMoveTo=function(a,b,d){if(0>b.x||0>b.y||this._wwaData.mapWidth<=b.x||this._wwaData.mapWidth<=b.y)return!1;var f=this._wwaData.map[b.y][b.x],h=this._wwaData.mapObject[b.y][b.x],e=this._wwaData.mapAttribute[f][c.ATR_TYPE],g=this._camera.getPosition(),l=g.getPartsCoord().x,g=g.getPartsCoord().y;if(0===f&&!this.isOldMap()||e===c.MAP_WALL)return!1;f=b.x-l+1;e=b.y-g+1;if(0<=f&&0<=e&&f<d.length&&e<d.length){if(0!==
d[e][f])return!1}else if(0!==h)return!1;if(a){if(this._player.getPosition().getNextJustPosition().getPartsCoord().equals(b))return!1}else if(this._player.getPosition().getPartsCoord().equals(b))return!1;return!0};f.prototype._setObjectsInNextFrame=function(a,b,c,d,f,e){var g=b.x-c+1,l=b.y-d+1;0<=b.x&&b.x<=this._wwaData.mapWidth&&0<=b.y&&b.y<=this._wwaData.mapWidth&&(0<=g&&g<f.length&&0<=l&&l<f.length&&(f[a.y-d+1][a.x-c+1]=0,f[b.y-d+1][b.x-c+1]=e,this.hoge[b.y-d+1][b.x-c+1]=e),this._objectMovingDataManager.add(e,
a.convertIntoPosition(this),b.convertIntoPosition(this),a.getDirectionTo(b)))};f.prototype.launchBattleEstimateWindow=function(){var a=this._camera.getPosition().getPartsCoord(),b=Math.max(0,a.x),d=Math.min(this._wwaData.mapWidth-1,a.x+c.H_PARTS_NUM_IN_WINDOW-1),f=Math.max(0,a.y),a=Math.min(this._wwaData.mapWidth-1,a.y+c.V_PARTS_NUM_IN_WINDOW)-1,e=[];for(this.playSound(wwa_data.SystemSound.DECISION);b<=d;b++)for(var g=f;g<=a;g++){var l=this._wwaData.mapObject[g][b];this._wwaData.objectAttribute[l][c.ATR_TYPE]===
c.OBJECT_MONSTER&&-1===e.indexOf(l)&&e.push(l)}if(0===e.length)return!1;this._battleEstimateWindow.update(this._player.getStatus(),e);this._battleEstimateWindow.show();this._player.setEstimateWindowWating();return!0};f.prototype.hideBattleEstimateWindow=function(){this._battleEstimateWindow.hide();this._player.clearEstimateWindowWaiting()};f.prototype.hidePasswordWindow=function(a){void 0===a&&(a=!1);this._passwordWindow.hide();if(a||this._passwordWindow.mode===wwa_password_window.Mode.SAVE)this._player.clearPasswordWindowWaiting();
else{try{var b=this._quickLoad(!1,this._passwordWindow.password,!1)}catch(c){this._player.clearPasswordWindowWaiting();alert("\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u6b63\u5e38\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u30a8\u30e9\u30fc\u8a73\u7d30:\n"+c.message);return}this._passwordLoadExecInNextFrame=!0;this._passwordSaveExtractData=b}};f.prototype._displayHelp=function(){this._player.isControllable()&&this.setMessageQueue("\u3010\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30ad\u30fc\u306e\u4e00\u89a7\u3011\n\uff26\uff11\u3001\uff2d\uff1a\u6226\u95d8\u7d50\u679c\u4e88\u6e2c\u306e\u8868\u793a\n\uff26\uff13\uff1a\u5fa9\u5e30\u7528\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\n\uff26\uff14\uff1a\u5fa9\u5e30\u7528\u30d1\u30b9\u30ef\u30fc\u30c9\u8868\u793a\n\uff26\uff15\uff1a\u4e00\u6642\u4fdd\u5b58\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f\n\uff26\uff16\uff1a\u30c7\u30fc\u30bf\u306e\u4e00\u6642\u4fdd\u5b58\n\uff26\uff17\uff1a\u521d\u3081\u304b\u3089\u30b9\u30bf\u30fc\u30c8\n\uff26\uff18\uff1a\uff37\uff37\uff21\u516c\u5f0f\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\n\uff26\uff11\uff12\uff1a\u3053\u306e\u30ea\u30b9\u30c8\u306e\u8868\u793a\n\u30ad\u30fc\u30dc\u30fc\u30c9\u306e\u300c\uff11\uff12\uff13\u3001\uff31\uff37\uff25\u3001\uff21\uff33\uff24\u3001\uff3a\uff38\uff23\u300d\u306f\u53f3\u306e\u30a2\u30a4\u30c6\u30e0\u30dc\u30c3\u30af\u30b9\u306b\u5bfe\u5fdc\u3002\n\u300c\uff25\uff4e\uff54\uff45\uff52\u3001\uff39\u300d\u306f\uff39\uff45\uff53,\u300c\uff25\uff53\uff43\u3001\uff2e\u300d\u306f\uff2e\uff4f\u306b\u5bfe\u5fdc\u3002\n I : \u79fb\u52d5\u901f\u5ea6\u3092\u843d\u3068\u3059\uff0f\uff30: \u79fb\u52d5\u901f\u5ea6\u3092\u4e0a\u3052\u308b\n\u73fe\u5728\u306e\u79fb\u52d5\u56de\u6570\uff1a"+
this._player.getMoveCount()+"\nWWA Wing \u30d0\u30fc\u30b8\u30e7\u30f3:"+c.VERSION_WWAJS,!1,!0)};f.prototype._setNextMessage=function(a){void 0===a&&(a=!1);this._clearFacesInNextFrame=!0;this._scoreWindow.isVisible()&&this._scoreWindow.hide();this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0);if(0===this._messageQueue.length)this._hideMessageWindow();else{var b=this._messageQueue.shift(),
c=b.message,d=b.macro;this._lastMessage=b;for(b=0;b<d.length;b++)this._execMacroListInNextFrame.push(d[b]);""!==c?(this._messageWindow.hide(),this._messageWindow.setMessage(c),this._messageWindow.setPositionByPlayerPosition(0!==this._faces.length,this._scoreWindow.isVisible(),a,this._player.getPosition(),this._camera.getPosition()),this._messageWindow.show()):0===this._messageQueue.length?this._hideMessageWindow():this._setNextMessage()}};f.prototype._hideMessageWindow=function(a){void 0===a&&(a=
!0);var b=0;this._player.isReadyToUseItem()&&(b=this._player.useItem());var d=this.getObjectAttributeById(b,c.ATR_STRING);this.clearFaces();0===d?(a&&(this._messageWindow.hide(),this._keyStore.allClear(),this._mouseStore.clear()),this._player.clearMessageWaiting()):this.setMessageQueue(this.getMessageById(d),!1,!1,b,wwa_data.PartsType.OBJECT,this._player.getPosition().getPartsCoord(),!0)};f.prototype.replaceParts=function(a,b,d,f){void 0===d&&(d=wwa_data.PartsType.OBJECT);void 0===f&&(f=!1);var e=
this._camera.getPosition().getPartsCoord(),g=f?Math.min(this._wwaData.mapWidth-1,e.x+c.H_PARTS_NUM_IN_WINDOW-1):this._wwaData.mapWidth-1,l=f?Math.max(0,e.y):0,k=f?Math.min(this._wwaData.mapWidth-1,e.y+c.V_PARTS_NUM_IN_WINDOW)-1:this._wwaData.mapWidth-1;for(f=f?Math.max(0,e.x):0;f<=g;f++)for(e=l;e<=k;e++)if(d===wwa_data.PartsType.OBJECT){var v=this._wwaData.mapObject[e][f];v===a&&(this._wwaData.mapObject[e][f]=b)}else v=this._wwaData.map[e][f],v===a&&(this._wwaData.map[e][f]=b)};f.prototype.getYesNoImgCoord=
function(){return new z(this._wwaData.yesnoImgPosX,this._wwaData.yesnoImgPosY)};f.prototype.setYesNoImgCoord=function(a){this._wwaData.yesnoImgPosX=a.x;this._wwaData.yesnoImgPosY=a.y;return a};f.prototype.getPlayerImgCoord=function(){return new z(this._wwaData.playerImgPosX,this._wwaData.playerImgPosY)};f.prototype.setPlayerImgCoord=function(a){this._wwaData.playerImgPosX=a.x;this._wwaData.playerImgPosY=a.y;return a};f.prototype.setPlayerEnergyMax=function(a){return this._player.setEnergyMax(a)};
f.prototype.getMapPartsNum=function(){return this._wwaData.mapPartsMax};f.prototype.getObjectPartsNum=function(){return this._wwaData.objPartsMax};f.prototype.setMoveMacroWaitingToPlayer=function(a){this._reservedMoveMacroTurn=a};f.prototype.disableSave=function(a){return this._wwaData.disableSaveFlag=a};f.prototype.isOldMap=function(){return this._wwaData.isOldMap};f.prototype.setOldMap=function(a){return this._wwaData.isOldMap=a};f.prototype.setObjectNotCollapseOnPartsOnPlayer=function(a){return this._wwaData.objectNoCollapseDefaultFlag=
a};f.prototype.setGameOverPosition=function(a){if(0>a.x||a.x>=this.getMapWidth()||0>a.y||a.y>=this.getMapWidth())throw Error("\u30de\u30c3\u30d7\u306e\u7bc4\u56f2\u5916\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059!");this._wwaData.gameoverX=a.x;this._wwaData.gameoverY=a.y;return a};f.prototype.setPlayerStatus=function(a,b){if(a===wwa_data.MacroStatusIndex.ENERGY)this._player.setEnergy(b);else if(a===wwa_data.MacroStatusIndex.STRENGTH)this._player.setStrength(b);else if(a===wwa_data.MacroStatusIndex.DEFENCE)this._player.setDefence(b);
else if(a===wwa_data.MacroStatusIndex.GOLD)this._player.setGold(b);else if(a===wwa_data.MacroStatusIndex.MOVES)this._player.setMoveCount(b);else throw Error("\u672a\u5b9a\u7fa9\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u30bf\u30a4\u30d7\u3067\u3059");};f.prototype.setDelPlayer=function(a){return this._wwaData.delPlayerFlag=a};f.prototype.setPlayerGetItem=function(a,b){try{this._player.addItem(b,a,!0)}catch(c){}};f.prototype.setFrameCoord=function(a){return this._frameCoord=a.clone()};f.prototype.setBattleEffectCoord=
function(a){return this._battleEffectCoord=a.clone()};f.prototype.canInput=function(){return!this._temporaryInputDisable};f.prototype.setWaitTime=function(a){this._waitTimeInCurrentFrame+=a;this._temporaryInputDisable=!0};f.prototype.setEffect=function(a,b){this._wwaData.effectWaits=a;this._wwaData.effectCoords=b};f.prototype.stopEffect=function(){this._wwaData.effectCoords=[]};f.prototype.setImgClick=function(a){this._wwaData.imgClickX=a.x;this._wwaData.imgClickY=a.y;if(a.equals(new z(0,0)))Array.prototype.forEach.call(wwa_util.$qsAll(".item-cell>.item-click-border"),
function(a){a.style.backgroundImage="url('"+wwa_data.WWAConsts.ITEM_BORDER_IMG_DATA_URL+"')";a.style.backgroundPosition="0 0"});else{var b=this._wwaData.mapCGName.replace("(","\\(").replace(")","\\)");Array.prototype.forEach.call(wwa_util.$qsAll(".item-cell>.item-click-border"),function(d){d.style.backgroundImage="url('"+b+"')";d.style.backgroundPosition="-"+a.x*c.CHIP_SIZE+"px -"+a.y*c.CHIP_SIZE+"px"})}};f.prototype.addFace=function(a){this._faces.push(a)};f.prototype.clearFaces=function(){this._faces=
[]};f.prototype.initCSSRule=function(){this._styleElm=wwa_util.$id(c.WWA_STYLE_TAG_ID);this._sheet=this._styleElm.sheet;this.updateCSSRule()};f.prototype.updateCSSRule=function(){if(void 0===this._stylePos)this._stylePos=Array(2);else if(void 0!==this._sheet.addRule)for(var a=0;a<this._stylePos.length;a++)this._sheet.removeRule(this._stylePos[this._styleElm[a]]);else for(a=0;a<this._stylePos.length;a++)this._sheet.deleteRule(this._stylePos[this._styleElm[a]]);void 0!==this._sheet.addRule?(this._stylePos[wwa_data.SelectorType.MESSAGE_WINDOW]=
this._sheet.addRule("div.wwa-message-window, div#wwa-battle-estimate, div#wwa-password-window","background-color: rgba("+this._wwaData.frameColorR+","+this._wwaData.frameColorG+","+this._wwaData.frameColorB+",0.9);border-color: rgba("+this._wwaData.frameOutColorR+","+this._wwaData.frameOutColorG+","+this._wwaData.frameOutColorB+",1);color: rgba("+this._wwaData.fontColorR+","+this._wwaData.fontColorG+","+this._wwaData.fontColorB+",1);"),this._stylePos[wwa_data.SelectorType.SIDEBAR]=this._sheet.addRule("div#wwa-sidebar",
"color: rgba("+this._wwaData.statusColorR+","+this._wwaData.statusColorG+","+this._wwaData.statusColorB+",1);font-weight: bold;")):(this._stylePos[wwa_data.SelectorType.MESSAGE_WINDOW]=this._sheet.insertRule("div.wwa-message-window, div#wwa-battle-estimate, div#wwa-password-window {\nbackground-color: rgba("+this._wwaData.frameColorR+","+this._wwaData.frameColorG+","+this._wwaData.frameColorB+",0.9);\nborder-color: rgba("+this._wwaData.frameOutColorR+","+this._wwaData.frameOutColorG+","+this._wwaData.frameOutColorB+
",1);\ncolor: rgba("+this._wwaData.fontColorR+","+this._wwaData.fontColorG+","+this._wwaData.fontColorB+",1);\n}",0),this._stylePos[wwa_data.SelectorType.SIDEBAR]=this._sheet.insertRule("div#wwa-sidebar {\ncolor: rgba("+this._wwaData.statusColorR+","+this._wwaData.statusColorG+","+this._wwaData.statusColorB+",1);\nfont-weight: bold;\n}",1))};f.prototype.changeStyleRule=function(a,b,c,d){a===wwa_data.ChangeStyleType.COLOR_FRAME?(this._wwaData.frameColorR=b,this._wwaData.frameColorG=c,this._wwaData.frameColorB=
d):a===wwa_data.ChangeStyleType.COLOR_FRAMEOUT?(this._wwaData.frameOutColorR=b,this._wwaData.frameOutColorG=c,this._wwaData.frameOutColorB=d):a===wwa_data.ChangeStyleType.COLOR_STR?(this._wwaData.fontColorR=b,this._wwaData.fontColorG=c,this._wwaData.fontColorB=d):a===wwa_data.ChangeStyleType.COLOR_STATUS_STR&&(this._wwaData.statusColorR=b,this._wwaData.statusColorG=c,this._wwaData.statusColorB=d);this.updateCSSRule()};f.prototype.showMonsterWindow=function(){this._monsterWindow.show()};f.prototype.isConsoleOutputMode=
function(){return this._useConsole};return f}();g.WWA=A;var v=!1;"complete"===document.readyState?e():window.addEventListener("load",e)})(wwa_main||(wwa_main={}));
var CryptoJS=CryptoJS||function(g,d){var e={},b=e.lib={},p=function(){},k=b.Base={extend:function(a){p.prototype=this;var b=new p;a&&b.mixIn(a);b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)});b.init.prototype=b;b.$super=this;return b},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},
a=b.WordArray=k.extend({init:function(a,b){a=this.words=a||[];this.sigBytes=b!=d?b:4*a.length},toString:function(a){return(a||m).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;a=a.sigBytes;this.clamp();if(d%4)for(var e=0;e<a;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-e%4*8&255)<<24-(d+e)%4*8;else if(65535<c.length)for(e=0;e<a;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);this.sigBytes+=a;return this},clamp:function(){var a=this.words,b=this.sigBytes;a[b>>>2]&=4294967295<<32-
b%4*8;a.length=g.ceil(b/4)},clone:function(){var a=k.clone.call(this);a.words=this.words.slice(0);return a},random:function(b){for(var c=[],d=0;d<b;d+=4)c.push(4294967296*g.random()|0);return new a.init(c,b)}}),x=e.enc={},m=x.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++){var e=b[d>>>2]>>>24-d%4*8&255;c.push((e>>>4).toString(16));c.push((e&15).toString(16))}return c.join("")},parse:function(b){for(var c=b.length,d=[],f=0;f<c;f+=2)d[f>>>3]|=parseInt(b.substr(f,2),16)<<
24-f%8*4;return new a.init(d,c/2)}},c=x.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-d%4*8&255));return c.join("")},parse:function(b){for(var c=b.length,d=[],f=0;f<c;f++)d[f>>>2]|=(b.charCodeAt(f)&255)<<24-f%4*8;return new a.init(d,c)}},z=x.Utf8={stringify:function(a){try{return decodeURIComponent(escape(c.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data");}},parse:function(a){return c.parse(unescape(encodeURIComponent(a)))}},
B=b.BufferedBlockAlgorithm=k.extend({reset:function(){this._data=new a.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=z.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,f=c.sigBytes,e=this.blockSize,k=f/(4*e),k=b?g.ceil(k):g.max((k|0)-this._minBufferSize,0);b=k*e;f=g.min(4*b,f);if(b){for(var n=0;n<b;n+=e)this._doProcessBlock(d,n);n=d.splice(0,b);c.sigBytes-=f}return new a.init(n,f)},clone:function(){var a=k.clone.call(this);
a._data=this._data.clone();return a},_minBufferSize:0});b.Hasher=B.extend({cfg:k.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){B.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return(new a.init(c)).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return(new C.HMAC.init(a,
c)).finalize(b)}}});var C=e.algo={};return e}(Math);
(function(){var g=CryptoJS,d=g.lib.WordArray;g.enc.Base64={stringify:function(d){var b=d.words,g=d.sigBytes,k=this._map;d.clamp();d=[];for(var a=0;a<g;a+=3)for(var x=(b[a>>>2]>>>24-a%4*8&255)<<16|(b[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|b[a+2>>>2]>>>24-(a+2)%4*8&255,m=0;4>m&&a+.75*m<g;m++)d.push(k.charAt(x>>>6*(3-m)&63));if(b=k.charAt(64))for(;d.length%4;)d.push(b);return d.join("")},parse:function(e){var b=e.length,g=this._map,k=g.charAt(64);k&&(k=e.indexOf(k),-1!=k&&(b=k));for(var k=[],a=0,x=0;x<b;x++)if(x%
4){var m=g.indexOf(e.charAt(x-1))<<x%4*2,c=g.indexOf(e.charAt(x))>>>6-x%4*2;k[a>>>2]|=(m|c)<<24-a%4*8;a++}return d.create(k,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();
(function(g){function d(a,b,c,d,e,f,g){a=a+(b&c|~b&d)+e+g;return(a<<f|a>>>32-f)+b}function e(a,b,c,d,e,f,g){a=a+(b&d|c&~d)+e+g;return(a<<f|a>>>32-f)+b}function b(a,b,c,d,e,f,g){a=a+(b^c^d)+e+g;return(a<<f|a>>>32-f)+b}function p(a,b,c,d,e,f,g){a=a+(c^(b|~d))+e+g;return(a<<f|a>>>32-f)+b}for(var k=CryptoJS,a=k.lib,x=a.WordArray,m=a.Hasher,a=k.algo,c=[],z=0;64>z;z++)c[z]=4294967296*g.abs(g.sin(z+1))|0;a=a.MD5=m.extend({_doReset:function(){this._hash=new x.init([1732584193,4023233417,2562383102,271733878])},
_doProcessBlock:function(a,g){for(var k=0;16>k;k++){var m=g+k,v=a[m];a[m]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360}var k=this._hash.words,m=a[g+0],v=a[g+1],f=a[g+2],w=a[g+3],y=a[g+4],n=a[g+5],x=a[g+6],h=a[g+7],z=a[g+8],J=a[g+9],K=a[g+10],E=a[g+11],F=a[g+12],G=a[g+13],H=a[g+14],I=a[g+15],q=k[0],t=k[1],r=k[2],u=k[3],q=d(q,t,r,u,m,7,c[0]),u=d(u,q,t,r,v,12,c[1]),r=d(r,u,q,t,f,17,c[2]),t=d(t,r,u,q,w,22,c[3]),q=d(q,t,r,u,y,7,c[4]),u=d(u,q,t,r,n,12,c[5]),r=d(r,u,q,t,x,17,c[6]),t=d(t,r,u,q,h,22,c[7]),
q=d(q,t,r,u,z,7,c[8]),u=d(u,q,t,r,J,12,c[9]),r=d(r,u,q,t,K,17,c[10]),t=d(t,r,u,q,E,22,c[11]),q=d(q,t,r,u,F,7,c[12]),u=d(u,q,t,r,G,12,c[13]),r=d(r,u,q,t,H,17,c[14]),t=d(t,r,u,q,I,22,c[15]),q=e(q,t,r,u,v,5,c[16]),u=e(u,q,t,r,x,9,c[17]),r=e(r,u,q,t,E,14,c[18]),t=e(t,r,u,q,m,20,c[19]),q=e(q,t,r,u,n,5,c[20]),u=e(u,q,t,r,K,9,c[21]),r=e(r,u,q,t,I,14,c[22]),t=e(t,r,u,q,y,20,c[23]),q=e(q,t,r,u,J,5,c[24]),u=e(u,q,t,r,H,9,c[25]),r=e(r,u,q,t,w,14,c[26]),t=e(t,r,u,q,z,20,c[27]),q=e(q,t,r,u,G,5,c[28]),u=e(u,q,
t,r,f,9,c[29]),r=e(r,u,q,t,h,14,c[30]),t=e(t,r,u,q,F,20,c[31]),q=b(q,t,r,u,n,4,c[32]),u=b(u,q,t,r,z,11,c[33]),r=b(r,u,q,t,E,16,c[34]),t=b(t,r,u,q,H,23,c[35]),q=b(q,t,r,u,v,4,c[36]),u=b(u,q,t,r,y,11,c[37]),r=b(r,u,q,t,h,16,c[38]),t=b(t,r,u,q,K,23,c[39]),q=b(q,t,r,u,G,4,c[40]),u=b(u,q,t,r,m,11,c[41]),r=b(r,u,q,t,w,16,c[42]),t=b(t,r,u,q,x,23,c[43]),q=b(q,t,r,u,J,4,c[44]),u=b(u,q,t,r,F,11,c[45]),r=b(r,u,q,t,I,16,c[46]),t=b(t,r,u,q,f,23,c[47]),q=p(q,t,r,u,m,6,c[48]),u=p(u,q,t,r,h,10,c[49]),r=p(r,u,q,t,
H,15,c[50]),t=p(t,r,u,q,n,21,c[51]),q=p(q,t,r,u,F,6,c[52]),u=p(u,q,t,r,w,10,c[53]),r=p(r,u,q,t,K,15,c[54]),t=p(t,r,u,q,v,21,c[55]),q=p(q,t,r,u,z,6,c[56]),u=p(u,q,t,r,I,10,c[57]),r=p(r,u,q,t,x,15,c[58]),t=p(t,r,u,q,G,21,c[59]),q=p(q,t,r,u,y,6,c[60]),u=p(u,q,t,r,E,10,c[61]),r=p(r,u,q,t,f,15,c[62]),t=p(t,r,u,q,J,21,c[63]);k[0]=k[0]+q|0;k[1]=k[1]+t|0;k[2]=k[2]+r|0;k[3]=k[3]+u|0},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,d=8*a.sigBytes;b[d>>>5]|=128<<24-d%32;var e=g.floor(c/
4294967296);b[(d+64>>>9<<4)+15]=(e<<8|e>>>24)&16711935|(e<<24|e>>>8)&4278255360;b[(d+64>>>9<<4)+14]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360;a.sigBytes=4*(b.length+1);this._process();a=this._hash;b=a.words;for(c=0;4>c;c++)d=b[c],b[c]=(d<<8|d>>>24)&16711935|(d<<24|d>>>8)&4278255360;return a},clone:function(){var a=m.clone.call(this);a._hash=this._hash.clone();return a}});k.MD5=m._createHelper(a);k.HmacMD5=m._createHmacHelper(a)})(Math);
(function(){var g=CryptoJS,d=g.lib,e=d.Base,b=d.WordArray,d=g.algo,p=d.EvpKDF=e.extend({cfg:e.extend({keySize:4,hasher:d.MD5,iterations:1}),init:function(b){this.cfg=this.cfg.extend(b)},compute:function(d,a){for(var e=this.cfg,g=e.hasher.create(),c=b.create(),p=c.words,B=e.keySize,e=e.iterations;p.length<B;){C&&g.update(C);var C=g.update(d).finalize(a);g.reset();for(var l=1;l<e;l++)C=g.finalize(C),g.reset();c.concat(C)}c.sigBytes=4*B;return c}});g.EvpKDF=function(b,a,d){return p.create(d).compute(b,
a)}})();
CryptoJS.lib.Cipher||function(g){var d=CryptoJS,e=d.lib,b=e.Base,p=e.WordArray,k=e.BufferedBlockAlgorithm,a=d.enc.Base64,x=d.algo.EvpKDF,m=e.Cipher=k.extend({cfg:b.extend(),createEncryptor:function(a,b){return this.create(this._ENC_XFORM_MODE,a,b)},createDecryptor:function(a,b){return this.create(this._DEC_XFORM_MODE,a,b)},init:function(a,b,c){this.cfg=this.cfg.extend(c);this._xformMode=a;this._key=b;this.reset()},reset:function(){k.reset.call(this);this._doReset()},process:function(a){this._append(a);return this._process()},
finalize:function(a){a&&this._append(a);return this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(a){return{encrypt:function(b,c,d){return("string"==typeof c?A:l).encrypt(a,b,c,d)},decrypt:function(b,c,d){return("string"==typeof c?A:l).decrypt(a,b,c,d)}}}});e.StreamCipher=m.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=d.mode={},z=function(a,b,c){var d=this._iv;d?this._iv=g:d=this._prevBlock;for(var e=0;e<c;e++)a[b+e]^=
d[e]},B=(e.BlockCipherMode=b.extend({createEncryptor:function(a,b){return this.Encryptor.create(a,b)},createDecryptor:function(a,b){return this.Decryptor.create(a,b)},init:function(a,b){this._cipher=a;this._iv=b}})).extend();B.Encryptor=B.extend({processBlock:function(a,b){var c=this._cipher,d=c.blockSize;z.call(this,a,b,d);c.encryptBlock(a,b);this._prevBlock=a.slice(b,b+d)}});B.Decryptor=B.extend({processBlock:function(a,b){var c=this._cipher,d=c.blockSize,e=a.slice(b,b+d);c.decryptBlock(a,b);z.call(this,
a,b,d);this._prevBlock=e}});c=c.CBC=B;B=(d.pad={}).Pkcs7={pad:function(a,b){for(var c=4*b,c=c-a.sigBytes%c,d=c<<24|c<<16|c<<8|c,e=[],g=0;g<c;g+=4)e.push(d);c=p.create(e,c);a.concat(c)},unpad:function(a){a.sigBytes-=a.words[a.sigBytes-1>>>2]&255}};e.BlockCipher=m.extend({cfg:m.cfg.extend({mode:c,padding:B}),reset:function(){m.reset.call(this);var a=this.cfg,b=a.iv,a=a.mode;if(this._xformMode==this._ENC_XFORM_MODE)var c=a.createEncryptor;else c=a.createDecryptor,this._minBufferSize=1;this._mode=c.call(a,
this,b&&b.words)},_doProcessBlock:function(a,b){this._mode.processBlock(a,b)},_doFinalize:function(){var a=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var b=this._process(!0)}else b=this._process(!0),a.unpad(b);return b},blockSize:4});var C=e.CipherParams=b.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}}),c=(d.format={}).OpenSSL={stringify:function(b){var c=b.ciphertext;b=b.salt;return(b?p.create([1398893684,
1701076831]).concat(b).concat(c):c).toString(a)},parse:function(b){b=a.parse(b);var c=b.words;if(1398893684==c[0]&&1701076831==c[1]){var d=p.create(c.slice(2,4));c.splice(0,4);b.sigBytes-=16}return C.create({ciphertext:b,salt:d})}},l=e.SerializableCipher=b.extend({cfg:b.extend({format:c}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var e=a.createEncryptor(c,d);b=e.finalize(b);e=e.cfg;return C.create({ciphertext:b,key:c,iv:e.iv,algorithm:a,mode:e.mode,padding:e.padding,blockSize:a.blockSize,formatter:d.format})},
decrypt:function(a,b,c,d){d=this.cfg.extend(d);b=this._parse(b,d.format);return a.createDecryptor(c,d).finalize(b.ciphertext)},_parse:function(a,b){return"string"==typeof a?b.parse(a,this):a}}),d=(d.kdf={}).OpenSSL={execute:function(a,b,c,d){d||(d=p.random(8));a=x.create({keySize:b+c}).compute(a,d);c=p.create(a.words.slice(b),4*c);a.sigBytes=4*b;return C.create({key:a,iv:c,salt:d})}},A=e.PasswordBasedCipher=l.extend({cfg:l.cfg.extend({kdf:d}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);c=d.kdf.execute(c,
a.keySize,a.ivSize);d.iv=c.iv;a=l.encrypt.call(this,a,b,c.key,d);a.mixIn(c);return a},decrypt:function(a,b,c,d){d=this.cfg.extend(d);b=this._parse(b,d.format);c=d.kdf.execute(c,a.keySize,a.ivSize,b.salt);d.iv=c.iv;return l.decrypt.call(this,a,b,c.key,d)}})}();
(function(){for(var g=CryptoJS,d=g.lib.BlockCipher,e=g.algo,b=[],p=[],k=[],a=[],x=[],m=[],c=[],z=[],B=[],C=[],l=[],A=0;256>A;A++)l[A]=128>A?A<<1:A<<1^283;for(var v=0,f=0,A=0;256>A;A++){var w=f^f<<1^f<<2^f<<3^f<<4,w=w>>>8^w&255^99;b[v]=w;p[w]=v;var y=l[v],n=l[y],D=l[n],h=257*l[w]^16843008*w;k[v]=h<<24|h>>>8;a[v]=h<<16|h>>>16;x[v]=h<<8|h>>>24;m[v]=h;h=16843009*D^65537*n^257*y^16843008*v;c[w]=h<<24|h>>>8;z[w]=h<<16|h>>>16;B[w]=h<<8|h>>>24;C[w]=h;v?(v=y^l[l[l[D^y]]],f^=l[l[f]]):v=f=1}var L=[0,1,2,4,8,
16,32,64,128,27,54],e=e.AES=d.extend({_doReset:function(){for(var a=this._key,d=a.words,e=a.sigBytes/4,a=4*((this._nRounds=e+6)+1),f=this._keySchedule=[],g=0;g<a;g++)if(g<e)f[g]=d[g];else{var h=f[g-1];g%e?6<e&&4==g%e&&(h=b[h>>>24]<<24|b[h>>>16&255]<<16|b[h>>>8&255]<<8|b[h&255]):(h=h<<8|h>>>24,h=b[h>>>24]<<24|b[h>>>16&255]<<16|b[h>>>8&255]<<8|b[h&255],h^=L[g/e|0]<<24);f[g]=f[g-e]^h}d=this._invKeySchedule=[];for(e=0;e<a;e++)g=a-e,h=e%4?f[g]:f[g-4],d[e]=4>e||4>=g?h:c[b[h>>>24]]^z[b[h>>>16&255]]^B[b[h>>>
8&255]]^C[b[h&255]]},encryptBlock:function(c,d){this._doCryptBlock(c,d,this._keySchedule,k,a,x,m,b)},decryptBlock:function(a,b){var d=a[b+1];a[b+1]=a[b+3];a[b+3]=d;this._doCryptBlock(a,b,this._invKeySchedule,c,z,B,C,p);d=a[b+1];a[b+1]=a[b+3];a[b+3]=d},_doCryptBlock:function(a,b,c,d,e,f,g,h){for(var k=this._nRounds,l=a[b]^c[0],m=a[b+1]^c[1],n=a[b+2]^c[2],p=a[b+3]^c[3],v=4,w=1;w<k;w++)var x=d[l>>>24]^e[m>>>16&255]^f[n>>>8&255]^g[p&255]^c[v++],y=d[m>>>24]^e[n>>>16&255]^f[p>>>8&255]^g[l&255]^c[v++],z=
d[n>>>24]^e[p>>>16&255]^f[l>>>8&255]^g[m&255]^c[v++],p=d[p>>>24]^e[l>>>16&255]^f[m>>>8&255]^g[n&255]^c[v++],l=x,m=y,n=z;x=(h[l>>>24]<<24|h[m>>>16&255]<<16|h[n>>>8&255]<<8|h[p&255])^c[v++];y=(h[m>>>24]<<24|h[n>>>16&255]<<16|h[p>>>8&255]<<8|h[l&255])^c[v++];z=(h[n>>>24]<<24|h[p>>>16&255]<<16|h[l>>>8&255]<<8|h[m&255])^c[v++];p=(h[p>>>24]<<24|h[l>>>16&255]<<16|h[m>>>8&255]<<8|h[n&255])^c[v++];a[b]=x;a[b+1]=y;a[b+2]=z;a[b+3]=p},keySize:8});g.AES=d._createHelper(e)})();
