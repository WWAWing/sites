/*!
 * @license WWA Wing Engine (c) NAO / WWA Wing Team / MIT License https://github.com/WWAWing/WWAWing/blob/develop/packages/engine/LICENSE
 * @license crypto-js (c) Jeff Mott / Evan Vosberg / MIT License https://github.com/brix/crypto-js/blob/develop/LICENSE
 */!function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=34)}([function(t,e,i){var s;t.exports=(s=s||function(t,e){var i=Object.create||function(){function t(){}return function(e){var i;return t.prototype=e,i=new t,t.prototype=null,i}}(),s={},a=s.lib={},o=a.Base={extend:function(t){var e=i(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},r=a.WordArray=o.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||_).stringify(this)},concat:function(t){var e=this.words,i=t.words,s=this.sigBytes,a=t.sigBytes;if(this.clamp(),s%4)for(var o=0;o<a;o++){var r=i[o>>>2]>>>24-o%4*8&255;e[s+o>>>2]|=r<<24-(s+o)%4*8}else for(o=0;o<a;o+=4)e[s+o>>>2]=i[o>>>2];return this.sigBytes+=a,this},clamp:function(){var e=this.words,i=this.sigBytes;e[i>>>2]&=4294967295<<32-i%4*8,e.length=t.ceil(i/4)},clone:function(){var t=o.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var i,s=[],a=function(e){e=e;var i=987654321,s=4294967295;return function(){var a=((i=36969*(65535&i)+(i>>16)&s)<<16)+(e=18e3*(65535&e)+(e>>16)&s)&s;return a/=4294967296,(a+=.5)*(t.random()>.5?1:-1)}},o=0;o<e;o+=4){var n=a(4294967296*(i||t.random()));i=987654071*n(),s.push(4294967296*n()|0)}return new r.init(s,e)}}),n=s.enc={},_=n.Hex={stringify:function(t){for(var e=t.words,i=t.sigBytes,s=[],a=0;a<i;a++){var o=e[a>>>2]>>>24-a%4*8&255;s.push((o>>>4).toString(16)),s.push((15&o).toString(16))}return s.join("")},parse:function(t){for(var e=t.length,i=[],s=0;s<e;s+=2)i[s>>>3]|=parseInt(t.substr(s,2),16)<<24-s%8*4;return new r.init(i,e/2)}},h=n.Latin1={stringify:function(t){for(var e=t.words,i=t.sigBytes,s=[],a=0;a<i;a++){var o=e[a>>>2]>>>24-a%4*8&255;s.push(String.fromCharCode(o))}return s.join("")},parse:function(t){for(var e=t.length,i=[],s=0;s<e;s++)i[s>>>2]|=(255&t.charCodeAt(s))<<24-s%4*8;return new r.init(i,e)}},c=n.Utf8={stringify:function(t){try{return decodeURIComponent(escape(h.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return h.parse(unescape(encodeURIComponent(t)))}},l=a.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=c.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var i=this._data,s=i.words,a=i.sigBytes,o=this.blockSize,n=a/(4*o),_=(n=e?t.ceil(n):t.max((0|n)-this._minBufferSize,0))*o,h=t.min(4*_,a);if(_){for(var c=0;c<_;c+=o)this._doProcessBlock(s,c);var l=s.splice(0,_);i.sigBytes-=h}return new r.init(l,h)},clone:function(){var t=o.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),u=(a.Hasher=l.extend({cfg:o.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,i){return new t.init(i).finalize(e)}},_createHmacHelper:function(t){return function(e,i){return new u.HMAC.init(t,i).finalize(e)}}}),s.algo={});return s}(Math),s)},function(t,e,i){var s,a,o,r,n,_,h,c,l,u,d,p,E,m,y,g,w,f,A;t.exports=(s=i(0),i(2),void(s.lib.Cipher||(a=s,o=a.lib,r=o.Base,n=o.WordArray,_=o.BufferedBlockAlgorithm,h=a.enc,h.Utf8,c=h.Base64,l=a.algo.EvpKDF,u=o.Cipher=_.extend({cfg:r.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,i){this.cfg=this.cfg.extend(i),this._xformMode=t,this._key=e,this.reset()},reset:function(){_.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return"string"==typeof t?A:w}return function(e){return{encrypt:function(i,s,a){return t(s).encrypt(e,i,s,a)},decrypt:function(i,s,a){return t(s).decrypt(e,i,s,a)}}}}()}),o.StreamCipher=u.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),d=a.mode={},p=o.BlockCipherMode=r.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}}),E=d.CBC=function(){var t=p.extend();function e(t,e,i){var s=this._iv;if(s){var a=s;this._iv=void 0}else a=this._prevBlock;for(var o=0;o<i;o++)t[e+o]^=a[o]}return t.Encryptor=t.extend({processBlock:function(t,i){var s=this._cipher,a=s.blockSize;e.call(this,t,i,a),s.encryptBlock(t,i),this._prevBlock=t.slice(i,i+a)}}),t.Decryptor=t.extend({processBlock:function(t,i){var s=this._cipher,a=s.blockSize,o=t.slice(i,i+a);s.decryptBlock(t,i),e.call(this,t,i,a),this._prevBlock=o}}),t}(),m=(a.pad={}).Pkcs7={pad:function(t,e){for(var i=4*e,s=i-t.sigBytes%i,a=s<<24|s<<16|s<<8|s,o=[],r=0;r<s;r+=4)o.push(a);var _=n.create(o,s);t.concat(_)},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},o.BlockCipher=u.extend({cfg:u.cfg.extend({mode:E,padding:m}),reset:function(){u.reset.call(this);var t=this.cfg,e=t.iv,i=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var s=i.createEncryptor;else s=i.createDecryptor,this._minBufferSize=1;this._mode&&this._mode.__creator==s?this._mode.init(this,e&&e.words):(this._mode=s.call(i,this,e&&e.words),this._mode.__creator=s)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){t.pad(this._data,this.blockSize);var e=this._process(!0)}else e=this._process(!0),t.unpad(e);return e},blockSize:4}),y=o.CipherParams=r.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}}),g=(a.format={}).OpenSSL={stringify:function(t){var e=t.ciphertext,i=t.salt;if(i)var s=n.create([1398893684,1701076831]).concat(i).concat(e);else s=e;return s.toString(c)},parse:function(t){var e=c.parse(t),i=e.words;if(1398893684==i[0]&&1701076831==i[1]){var s=n.create(i.slice(2,4));i.splice(0,4),e.sigBytes-=16}return y.create({ciphertext:e,salt:s})}},w=o.SerializableCipher=r.extend({cfg:r.extend({format:g}),encrypt:function(t,e,i,s){s=this.cfg.extend(s);var a=t.createEncryptor(i,s),o=a.finalize(e),r=a.cfg;return y.create({ciphertext:o,key:i,iv:r.iv,algorithm:t,mode:r.mode,padding:r.padding,blockSize:t.blockSize,formatter:s.format})},decrypt:function(t,e,i,s){return s=this.cfg.extend(s),e=this._parse(e,s.format),t.createDecryptor(i,s).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),f=(a.kdf={}).OpenSSL={execute:function(t,e,i,s){s||(s=n.random(8));var a=l.create({keySize:e+i}).compute(t,s),o=n.create(a.words.slice(e),4*i);return a.sigBytes=4*e,y.create({key:a,iv:o,salt:s})}},A=o.PasswordBasedCipher=w.extend({cfg:w.cfg.extend({kdf:f}),encrypt:function(t,e,i,s){var a=(s=this.cfg.extend(s)).kdf.execute(i,t.keySize,t.ivSize);s.iv=a.iv;var o=w.encrypt.call(this,t,e,a.key,s);return o.mixIn(a),o},decrypt:function(t,e,i,s){s=this.cfg.extend(s),e=this._parse(e,s.format);var a=s.kdf.execute(i,t.keySize,t.ivSize,e.salt);return s.iv=a.iv,w.decrypt.call(this,t,e,a.key,s)}}))))},function(t,e,i){var s,a,o,r,n,_,h,c;t.exports=(c=i(0),i(7),i(8),a=(s=c).lib,o=a.Base,r=a.WordArray,n=s.algo,_=n.MD5,h=n.EvpKDF=o.extend({cfg:o.extend({keySize:4,hasher:_,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var i=this.cfg,s=i.hasher.create(),a=r.create(),o=a.words,n=i.keySize,_=i.iterations;o.length<n;){h&&s.update(h);var h=s.update(t).finalize(e);s.reset();for(var c=1;c<_;c++)h=s.finalize(h),s.reset();a.concat(h)}return a.sigBytes=4*n,a}}),s.EvpKDF=function(t,e,i){return h.create(i).compute(t,e)},c.EvpKDF)},function(t,e,i){var s;t.exports=(s=i(0),i(6),i(11),i(12),i(4),i(5),i(7),i(9),i(13),i(10),i(14),i(15),i(16),i(8),i(17),i(2),i(1),i(18),i(19),i(20),i(21),i(22),i(23),i(24),i(25),i(26),i(27),i(28),i(29),i(30),i(31),i(32),i(33),s)},function(t,e,i){var s,a,o;t.exports=(o=i(0),a=(s=o).lib.WordArray,s.enc.Base64={stringify:function(t){var e=t.words,i=t.sigBytes,s=this._map;t.clamp();for(var a=[],o=0;o<i;o+=3)for(var r=(e[o>>>2]>>>24-o%4*8&255)<<16|(e[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|e[o+2>>>2]>>>24-(o+2)%4*8&255,n=0;n<4&&o+.75*n<i;n++)a.push(s.charAt(r>>>6*(3-n)&63));var _=s.charAt(64);if(_)for(;a.length%4;)a.push(_);return a.join("")},parse:function(t){var e=t.length,i=this._map,s=this._reverseMap;if(!s){s=this._reverseMap=[];for(var o=0;o<i.length;o++)s[i.charCodeAt(o)]=o}var r=i.charAt(64);if(r){var n=t.indexOf(r);-1!==n&&(e=n)}return function(t,e,i){for(var s=[],o=0,r=0;r<e;r++)if(r%4){var n=i[t.charCodeAt(r-1)]<<r%4*2,_=i[t.charCodeAt(r)]>>>6-r%4*2;s[o>>>2]|=(n|_)<<24-o%4*8,o++}return a.create(s,o)}(t,e,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},o.enc.Base64)},function(t,e,i){var s;t.exports=(s=i(0),function(t){var e=s,i=e.lib,a=i.WordArray,o=i.Hasher,r=e.algo,n=[];!function(){for(var e=0;e<64;e++)n[e]=4294967296*t.abs(t.sin(e+1))|0}();var _=r.MD5=o.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var i=0;i<16;i++){var s=e+i,a=t[s];t[s]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}var o=this._hash.words,r=t[e+0],_=t[e+1],d=t[e+2],p=t[e+3],E=t[e+4],m=t[e+5],y=t[e+6],g=t[e+7],w=t[e+8],f=t[e+9],A=t[e+10],I=t[e+11],T=t[e+12],S=t[e+13],O=t[e+14],C=t[e+15],D=o[0],v=o[1],P=o[2],N=o[3];D=h(D,v,P,N,r,7,n[0]),N=h(N,D,v,P,_,12,n[1]),P=h(P,N,D,v,d,17,n[2]),v=h(v,P,N,D,p,22,n[3]),D=h(D,v,P,N,E,7,n[4]),N=h(N,D,v,P,m,12,n[5]),P=h(P,N,D,v,y,17,n[6]),v=h(v,P,N,D,g,22,n[7]),D=h(D,v,P,N,w,7,n[8]),N=h(N,D,v,P,f,12,n[9]),P=h(P,N,D,v,A,17,n[10]),v=h(v,P,N,D,I,22,n[11]),D=h(D,v,P,N,T,7,n[12]),N=h(N,D,v,P,S,12,n[13]),P=h(P,N,D,v,O,17,n[14]),D=c(D,v=h(v,P,N,D,C,22,n[15]),P,N,_,5,n[16]),N=c(N,D,v,P,y,9,n[17]),P=c(P,N,D,v,I,14,n[18]),v=c(v,P,N,D,r,20,n[19]),D=c(D,v,P,N,m,5,n[20]),N=c(N,D,v,P,A,9,n[21]),P=c(P,N,D,v,C,14,n[22]),v=c(v,P,N,D,E,20,n[23]),D=c(D,v,P,N,f,5,n[24]),N=c(N,D,v,P,O,9,n[25]),P=c(P,N,D,v,p,14,n[26]),v=c(v,P,N,D,w,20,n[27]),D=c(D,v,P,N,S,5,n[28]),N=c(N,D,v,P,d,9,n[29]),P=c(P,N,D,v,g,14,n[30]),D=l(D,v=c(v,P,N,D,T,20,n[31]),P,N,m,4,n[32]),N=l(N,D,v,P,w,11,n[33]),P=l(P,N,D,v,I,16,n[34]),v=l(v,P,N,D,O,23,n[35]),D=l(D,v,P,N,_,4,n[36]),N=l(N,D,v,P,E,11,n[37]),P=l(P,N,D,v,g,16,n[38]),v=l(v,P,N,D,A,23,n[39]),D=l(D,v,P,N,S,4,n[40]),N=l(N,D,v,P,r,11,n[41]),P=l(P,N,D,v,p,16,n[42]),v=l(v,P,N,D,y,23,n[43]),D=l(D,v,P,N,f,4,n[44]),N=l(N,D,v,P,T,11,n[45]),P=l(P,N,D,v,C,16,n[46]),D=u(D,v=l(v,P,N,D,d,23,n[47]),P,N,r,6,n[48]),N=u(N,D,v,P,g,10,n[49]),P=u(P,N,D,v,O,15,n[50]),v=u(v,P,N,D,m,21,n[51]),D=u(D,v,P,N,T,6,n[52]),N=u(N,D,v,P,p,10,n[53]),P=u(P,N,D,v,A,15,n[54]),v=u(v,P,N,D,_,21,n[55]),D=u(D,v,P,N,w,6,n[56]),N=u(N,D,v,P,C,10,n[57]),P=u(P,N,D,v,y,15,n[58]),v=u(v,P,N,D,S,21,n[59]),D=u(D,v,P,N,E,6,n[60]),N=u(N,D,v,P,I,10,n[61]),P=u(P,N,D,v,d,15,n[62]),v=u(v,P,N,D,f,21,n[63]),o[0]=o[0]+D|0,o[1]=o[1]+v|0,o[2]=o[2]+P|0,o[3]=o[3]+N|0},_doFinalize:function(){var e=this._data,i=e.words,s=8*this._nDataBytes,a=8*e.sigBytes;i[a>>>5]|=128<<24-a%32;var o=t.floor(s/4294967296),r=s;i[15+(a+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),i[14+(a+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(i.length+1),this._process();for(var n=this._hash,_=n.words,h=0;h<4;h++){var c=_[h];_[h]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return n},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});function h(t,e,i,s,a,o,r){var n=t+(e&i|~e&s)+a+r;return(n<<o|n>>>32-o)+e}function c(t,e,i,s,a,o,r){var n=t+(e&s|i&~s)+a+r;return(n<<o|n>>>32-o)+e}function l(t,e,i,s,a,o,r){var n=t+(e^i^s)+a+r;return(n<<o|n>>>32-o)+e}function u(t,e,i,s,a,o,r){var n=t+(i^(e|~s))+a+r;return(n<<o|n>>>32-o)+e}e.MD5=o._createHelper(_),e.HmacMD5=o._createHmacHelper(_)}(Math),s.MD5)},function(t,e,i){var s,a,o,r,n,_;t.exports=(_=i(0),a=(s=_).lib,o=a.Base,r=a.WordArray,(n=s.x64={}).Word=o.extend({init:function(t,e){this.high=t,this.low=e}}),n.WordArray=o.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:8*t.length},toX32:function(){for(var t=this.words,e=t.length,i=[],s=0;s<e;s++){var a=t[s];i.push(a.high),i.push(a.low)}return r.create(i,this.sigBytes)},clone:function(){for(var t=o.clone.call(this),e=t.words=this.words.slice(0),i=e.length,s=0;s<i;s++)e[s]=e[s].clone();return t}}),_)},function(t,e,i){var s,a,o,r,n,_,h,c;t.exports=(c=i(0),a=(s=c).lib,o=a.WordArray,r=a.Hasher,n=s.algo,_=[],h=n.SHA1=r.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var i=this._hash.words,s=i[0],a=i[1],o=i[2],r=i[3],n=i[4],h=0;h<80;h++){if(h<16)_[h]=0|t[e+h];else{var c=_[h-3]^_[h-8]^_[h-14]^_[h-16];_[h]=c<<1|c>>>31}var l=(s<<5|s>>>27)+n+_[h];l+=h<20?1518500249+(a&o|~a&r):h<40?1859775393+(a^o^r):h<60?(a&o|a&r|o&r)-1894007588:(a^o^r)-899497514,n=r,r=o,o=a<<30|a>>>2,a=s,s=l}i[0]=i[0]+s|0,i[1]=i[1]+a|0,i[2]=i[2]+o|0,i[3]=i[3]+r|0,i[4]=i[4]+n|0},_doFinalize:function(){var t=this._data,e=t.words,i=8*this._nDataBytes,s=8*t.sigBytes;return e[s>>>5]|=128<<24-s%32,e[14+(s+64>>>9<<4)]=Math.floor(i/4294967296),e[15+(s+64>>>9<<4)]=i,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=r.clone.call(this);return t._hash=this._hash.clone(),t}}),s.SHA1=r._createHelper(h),s.HmacSHA1=r._createHmacHelper(h),c.SHA1)},function(t,e,i){var s,a,o,r;t.exports=(s=i(0),o=(a=s).lib.Base,r=a.enc.Utf8,void(a.algo.HMAC=o.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=r.parse(e));var i=t.blockSize,s=4*i;e.sigBytes>s&&(e=t.finalize(e)),e.clamp();for(var a=this._oKey=e.clone(),o=this._iKey=e.clone(),n=a.words,_=o.words,h=0;h<i;h++)n[h]^=1549556828,_[h]^=909522486;a.sigBytes=o.sigBytes=s,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,i=e.finalize(t);return e.reset(),e.finalize(this._oKey.clone().concat(i))}})))},function(t,e,i){var s;t.exports=(s=i(0),function(t){var e=s,i=e.lib,a=i.WordArray,o=i.Hasher,r=e.algo,n=[],_=[];!function(){function e(e){for(var i=t.sqrt(e),s=2;s<=i;s++)if(!(e%s))return!1;return!0}function i(t){return 4294967296*(t-(0|t))|0}for(var s=2,a=0;a<64;)e(s)&&(a<8&&(n[a]=i(t.pow(s,.5))),_[a]=i(t.pow(s,1/3)),a++),s++}();var h=[],c=r.SHA256=o.extend({_doReset:function(){this._hash=new a.init(n.slice(0))},_doProcessBlock:function(t,e){for(var i=this._hash.words,s=i[0],a=i[1],o=i[2],r=i[3],n=i[4],c=i[5],l=i[6],u=i[7],d=0;d<64;d++){if(d<16)h[d]=0|t[e+d];else{var p=h[d-15],E=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,m=h[d-2],y=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;h[d]=E+h[d-7]+y+h[d-16]}var g=s&a^s&o^a&o,w=(s<<30|s>>>2)^(s<<19|s>>>13)^(s<<10|s>>>22),f=u+((n<<26|n>>>6)^(n<<21|n>>>11)^(n<<7|n>>>25))+(n&c^~n&l)+_[d]+h[d];u=l,l=c,c=n,n=r+f|0,r=o,o=a,a=s,s=f+(w+g)|0}i[0]=i[0]+s|0,i[1]=i[1]+a|0,i[2]=i[2]+o|0,i[3]=i[3]+r|0,i[4]=i[4]+n|0,i[5]=i[5]+c|0,i[6]=i[6]+l|0,i[7]=i[7]+u|0},_doFinalize:function(){var e=this._data,i=e.words,s=8*this._nDataBytes,a=8*e.sigBytes;return i[a>>>5]|=128<<24-a%32,i[14+(a+64>>>9<<4)]=t.floor(s/4294967296),i[15+(a+64>>>9<<4)]=s,e.sigBytes=4*i.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=o._createHelper(c),e.HmacSHA256=o._createHmacHelper(c)}(Math),s.SHA256)},function(t,e,i){var s;t.exports=(s=i(0),i(6),function(){var t=s,e=t.lib.Hasher,i=t.x64,a=i.Word,o=i.WordArray,r=t.algo;function n(){return a.create.apply(a,arguments)}var _=[n(1116352408,3609767458),n(1899447441,602891725),n(3049323471,3964484399),n(3921009573,2173295548),n(961987163,4081628472),n(1508970993,3053834265),n(2453635748,2937671579),n(2870763221,3664609560),n(3624381080,2734883394),n(310598401,1164996542),n(607225278,1323610764),n(1426881987,3590304994),n(1925078388,4068182383),n(2162078206,991336113),n(2614888103,633803317),n(3248222580,3479774868),n(3835390401,2666613458),n(4022224774,944711139),n(264347078,2341262773),n(604807628,2007800933),n(770255983,1495990901),n(1249150122,1856431235),n(1555081692,3175218132),n(1996064986,2198950837),n(2554220882,3999719339),n(2821834349,766784016),n(2952996808,2566594879),n(3210313671,3203337956),n(3336571891,1034457026),n(3584528711,2466948901),n(113926993,3758326383),n(338241895,168717936),n(666307205,1188179964),n(773529912,1546045734),n(1294757372,1522805485),n(1396182291,2643833823),n(1695183700,2343527390),n(1986661051,1014477480),n(2177026350,1206759142),n(2456956037,344077627),n(2730485921,1290863460),n(2820302411,3158454273),n(3259730800,3505952657),n(3345764771,106217008),n(3516065817,3606008344),n(3600352804,1432725776),n(4094571909,1467031594),n(275423344,851169720),n(430227734,3100823752),n(506948616,1363258195),n(659060556,3750685593),n(883997877,3785050280),n(958139571,3318307427),n(1322822218,3812723403),n(1537002063,2003034995),n(1747873779,3602036899),n(1955562222,1575990012),n(2024104815,1125592928),n(2227730452,2716904306),n(2361852424,442776044),n(2428436474,593698344),n(2756734187,3733110249),n(3204031479,2999351573),n(3329325298,3815920427),n(3391569614,3928383900),n(3515267271,566280711),n(3940187606,3454069534),n(4118630271,4000239992),n(116418474,1914138554),n(174292421,2731055270),n(289380356,3203993006),n(460393269,320620315),n(685471733,587496836),n(852142971,1086792851),n(1017036298,365543100),n(1126000580,2618297676),n(1288033470,3409855158),n(1501505948,4234509866),n(1607167915,987167468),n(1816402316,1246189591)],h=[];!function(){for(var t=0;t<80;t++)h[t]=n()}();var c=r.SHA512=e.extend({_doReset:function(){this._hash=new o.init([new a.init(1779033703,4089235720),new a.init(3144134277,2227873595),new a.init(1013904242,4271175723),new a.init(2773480762,1595750129),new a.init(1359893119,2917565137),new a.init(2600822924,725511199),new a.init(528734635,4215389547),new a.init(1541459225,327033209)])},_doProcessBlock:function(t,e){for(var i=this._hash.words,s=i[0],a=i[1],o=i[2],r=i[3],n=i[4],c=i[5],l=i[6],u=i[7],d=s.high,p=s.low,E=a.high,m=a.low,y=o.high,g=o.low,w=r.high,f=r.low,A=n.high,I=n.low,T=c.high,S=c.low,O=l.high,C=l.low,D=u.high,v=u.low,P=d,N=p,M=E,R=m,b=y,L=g,B=w,x=f,W=A,U=I,Y=T,F=S,k=O,G=C,H=D,K=v,X=0;X<80;X++){var j=h[X];if(X<16)var J=j.high=0|t[e+2*X],V=j.low=0|t[e+2*X+1];else{var Z=h[X-15],Q=Z.high,z=Z.low,q=(Q>>>1|z<<31)^(Q>>>8|z<<24)^Q>>>7,$=(z>>>1|Q<<31)^(z>>>8|Q<<24)^(z>>>7|Q<<25),tt=h[X-2],et=tt.high,it=tt.low,st=(et>>>19|it<<13)^(et<<3|it>>>29)^et>>>6,at=(it>>>19|et<<13)^(it<<3|et>>>29)^(it>>>6|et<<26),ot=h[X-7],rt=ot.high,nt=ot.low,_t=h[X-16],ht=_t.high,ct=_t.low;J=(J=(J=q+rt+((V=$+nt)>>>0<$>>>0?1:0))+st+((V+=at)>>>0<at>>>0?1:0))+ht+((V+=ct)>>>0<ct>>>0?1:0),j.high=J,j.low=V}var lt,ut=W&Y^~W&k,dt=U&F^~U&G,pt=P&M^P&b^M&b,Et=N&R^N&L^R&L,mt=(P>>>28|N<<4)^(P<<30|N>>>2)^(P<<25|N>>>7),yt=(N>>>28|P<<4)^(N<<30|P>>>2)^(N<<25|P>>>7),gt=(W>>>14|U<<18)^(W>>>18|U<<14)^(W<<23|U>>>9),wt=(U>>>14|W<<18)^(U>>>18|W<<14)^(U<<23|W>>>9),ft=_[X],At=ft.high,It=ft.low,Tt=H+gt+((lt=K+wt)>>>0<K>>>0?1:0),St=yt+Et;H=k,K=G,k=Y,G=F,Y=W,F=U,W=B+(Tt=(Tt=(Tt=Tt+ut+((lt+=dt)>>>0<dt>>>0?1:0))+At+((lt+=It)>>>0<It>>>0?1:0))+J+((lt+=V)>>>0<V>>>0?1:0))+((U=x+lt|0)>>>0<x>>>0?1:0)|0,B=b,x=L,b=M,L=R,M=P,R=N,P=Tt+(mt+pt+(St>>>0<yt>>>0?1:0))+((N=lt+St|0)>>>0<lt>>>0?1:0)|0}p=s.low=p+N,s.high=d+P+(p>>>0<N>>>0?1:0),m=a.low=m+R,a.high=E+M+(m>>>0<R>>>0?1:0),g=o.low=g+L,o.high=y+b+(g>>>0<L>>>0?1:0),f=r.low=f+x,r.high=w+B+(f>>>0<x>>>0?1:0),I=n.low=I+U,n.high=A+W+(I>>>0<U>>>0?1:0),S=c.low=S+F,c.high=T+Y+(S>>>0<F>>>0?1:0),C=l.low=C+G,l.high=O+k+(C>>>0<G>>>0?1:0),v=u.low=v+K,u.high=D+H+(v>>>0<K>>>0?1:0)},_doFinalize:function(){var t=this._data,e=t.words,i=8*this._nDataBytes,s=8*t.sigBytes;return e[s>>>5]|=128<<24-s%32,e[30+(s+128>>>10<<5)]=Math.floor(i/4294967296),e[31+(s+128>>>10<<5)]=i,t.sigBytes=4*e.length,this._process(),this._hash.toX32()},clone:function(){var t=e.clone.call(this);return t._hash=this._hash.clone(),t},blockSize:32});t.SHA512=e._createHelper(c),t.HmacSHA512=e._createHmacHelper(c)}(),s.SHA512)},function(t,e,i){var s;t.exports=(s=i(0),function(){if("function"==typeof ArrayBuffer){var t=s.lib.WordArray,e=t.init;(t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var i=t.byteLength,s=[],a=0;a<i;a++)s[a>>>2]|=t[a]<<24-a%4*8;e.call(this,s,i)}else e.apply(this,arguments)}).prototype=t}}(),s.lib.WordArray)},function(t,e,i){var s;t.exports=(s=i(0),function(){var t=s,e=t.lib.WordArray,i=t.enc;function a(t){return t<<8&4278255360|t>>>8&16711935}i.Utf16=i.Utf16BE={stringify:function(t){for(var e=t.words,i=t.sigBytes,s=[],a=0;a<i;a+=2){var o=e[a>>>2]>>>16-a%4*8&65535;s.push(String.fromCharCode(o))}return s.join("")},parse:function(t){for(var i=t.length,s=[],a=0;a<i;a++)s[a>>>1]|=t.charCodeAt(a)<<16-a%2*16;return e.create(s,2*i)}},i.Utf16LE={stringify:function(t){for(var e=t.words,i=t.sigBytes,s=[],o=0;o<i;o+=2){var r=a(e[o>>>2]>>>16-o%4*8&65535);s.push(String.fromCharCode(r))}return s.join("")},parse:function(t){for(var i=t.length,s=[],o=0;o<i;o++)s[o>>>1]|=a(t.charCodeAt(o)<<16-o%2*16);return e.create(s,2*i)}}}(),s.enc.Utf16)},function(t,e,i){var s,a,o,r,n,_;t.exports=(_=i(0),i(9),a=(s=_).lib.WordArray,o=s.algo,r=o.SHA256,n=o.SHA224=r.extend({_doReset:function(){this._hash=new a.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var t=r._doFinalize.call(this);return t.sigBytes-=4,t}}),s.SHA224=r._createHelper(n),s.HmacSHA224=r._createHmacHelper(n),_.SHA224)},function(t,e,i){var s,a,o,r,n,_,h,c;t.exports=(c=i(0),i(6),i(10),a=(s=c).x64,o=a.Word,r=a.WordArray,n=s.algo,_=n.SHA512,h=n.SHA384=_.extend({_doReset:function(){this._hash=new r.init([new o.init(3418070365,3238371032),new o.init(1654270250,914150663),new o.init(2438529370,812702999),new o.init(355462360,4144912697),new o.init(1731405415,4290775857),new o.init(2394180231,1750603025),new o.init(3675008525,1694076839),new o.init(1203062813,3204075428)])},_doFinalize:function(){var t=_._doFinalize.call(this);return t.sigBytes-=16,t}}),s.SHA384=_._createHelper(h),s.HmacSHA384=_._createHmacHelper(h),c.SHA384)},function(t,e,i){var s;t.exports=(s=i(0),i(6),function(t){var e=s,i=e.lib,a=i.WordArray,o=i.Hasher,r=e.x64.Word,n=e.algo,_=[],h=[],c=[];!function(){for(var t=1,e=0,i=0;i<24;i++){_[t+5*e]=(i+1)*(i+2)/2%64;var s=(2*t+3*e)%5;t=e%5,e=s}for(t=0;t<5;t++)for(e=0;e<5;e++)h[t+5*e]=e+(2*t+3*e)%5*5;for(var a=1,o=0;o<24;o++){for(var n=0,l=0,u=0;u<7;u++){if(1&a){var d=(1<<u)-1;d<32?l^=1<<d:n^=1<<d-32}128&a?a=a<<1^113:a<<=1}c[o]=r.create(n,l)}}();var l=[];!function(){for(var t=0;t<25;t++)l[t]=r.create()}();var u=n.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var t=this._state=[],e=0;e<25;e++)t[e]=new r.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(t,e){for(var i=this._state,s=this.blockSize/2,a=0;a<s;a++){var o=t[e+2*a],r=t[e+2*a+1];o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),(v=i[a]).high^=r,v.low^=o}for(var n=0;n<24;n++){for(var u=0;u<5;u++){for(var d=0,p=0,E=0;E<5;E++)d^=(v=i[u+5*E]).high,p^=v.low;var m=l[u];m.high=d,m.low=p}for(u=0;u<5;u++){var y=l[(u+4)%5],g=l[(u+1)%5],w=g.high,f=g.low;for(d=y.high^(w<<1|f>>>31),p=y.low^(f<<1|w>>>31),E=0;E<5;E++)(v=i[u+5*E]).high^=d,v.low^=p}for(var A=1;A<25;A++){var I=(v=i[A]).high,T=v.low,S=_[A];S<32?(d=I<<S|T>>>32-S,p=T<<S|I>>>32-S):(d=T<<S-32|I>>>64-S,p=I<<S-32|T>>>64-S);var O=l[h[A]];O.high=d,O.low=p}var C=l[0],D=i[0];for(C.high=D.high,C.low=D.low,u=0;u<5;u++)for(E=0;E<5;E++){var v=i[A=u+5*E],P=l[A],N=l[(u+1)%5+5*E],M=l[(u+2)%5+5*E];v.high=P.high^~N.high&M.high,v.low=P.low^~N.low&M.low}v=i[0];var R=c[n];v.high^=R.high,v.low^=R.low}},_doFinalize:function(){var e=this._data,i=e.words,s=(this._nDataBytes,8*e.sigBytes),o=32*this.blockSize;i[s>>>5]|=1<<24-s%32,i[(t.ceil((s+1)/o)*o>>>5)-1]|=128,e.sigBytes=4*i.length,this._process();for(var r=this._state,n=this.cfg.outputLength/8,_=n/8,h=[],c=0;c<_;c++){var l=r[c],u=l.high,d=l.low;u=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8),d=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),h.push(d),h.push(u)}return new a.init(h,n)},clone:function(){for(var t=o.clone.call(this),e=t._state=this._state.slice(0),i=0;i<25;i++)e[i]=e[i].clone();return t}});e.SHA3=o._createHelper(u),e.HmacSHA3=o._createHmacHelper(u)}(Math),s.SHA3)},function(t,e,i){var s;t.exports=(s=i(0),
/** @preserve
	(c) 2012 by Cédric Mesnil. All rights reserved.

	Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

	    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
	    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

	THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	*/
function(t){var e=s,i=e.lib,a=i.WordArray,o=i.Hasher,r=e.algo,n=a.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),_=a.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),h=a.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),c=a.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),l=a.create([0,1518500249,1859775393,2400959708,2840853838]),u=a.create([1352829926,1548603684,1836072691,2053994217,0]),d=r.RIPEMD160=o.extend({_doReset:function(){this._hash=a.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var i=0;i<16;i++){var s=e+i,a=t[s];t[s]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}var o,r,d,f,A,I,T,S,O,C,D,v=this._hash.words,P=l.words,N=u.words,M=n.words,R=_.words,b=h.words,L=c.words;for(I=o=v[0],T=r=v[1],S=d=v[2],O=f=v[3],C=A=v[4],i=0;i<80;i+=1)D=o+t[e+M[i]]|0,D+=i<16?p(r,d,f)+P[0]:i<32?E(r,d,f)+P[1]:i<48?m(r,d,f)+P[2]:i<64?y(r,d,f)+P[3]:g(r,d,f)+P[4],D=(D=w(D|=0,b[i]))+A|0,o=A,A=f,f=w(d,10),d=r,r=D,D=I+t[e+R[i]]|0,D+=i<16?g(T,S,O)+N[0]:i<32?y(T,S,O)+N[1]:i<48?m(T,S,O)+N[2]:i<64?E(T,S,O)+N[3]:p(T,S,O)+N[4],D=(D=w(D|=0,L[i]))+C|0,I=C,C=O,O=w(S,10),S=T,T=D;D=v[1]+d+O|0,v[1]=v[2]+f+C|0,v[2]=v[3]+A+I|0,v[3]=v[4]+o+T|0,v[4]=v[0]+r+S|0,v[0]=D},_doFinalize:function(){var t=this._data,e=t.words,i=8*this._nDataBytes,s=8*t.sigBytes;e[s>>>5]|=128<<24-s%32,e[14+(s+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t.sigBytes=4*(e.length+1),this._process();for(var a=this._hash,o=a.words,r=0;r<5;r++){var n=o[r];o[r]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}return a},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});function p(t,e,i){return t^e^i}function E(t,e,i){return t&e|~t&i}function m(t,e,i){return(t|~e)^i}function y(t,e,i){return t&i|e&~i}function g(t,e,i){return t^(e|~i)}function w(t,e){return t<<e|t>>>32-e}e.RIPEMD160=o._createHelper(d),e.HmacRIPEMD160=o._createHmacHelper(d)}(Math),s.RIPEMD160)},function(t,e,i){var s,a,o,r,n,_,h,c,l;t.exports=(l=i(0),i(7),i(8),a=(s=l).lib,o=a.Base,r=a.WordArray,n=s.algo,_=n.SHA1,h=n.HMAC,c=n.PBKDF2=o.extend({cfg:o.extend({keySize:4,hasher:_,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var i=this.cfg,s=h.create(i.hasher,t),a=r.create(),o=r.create([1]),n=a.words,_=o.words,c=i.keySize,l=i.iterations;n.length<c;){var u=s.update(e).finalize(o);s.reset();for(var d=u.words,p=d.length,E=u,m=1;m<l;m++){E=s.finalize(E),s.reset();for(var y=E.words,g=0;g<p;g++)d[g]^=y[g]}a.concat(u),_[0]++}return a.sigBytes=4*c,a}}),s.PBKDF2=function(t,e,i){return c.create(i).compute(t,e)},l.PBKDF2)},function(t,e,i){var s;t.exports=(s=i(0),i(1),s.mode.CFB=function(){var t=s.lib.BlockCipherMode.extend();function e(t,e,i,s){var a=this._iv;if(a){var o=a.slice(0);this._iv=void 0}else o=this._prevBlock;s.encryptBlock(o,0);for(var r=0;r<i;r++)t[e+r]^=o[r]}return t.Encryptor=t.extend({processBlock:function(t,i){var s=this._cipher,a=s.blockSize;e.call(this,t,i,a,s),this._prevBlock=t.slice(i,i+a)}}),t.Decryptor=t.extend({processBlock:function(t,i){var s=this._cipher,a=s.blockSize,o=t.slice(i,i+a);e.call(this,t,i,a,s),this._prevBlock=o}}),t}(),s.mode.CFB)},function(t,e,i){var s,a,o;t.exports=(o=i(0),i(1),o.mode.CTR=(s=o.lib.BlockCipherMode.extend(),a=s.Encryptor=s.extend({processBlock:function(t,e){var i=this._cipher,s=i.blockSize,a=this._iv,o=this._counter;a&&(o=this._counter=a.slice(0),this._iv=void 0);var r=o.slice(0);i.encryptBlock(r,0),o[s-1]=o[s-1]+1|0;for(var n=0;n<s;n++)t[e+n]^=r[n]}}),s.Decryptor=a,s),o.mode.CTR)},function(t,e,i){var s;t.exports=(s=i(0),i(1),
/** @preserve
	 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
	 * derived from CryptoJS.mode.CTR
	 * Jan Hruby jhruby.web@gmail.com
	 */
s.mode.CTRGladman=function(){var t=s.lib.BlockCipherMode.extend();function e(t){if(255==(t>>24&255)){var e=t>>16&255,i=t>>8&255,s=255&t;255===e?(e=0,255===i?(i=0,255===s?s=0:++s):++i):++e,t=0,t+=e<<16,t+=i<<8,t+=s}else t+=1<<24;return t}var i=t.Encryptor=t.extend({processBlock:function(t,i){var s=this._cipher,a=s.blockSize,o=this._iv,r=this._counter;o&&(r=this._counter=o.slice(0),this._iv=void 0),function(t){0===(t[0]=e(t[0]))&&(t[1]=e(t[1]))}(r);var n=r.slice(0);s.encryptBlock(n,0);for(var _=0;_<a;_++)t[i+_]^=n[_]}});return t.Decryptor=i,t}(),s.mode.CTRGladman)},function(t,e,i){var s,a,o;t.exports=(o=i(0),i(1),o.mode.OFB=(s=o.lib.BlockCipherMode.extend(),a=s.Encryptor=s.extend({processBlock:function(t,e){var i=this._cipher,s=i.blockSize,a=this._iv,o=this._keystream;a&&(o=this._keystream=a.slice(0),this._iv=void 0),i.encryptBlock(o,0);for(var r=0;r<s;r++)t[e+r]^=o[r]}}),s.Decryptor=a,s),o.mode.OFB)},function(t,e,i){var s,a;t.exports=(a=i(0),i(1),a.mode.ECB=((s=a.lib.BlockCipherMode.extend()).Encryptor=s.extend({processBlock:function(t,e){this._cipher.encryptBlock(t,e)}}),s.Decryptor=s.extend({processBlock:function(t,e){this._cipher.decryptBlock(t,e)}}),s),a.mode.ECB)},function(t,e,i){var s;t.exports=(s=i(0),i(1),s.pad.AnsiX923={pad:function(t,e){var i=t.sigBytes,s=4*e,a=s-i%s,o=i+a-1;t.clamp(),t.words[o>>>2]|=a<<24-o%4*8,t.sigBytes+=a},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},s.pad.Ansix923)},function(t,e,i){var s;t.exports=(s=i(0),i(1),s.pad.Iso10126={pad:function(t,e){var i=4*e,a=i-t.sigBytes%i;t.concat(s.lib.WordArray.random(a-1)).concat(s.lib.WordArray.create([a<<24],1))},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},s.pad.Iso10126)},function(t,e,i){var s;t.exports=(s=i(0),i(1),s.pad.Iso97971={pad:function(t,e){t.concat(s.lib.WordArray.create([2147483648],1)),s.pad.ZeroPadding.pad(t,e)},unpad:function(t){s.pad.ZeroPadding.unpad(t),t.sigBytes--}},s.pad.Iso97971)},function(t,e,i){var s;t.exports=(s=i(0),i(1),s.pad.ZeroPadding={pad:function(t,e){var i=4*e;t.clamp(),t.sigBytes+=i-(t.sigBytes%i||i)},unpad:function(t){for(var e=t.words,i=t.sigBytes-1;!(e[i>>>2]>>>24-i%4*8&255);)i--;t.sigBytes=i+1}},s.pad.ZeroPadding)},function(t,e,i){var s;t.exports=(s=i(0),i(1),s.pad.NoPadding={pad:function(){},unpad:function(){}},s.pad.NoPadding)},function(t,e,i){var s,a,o,r;t.exports=(r=i(0),i(1),a=(s=r).lib.CipherParams,o=s.enc.Hex,s.format.Hex={stringify:function(t){return t.ciphertext.toString(o)},parse:function(t){var e=o.parse(t);return a.create({ciphertext:e})}},r.format.Hex)},function(t,e,i){var s;t.exports=(s=i(0),i(4),i(5),i(2),i(1),function(){var t=s,e=t.lib.BlockCipher,i=t.algo,a=[],o=[],r=[],n=[],_=[],h=[],c=[],l=[],u=[],d=[];!function(){for(var t=[],e=0;e<256;e++)t[e]=e<128?e<<1:e<<1^283;var i=0,s=0;for(e=0;e<256;e++){var p=s^s<<1^s<<2^s<<3^s<<4;p=p>>>8^255&p^99,a[i]=p,o[p]=i;var E=t[i],m=t[E],y=t[m],g=257*t[p]^16843008*p;r[i]=g<<24|g>>>8,n[i]=g<<16|g>>>16,_[i]=g<<8|g>>>24,h[i]=g,g=16843009*y^65537*m^257*E^16843008*i,c[p]=g<<24|g>>>8,l[p]=g<<16|g>>>16,u[p]=g<<8|g>>>24,d[p]=g,i?(i=E^t[t[t[y^E]]],s^=t[t[s]]):i=s=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],E=i.AES=e.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var t=this._keyPriorReset=this._key,e=t.words,i=t.sigBytes/4,s=4*((this._nRounds=i+6)+1),o=this._keySchedule=[],r=0;r<s;r++)if(r<i)o[r]=e[r];else{var n=o[r-1];r%i?i>6&&r%i==4&&(n=a[n>>>24]<<24|a[n>>>16&255]<<16|a[n>>>8&255]<<8|a[255&n]):(n=a[(n=n<<8|n>>>24)>>>24]<<24|a[n>>>16&255]<<16|a[n>>>8&255]<<8|a[255&n],n^=p[r/i|0]<<24),o[r]=o[r-i]^n}for(var _=this._invKeySchedule=[],h=0;h<s;h++)r=s-h,n=h%4?o[r]:o[r-4],_[h]=h<4||r<=4?n:c[a[n>>>24]]^l[a[n>>>16&255]]^u[a[n>>>8&255]]^d[a[255&n]]}},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,r,n,_,h,a)},decryptBlock:function(t,e){var i=t[e+1];t[e+1]=t[e+3],t[e+3]=i,this._doCryptBlock(t,e,this._invKeySchedule,c,l,u,d,o),i=t[e+1],t[e+1]=t[e+3],t[e+3]=i},_doCryptBlock:function(t,e,i,s,a,o,r,n){for(var _=this._nRounds,h=t[e]^i[0],c=t[e+1]^i[1],l=t[e+2]^i[2],u=t[e+3]^i[3],d=4,p=1;p<_;p++){var E=s[h>>>24]^a[c>>>16&255]^o[l>>>8&255]^r[255&u]^i[d++],m=s[c>>>24]^a[l>>>16&255]^o[u>>>8&255]^r[255&h]^i[d++],y=s[l>>>24]^a[u>>>16&255]^o[h>>>8&255]^r[255&c]^i[d++],g=s[u>>>24]^a[h>>>16&255]^o[c>>>8&255]^r[255&l]^i[d++];h=E,c=m,l=y,u=g}E=(n[h>>>24]<<24|n[c>>>16&255]<<16|n[l>>>8&255]<<8|n[255&u])^i[d++],m=(n[c>>>24]<<24|n[l>>>16&255]<<16|n[u>>>8&255]<<8|n[255&h])^i[d++],y=(n[l>>>24]<<24|n[u>>>16&255]<<16|n[h>>>8&255]<<8|n[255&c])^i[d++],g=(n[u>>>24]<<24|n[h>>>16&255]<<16|n[c>>>8&255]<<8|n[255&l])^i[d++],t[e]=E,t[e+1]=m,t[e+2]=y,t[e+3]=g},keySize:8});t.AES=e._createHelper(E)}(),s.AES)},function(t,e,i){var s;t.exports=(s=i(0),i(4),i(5),i(2),i(1),function(){var t=s,e=t.lib,i=e.WordArray,a=e.BlockCipher,o=t.algo,r=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],n=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],_=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],h=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],c=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],l=o.DES=a.extend({_doReset:function(){for(var t=this._key.words,e=[],i=0;i<56;i++){var s=r[i]-1;e[i]=t[s>>>5]>>>31-s%32&1}for(var a=this._subKeys=[],o=0;o<16;o++){var h=a[o]=[],c=_[o];for(i=0;i<24;i++)h[i/6|0]|=e[(n[i]-1+c)%28]<<31-i%6,h[4+(i/6|0)]|=e[28+(n[i+24]-1+c)%28]<<31-i%6;for(h[0]=h[0]<<1|h[0]>>>31,i=1;i<7;i++)h[i]=h[i]>>>4*(i-1)+3;h[7]=h[7]<<5|h[7]>>>27}var l=this._invSubKeys=[];for(i=0;i<16;i++)l[i]=a[15-i]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._subKeys)},decryptBlock:function(t,e){this._doCryptBlock(t,e,this._invSubKeys)},_doCryptBlock:function(t,e,i){this._lBlock=t[e],this._rBlock=t[e+1],u.call(this,4,252645135),u.call(this,16,65535),d.call(this,2,858993459),d.call(this,8,16711935),u.call(this,1,1431655765);for(var s=0;s<16;s++){for(var a=i[s],o=this._lBlock,r=this._rBlock,n=0,_=0;_<8;_++)n|=h[_][((r^a[_])&c[_])>>>0];this._lBlock=r,this._rBlock=o^n}var l=this._lBlock;this._lBlock=this._rBlock,this._rBlock=l,u.call(this,1,1431655765),d.call(this,8,16711935),d.call(this,2,858993459),u.call(this,16,65535),u.call(this,4,252645135),t[e]=this._lBlock,t[e+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function u(t,e){var i=(this._lBlock>>>t^this._rBlock)&e;this._rBlock^=i,this._lBlock^=i<<t}function d(t,e){var i=(this._rBlock>>>t^this._lBlock)&e;this._lBlock^=i,this._rBlock^=i<<t}t.DES=a._createHelper(l);var p=o.TripleDES=a.extend({_doReset:function(){var t=this._key.words;this._des1=l.createEncryptor(i.create(t.slice(0,2))),this._des2=l.createEncryptor(i.create(t.slice(2,4))),this._des3=l.createEncryptor(i.create(t.slice(4,6)))},encryptBlock:function(t,e){this._des1.encryptBlock(t,e),this._des2.decryptBlock(t,e),this._des3.encryptBlock(t,e)},decryptBlock:function(t,e){this._des3.decryptBlock(t,e),this._des2.encryptBlock(t,e),this._des1.decryptBlock(t,e)},keySize:6,ivSize:2,blockSize:2});t.TripleDES=a._createHelper(p)}(),s.TripleDES)},function(t,e,i){var s;t.exports=(s=i(0),i(4),i(5),i(2),i(1),function(){var t=s,e=t.lib.StreamCipher,i=t.algo,a=i.RC4=e.extend({_doReset:function(){for(var t=this._key,e=t.words,i=t.sigBytes,s=this._S=[],a=0;a<256;a++)s[a]=a;a=0;for(var o=0;a<256;a++){var r=a%i,n=e[r>>>2]>>>24-r%4*8&255;o=(o+s[a]+n)%256;var _=s[a];s[a]=s[o],s[o]=_}this._i=this._j=0},_doProcessBlock:function(t,e){t[e]^=o.call(this)},keySize:8,ivSize:0});function o(){for(var t=this._S,e=this._i,i=this._j,s=0,a=0;a<4;a++){i=(i+t[e=(e+1)%256])%256;var o=t[e];t[e]=t[i],t[i]=o,s|=t[(t[e]+t[i])%256]<<24-8*a}return this._i=e,this._j=i,s}t.RC4=e._createHelper(a);var r=i.RC4Drop=a.extend({cfg:a.cfg.extend({drop:192}),_doReset:function(){a._doReset.call(this);for(var t=this.cfg.drop;t>0;t--)o.call(this)}});t.RC4Drop=e._createHelper(r)}(),s.RC4)},function(t,e,i){var s;t.exports=(s=i(0),i(4),i(5),i(2),i(1),function(){var t=s,e=t.lib.StreamCipher,i=t.algo,a=[],o=[],r=[],n=i.Rabbit=e.extend({_doReset:function(){for(var t=this._key.words,e=this.cfg.iv,i=0;i<4;i++)t[i]=16711935&(t[i]<<8|t[i]>>>24)|4278255360&(t[i]<<24|t[i]>>>8);var s=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],a=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];for(this._b=0,i=0;i<4;i++)_.call(this);for(i=0;i<8;i++)a[i]^=s[i+4&7];if(e){var o=e.words,r=o[0],n=o[1],h=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),c=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),l=h>>>16|4294901760&c,u=c<<16|65535&h;for(a[0]^=h,a[1]^=l,a[2]^=c,a[3]^=u,a[4]^=h,a[5]^=l,a[6]^=c,a[7]^=u,i=0;i<4;i++)_.call(this)}},_doProcessBlock:function(t,e){var i=this._X;_.call(this),a[0]=i[0]^i[5]>>>16^i[3]<<16,a[1]=i[2]^i[7]>>>16^i[5]<<16,a[2]=i[4]^i[1]>>>16^i[7]<<16,a[3]=i[6]^i[3]>>>16^i[1]<<16;for(var s=0;s<4;s++)a[s]=16711935&(a[s]<<8|a[s]>>>24)|4278255360&(a[s]<<24|a[s]>>>8),t[e+s]^=a[s]},blockSize:4,ivSize:2});function _(){for(var t=this._X,e=this._C,i=0;i<8;i++)o[i]=e[i];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<o[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<o[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<o[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<o[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<o[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<o[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<o[6]>>>0?1:0)|0,this._b=e[7]>>>0<o[7]>>>0?1:0,i=0;i<8;i++){var s=t[i]+e[i],a=65535&s,n=s>>>16,_=((a*a>>>17)+a*n>>>15)+n*n,h=((4294901760&s)*s|0)+((65535&s)*s|0);r[i]=_^h}t[0]=r[0]+(r[7]<<16|r[7]>>>16)+(r[6]<<16|r[6]>>>16)|0,t[1]=r[1]+(r[0]<<8|r[0]>>>24)+r[7]|0,t[2]=r[2]+(r[1]<<16|r[1]>>>16)+(r[0]<<16|r[0]>>>16)|0,t[3]=r[3]+(r[2]<<8|r[2]>>>24)+r[1]|0,t[4]=r[4]+(r[3]<<16|r[3]>>>16)+(r[2]<<16|r[2]>>>16)|0,t[5]=r[5]+(r[4]<<8|r[4]>>>24)+r[3]|0,t[6]=r[6]+(r[5]<<16|r[5]>>>16)+(r[4]<<16|r[4]>>>16)|0,t[7]=r[7]+(r[6]<<8|r[6]>>>24)+r[5]|0}t.Rabbit=e._createHelper(n)}(),s.Rabbit)},function(t,e,i){var s;t.exports=(s=i(0),i(4),i(5),i(2),i(1),function(){var t=s,e=t.lib.StreamCipher,i=t.algo,a=[],o=[],r=[],n=i.RabbitLegacy=e.extend({_doReset:function(){var t=this._key.words,e=this.cfg.iv,i=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],s=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];this._b=0;for(var a=0;a<4;a++)_.call(this);for(a=0;a<8;a++)s[a]^=i[a+4&7];if(e){var o=e.words,r=o[0],n=o[1],h=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),c=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),l=h>>>16|4294901760&c,u=c<<16|65535&h;for(s[0]^=h,s[1]^=l,s[2]^=c,s[3]^=u,s[4]^=h,s[5]^=l,s[6]^=c,s[7]^=u,a=0;a<4;a++)_.call(this)}},_doProcessBlock:function(t,e){var i=this._X;_.call(this),a[0]=i[0]^i[5]>>>16^i[3]<<16,a[1]=i[2]^i[7]>>>16^i[5]<<16,a[2]=i[4]^i[1]>>>16^i[7]<<16,a[3]=i[6]^i[3]>>>16^i[1]<<16;for(var s=0;s<4;s++)a[s]=16711935&(a[s]<<8|a[s]>>>24)|4278255360&(a[s]<<24|a[s]>>>8),t[e+s]^=a[s]},blockSize:4,ivSize:2});function _(){for(var t=this._X,e=this._C,i=0;i<8;i++)o[i]=e[i];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<o[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<o[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<o[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<o[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<o[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<o[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<o[6]>>>0?1:0)|0,this._b=e[7]>>>0<o[7]>>>0?1:0,i=0;i<8;i++){var s=t[i]+e[i],a=65535&s,n=s>>>16,_=((a*a>>>17)+a*n>>>15)+n*n,h=((4294901760&s)*s|0)+((65535&s)*s|0);r[i]=_^h}t[0]=r[0]+(r[7]<<16|r[7]>>>16)+(r[6]<<16|r[6]>>>16)|0,t[1]=r[1]+(r[0]<<8|r[0]>>>24)+r[7]|0,t[2]=r[2]+(r[1]<<16|r[1]>>>16)+(r[0]<<16|r[0]>>>16)|0,t[3]=r[3]+(r[2]<<8|r[2]>>>24)+r[1]|0,t[4]=r[4]+(r[3]<<16|r[3]>>>16)+(r[2]<<16|r[2]>>>16)|0,t[5]=r[5]+(r[4]<<8|r[4]>>>24)+r[3]|0,t[6]=r[6]+(r[5]<<16|r[5]>>>16)+(r[4]<<16|r[4]>>>16)|0,t[7]=r[7]+(r[6]<<8|r[6]>>>24)+r[5]|0}t.RabbitLegacy=e._createHelper(n)}(),s.RabbitLegacy)},function(t,e,i){"use strict";var s,a;i.r(e),i.d(e,"getProgress",(function(){return ae})),i.d(e,"WWA",(function(){return oe})),function(t){t[t.NONE=0]="NONE",t[t.KEYDOWN=1]="KEYDOWN",t[t.KEYPRESS=2]="KEYPRESS",t[t.KEYUP=3]="KEYUP",t[t.KEYPRESS_MESSAGECHANGE=4]="KEYPRESS_MESSAGECHANGE"}(s||(s={})),function(t){t[t.KEY_ENTER=13]="KEY_ENTER",t[t.KEY_SHIFT=16]="KEY_SHIFT",t[t.KEY_ESC=27]="KEY_ESC",t[t.KEY_SPACE=32]="KEY_SPACE",t[t.KEY_LEFT=37]="KEY_LEFT",t[t.KEY_UP=38]="KEY_UP",t[t.KEY_RIGHT=39]="KEY_RIGHT",t[t.KEY_DOWN=40]="KEY_DOWN",t[t.KEY_1=49]="KEY_1",t[t.KEY_2=50]="KEY_2",t[t.KEY_3=51]="KEY_3",t[t.KEY_A=65]="KEY_A",t[t.KEY_C=67]="KEY_C",t[t.KEY_D=68]="KEY_D",t[t.KEY_E=69]="KEY_E",t[t.KEY_I=73]="KEY_I",t[t.KEY_M=77]="KEY_M",t[t.KEY_N=78]="KEY_N",t[t.KEY_P=80]="KEY_P",t[t.KEY_Q=81]="KEY_Q",t[t.KEY_S=83]="KEY_S",t[t.KEY_W=87]="KEY_W",t[t.KEY_X=88]="KEY_X",t[t.KEY_Y=89]="KEY_Y",t[t.KEY_Z=90]="KEY_Z",t[t.KEY_F1=112]="KEY_F1",t[t.KEY_F2=113]="KEY_F2",t[t.KEY_F3=114]="KEY_F3",t[t.KEY_F4=115]="KEY_F4",t[t.KEY_F5=116]="KEY_F5",t[t.KEY_F6=117]="KEY_F6",t[t.KEY_F7=118]="KEY_F7",t[t.KEY_F8=119]="KEY_F8",t[t.KEY_F9=120]="KEY_F9",t[t.KEY_F12=123]="KEY_F12"}(a||(a={}));var o,r,n=function(){function t(){var e;for(this._nextKeyState=new Array(t.KEY_BUFFER_MAX),this._keyState=new Array(t.KEY_BUFFER_MAX),this._prevKeyState=new Array(t.KEY_BUFFER_MAX),this._prevKeyStateOnControllable=new Array(t.KEY_BUFFER_MAX),this._keyInputContinueFrameNum=new Array(t.KEY_BUFFER_MAX),e=0;e<t.KEY_BUFFER_MAX;e++)this._nextKeyState[e]=!1,this._keyState[e]=!1,this._prevKeyState[e]=!1,this._prevKeyStateOnControllable[e]=!1,this._keyInputContinueFrameNum[e]=0}return t.prototype.checkHitKey=function(t){var e=this.getKeyState(t);return e===s.KEYDOWN||e===s.KEYPRESS},t.prototype.getKeyState=function(t){return this._prevKeyState[t]?this._keyState[t]?s.KEYPRESS:s.KEYUP:this._keyState[t]?s.KEYDOWN:s.NONE},t.prototype.getKeyStateForControllPlayer=function(t){return this._prevKeyStateOnControllable[t]?this._keyState[t]?s.KEYPRESS:s.KEYUP:this._keyState[t]?s.KEYDOWN:s.NONE},t.prototype.getKeyStateForMessageCheck=function(t){return this._prevKeyState[t]?this._keyState[t]?this._keyInputContinueFrameNum[t]>=Q.KEYPRESS_MESSAGE_CHANGE_FRAME_NUM?s.KEYPRESS_MESSAGECHANGE:s.KEYPRESS:s.KEYUP:this._keyState[t]?s.KEYDOWN:s.NONE},t.prototype.setPressInfo=function(t){this._nextKeyState[t]=!0,this._keyInputContinueFrameNum[t]=-1},t.prototype.setReleaseInfo=function(t){this._nextKeyState[t]=!1,this._keyInputContinueFrameNum[t]=-1},t.prototype.update=function(){var e;for(this._prevKeyState=this._keyState.slice(),this._keyState=this._nextKeyState.slice(),e=0;e<t.KEY_BUFFER_MAX;e++)this._keyState[e]&&this._keyInputContinueFrameNum[e]++},t.prototype.memorizeKeyStateOnControllableFrame=function(){this._prevKeyStateOnControllable=this._keyState.slice()},t.prototype.allClear=function(){var e;for(this._nextKeyState=new Array(t.KEY_BUFFER_MAX),e=0;e<t.KEY_BUFFER_MAX;e++)this._nextKeyState[e]=!1},t.KEY_BUFFER_MAX=256,t}();!function(t){t[t.NONE=0]="NONE",t[t.MOUSEDOWN=1]="MOUSEDOWN",t[t.MOUSEPRESS=2]="MOUSEPRESS",t[t.MOUSEUP=3]="MOUSEUP"}(o||(o={})),function(t){t[t.DIR_KEY=1]="DIR_KEY"}(r||(r={}));var _,h,c=function(){function t(){this._prevMouseState=!1,this._mouseState=!1,this._nextMouseState=!1}return t.prototype.checkClickMouse=function(t){var e;return(e=void 0!==t?this.getMouseState(t):this.getMouseState())===o.MOUSEDOWN||e===o.MOUSEPRESS},t.prototype.getMouseState=function(t){return void 0!==t&&this._inputDir!==t?o.NONE:this._prevMouseState?this._mouseState?o.MOUSEPRESS:o.MOUSEUP:this._mouseState?o.MOUSEDOWN:o.NONE},t.prototype.getMouseStateForControllPlayer=function(t){return void 0!==t&&this._inputDir!==t?o.NONE:this._prevMouseStateOnControllable?this._mouseState?o.MOUSEPRESS:o.MOUSEUP:this._mouseState?o.MOUSEDOWN:o.NONE},t.prototype.setPressInfo=function(t,e){this._nextMouseState=!0,this._inputDir=t,this._touchID=e},t.prototype.setReleaseInfo=function(){this._touchID=0,this._nextMouseState=!1},t.prototype.touchIDIsSetDir=function(){return this._touchID===r.DIR_KEY},t.prototype.memorizeMouseStateOnControllableFrame=function(){this._prevMouseStateOnControllable=this._mouseState},t.prototype.update=function(){this._prevMouseState=this._mouseState,this._mouseState=this._nextMouseState},t.prototype.clear=function(){this._nextMouseState=!1},t.prototype.getTouchID=function(){return this._touchID},t}();!function(t){t[t.BUTTON_INDEX_B=0]="BUTTON_INDEX_B",t[t.BUTTON_INDEX_A=1]="BUTTON_INDEX_A",t[t.BUTTON_INDEX_Y=2]="BUTTON_INDEX_Y",t[t.BUTTON_INDEX_X=3]="BUTTON_INDEX_X",t[t.BUTTON_INDEX_L=4]="BUTTON_INDEX_L",t[t.BUTTON_INDEX_R=5]="BUTTON_INDEX_R",t[t.BUTTON_INDEX_ZL=6]="BUTTON_INDEX_ZL",t[t.BUTTON_INDEX_ZR=7]="BUTTON_INDEX_ZR",t[t.BUTTON_INDEX_MINUS=8]="BUTTON_INDEX_MINUS",t[t.BUTTON_INDEX_PLUS=9]="BUTTON_INDEX_PLUS",t[t.BUTTON_INDEX_LEFT_STICK=10]="BUTTON_INDEX_LEFT_STICK",t[t.BUTTON_INDEX_RIGHT_STICK=11]="BUTTON_INDEX_RIGHT_STICK",t[t.BUTTON_CROSS_KEY_UP=12]="BUTTON_CROSS_KEY_UP",t[t.BUTTON_CROSS_KEY_DOWN=13]="BUTTON_CROSS_KEY_DOWN",t[t.BUTTON_CROSS_KEY_LEFT=14]="BUTTON_CROSS_KEY_LEFT",t[t.BUTTON_CROSS_KEY_RIGHT=15]="BUTTON_CROSS_KEY_RIGHT"}(_||(_={})),function(t){t[t.AXES_L_HORIZONTAL_INDEX=0]="AXES_L_HORIZONTAL_INDEX",t[t.AXES_L_VERTICAL_INDEX=1]="AXES_L_VERTICAL_INDEX",t[t.AXES_R_HORIZONTAL_INDEX=2]="AXES_R_HORIZONTAL_INDEX",t[t.AXES_R_VERTICAL_INDEX=3]="AXES_R_VERTICAL_INDEX",t[t.AXES_CROSS_KEY=9]="AXES_CROSS_KEY"}(h||(h={}));var l,u,d,p=function(){function t(){var t;for(this.gamepad=null,this.triggers=[],t=0;t<16;t++)this.triggers[t]=!1}return t.prototype.update=function(){this.gamepad=null;var t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];if(t&&t.length>0&&t[0]){var e=t[0];this.gamepad=e}},t.prototype.buttonTrigger=function(){for(var t,e,i,s,a,o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];if(!this.gamepad)return!1;for(e=o.length,t=0;t<e;t++){i=o[t];var n=this.gamepad.buttons[i];if(!n)return!1;if(s="object"==typeof n?!0===n.pressed:1===n,a=this.triggers[i],this.triggers[i]=s,s&&!a)return!0}return!1},t.prototype.buttonPressed=function(){for(var t,e,i,s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];if(!this.gamepad)return!1;for(e=s.length,t=0;t<e;t++){i=s[t];var o=this.gamepad.buttons[i];if(!o)return!1;if("object"==typeof o?!0===o.pressed:1===o)return!0}return!1},t.prototype.crossPressed=function(){for(var t,e,i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];if(!this.gamepad)return!1;for(e=i.length,t=0;t<e;t++)switch(i[t]){case _.BUTTON_CROSS_KEY_UP:if(this.gamepad.axes[h.AXES_L_VERTICAL_INDEX]<=-.6||this.gamepad.axes[h.AXES_R_VERTICAL_INDEX]<=-.6||-1===this.stickFloor(h.AXES_CROSS_KEY)||this.buttonPressed(_.BUTTON_CROSS_KEY_UP))return!0;break;case _.BUTTON_CROSS_KEY_DOWN:if(this.gamepad.axes[h.AXES_L_VERTICAL_INDEX]>=.7||this.gamepad.axes[h.AXES_R_VERTICAL_INDEX]>=.7||.1===this.stickFloor(h.AXES_CROSS_KEY)||this.buttonPressed(_.BUTTON_CROSS_KEY_DOWN))return!0;break;case _.BUTTON_CROSS_KEY_LEFT:if(this.gamepad.axes[h.AXES_L_HORIZONTAL_INDEX]<=-.7||this.gamepad.axes[h.AXES_R_HORIZONTAL_INDEX]<=-.7||.7===this.stickFloor(h.AXES_CROSS_KEY)||this.buttonPressed(_.BUTTON_CROSS_KEY_LEFT))return!0;break;case _.BUTTON_CROSS_KEY_RIGHT:if(this.gamepad.axes[h.AXES_L_HORIZONTAL_INDEX]>.6||this.gamepad.axes[h.AXES_R_HORIZONTAL_INDEX]>.6||-.5===this.stickFloor(h.AXES_CROSS_KEY)||this.buttonPressed(_.BUTTON_CROSS_KEY_RIGHT))return!0}return!1},t.prototype.vibration=function(t){return!!this.gamepad&&(!!this.gamepad.vibrationActuator&&void(t?this.gamepad.vibrationActuator.playEffect("dual-rumble",{startDelay:0,duration:100,weakMagnitude:1,strongMagnitude:.5}):this.gamepad.vibrationActuator.playEffect("dual-rumble",{startDelay:0,duration:100,weakMagnitude:.5,strongMagnitude:1})))},t.prototype.stickFloor=function(){for(var t,e,i,s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];if(!this.gamepad)return 0;for(e=s.length,t=0;t<e;t++){i=s[t];var o=this.gamepad.axes[i];return"number"!=typeof o?0:Math.floor(10*o)/10}return 0},t}(),E=(l=function(t,e){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),m=function(){function t(t,e){this.strength=t,this.defence=e}return t.prototype.add=function(t){return this.strength+=t.strength,this.defence+=t.defence,this},t.prototype.plus=function(e){return new t(this.strength+e.strength,this.defence+e.defence)},t.prototype.minus=function(e){return new t(this.strength-e.strength,this.defence-e.defence)},t.prototype.equals=function(t){return this.strength===t.strength&&this.defence===t.defence},t}(),y=function(t){function e(e,i,s,a){var o=t.call(this,i,s)||this;return o.energy=e,o.gold=a,o}return E(e,t),e.prototype.add=function(t){return t instanceof e&&(this.energy+=t.energy,this.gold+=t.gold),this.strength+=t.strength,this.defence+=t.defence,this},e.prototype.plus=function(t){return t instanceof e?new e(this.energy+t.energy,this.strength+t.strength,this.defence+t.defence,this.gold+t.gold):new e(this.energy,this.strength+t.strength,this.defence+t.defence,this.gold)},e.prototype.minus=function(t){return t instanceof e?new e(this.energy-t.energy,this.strength-t.strength,this.defence-t.defence,this.gold-t.gold):new e(this.energy,this.strength-t.strength,this.defence-t.defence,this.gold)},e.prototype.equals=function(t){return this.energy===t.energy&&this.strength===t.strength&&this.defence===t.defence&&this.gold===t.gold},e.prototype.calculateScore=function(t){var e=this;return Object.keys(t).reduce((function(i,s){return i+t[s]*e[s]}),0)},e}(m),g=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.prototype.substract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.convertIntoPosition=function(t){return new w(t,this.x,this.y,0,0)},t.prototype.getDirectionTo=function(t){return this.x<t.x?this.y>t.y?d.RIGHT_UP:this.y===t.y?d.RIGHT:d.RIGHT_DOWN:this.x===t.x?this.y>t.y?d.UP:this.y===t.y?d.NO_DIRECTION:d.DOWN:this.y>t.y?d.LEFT_UP:this.y===t.y?d.LEFT:d.LEFT_DOWN},t.prototype.toString=function(){return"("+this.x+", "+this.y+")"},t}(),w=function(){function t(t,e,i,s,a){if(void 0===s&&(s=0),void 0===a&&(a=0),this._wwa=t,void 0===this._wwa)throw new Error("WWAのインスタンスが存在しません. ");var o=this._wwa.getMapWidth();if(e<0||e>=o||e>=o-1&&s>0||i<0||i>=o||i>=o-1&&a>0)throw new Error("範囲外の座標です!! parts:("+e+", "+i+"), offset:("+s+", "+a+"), mapWidth = "+o);this._partsCoord=new g(e,i),this._offsetCoord=new g(s,a)}return t.prototype.getPartsCoord=function(){return this._partsCoord},t.prototype.getOffsetCoord=function(){return this._offsetCoord},t.prototype.getScreenTopPosition=function(){var e=Math.floor(this._partsCoord.x/(Q.H_PARTS_NUM_IN_WINDOW-1))*(Q.H_PARTS_NUM_IN_WINDOW-1),i=Math.floor(this._partsCoord.y/(Q.V_PARTS_NUM_IN_WINDOW-1))*(Q.V_PARTS_NUM_IN_WINDOW-1);return new t(this._wwa,e,i,0,0)},t.prototype.getDefaultCameraPosition=function(){var t=this.getScreenTopPosition(),e=t.getPartsCoord(),i=this._wwa.getMapWidth(),s=t.getPartsCoord().clone();return e.x===i-1&&s.x--,e.y===i-1&&s.y--,s.convertIntoPosition(this._wwa).getScreenTopPosition()},t.prototype.getNextJustPosition=function(e){if(void 0!==e){var i=this._partsCoord;return new t(this._wwa,i.x+O[e],i.y+C[e],0,0)}var s=this._partsCoord.x,a=this._partsCoord.y;return this._offsetCoord.x<0?s--:this._offsetCoord.x>0&&s++,this._offsetCoord.y<0?a--:this._offsetCoord.y>0&&a++,new t(this._wwa,s,a,0,0)},t.prototype.getNextFramePosition=function(e,i,s){var a=this._partsCoord.x,o=this._partsCoord.y,r=this._offsetCoord.x+O[e]*i,n=this._offsetCoord.y+C[e]*s;if(r<0){var _=Math.floor(Math.abs(r)/Q.CHIP_SIZE);a-=_,r=(r+_*Q.CHIP_SIZE)%Q.CHIP_SIZE}if(n<0){var h=Math.floor(Math.abs(n)/Q.CHIP_SIZE);o-=h,n=(n+h*Q.CHIP_SIZE)%Q.CHIP_SIZE}return r>=Q.CHIP_SIZE&&(a+=Math.floor(r/Q.CHIP_SIZE),r=(r+Q.CHIP_SIZE)%Q.CHIP_SIZE),n>=Q.CHIP_SIZE&&(o+=Math.floor(n/Q.CHIP_SIZE),n=(n+Q.CHIP_SIZE)%Q.CHIP_SIZE),new t(this._wwa,a,o,r,n)},t.prototype.isJustPosition=function(){return 0==this._offsetCoord.x&&0==this._offsetCoord.y},t.prototype.isScreenTopPosition=function(){var t=this.getScreenTopPosition();return this.equals(t)},t.prototype.equals=function(t){return this._partsCoord.equals(t.getPartsCoord())&&this._offsetCoord.equals(t.getOffsetCoord())},t.prototype.isInCameraRange=function(t,e){void 0===e&&(e=!1);var i=t.getPosition()._partsCoord,s=this._partsCoord.x,a=this._partsCoord.y,o=e?1:0;return i.x<=s&&s<i.x+Q.H_PARTS_NUM_IN_WINDOW-o&&i.y<=a&&a<i.y+Q.V_PARTS_NUM_IN_WINDOW-o},t.prototype.hasLocalGate=function(){return this._wwa.getMapTypeByPosition(this)===Q.MAP_LOCALGATE||this._wwa.getObjectTypeByPosition(this)===Q.OBJECT_LOCALGATE},t.prototype.clone=function(){return new t(this._wwa,this._partsCoord.x,this._partsCoord.y,this._offsetCoord.x,this._offsetCoord.y)},t}(),f=function(t,e,i){this.destPos=t.clone(),this.srcPos=e.clone(),this.srcSize=i.clone()};!function(t){t[t.GOTO_WWA=0]="GOTO_WWA",t[t.BATTLE_REPORT=1]="BATTLE_REPORT",t[t.GAME_END=2]="GAME_END"}(u||(u={})),function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.DOWN=2]="DOWN",t[t.UP=3]="UP",t[t.LEFT_DOWN=4]="LEFT_DOWN",t[t.LEFT_UP=5]="LEFT_UP",t[t.RIGHT_DOWN=6]="RIGHT_DOWN",t[t.RIGHT_UP=7]="RIGHT_UP",t[t.NO_DIRECTION=8]="NO_DIRECTION"}(d||(d={}));var A,I,T,S,O=[-1,1,0,0,-1,-1,1,1,0],C=[0,0,1,-1,1,-1,1,-1,0],D=[4,6,2,0],v=[a.KEY_LEFT,a.KEY_RIGHT,a.KEY_DOWN,a.KEY_UP];!function(t){t[t.YES=0]="YES",t[t.NO=1]="NO",t[t.UNSELECTED=2]="UNSELECTED"}(A||(A={})),function(t){t[t.MAP=0]="MAP",t[t.OBJECT=1]="OBJECT",t[t.CHOICE_YES=2]="CHOICE_YES",t[t.CHOICE_NO=3]="CHOICE_NO"}(I||(I={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.CAN_USE=1]="CAN_USE",t[t.NOT_DISAPPEAR=2]="NOT_DISAPPEAR"}(T||(T={})),function(t){t[t.MAP=1]="MAP",t[t.OBJECT=0]="OBJECT"}(S||(S={}));var P,N,M,R,b,L,B,x,W,U=function(){function t(){var t=window.navigator.userAgent;this.os=this._getOS(t),this.browser=this.getBrowser(t),this.device=this.getDevice()}return t.prototype._getOS=function(t){return t.match(/xbox/i)?P.XBOX:t.match(/windows/i)?P.WINDOWS:t.match(/macintosh/i)?P.MACINTOSH:t.match(/iphone|ipad|ipod/i)?P.IOS:t.match(/oculus/i)?P.OCULUS:t.match(/android/i)?P.ANDROID:t.match(/nintendo/i)?P.NINTENDO:t.match(/playstation/i)?P.PLAY_STATION:t.match(/linux/i)?P.LINUX:P.OTHERS},t.prototype.getBrowser=function(t){return t.match(/(?:msie|trident)/i)?M.INTERNET_EXPLORER:t.match(/edge/i)?M.EDGE:t.match(/chrome/i)?M.CHROME:t.match(/firefox/i)?M.FIREFOX:t.match(/safari/i)?M.SAFARI:M.OTHERS},t.prototype.getDevice=function(){switch(this.os){case P.WINDOWS:case P.MACINTOSH:case P.LINUX:return N.PC;case P.IOS:case P.ANDROID:return N.SP;case P.OCULUS:return N.VR;case P.NINTENDO:case P.PLAY_STATION:case P.XBOX:return N.GAME}return N.OTHERS},t}();!function(t){t[t.WINDOWS=1]="WINDOWS",t[t.MACINTOSH=2]="MACINTOSH",t[t.LINUX=3]="LINUX",t[t.ANDROID=4]="ANDROID",t[t.IOS=5]="IOS",t[t.NINTENDO=6]="NINTENDO",t[t.PLAY_STATION=7]="PLAY_STATION",t[t.OCULUS=8]="OCULUS",t[t.XBOX=9]="XBOX",t[t.OTHERS=9999]="OTHERS"}(P||(P={})),function(t){t[t.PC=1]="PC",t[t.SP=2]="SP",t[t.VR=3]="VR",t[t.GAME=4]="GAME",t[t.OTHERS=9999]="OTHERS"}(N||(N={})),function(t){t[t.CHROME=1]="CHROME",t[t.FIREFOX=2]="FIREFOX",t[t.SAFARI=3]="SAFARI",t[t.EDGE=4]="EDGE",t[t.INTERNET_EXPLORER=5]="INTERNET_EXPLORER",t[t.OTHERS=9999]="OTHERS"}(M||(M={})),function(t){t[t.NONE=0]="NONE",t[t.CALL_BY_MAP_PARTS=1]="CALL_BY_MAP_PARTS",t[t.CALL_BY_OBJECT_PARTS=2]="CALL_BY_OBJECT_PARTS",t[t.CALL_BY_ITEM_USE=3]="CALL_BY_ITEM_USE",t[t.CALL_BY_QUICK_SAVE=4]="CALL_BY_QUICK_SAVE",t[t.CALL_BY_QUICK_LOAD=5]="CALL_BY_QUICK_LOAD",t[t.CALL_BY_RESTART_GAME=6]="CALL_BY_RESTART_GAME",t[t.CALL_BY_GOTO_WWA=7]="CALL_BY_GOTO_WWA",t[t.CALL_BY_PASSWORD_SAVE=8]="CALL_BY_PASSWORD_SAVE",t[t.CALL_BY_PASSWORD_LOAD=9]="CALL_BY_PASSWORD_LOAD",t[t.CALL_BY_END_GAME=10]="CALL_BY_END_GAME"}(R||(R={})),function(t){t[t.QUICK_LOAD=0]="QUICK_LOAD",t[t.QUICK_SAVE=1]="QUICK_SAVE",t[t.RESTART_GAME=2]="RESTART_GAME",t[t.GOTO_WWA=3]="GOTO_WWA"}(b||(b={})),function(t){t[t.UP=0]="UP",t[t.DOWN=1]="DOWN"}(L||(L={})),function(t){t[t.QUICK_LOAD=0]="QUICK_LOAD",t[t.RESTART_GAME=1]="RESTART_GAME",t[t.PASSWORD=2]="PASSWORD"}(B||(B={})),function(t){t[t.STATIC=0]="STATIC",t[t.CHASE_PLAYER=1]="CHASE_PLAYER",t[t.RUN_OUT=2]="RUN_OUT",t[t.HANG_AROUND=3]="HANG_AROUND"}(x||(x={})),function(t){t[t.MODE_X=0]="MODE_X",t[t.MODE_Y=1]="MODE_Y",t[t.UNDECIDED=2]="UNDECIDED"}(W||(W={}));var Y,F,k,G=["cell-load","cell-save","cell-restart","cell-gotowwa"];!function(t){t[t.ASK_LINK=5]="ASK_LINK",t[t.NO_MONEY=6]="NO_MONEY",t[t.NO_ITEM=7]="NO_ITEM",t[t.USE_ITEM=8]="USE_ITEM"}(Y||(Y={})),function(t){t[t.CLICKABLE_ITEM=0]="CLICKABLE_ITEM",t[t.FULL_ITEM=1]="FULL_ITEM",t[t.LOAD_SE=2]="LOAD_SE"}(F||(F={})),function(t){t[t.UNDEFINED=0]="UNDEFINED",t[t.IMGPLAYER=1]="IMGPLAYER",t[t.IMGYESNO=2]="IMGYESNO",t[t.HPMAX=3]="HPMAX",t[t.SAVE=4]="SAVE",t[t.ITEM=5]="ITEM",t[t.DEFAULT=6]="DEFAULT",t[t.OLDMAP=7]="OLDMAP",t[t.PARTS=8]="PARTS",t[t.MOVE=9]="MOVE",t[t.MAP=10]="MAP",t[t.DIRMAP=11]="DIRMAP",t[t.IMGFRAME=12]="IMGFRAME",t[t.IMGBOM=13]="IMGBOM",t[t.DELPLAYER=14]="DELPLAYER",t[t.FACE=15]="FACE",t[t.EFFECT=16]="EFFECT",t[t.GAMEOVER=17]="GAMEOVER",t[t.IMGCLICK=18]="IMGCLICK",t[t.STATUS=19]="STATUS",t[t.EFFITEM=20]="EFFITEM",t[t.COLOR=21]="COLOR",t[t.WAIT=22]="WAIT",t[t.SOUND=23]="SOUND",t[t.GAMEPAD_BUTTON=100]="GAMEPAD_BUTTON"}(k||(k={}));var H,K,X,j={"":0,$imgplayer:1,$imgyesno:2,$hpmax:3,$save:4,$item:5,$default:6,$oldmap:7,$parts:8,$move:9,$map:10,$dirmap:11,$imgframe:12,$imgbom:13,$delplayer:14,$face:15,$effect:16,$gameover:17,$imgclick:18,$status:19,$effitem:20,$color:21,$wait:22,$sound:23,$gamepad_button:100};!function(t){t[t.ENERGY=0]="ENERGY",t[t.STRENGTH=1]="STRENGTH",t[t.DEFENCE=2]="DEFENCE",t[t.GOLD=3]="GOLD",t[t.MOVES=4]="MOVES"}(H||(H={})),function(t){t[t.ENERGY=0]="ENERGY",t[t.STRENGTH=1]="STRENGTH",t[t.DEFENCE=2]="DEFENCE",t[t.GOLD=3]="GOLD",t[t.WIDE_CELL_ROW=4]="WIDE_CELL_ROW",t[t.ITEM_BG=5]="ITEM_BG",t[t.MAIN_FRAME=6]="MAIN_FRAME"}(K||(K={})),function(t){t[t.DECISION=1]="DECISION",t[t.ATTACK=3]="ATTACK",t[t.BGM_LB=70]="BGM_LB",t[t.NO_SOUND=99]="NO_SOUND"}(X||(X={}));var J,V=[2,5,8,10],Z=["低速","準低速","中速","高速"],Q=function(){function t(){}return t.WWA_HOME="http://wwajp.com",t.ITEMBOX_SIZE=12,t.MAP_ATR_MAX=60,t.OBJ_ATR_MAX=60,t.OLD_MAP_ATR_MAX=40,t.OLD_OBJ_ATR_MAX=40,t.ATR_TYPE=3,t.ATR_MODE=4,t.ATR_STRING=5,t.ATR_X=6,t.ATR_Y=7,t.ATR_X2=8,t.ATR_Y2=9,t.ATR_ENERGY=10,t.ATR_STRENGTH=11,t.ATR_DEFENCE=12,t.ATR_GOLD=13,t.ATR_ITEM=14,t.ATR_NUMBER=15,t.ATR_JUMP_X=16,t.ATR_MOVE=16,t.ATR_JUMP_Y=17,t.ATR_SOUND=19,t.ATR_APPERANCE_BASE=20,t.REL_ATR_APPERANCE_ID=0,t.REL_ATR_APPERANCE_X=1,t.REL_ATR_APPERANCE_Y=2,t.REL_ATR_APPERANCE_TYPE=3,t.REL_ATR_APPERANCE_UNIT_LENGTH=4,t.ATR_RANDOM_BASE=10,t.RANDOM_ATR_NUM=10,t.RANDOM_ITERATION_MAX=10,t.MAP_STREET=0,t.MAP_WALL=1,t.MAP_LOCALGATE=2,t.MAP_URLGATE=4,t.OBJECT_NORMAL=0,t.OBJECT_MESSAGE=1,t.OBJECT_URLGATE=2,t.OBJECT_STATUS=3,t.OBJECT_ITEM=4,t.OBJECT_DOOR=5,t.OBJECT_MONSTER=6,t.OBJECT_SCORE=11,t.OBJECT_SELL=14,t.OBJECT_BUY=15,t.OBJECT_RANDOM=16,t.OBJECT_SELECT=17,t.OBJECT_LOCALGATE=18,t.SYSTEM_MESSAGE_NUM=20,t.IMGPOS_DEFAULT_YESNO_X=3,t.IMGPOS_DEFAULT_YESNO_Y=1,t.IMGRELPOS_YESNO_YES_X=0,t.IMGRELPOS_YESNO_NO_X=1,t.IMGRELPOS_YESNO_YESP_X=2,t.IMGRELPOS_YESNO_NOP_X=3,t.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_X=0,t.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_Y=0,t.DEFAULT_DISABLE_SAVE=!1,t.DEFAULT_OLDMAP=!1,t.DEFAULT_OBJECT_NO_COLLAPSE=!1,t.SPLASH_SCREEN_DISP_MILLS=100,t.DEFAULT_FRAME_INTERVAL=20,t.GAMEOVER_FRAME_INTERVAL=50,t.YESNO_PRESS_DISP_FRAME_NUM=20,t.WAIT_TIME_FRAME_NUM=6,t.CHIP_SIZE=40,t.MAP_WINDOW_WIDTH=440,t.MAP_WINDOW_HEIGHT=440,t.H_PARTS_NUM_IN_WINDOW=t.MAP_WINDOW_WIDTH/t.CHIP_SIZE,t.V_PARTS_NUM_IN_WINDOW=t.MAP_WINDOW_HEIGHT/t.CHIP_SIZE,t.DEFAULT_SPEED_INDEX=2,t.MIN_SPEED_INDEX=0,t.MAX_SPEED_INDEX=V.length-1,t.ANIMATION_REP_HALF_FRAME=22,t.PLAYER_LOOKING_AROUND_START_FRAME=4*t.ANIMATION_REP_HALF_FRAME,t.RELATIVE_COORD_BIAS=1e4,t.RELATIVE_COORD_LOWER=t.RELATIVE_COORD_BIAS-1e3,t.PLAYER_COORD=t.RELATIVE_COORD_BIAS-1e3,t.LOCALGATE_PLAYER_WAIT_FRAME=5,t.STATUS_CHANGED_EFFECT_FRAME_NUM=20,t.PASSABLE_OBJECT=1,t.APPERANCE_PARTS_MIN_INDEX=0,t.APPERANCE_PARTS_MAX_INDEX=9,t.APPERANCE_PARTS_MIN_INDEX_NO=5,t.APPERANCE_PARTS_MAX_INDEX_YES=4,t.FADEOUT_SPEED=8,t.STATUS_MINUS_BORDER=3e4,t.ITEMBOX_IS_FULL=-1,t.BATTLE_INTERVAL_FRAME_NUM=10,t.BATTLE_SPEED_CHANGE_TURN_NUM=40,t.RANDOM_MOVE_ITERATION_NUM=50,t.RANDOM_MOVE_ITERATION_NUM_BEFORE_V31=8,t.BATTLE_ESTIMATE_MONSTER_TYPE_MAX=8,t.SOUND_MAX=100,t.ITEM_BORDER_IMG_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAArklEQVRYR+2Y0QqAIAxFt///aENJHwxxuJUSxzeh3S7HXaNpEkly4FIRzba0GEyHeVTN7jqDWvb7V4Y1NLibZIY0NbiL5G3MZLCe / 1fn3XJgJYjB7mgg6O1VCEKwXo79JeklY62nB62kRs9BEIKkeNIDhISQEBJC4k0BBCF4D7D4cV9shf99ixdB + MrM0y3fa3zV05D45GOqhwPMGPkYlccIOEY2VKUN0UNVXxC7ADj7mDi9aFZZAAAAAElFTkSuQmCC",t.LOAD_STAGE_MAX_EXCEPT_AUDIO=7,t.WWA_STYLE_TAG_ID="wwa-additional-style",t.DEFAULT_FRAME_COLOR_R=255,t.DEFAULT_FRAME_COLOR_G=255,t.DEFAULT_FRAME_COLOR_B=255,t.DEFAULT_FRAMEOUT_COLOR_R=96,t.DEFAULT_FRAMEOUT_COLOR_G=96,t.DEFAULT_FRAMEOUT_COLOR_B=96,t.DEFAULT_STRBACK_COLOR_R=0,t.DEFAULT_STRBACK_COLOR_G=0,t.DEFAULT_STRBACK_COLOR_B=0,t.DEFAULT_STATUS_COLOR_R=0,t.DEFAULT_STATUS_COLOR_G=0,t.DEFAULT_STATUS_COLOR_B=0,t.KEYPRESS_MESSAGE_CHANGE_FRAME_NUM=20,t.WWAP_SERVER_OLD="http://wwawing.com/wwap",t.WWAP_SERVER="https://wwaphoenix.github.io",t.WWAP_SERVER_AUDIO_DIR="audio",t.WWAP_SERVER_TITLE_IMG="cover_p.gif",t.WWAP_SERVER_LOADER_NO_WORKER="wwaload.noworker.js",t.SCREEN_WIDTH=560,t.SCREEN_HEIGHT=440,t.LOADING_FONT="Times New Roman",t.MSG_STR_WIDTH=16,t.ITEM_EFFECT_SPEED_PIXEL_PER_FRAME=20,t.ITEMBOX_TOP_Y=140,t.QUICK_SAVE_MAX=4,t.QUICK_SAVE_THUMNAIL_WIDTH=99,t.QUICK_SAVE_THUMNAIL_HEIGHT=99,t.CONTROLL_WAIT_FRAME=6,t}(),z=function(){function t(){}return t.EMPTY_LOAD="",t.EMPTY_SAVE="",t.PASSWORD="Password",t.QUICK_SAVE="Quick Save",t.QUICK_LOAD="Quick Load",t.BATTLE_REPORT="Battle Report",t.GAME_END="Game End",t.GOTO_WWA="Goto WWA",t.RESTART_GAME="Restart Game",t}(),q=function(){};!function(t){t[t.INIT=0]="INIT",t[t.MAP_LOAD=1]="MAP_LOAD",t[t.OBJ_LOAD=2]="OBJ_LOAD",t[t.MAP_ATTR=3]="MAP_ATTR",t[t.OBJ_ATTR=4]="OBJ_ATTR",t[t.RAND_PARTS=5]="RAND_PARTS",t[t.MESSAGE=6]="MESSAGE",t[t.GAME_INIT=7]="GAME_INIT",t[t.AUDIO=8]="AUDIO",t[t.FINISH=9]="FINISH"}(J||(J={}));var $,tt,et,it,st,at=["ロードの準備をしています。","背景パーツを読み込んでいます。","物体パーツを読み込んでます。","背景パーツの属性を読み込んでます。","物体パーツの属性を読み込んでます。","ランダムパーツを置換しています。","メッセージを読み込んでます。","Welcome to WWA Wing!"],ot=["Welcome to WWA Wing!","Now Map Data Loading .....","Now CG Data Loading .....","Now Making chara CG ....."];!function(t){t[t.LINE=30]="LINE",t[t.TITLE_X=100]="TITLE_X",t[t.TITLE_Y=70]="TITLE_Y",t[t.LOADING_X=50]="LOADING_X",t[t.LOADING_Y=140]="LOADING_Y",t[t.ERROR_X=10]="ERROR_X",t[t.ERROR_Y=180]="ERROR_Y",t[t.FOOTER_X=160]="FOOTER_X",t[t.FOOTER_Y=360]="FOOTER_Y",t[t.WORLD_Y=330]="WORLD_Y",t[t.COPYRIGHT_Y=390]="COPYRIGHT_Y"}($||($={})),function(t){t[t.TITLE=32]="TITLE",t[t.LOADING=22]="LOADING",t[t.FOOTER=18]="FOOTER",t[t.ERRROR=16]="ERRROR"}(tt||(tt={})),function(t){t[t.COLOR_FRAME=0]="COLOR_FRAME",t[t.COLOR_FRAMEOUT=1]="COLOR_FRAMEOUT",t[t.COLOR_STR=2]="COLOR_STR",t[t.COLOR_STATUS_STR=4]="COLOR_STATUS_STR"}(et||(et={})),function(t){t[t.MESSAGE_WINDOW=0]="MESSAGE_WINDOW",t[t.SIDEBAR=1]="SIDEBAR"}(it||(it={})),function(t){t[t.BITSHIFT=16]="BITSHIFT",t[t.BITMASK=65535]="BITMASK"}(st||(st={}));var rt,nt=i(3),_t=function(t){return document.getElementById(t)},ht=function(t){return document.querySelector(t)},ct=function(t){return document.querySelectorAll(t)},lt=function(t,e){var i,s,a=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,o=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop;return i=t-_t("wwa-wrapper").offsetLeft+a,s=e-_t("wwa-wrapper").offsetTop+o,new g(i,s)},ut=function(t){return t.match(/^https?:\/\//)||t.match(/^\.\.\//)?t:location.href="./"+t},dt=function(t){var e="";if(t instanceof Array){for(var i=0;i<t.length;i++)e+=dt(t[i])+"/";return e}return t+""},pt=function(){function t(t,e){this.cvs=document.createElement("canvas"),this.cvs.width=t,this.cvs.height=e,this.ctx=this.cvs.getContext("2d")}return t.prototype.drawCanvas=function(t,e,i,s,a,o){void 0===o&&(o=!1),this.ctx.drawImage(t,Q.CHIP_SIZE*e,Q.CHIP_SIZE*i,Q.CHIP_SIZE,Q.CHIP_SIZE,s,a,Q.CHIP_SIZE,Q.CHIP_SIZE)},t.prototype.clear=function(){this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height)},t}(),Et=function(){function t(t,e,i,s,a){this._isLoaded=!1,this.mapCache=void 0,this.mapCacheYLimit=0,this._ctx=t,this._ctxSub=e,this._fileName=i,this._loadCompleteCallBack=a,this._load(),this._frameCoord=s.clone(),this.cpPartsLog=new g(0,0)}return t.prototype._load=function(){var t=this;this._frameCoord,this._isLoaded||(this.mapCache=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this._image=new Image,this._image.addEventListener("load",(function(){t._createCacheCanvas(),t.createFrame(),t._loadCompleteCallBack()})),this._image.addEventListener("error",(function(){throw new Error("Image Load Failed!!\nfile name:"+t._fileName)})),this._image.src=this._fileName,this._isLoaded=!0)},t.prototype._createCacheCanvas=function(){this._frameCanvas=new pt(Q.CHIP_SIZE*Q.V_PARTS_NUM_IN_WINDOW,Q.CHIP_SIZE*Q.H_PARTS_NUM_IN_WINDOW),this._backCanvas=new pt(Q.CHIP_SIZE*Q.V_PARTS_NUM_IN_WINDOW,Q.CHIP_SIZE*Q.H_PARTS_NUM_IN_WINDOW)},t.prototype.createFrame=function(){this._frameCanvas.clear(),this._frameCanvas.drawCanvas(this._image,this._frameCoord.x,this._frameCoord.y,0,0,!1),this._frameCanvas.drawCanvas(this._image,this._frameCoord.x+2,this._frameCoord.y,Q.MAP_WINDOW_WIDTH-Q.CHIP_SIZE,0,!1),this._frameCanvas.drawCanvas(this._image,this._frameCoord.x,this._frameCoord.y+2,0,Q.MAP_WINDOW_HEIGHT-Q.CHIP_SIZE,!1),this._frameCanvas.drawCanvas(this._image,this._frameCoord.x+2,this._frameCoord.y+2,Q.MAP_WINDOW_WIDTH-Q.CHIP_SIZE,Q.MAP_WINDOW_HEIGHT-Q.CHIP_SIZE,!1);for(var t=1;t<Q.H_PARTS_NUM_IN_WINDOW-1;t++)this._frameCanvas.drawCanvas(this._image,this._frameCoord.x+1,this._frameCoord.y,Q.CHIP_SIZE*t,0,!1),this._frameCanvas.drawCanvas(this._image,this._frameCoord.x+1,this._frameCoord.y+2,Q.CHIP_SIZE*t,Q.MAP_WINDOW_HEIGHT-Q.CHIP_SIZE,!1);for(t=1;t<Q.V_PARTS_NUM_IN_WINDOW-1;t++)this._frameCanvas.drawCanvas(this._image,this._frameCoord.x,this._frameCoord.y+1,0,Q.CHIP_SIZE*t,!1),this._frameCanvas.drawCanvas(this._image,this._frameCoord.x+2,this._frameCoord.y+1,Q.MAP_WINDOW_WIDTH-Q.CHIP_SIZE,Q.CHIP_SIZE*t,!1)},t.prototype.drawFrame=function(){this._ctx.drawImage(this._frameCanvas.cvs,0,0,Q.CHIP_SIZE*Q.V_PARTS_NUM_IN_WINDOW,Q.CHIP_SIZE,0,0,Q.CHIP_SIZE*Q.V_PARTS_NUM_IN_WINDOW,Q.CHIP_SIZE),this._ctx.drawImage(this._frameCanvas.cvs,0,Q.CHIP_SIZE*(Q.H_PARTS_NUM_IN_WINDOW-1),Q.CHIP_SIZE*Q.V_PARTS_NUM_IN_WINDOW,Q.CHIP_SIZE,0,Q.CHIP_SIZE*(Q.H_PARTS_NUM_IN_WINDOW-1),Q.CHIP_SIZE*Q.V_PARTS_NUM_IN_WINDOW,Q.CHIP_SIZE),this._ctx.drawImage(this._frameCanvas.cvs,0,Q.CHIP_SIZE,Q.CHIP_SIZE,Q.CHIP_SIZE*(Q.H_PARTS_NUM_IN_WINDOW-2),0,Q.CHIP_SIZE,Q.CHIP_SIZE,Q.CHIP_SIZE*(Q.H_PARTS_NUM_IN_WINDOW-2)),this._ctx.drawImage(this._frameCanvas.cvs,Q.CHIP_SIZE*(Q.H_PARTS_NUM_IN_WINDOW-1),Q.CHIP_SIZE,Q.CHIP_SIZE,Q.CHIP_SIZE*(Q.H_PARTS_NUM_IN_WINDOW-2),Q.CHIP_SIZE*(Q.H_PARTS_NUM_IN_WINDOW-1),Q.CHIP_SIZE,Q.CHIP_SIZE,Q.CHIP_SIZE*(Q.H_PARTS_NUM_IN_WINDOW-2))},t.prototype.drawCanvas=function(t,e,i,s,a){void 0===a&&(a=!1);var o=a?this._ctxSub:this._ctx;if(!this._isLoaded)throw new Error("No image was loaded.");o.drawImage(this._image,Q.CHIP_SIZE*t,Q.CHIP_SIZE*e,Q.CHIP_SIZE,Q.CHIP_SIZE,i,s,Q.CHIP_SIZE,Q.CHIP_SIZE)},t.prototype.drawCanvasWithSize=function(t,e,i,s,a,o,r){void 0===r&&(r=!1);var n=r?this._ctxSub:this._ctx;if(!this._isLoaded)throw new Error("No image was loaded.");n.drawImage(this._image,Q.CHIP_SIZE*t,Q.CHIP_SIZE*e,Q.CHIP_SIZE*i,Q.CHIP_SIZE*s,a,o,Q.CHIP_SIZE*i,Q.CHIP_SIZE*s)},t.prototype.drawCanvasWithUpperYLimit=function(t,e,i,s,a,o){void 0===o&&(o=!1);var r=o?this._ctxSub:this._ctx;if(!this._isLoaded)throw new Error("No image was loaded.");var n=Math.max(0,s+Q.CHIP_SIZE-a);n>=Q.CHIP_SIZE||r.drawImage(this._image,Q.CHIP_SIZE*t,Q.CHIP_SIZE*e,Q.CHIP_SIZE,Q.CHIP_SIZE-n,i,s,Q.CHIP_SIZE,Q.CHIP_SIZE)},t.prototype.copyBackCanvasWithUpperYLimit=function(t,e,i,s,a,o){void 0===o&&(o=!1);o?this._ctxSub:this._ctx;if(!this._isLoaded)throw new Error("No image was loaded.");var r=Math.max(0,s+Q.CHIP_SIZE-a);r>=Q.CHIP_SIZE||this._backCanvas.ctx.drawImage(this._image,Q.CHIP_SIZE*t,Q.CHIP_SIZE*e+r,Q.CHIP_SIZE,Q.CHIP_SIZE-r,i,s+r,Q.CHIP_SIZE,Q.CHIP_SIZE)},t.prototype.drawBackCanvas=function(t){void 0===t&&(t=!1);var e=t?this._ctxSub:this._ctx;if(!this._isLoaded)throw new Error("No image was loaded.");e.drawImage(this._backCanvas.cvs,0,0,Q.CHIP_SIZE*Q.V_PARTS_NUM_IN_WINDOW,Q.CHIP_SIZE*Q.H_PARTS_NUM_IN_WINDOW,0,0,Q.CHIP_SIZE*Q.V_PARTS_NUM_IN_WINDOW,Q.CHIP_SIZE*Q.H_PARTS_NUM_IN_WINDOW)},t.prototype.clearBackCanvas=function(){this._backCanvas.clear()},t.prototype.drawCanvasWithLowerYLimit=function(t,e,i,s,a,o){void 0===o&&(o=!1);var r=o?this._ctxSub:this._ctx;if(!this._isLoaded)throw new Error("No image was loaded.");var n=Math.max(0,a-s);n>=Q.CHIP_SIZE||r.drawImage(this._image,Q.CHIP_SIZE*t,Q.CHIP_SIZE*e+n,Q.CHIP_SIZE,Q.CHIP_SIZE-n,i,s+n,Q.CHIP_SIZE,Q.CHIP_SIZE)},t.prototype.clearCanvas=function(t,e,i,s,a){void 0===a&&(a=!1),(a?this._ctxSub:this._ctx).clearRect(t,e,i,s)},t.prototype.drawBase=function(t,e,i,s,a){void 0===a&&(a=!1);var o=a?this._ctxSub:this._ctx;o.fillStyle="#9E9E9E",o.fillRect(t,e,i,s)},t.prototype.setFrameImage=function(t){this._frameCoord=t,this.createFrame()},t}(),mt=function(){function t(t){this._position=null,this.reset(t)}return t.prototype.setPlayer=function(t){this._player=t},t.prototype.isResetting=function(){return this._isResetting},t.prototype.getPosition=function(){return this._position},t.prototype.getPreviousPosition=function(){return this._positionPrev},t.prototype.resetPreviousPosition=function(){this._positionPrev=null},t.prototype.move=function(t){var e=V[this._player.getSpeedIndex()];this._position=this._position.getNextFramePosition(t,e*(Q.H_PARTS_NUM_IN_WINDOW-1),e*(Q.V_PARTS_NUM_IN_WINDOW-1))},t.prototype.getTransitionStepNum=function(){return this._transitionStep},t.prototype.advanceTransitionStepNum=function(){return++this._transitionStep,this._transitionStep===Q.V_PARTS_NUM_IN_WINDOW&&(this._isResetting=!1,this._transitionStep=0),this._transitionStep},t.prototype.isFinalStep=function(){if(!1===this._isResetting)throw new Error("リセット中ではありません。");return this._transitionStep===Q.V_PARTS_NUM_IN_WINDOW-1},t.prototype.reset=function(t){this._positionPrev=this._position,this._position=t.getDefaultCameraPosition(),this._transitionStep=0,this._isResetting=!0},t}(),yt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),gt=function(){function t(t){this._position=t}return t.prototype.getPosition=function(){return this._position},t}(),wt=function(t){function e(e){return t.call(this,e)||this}return yt(e,t),e}(gt);!function(t){function e(e){return t.call(this,e)||this}yt(e,t)}(gt);!function(t){t[t.CONTROLLABLE=0]="CONTROLLABLE",t[t.MOVING=1]="MOVING",t[t.CAMERA_MOVING=2]="CAMERA_MOVING",t[t.MESSAGE_WAITING=3]="MESSAGE_WAITING",t[t.LOCALGATE_JUMPED=4]="LOCALGATE_JUMPED",t[t.BATTLE=5]="BATTLE",t[t.ESTIMATE_WINDOW_WAITING=6]="ESTIMATE_WINDOW_WAITING",t[t.PASSWORD_WINDOW_WAITING=7]="PASSWORD_WINDOW_WAITING"}(rt||(rt={}));var ft=function(t){function e(e,i,s,a,o,r){var n=t.call(this,i)||this;n.itemTransitioningClassName="item-transitioning",n.overwittenItemClassName="item-overwritten",n.overwittenItemSelector="."+n.overwittenItemClassName,n._status=a,n._equipStatus=new m(0,0),n._itemBox=new Array(Q.ITEMBOX_SIZE),n._itemBoxElement=new Array(Q.ITEMBOX_SIZE),n._itemUsingEvent=new Array(Q.ITEMBOX_SIZE);for(var _=0;_<n._itemBox.length;_++)n._itemBox[_]=0,n._itemBoxElement[_]=ht("#item"+_+">.item-disp");return n.updateItemBox(),n._energyMax=o,n._dir=d.DOWN,n._isMovingImage=!1,n._wwa=e,n._state=rt.CONTROLLABLE,n._camera=s,n._isPartsEventExecuted=!1,n._energyValueElement=ht("#disp-energy>.status-value-box"),n._strengthValueElement=ht("#disp-strength>.status-value-box"),n._defenceValueElement=ht("#disp-defence>.status-value-box"),n._goldValueElement=ht("#disp-gold>.status-value-box"),n._isReadyToUseItem=!1,n._isClickableItemGot=!1,n._moves=r,n._frameCount=0,n._moveMacroWaitingRemainMoves=0,n._moveObjectAutoExecTimer=0,n.updateStatusValueBox(),n._partsAppeared=!1,n._afterMoveMacroFlag=!1,n._isPreparedForLookingAround=!0,n._lookingAroundTimer=Q.PLAYER_LOOKING_AROUND_START_FRAME,n._speedIndex=Q.DEFAULT_SPEED_INDEX,n._messageDelayFrameCount=0,n}return yt(e,t),e.prototype.move=function(){if(this.isControllable())this.controll(this._dir);else if(this._state===rt.CAMERA_MOVING){try{this._camera.move(this._dir)}catch(t){}this._isOnCameraStopPosition()&&(this._state=rt.CONTROLLABLE)}else if(this._state===rt.MOVING){try{var t=this._position.getNextFramePosition(this._dir,V[this._speedIndex],V[this._speedIndex])}catch(t){}t.isJustPosition()&&(this._state=rt.CONTROLLABLE,this.toggleMovingImage(),this._moves++,this._isPartsEventExecuted=!1,this._samePosLastExecutedMapID=void 0,this._samePosLastExecutedObjID=void 0),this._position=t}},e.prototype.controll=function(t){var e,i;if(this.isControllable()){this._isPreparedForLookingAround=!1,this._dir=t;try{e=this._position.getNextFramePosition(this._dir,V[this._speedIndex],V[this._speedIndex]),i=this._position.getNextJustPosition(t)}catch(t){return}if(this._isOnCameraMovingPosition()){if(0!==this._wwa.getMapIdByPosition(i)||this._wwa.isOldMap()||this._wwa.debug)try{this._camera.move(this._dir),this._state=rt.CAMERA_MOVING}catch(t){this._state=rt.CONTROLLABLE}return}if(!this.canMoveTo(i))return this._wwa.getMapTypeByPosition(i)===Q.MAP_WALL&&this._wwa.checkMap(i.getPartsCoord()),void this._wwa.checkObject(i.getPartsCoord());this._position=e,this._state=rt.MOVING,this._wwa.getMapAttributeByPosition(this._position.getNextJustPosition(t),Q.ATR_TYPE)!==Q.MAP_LOCALGATE&&this._wwa.moveObjects(!0)}},e.prototype.setDir=function(t){this._isPreparedForLookingAround=!1,this._dir=t},e.prototype.canMoveTo=function(t){if(null===t)return!1;if(this._wwa.debug)return!0;this._wwa.getMapWidth(),t.getPartsCoord(),t.getOffsetCoord();return!(0===this._wwa.getMapIdByPosition(t)&&!this._wwa.isOldMap())&&(this._wwa.getMapTypeByPosition(t)!==Q.MAP_WALL&&(0===this._wwa.getObjectIdByPosition(t)||(this._wwa.getObjectTypeByPosition(t)===Q.OBJECT_NORMAL&&this._wwa.getObjectAttributeByPosition(t,Q.ATR_MODE)===Q.PASSABLE_OBJECT||this._wwa.getObjectTypeByPosition(t)===Q.OBJECT_DOOR&&this._wwa.getObjectAttributeByPosition(t,Q.ATR_NUMBER)===Q.PASSABLE_OBJECT&&!this.hasItem(this._wwa.getObjectAttributeByPosition(t,Q.ATR_ITEM)))))},e.prototype.isMoving=function(){return this._state==rt.MOVING||this._state==rt.CAMERA_MOVING},e.prototype._isOnCameraMovingPosition=function(){var t=this._camera.getPosition().getPartsCoord(),e=this.getPosition().getPartsCoord();return e.x-t.x==Q.H_PARTS_NUM_IN_WINDOW-1&&this._dir===d.RIGHT||e.x===t.x&&this._dir===d.LEFT||e.y-t.y==Q.V_PARTS_NUM_IN_WINDOW-1&&this._dir===d.DOWN||e.y===t.y&&this._dir===d.UP},e.prototype._isOnCameraStopPosition=function(){var t=this._camera.getPosition().getPartsCoord(),e=this.getPosition().getPartsCoord();return e.x-t.x==Q.H_PARTS_NUM_IN_WINDOW-1&&this._dir===d.LEFT||e.x===t.x&&this._dir===d.RIGHT||e.y-t.y==Q.V_PARTS_NUM_IN_WINDOW-1&&this._dir===d.UP||e.y===t.y&&this._dir===d.DOWN},e.prototype.isControllable=function(){var t=this._afterMoveMacroFlag;return this._afterMoveMacroFlag=!1,this._state===rt.CONTROLLABLE&&!this._partsAppeared&&(this._wwa.getMapTypeByPosition(this._position)!==Q.MAP_LOCALGATE&&this._wwa.getMapTypeByPosition(this._position)!==Q.MAP_URLGATE||!this._wwa.isPrevFrameEventExecuted())&&0===this._moveMacroWaitingRemainMoves&&0===this._moveObjectAutoExecTimer&&!t&&this._wwa.canInput()},e.prototype.getCopyOfItemBox=function(){return this._itemBox.slice()},e.prototype.getDir=function(){return this._dir},e.prototype.isMovingImage=function(){return this._isMovingImage},e.prototype.toggleMovingImage=function(){this._isMovingImage?this._isMovingImage=!1:this._isMovingImage=!0},e.prototype.getEnergyMax=function(){return this._energyMax},e.prototype.isJumped=function(){return this._state===rt.LOCALGATE_JUMPED},e.prototype.setMessageWaiting=function(){this._state=rt.MESSAGE_WAITING},e.prototype.isWaitingMessage=function(){return this._state===rt.MESSAGE_WAITING},e.prototype.isDelayFrame=function(){return this._messageDelayFrameCount>0},e.prototype.updateDelayFrame=function(){this._messageDelayFrameCount--},e.prototype.setDelayFrame=function(){this._messageDelayFrameCount=1},e.prototype.clearMessageWaiting=function(){this._state===rt.MESSAGE_WAITING&&(this._state=rt.CONTROLLABLE,this._isPartsEventExecuted=!0,this._isPreparedForLookingAround&&(this._lookingAroundTimer=Q.PLAYER_LOOKING_AROUND_START_FRAME))},e.prototype.setEstimateWindowWating=function(){this._state=rt.ESTIMATE_WINDOW_WAITING},e.prototype.isWatingEstimateWindow=function(){return this._state===rt.ESTIMATE_WINDOW_WAITING},e.prototype.clearEstimateWindowWaiting=function(){this._state===rt.ESTIMATE_WINDOW_WAITING&&(this._state=rt.CONTROLLABLE)},e.prototype.setPasswordWindowWating=function(){this._state=rt.PASSWORD_WINDOW_WAITING},e.prototype.isWaitingPasswordWindow=function(){return this._state===rt.PASSWORD_WINDOW_WAITING},e.prototype.clearPasswordWindowWaiting=function(){this._state===rt.PASSWORD_WINDOW_WAITING&&(this._state=rt.CONTROLLABLE)},e.prototype.isPartsEventExecuted=function(){return this._isPartsEventExecuted},e.prototype.resetEventExecutionInfo=function(){this._isPartsEventExecuted=!1},e.prototype.getLastExecPartsIDOnSamePosition=function(t){return t===S.MAP?this._samePosLastExecutedMapID:this._samePosLastExecutedObjID},e.prototype.setLastExecInfoOnSamePosition=function(t,e){t===S.MAP?this._samePosLastExecutedMapID=e:this._samePosLastExecutedObjID=e},e.prototype.processAfterJump=function(){this._state===rt.LOCALGATE_JUMPED&&0==--this._jumpWaitFramesRemain&&(this._state=rt.CONTROLLABLE)},e.prototype.jumpTo=function(t){var e=this._camera.getPosition();this.getPosition();return!this._position.equals(t)&&(this._position=t,t.isInCameraRange(this._camera,!0)||this._camera.reset(t),this._state=rt.LOCALGATE_JUMPED,this._jumpWaitFramesRemain=Q.LOCALGATE_PLAYER_WAIT_FRAME,this._samePosLastExecutedMapID=void 0,this._samePosLastExecutedObjID=void 0,t.hasLocalGate()?this._dir=d.DOWN:t.getPartsCoord().y<=this._wwa.getMapWidth()-2&&t.getNextJustPosition(d.DOWN).hasLocalGate()?this._dir=d.UP:t.getPartsCoord().y>=1&&t.getNextJustPosition(d.UP).hasLocalGate()?this._dir=d.DOWN:t.getPartsCoord().x<=this._wwa.getMapWidth()-2&&t.getNextJustPosition(d.RIGHT).hasLocalGate()?this._dir=d.LEFT:t.getPartsCoord().x>=1&&t.getNextJustPosition(d.LEFT).hasLocalGate()?this._dir=d.RIGHT:this._dir=d.DOWN,this._camera.getPosition().equals(e)||(this._isPreparedForLookingAround=!0,this._lookingAroundTimer=Q.PLAYER_LOOKING_AROUND_START_FRAME),!0)},e.prototype.systemJumpTo=function(t){this._position=t,this._camera.reset(t),this._camera.resetPreviousPosition(),this._state=rt.LOCALGATE_JUMPED,this._jumpWaitFramesRemain=Q.LOCALGATE_PLAYER_WAIT_FRAME,this._samePosLastExecutedMapID=void 0,this._samePosLastExecutedObjID=void 0,this._dir=d.DOWN,this._isPreparedForLookingAround=!0,this._lookingAroundTimer=Q.PLAYER_LOOKING_AROUND_START_FRAME},e.prototype.addStatusAll=function(t){return this._status.add(t),this.isDead()&&(this._status.energy=0),0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax)),this.updateStatusValueBox(),this._status},e.prototype.setEnergyMax=function(t){return this._energyMax=t,0!==t&&(this._status.energy=Math.min(this._status.energy,this._energyMax)),this.updateStatusValueBox(),t},e.prototype.setEnergy=function(t){return this._status.energy=t,this.isDead()&&(this._status.energy=0),0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax)),this.updateStatusValueBox(),t},e.prototype.damage=function(t){this._status.energy=Math.max(0,this._status.energy-t),this.isDead()&&(this._status.energy=0),0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax)),this.updateStatusValueBox()},e.prototype.setStrength=function(t){return this._status.strength=t,this.updateStatusValueBox(),t},e.prototype.setDefence=function(t){return this._status.defence=t,this.updateStatusValueBox(),t},e.prototype.setGold=function(t){return this._status.gold=t,this.updateStatusValueBox(),t},e.prototype.getStatus=function(){return this._status.plus(this._equipStatus)},e.prototype.getStatusWithoutEquipments=function(){return this._status.plus(new m(0,0))},e.prototype.updateStatusValueBox=function(){var t=this._status.plus(this._equipStatus),e=t.energy,i=t.strength,s=t.defence,a=t.gold;this._energyValueElement.textContent=e+"",this._strengthValueElement.textContent=i+"",this._defenceValueElement.textContent=s+"",this._goldValueElement.textContent=a+""},e.prototype.updateItemBox=function(t){for(var e=this,i=function(i){var a,o=s._itemBoxElement[i],r=(a="#item"+i,document.querySelector(a));if(0===s._itemBox[i])return o.style.backgroundPosition="-40px 0px",s.disposeItemEffect(s._itemBoxElement[i],r),"continue";var n=s._wwa.getObjectCropXById(s._itemBox[i]),_=s._wwa.getObjectCropYById(s._itemBox[i]);if(!t||i!==t.insertPos-1)return o.style.backgroundPosition="-"+n+"px -"+_+"px",s.disposeItemEffect(s._itemBoxElement[i],r),"continue";var h=t.itemScreenPixelCoord.x-t.itemBoxScreenPixelCoord.x,c=t.itemScreenPixelCoord.y-t.itemBoxScreenPixelCoord.y,l=-h*Q.DEFAULT_FRAME_INTERVAL/Q.ITEM_EFFECT_SPEED_PIXEL_PER_FRAME,u=0===t.overwrittenObjectId||void 0===t.overwrittenObjectId,d=u?t.itemBoxBackgroundImageCoord.x:s._wwa.getObjectCropXById(t.overwrittenObjectId),p=u?t.itemBoxBackgroundImageCoord.y:s._wwa.getObjectCropYById(t.overwrittenObjectId);o.style.left=h+"px",o.style.top=c+"px",window.setTimeout((function(){return e.startItemEffect(o,r,{target:{x:n,y:_},overwritten:{x:d,y:p}},l)}),Q.DEFAULT_FRAME_INTERVAL)},s=this,a=0;a<this._itemBoxElement.length;a++)i(a)},e.prototype.startItemEffect=function(t,e,i,s){var a=this,o=e.querySelector(this.overwittenItemSelector);o&&e.removeChild(o);var r=document.createElement("div");r.classList.add(this.overwittenItemClassName),r.style.backgroundPosition="-"+i.overwritten.x+"px -"+i.overwritten.y+"px",r.style.backgroundImage=e.style.backgroundImage,e.appendChild(r),t.style.backgroundPosition="-"+i.target.x+"px -"+i.target.y+"px",t.style.transitionDuration=s+"ms",t.style.transitionProperty="left,top",t.style.transitionTimingFunction="linear",t.style.left="0",t.style.top="0",e.classList.add(this.itemTransitioningClassName),t.addEventListener("transitionend",(function(){a.disposeItemEffect(t,e)}),{once:!0})},e.prototype.disposeItemEffect=function(t,e){t.style.transitionDuration="0s",t.style.transitionProperty="",t.style.left="0",t.style.top="0",e.classList.contains(this.itemTransitioningClassName)&&e.classList.remove(this.itemTransitioningClassName);var i=e.querySelector(this.overwittenItemSelector);i&&e.removeChild(i)},e.prototype.isDead=function(){return this._status.energy<=0},e.prototype.addItem=function(t,e,i,s){var a,o,r;void 0===e&&(e=0),void 0===i&&(i=!1);var n=this._wwa.getObjectAttributeById(t,Q.ATR_NUMBER),_=0;if(0===e&&0!==n&&(e=n),0===e){if(0===t)return;if((a=this._getBlankItemPos())===Q.ITEMBOX_IS_FULL)throw new Error("これ以上、アイテムを持てません。");_=this._itemBox[a-1],this._forceSetItemBox(a,t)}else if(!1===i)if(a=e,r=this._itemBox[a-1],this._wwa.getObjectAttributeById(r,Q.ATR_NUMBER)!==this._wwa.getObjectAttributeById(t,Q.ATR_NUMBER)){if((o=this._getBlankItemPos())===Q.ITEMBOX_IS_FULL)throw new Error("これ以上、アイテムを持てません。");this._forceSetItemBox(o,r),this._forceSetItemBox(a,t)}else _=this._itemBox[a-1],this._forceSetItemBox(a,t);else a=e,_=this._itemBox[a-1],this._forceSetItemBox(a,t);this._updateEquipmentStatus(),this.updateItemBox(s?{insertPos:a,itemScreenPixelCoord:s.screenPixelCoord,itemBoxBackgroundImageCoord:s.itemBoxBackgroundImageCoord,itemBoxScreenPixelCoord:new g(Q.MAP_WINDOW_WIDTH+(a-1)%3*Q.CHIP_SIZE,Q.ITEMBOX_TOP_Y+Math.floor((a-1)/3)*Q.CHIP_SIZE),overwrittenObjectId:_}:void 0)},e.prototype._forceSetItemBox=function(t,e){var i=this,s=ht("#item"+(t-1)+">.item-click-border"),a=this._wwa.getObjectAttributeById(e,Q.ATR_MODE);if(this.removeItemByItemPosition(t),this._itemBox[t-1]=e,0!==e&&a!==T.NORMAL){var o=this._wwa.getSystemMessageById(F.CLICKABLE_ITEM);this._isClickableItemGot||("BLANK"!==o&&this._wwa.setMessageQueue(""===o?"このアイテムは右のボックスをクリックすることで使用できます。\n使用できるアイテムは色枠で囲まれます。":o,!1,!0),this._isClickableItemGot=!0),s.style.display="block",function(t){i._itemUsingEvent[t-1]=function(){(i.isControllable()||i._wwa._messageWindow.isItemMenuChoice())&&(i._wwa._itemMenu.close(),i._wwa._setNextMessage(),i._wwa.onselectitem(t))}}(t),s.addEventListener("click",this._itemUsingEvent[t-1])}},e.prototype._getBlankItemPos=function(){var t;for(t=1;t<this._itemBox.length+1;t++)if(0===this._itemBox[t-1])return t;return Q.ITEMBOX_IS_FULL},e.prototype._updateEquipmentStatus=function(){var t,e=new m(0,0);for(t=0;t<Q.ITEMBOX_SIZE;t++)0!==this._itemBox[t]&&(e.strength+=this._wwa.getObjectAttributeById(this._itemBox[t],Q.ATR_STRENGTH),e.defence+=this._wwa.getObjectAttributeById(this._itemBox[t],Q.ATR_DEFENCE));var i=e.minus(this._equipStatus);this._wwa.setStatusChangedEffect(i),this._equipStatus=e,this.updateStatusValueBox()},e.prototype.hasItem=function(t){for(var e=0;e<Q.ITEMBOX_SIZE;e++)if(this._itemBox[e]===t)return!0;return!1},e.prototype.canUseItem=function(t){var e=this._itemBox[t-1];return 0!==e&&this._wwa.getObjectAttributeById(e,Q.ATR_MODE)!==T.NORMAL},e.prototype.useItem=function(){var t;t=this._itemBox[this._readyToUseItemPos-1],this._wwa.getObjectAttributeById(t,Q.ATR_MODE)!==T.NOT_DISAPPEAR&&this.removeItemByItemPosition(this._readyToUseItemPos);var e=_t("item"+(this._readyToUseItemPos-1));return setTimeout((function(){e.classList.contains("onpress")&&e.classList.remove("onpress")}),Q.DEFAULT_FRAME_INTERVAL),this._isReadyToUseItem=!1,this._readyToUseItemPos=void 0,t},e.prototype.canHaveMoreItems=function(){return this._getBlankItemPos()!==Q.ITEMBOX_IS_FULL},e.prototype.removeItemByItemPosition=function(t){var e;0!==this._itemBox[t-1]&&(this._wwa.getObjectAttributeById(this._itemBox[t-1],Q.ATR_MODE)!==T.NORMAL&&((e=ht("#item"+(t-1)+">.item-click-border")).removeEventListener("click",this._itemUsingEvent[t-1]),e.style.display="none"),this._itemBox[t-1]=0,this._updateEquipmentStatus(),this.updateItemBox())},e.prototype.removeItemByPartsID=function(t){var e;if(!this.hasItem(t))throw new Error("アイテムを持っていない");for(var i=0;i<Q.ITEMBOX_SIZE;i++)if(this._itemBox[i]===t)return this._wwa.getObjectAttributeById(this._itemBox[i],Q.ATR_MODE)!==T.NORMAL&&((e=ht("#item"+i+">.item-click-border")).removeEventListener("click",this._itemUsingEvent[i]),e.style.display="none"),this._itemBox[i]=0,this._updateEquipmentStatus(),void this.updateItemBox()},e.prototype.clearItemBox=function(){for(var t=1;t<=Q.ITEMBOX_SIZE;t++)this.removeItemByItemPosition(t);this._updateEquipmentStatus(),this.updateItemBox()},e.prototype.hasGold=function(t){return this._status.gold>=t},e.prototype.payGold=function(t){if(!this.hasGold(t))throw new Error("お金が足りない");this.setGold(this._status.gold-t)},e.prototype.earnGold=function(t){this.setGold(this._status.gold+t)},e.prototype.setPartsAppearedFlag=function(){this._partsAppeared=!0},e.prototype.clearPartsAppearedFlag=function(){this._partsAppeared=!1},e.prototype.isPartsAppearedTime=function(){return!0===this._partsAppeared},e.prototype.startBattleWith=function(t){this._isPlayerTurn=!0,this._battleFrameCounter=Q.BATTLE_INTERVAL_FRAME_NUM,this._battleTurnNum=0,this._enemy=t,this._state=rt.BATTLE},e.prototype.isFighting=function(){return this._state===rt.BATTLE},e.prototype.isTurn=function(){return this._isPlayerTurn},e.prototype.getTurnNum=function(){return this._battleTurnNum},e.prototype.isBattleStartFrame=function(){return this._battleFrameCounter===Q.BATTLE_INTERVAL_FRAME_NUM&&0===this._battleTurnNum},e.prototype.fight=function(){if(!this.isFighting())throw new Error("バトルが開始されていません。");if(0===this._battleTurnNum&&this._battleFrameCounter===Q.BATTLE_INTERVAL_FRAME_NUM&&this._wwa.showMonsterWindow(),!(--this._battleFrameCounter>0)){this._battleTurnNum++,this._speedIndex===Q.MAX_SPEED_INDEX||this._battleTurnNum>Q.BATTLE_SPEED_CHANGE_TURN_NUM?(1===this._battleTurnNum&&(this._wwa.playSound(X.ATTACK),this._wwa.vibration(!1)),this._battleFrameCounter=1):(this._battleFrameCounter=Q.BATTLE_INTERVAL_FRAME_NUM,this._wwa.playSound(X.ATTACK),this._wwa.vibration(!0));var t=this.getStatus(),e=this._enemy.status;if(this._isPlayerTurn){if(t.strength>e.defence||t.defence<e.strength)return e.energy>t.strength-e.defence?t.strength>e.defence&&this._enemy.damage(t.strength-e.defence):(this._wwa.playSound(this._wwa.getObjectAttributeById(this._enemy.partsID,Q.ATR_SOUND)),this.earnGold(e.gold),this._wwa.setStatusChangedEffect(new y(0,0,0,e.gold)),0!==this._enemy.item?this._wwa.setPartsOnPosition(S.OBJECT,this._enemy.item,this._enemy.position):this._wwa.setPartsOnPosition(S.OBJECT,0,this._enemy.position),this._wwa.appearParts(this._enemy.position,I.OBJECT,this._enemy.partsID),this._state=rt.CONTROLLABLE,this._wwa.setMessageQueue(this._enemy.message,!1,!1,this._enemy.partsID,S.OBJECT,this._enemy.position),this._enemy.battleEndProcess(),this._battleTurnNum=0,this._enemy=null),void(this._isPlayerTurn=!1);this._enemy.battleEndProcess(),this._wwa.setMessageQueue("相手の防御能力が高すぎる！",!1,!0),this._battleTurnNum=0,this._enemy=null}else e.strength>t.defence&&(t.energy>e.strength-t.defence?this.damage(e.strength-t.defence):(this.setEnergy(0),this._enemy.battleEndProcess(),this._state=rt.CONTROLLABLE,this._battleTurnNum=0,this._enemy=null,this._wwa.gameover()));this._isPlayerTurn=!0}},e.prototype.readyToUseItem=function(t){var e;if(!this.canUseItem(t))throw new Error("アイテムがないか、アイテムが使えません。");e=this._itemBox[t-1],this._wwa.getObjectAttributeById(e,Q.ATR_STRING),this._wwa.appearParts(this._position.getPartsCoord(),I.OBJECT,e),this._readyToUseItemPos=t,this._isReadyToUseItem=!0},e.prototype.isReadyToUseItem=function(){return this._isReadyToUseItem},e.prototype.getDrawingCenterPosition=function(){var t=this._position.getPartsCoord(),e=this._position.getOffsetCoord(),i=this._camera.getPosition(),s=i.getPartsCoord(),a=i.getOffsetCoord(),o=(t.x-s.x)*Q.CHIP_SIZE+e.x-a.x+Q.CHIP_SIZE/2,r=(t.y-s.y)*Q.CHIP_SIZE+e.y-a.y+Q.CHIP_SIZE/2;return new g(o,r)},e.prototype.getPlayTimeText=function(){var t=Math.floor(this._frameCount/60);return t>=36e6?"9999:99:99":("000"+(t/60/60|0)).slice(-4)+":"+("0"+(t/60|0)%60).slice(-2)+":"+("0"+t%60).slice(-2)},e.prototype.mainFrameCount=function(){this._frameCount++},e.prototype.getFrameCount=function(){return this._frameCount},e.prototype.setFrameCount=function(t){return"number"!=typeof t&&(t=0),this._frameCount=t},e.prototype.getMoveCount=function(){return this._moves},e.prototype.setMoveCount=function(t){return this._moves=t},e.prototype.isMoveObjectAutoExecTime=function(){return 0===this._moveObjectAutoExecTimer},e.prototype.setMoveMacroWaiting=function(t){t<0||(this._moveMacroWaitingRemainMoves=t,this._moveObjectAutoExecTimer=0)},e.prototype.resetMoveObjectAutoExecTimer=function(){this._moveObjectAutoExecTimer=Q.CHIP_SIZE/V[this._speedIndex],this._moveMacroWaitingRemainMoves--},e.prototype.decrementMoveObjectAutoExecTimer=function(){return this._moveMacroWaitingRemainMoves>=0&&this._moveObjectAutoExecTimer>0&&(this._moveObjectAutoExecTimer--,0===this._moveMacroWaitingRemainMoves&&0===this._moveObjectAutoExecTimer&&(this._afterMoveMacroFlag=!0)),0},e.prototype.isWaitingMoveMacro=function(){return 0!==this._moveMacroWaitingRemainMoves||0!==this._moveObjectAutoExecTimer},e.prototype.decrementLookingAroundTimer=function(){return this._isPreparedForLookingAround&&this._lookingAroundTimer>0?--this._lookingAroundTimer:0},e.prototype.isLookingAround=function(){return this._isPreparedForLookingAround&&0===this._lookingAroundTimer},e.prototype.getSpeedIndex=function(){return this._speedIndex},e.prototype.speedUp=function(){return this._speedIndex=Math.min(Q.MAX_SPEED_INDEX,this._speedIndex+1)},e.prototype.speedDown=function(){return this._speedIndex=Math.max(Q.MIN_SPEED_INDEX,this._speedIndex-1)},e}(wt),At=function(){function t(t,e,i,s,a,o,r){this._partsID=t,this._position=e,this._imgCoord=i,this._status=s,this._message=a,this._item=o,this._battleEndCallback=r}return Object.defineProperty(t.prototype,"partsID",{get:function(){return this._partsID},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imgCoord",{get:function(){return this._imgCoord},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"item",{get:function(){return this._item},enumerable:!0,configurable:!0}),t.prototype.damage=function(t){this._status.energy=Math.max(0,this._status.energy-t)},t.prototype.battleEndProcess=function(){this._battleEndCallback()},t}(),It=function(){function t(t,e,i,s,a){this._player=t,this._objectID=e,this._srcPos=i,this._destPos=s,this._dir=a,this._currentPos=this._srcPos.clone()}return t.prototype.update=function(){var t=this._player.getSpeedIndex();return this._currentPos=this._currentPos.getNextFramePosition(this._dir,V[t],V[t]),this._currentPos},Object.defineProperty(t.prototype,"isAchievedDestination",{get:function(){return this._currentPos.equals(this._destPos)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPosition",{get:function(){return this._currentPos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"beforePosition",{get:function(){return this._srcPos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"destination",{get:function(){return this._destPos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"objID",{get:function(){return this._objectID},enumerable:!0,configurable:!0}),t}(),Tt=function(){function t(t,e){this._wwa=t,this._player=e,this.clear()}return t.prototype.add=function(t,e,i,s){this._queue.push(new It(this._player,t,e,i,s))},t.prototype.update=function(){for(var t=[],e=[],i=0;i<this._queue.length;i++)this._queue[i].update(),this._queue[i].isAchievedDestination?(t.push(this._queue[i]),this._wwa.setPartsOnPosition(S.OBJECT,0,this._queue[i].beforePosition.getPartsCoord()),this._wwa.setPartsOnPosition(S.OBJECT,this._queue[i].objID,this._queue[i].destination.getPartsCoord())):e.push(this._queue[i]);return this._queue=e,t},t.prototype.clear=function(){this._queue=[]},Object.defineProperty(t.prototype,"objectMovingData",{get:function(){return this.objectMovingData},enumerable:!0,configurable:!0}),t.prototype.getOffsetByBeforePartsCoord=function(t){var e=this._queue.filter((function(e){return e.beforePosition.getPartsCoord().equals(t)}));return 0===e.length?null:e[0].currentPosition.getOffsetCoord()},t}(),St=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),Ot=function(t,e,i,s){this.message=t,this.isSystemMessage=e,this.isEndOfPartsEvent=i,this.macro=s,void 0===this.macro&&(this.macro=[])};var Ct=function(){function t(t,e,i,s,a,o){this._wwa=t,this._triggerPartsID=e,this._triggerPartsType=i,this._triggerPartsPosition=s,this.macroType=a,this.macroArgs=o}return t.prototype.execute=function(){try{switch(this.macroType){case k.IMGPLAYER:this._executeImgPlayerMacro();break;case k.IMGYESNO:this._executeImgYesNoMacro();break;case k.HPMAX:this._executeHPMaxMacro();break;case k.SAVE:this._executeSaveMacro();break;case k.ITEM:this._executeItemMacro();break;case k.DEFAULT:this._executeDefaultMacro();break;case k.OLDMAP:this._executeOldMapMacro();break;case k.PARTS:this._executePartsMacro();break;case k.MOVE:this._executeMoveMacro();break;case k.MAP:this._executeMapMacro();break;case k.DIRMAP:this._executeDirMapMacro();break;case k.IMGFRAME:this._executeImgFrameMacro();break;case k.IMGBOM:this._executeImgBomMacro();break;case k.DELPLAYER:this._executeDelPlayerMacro();break;case k.FACE:this._executeFaceMacro();break;case k.EFFECT:this._executeEffectMacro();break;case k.GAMEOVER:this._executeGameOverMacro();break;case k.IMGCLICK:this._executeImgClickMacro();break;case k.STATUS:this._executeStatusMacro();break;case k.EFFITEM:this._executeEffItemMacro();break;case k.COLOR:this._executeColorMacro();break;case k.WAIT:this._executeWaitMacro();break;case k.SOUND:this._executeSoundMacro();break;case k.GAMEPAD_BUTTON:this._executeGamePadButtonMacro();break;default:console.log("不明なマクロIDが実行されました:"+this.macroType)}}catch(t){}},t.prototype._concatEmptyArgs=function(t){if(this.macroArgs.length<t){for(var e=new Array(t-this.macroArgs.length),i=0;i<e.length;i++)e[i]="";this.macroArgs=this.macroArgs.concat(e)}},t.prototype._parseInt=function(t,e){void 0===e&&(e=0);var i=parseInt(this.macroArgs[t]);return isNaN(i)?e:i},t.prototype._executeImgPlayerMacro=function(){this._concatEmptyArgs(2);var t=this._parseInt(0),e=this._parseInt(1);this._wwa.setPlayerImgCoord(new g(t,e))},t.prototype._executeImgYesNoMacro=function(){this._concatEmptyArgs(2);var t=this._parseInt(0),e=this._parseInt(1);this._wwa.setYesNoImgCoord(new g(t,e))},t.prototype._executeHPMaxMacro=function(){this._concatEmptyArgs(1);var t=Math.max(0,this._parseInt(0));this._wwa.setPlayerEnergyMax(t)},t.prototype._executeSaveMacro=function(){this._concatEmptyArgs(1);var t=!!this._parseInt(0);this._wwa.disableSave(t)},t.prototype._executeItemMacro=function(){this._concatEmptyArgs(2);var t=this._parseInt(0),e=this._parseInt(1);this._wwa.setPlayerGetItem(t,e)},t.prototype._executeDefaultMacro=function(){this._concatEmptyArgs(1);var t=!!this._parseInt(0);this._wwa.setObjectNotCollapseOnPartsOnPlayer(t)},t.prototype._executeOldMapMacro=function(){this._concatEmptyArgs(1);var t=!!this._parseInt(0);this._wwa.setOldMap(t)},t.prototype._executePartsMacro=function(){this._concatEmptyArgs(4);var t=this._parseInt(0),e=this._parseInt(1),i=this._parseInt(2,S.OBJECT),s=this._parseInt(3);if(i!==S.OBJECT&&i!==S.MAP)throw new Error("パーツ種別が不明です");if(0!==s&&1!==s&&(s=1),t<0||e<0)throw new Error("パーツ番号が不正です");if(i===S.OBJECT){if(t>=this._wwa.getObjectPartsNum()||e>=this._wwa.getObjectPartsNum())throw new Error("パーツ番号が不正です")}else if(t>=this._wwa.getMapPartsNum()||e>=this._wwa.getMapPartsNum())throw new Error("パーツ番号が不正です");this._wwa.replaceParts(t,e,i,!!s)},t.prototype._executeMoveMacro=function(){this._concatEmptyArgs(1);var t=this._parseInt(0);this._wwa.setMoveMacroWaitingToPlayer(t)},t.prototype._executeMapMacro=function(){this._concatEmptyArgs(4);var t=this._parseInt(0),e=this.macroArgs[1],i=this.macroArgs[2],s=this._parseInt(3,S.OBJECT);if(t<0)throw new Error("パーツ番号が不正です");if(s===S.OBJECT){if(t>=this._wwa.getObjectPartsNum())throw new Error("パーツ番号が不正です")}else if(t>=this._wwa.getMapPartsNum())throw new Error("パーツ番号が不正です");this._wwa.appearPartsEval(this._triggerPartsPosition,e,i,t,s)},t.prototype._executeDirMapMacro=function(){this._concatEmptyArgs(3);var t=this._parseInt(0),e=this._parseInt(1),i=this._parseInt(2,S.OBJECT);if(isNaN(t)||isNaN(e)||isNaN(i))throw new Error("引数が整数ではありません");if(t<0)throw new Error("パーツ番号が不正です");if(i===S.OBJECT){if(t>=this._wwa.getObjectPartsNum())throw new Error("パーツ番号が不正です")}else if(t>=this._wwa.getMapPartsNum())throw new Error("パーツ番号が不正です");this._wwa.appearPartsByDirection(e,t,i)},t.prototype._executeImgFrameMacro=function(){this._concatEmptyArgs(3);var t=this._parseInt(0),e=this._parseInt(1),i=this._parseInt(2);if(e<0||i<0)throw new Error("座標は正でなければなりません。");if(t===K.ENERGY||t===K.STRENGTH||t===K.DEFENCE||t===K.GOLD)this._wwa.setStatusIconCoord(t,new g(e,i));else if(t===K.WIDE_CELL_ROW)this._wwa.setWideCellCoord(new g(e,i));else if(t===K.ITEM_BG)this._wwa.setItemboxBackgroundPosition({x:e,y:i});else{if(t!==K.MAIN_FRAME)throw new Error("種別が不正です。");this._wwa.setFrameCoord(new g(e,i))}},t.prototype._executeImgBomMacro=function(){this._concatEmptyArgs(2);var t=this._parseInt(0),e=this._parseInt(1);if(t<0||e<0)throw new Error("座標は正でなければなりません。");this._wwa.setBattleEffectCoord(new g(t,e))},t.prototype._executeDelPlayerMacro=function(){this._concatEmptyArgs(1);var t=parseInt(this.macroArgs[0]);this._wwa.setDelPlayer(!!t)},t.prototype._executeFaceMacro=function(){this._concatEmptyArgs(6);var t,e=this._parseInt(0),i=this._parseInt(1),s=this._parseInt(2),a=this._parseInt(3),o=this._parseInt(4),r=this._parseInt(5);if(e<0||i<0||s<0||a<0||o<0||r<0)throw new Error("各引数は0以上の整数でなければなりません。");t=new f(new g(e,i),new g(s,a),new g(o,r)),this._wwa.addFace(t)},t.prototype._executeEffectMacro=function(){this._concatEmptyArgs(1);var t=this._parseInt(0);if(t<0)throw new Error("待ち時間は0以上の整数でなければなりません。");if(0!==t){for(var e=[],i=1;i<this.macroArgs.length;i+=2){var s,a=this._parseInt(i);if(a<0)throw new Error("画像のパーツ座標指定は0以上の整数でなければなりません。");if(i+1===this.macroArgs.length)throw new Error("画像のパーツ座標指定で、Y座標が指定されていません。");if((s=this._parseInt(i+1))<0)throw new Error("画像のパーツ座標指定は0以上の整数でなければなりません。");e.push(new g(a,s))}this._wwa.setEffect(t,e)}else this._wwa.stopEffect()},t.prototype._executeGameOverMacro=function(){this._concatEmptyArgs(2);var t=this._parseInt(0),e=this._parseInt(1);if(t<0||t>=this._wwa.getMapWidth()||e<0||e>=this._wwa.getMapWidth())throw new Error("マップの範囲外が指定されています!");this._wwa.setGameOverPosition(new g(t,e))},t.prototype._executeImgClickMacro=function(){if(this._concatEmptyArgs(2),this.macroArgs.length<1)throw new Error("引数が少なすぎます");var t=this._parseInt(0),e=this._parseInt(1);if(t<0||e<0)throw new Error("引数が0以上の整数ではありません");this._wwa.setImgClick(new g(t,e))},t.prototype._executeEffItemMacro=function(){if(this.macroArgs.length<1)throw new Error("引数が少なすぎます");var t=this._parseInt(0);this._wwa.updateItemEffectEnabled(!!t)},t.prototype._executeStatusMacro=function(){this._concatEmptyArgs(2);var t=this._parseInt(0),e=this._parseInt(1);if(t<0||4<t)throw new Error("ステータス種別が範囲外です。");this._wwa.setPlayerStatus(t,e)},t.prototype._executeColorMacro=function(){this._concatEmptyArgs(4);var t=this._parseInt(0),e=this._parseInt(1),i=this._parseInt(2),s=this._parseInt(3);if(t<0||t>5)throw new Error("種別は0から5までです");if(e<0||e>255||i<0||i>255||s<0||s>255)throw new Error("色が範囲外です");this._wwa.changeStyleRule(t,e,i,s)},t.prototype._executeWaitMacro=function(){throw new Error("Not implemented!")},t.prototype._executeSoundMacro=function(){this._concatEmptyArgs(1);var t=parseInt(this.macroArgs[0]);this._wwa.playSound(t)},t.prototype._executeGamePadButtonMacro=function(){this._concatEmptyArgs(2);var t=this._parseInt(0),e=this._parseInt(1);if(t<0||e<0)throw new Error("各引数は0以上の整数でなければなりません。");if(e>Q.ITEMBOX_SIZE)throw new Error("アイテムボックス上限を超えた数値が指定されました。");this._wwa.setGamePadButtonItemTable(t,e)},t}();function Dt(t,e,i,s,a){var o=a.match(/^\$([a-zA-Z_][a-zA-Z0-9_]*)\=(.*)$/);if(null===o||3!==o.length)throw new Error("マクロではありません");var r=o[1],n=j["$"+r.toLowerCase()];return void 0===n?new Ct(t,e,i,s,k.UNDEFINED,o[2].split(",")):new Ct(t,e,i,s,n,o[2].split(",").map((function(t){return t.trim()})))}var vt,Pt=function(){function t(t,e,i,s,a,o,r){this._wwa=t,this._coord=e,this._width=i,this._height=s,this._isVisible=a,this._parentElement=o,this._element=document.createElement("div"),this._element.style.position="absolute",this._element.style.borderWidth="2px",this._element.style.borderStyle="solid",t.isClassicMode()?this._element.style.borderRadius="15px":this._element.style.borderRadius="10px",this._element.classList.add("wwa-message-window"),this._element.style.zIndex=r+"",this._element.style.left=this._coord.x+"px",this._element.style.top=this._coord.y+"px",this._element.style.width=this._width+"px",this._element.style.height=this._height+"px",this._parentElement.appendChild(this._element)}return t.prototype.update=function(t){},t.prototype.show=function(){this._isVisible=!0,this._element.style.display="block",this.update()},t.prototype.hide=function(){this._isVisible=!1,this._element.style.display="none",this.update()},t.prototype.isVisible=function(){return this._isVisible},t}(),Nt=function(t){function e(e,i,s,a,o,r,n){var _=t.call(this,e,new g(i.x,i.y),s,a,o,r,201)||this;return _._cgFileName=n,_._monsterBox=document.createElement("div"),_._monsterBox.style.width=Q.CHIP_SIZE+"px",_._monsterBox.style.height=Q.CHIP_SIZE+"px",_._monsterBox.style.position="absolute",_._monsterBox.style.left="10px",_._monsterBox.style.top="10px",_._monsterBox.style.backgroundImage="url("+_._cgFileName.replace("(","\\(").replace(")","\\)")+")",_._monsterBox.style.backgroundPosition="0 0",_._element.appendChild(_._monsterBox),_._energyBox=document.createElement("div"),_._energyBox.style.position="absolute",_._energyBox.style.left="80px",_._energyBox.style.top="10px",_._energyBox.textContent="生命力 0",_._element.appendChild(_._energyBox),_._strengthBox=document.createElement("div"),_._strengthBox.style.position="absolute",_._strengthBox.style.left="80px",_._strengthBox.style.top="30px",_._strengthBox.textContent="攻撃力 0",_._element.appendChild(_._strengthBox),_._defenceBox=document.createElement("div"),_._defenceBox.style.position="absolute",_._defenceBox.style.left="180px",_._defenceBox.style.top="30px",_._defenceBox.textContent="防御力 0",_._element.appendChild(_._defenceBox),_._isVisible?_._element.style.display="block":_._element.style.display="none",_}return St(e,t),e.prototype.update=function(t){void 0!==t&&(this._monsterBox.style.backgroundPosition="-"+t.imgCoord.x+"px -"+t.imgCoord.y+"px",this._energyBox.textContent="生命力 "+t.status.energy,this._strengthBox.textContent="攻撃力 "+t.status.strength,this._defenceBox.textContent="防御力 "+t.status.defence)},e}(Pt),Mt=function(t){function e(e,i,s,a){var o=this;return e.isClassicMode()?((o=t.call(this,e,new g(2*Q.CHIP_SIZE,30),7*Q.CHIP_SIZE,40,s,a,202)||this)._element.style.borderWidth="0",o._element.style.borderRadius="4px",o._element.style.fontSize="20px",o._element.style.lineHeight="40px"):o=t.call(this,e,new g(i.x,i.y),340,30,s,a,202)||this,o._element.style.textAlign="center",o._isVisible?o._element.style.display="block":o._element.style.display="none",o.update(0),o}return St(e,t),e.prototype.update=function(t){void 0!==t&&(this._element.textContent="Score: "+t)},e}(Pt);!function(t){t[t.TOP=0]="TOP",t[t.CENTER=1]="CENTER",t[t.BOTTOM=2]="BOTTOM",t[t.SCORE=3]="SCORE"}(vt||(vt={}));var Rt,bt=function(){function t(t,e,i,s,a,o,r,n,_,h,c){this._saveDataList=void 0,this._save_select_id=0,this._save_counter=0,this._save_close=!1;var l=this,u=r.replace("(","\\(").replace(")","\\)");switch(this._wwa=t,this._cgFileName=r,this._x=e,this._y=i,this._width=s,this._height=a,this._message=o,this._isVisible=n,this._isYesno=_,this._isItemMenu=h,this._element=document.createElement("div"),this._element.id="wwa-text-message-window",this._element.classList.add("wwa-message-window"),this._msgWrapperElement=document.createElement("div"),this._msgWrapperElement.style.textAlign="left",this._msgWrapperElement.style.wordWrap="break-word",this._msgWrapperElement.style.margin=t.isClassicMode()?"8px 0 8px 16px":"0",this._msgWrapperElement.style.padding=t.isClassicMode()?"0":"7px",this._element.appendChild(this._msgWrapperElement),this._saveElement=document.createElement("div"),this._saveElement.style.padding="0",this._saveElement.style.margin="0",this._element.appendChild(this._saveElement),this._dummyElement=document.createElement("div"),this._dummyElement.style.display="none",this._dummyElement.style.padding="0",this._dummyElement.style.margin="0",this._dummyElement.style.height="55px",this._element.appendChild(this._dummyElement),this._ynWrapperElement=document.createElement("div"),this._ynWrapperElement.classList.add("wwa-yesno-wrapper"),this._element.appendChild(this._ynWrapperElement),this._parentElement=c,this._parentElement.appendChild(this._element),this._divYesElement=document.createElement("div"),this._divYesElement.classList.add("wwa-yes-button"),this._divYesElement.style.background="url("+u+")",this._divYesElement.onclick=function(){l._isInputDisable||(t.setYesNoInput(A.YES),l.update())},this._divYesElement.style.cursor="pointer",this._divNoElement=document.createElement("div"),this._divNoElement.classList.add("wwa-no-button"),this._divNoElement.style.background="url("+u+")",this._divNoElement.onclick=function(){l._isInputDisable||(t.setYesNoInput(A.NO),l.update())},this._ynWrapperElement.appendChild(this._divYesElement),this._ynWrapperElement.appendChild(this._divNoElement),l._isInputDisable=!1,t.userDevice.device){case N.SP:case N.VR:this._parentElement.classList.add("useScaleUp")}this._saveDataList=[];for(var d=0;d<Q.QUICK_SAVE_MAX;d++)this._saveDataList[d]=new Lt;this.update()}return t.prototype.setPosition=function(t,e,i,s){this._x=t,this._y=e,this._width=i,this._height=s,this.update()},t.prototype.setPositionByPlayerPosition=function(t,e,i,s,a){var o,r=s.getPartsCoord().substract(a.getPartsCoord()).y;o=t?vt.BOTTOM:e?vt.SCORE:i?vt.CENTER:r>=Math.ceil(Q.V_PARTS_NUM_IN_WINDOW/2)?vt.TOP:vt.BOTTOM,this.setPositionEasy(o)},t.prototype.setPositionEasy=function(t){var e=Math.floor(this._element.clientHeight/2);return t===vt.CENTER?(this._y=Q.MAP_WINDOW_HEIGHT/2-e,void this.update()):t===vt.TOP?(this._y=Math.max(20,Q.MAP_WINDOW_HEIGHT/4-e)+10,void this.update()):t===vt.BOTTOM?(this._y=Math.min(Q.MAP_WINDOW_HEIGHT-20-this._element.clientHeight,3*Q.MAP_WINDOW_HEIGHT/4-e),void this.update()):t===vt.SCORE?(this._y=80,void this.update()):void 0},t.prototype.setMessage=function(t){this._message=t,this.update()},t.prototype.setYesNoChoice=function(t){return this._isInputDisable=!1,this._isYesno=t,this.update(),this._isYesno},t.prototype.isYesNoChoice=function(){return this._isYesno},t.prototype.isSaveChoice=function(){return this._isSave},t.prototype.setItemMenuChoice=function(t){return this._isInputDisable=!1,this._isItemMenu=t,this.update(),this._isItemMenu},t.prototype.isItemMenuChoice=function(){return this._isItemMenu},t.prototype.setInputDisable=function(){this._isInputDisable=!0},t.prototype.isInputDisable=function(){return this._isInputDisable},t.prototype.show=function(){this._isVisible=!0,this.update()},t.prototype.hide=function(){this._isVisible=!1,this.update()},t.prototype.isVisible=function(){return this._isVisible},t.prototype.isWideChar=function(t){return null!==t.match(/^[^\x01-\x7E\xA1-\xDF]+$/)},t.prototype.createClassicTextElement=function(t){for(var e=document.createElement("span"),i=0,s="",a=0;a<t.length||0!=i;a++)if(this.isWideChar(t.charAt(a))?i+=2:i+=1,s+=t.charAt(a),i+1>2*Q.MSG_STR_WIDTH){"。"!==t.charAt(a+1)&&"、"!==t.charAt(a+1)||(s+=t.charAt(a+1),a++);var o=document.createElement("span");o.style.display="inline-block",o.style.width="100%",o.textContent=s,e.appendChild(o),i=0,s=""}return e},t.prototype.update=function(){var t=this,e=this._wwa.getYesNoImgCoord();this._isYesno?(this._wwa.getYesNoState()===A.YES?(this._divYesElement.style.backgroundPosition="-"+(e.x+Q.IMGRELPOS_YESNO_YESP_X)*Q.CHIP_SIZE+"px -"+e.y*Q.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(e.x+Q.IMGRELPOS_YESNO_NO_X)*Q.CHIP_SIZE+"px -"+e.y*Q.CHIP_SIZE+"px"):this._wwa.getYesNoState()===A.NO?(this._divYesElement.style.backgroundPosition="-"+(e.x+Q.IMGRELPOS_YESNO_YES_X)*Q.CHIP_SIZE+"px -"+e.y*Q.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(e.x+Q.IMGRELPOS_YESNO_NOP_X)*Q.CHIP_SIZE+"px -"+e.y*Q.CHIP_SIZE+"px"):(this._divYesElement.style.backgroundPosition="-"+(e.x+Q.IMGRELPOS_YESNO_YES_X)*Q.CHIP_SIZE+"px -"+e.y*Q.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(e.x+Q.IMGRELPOS_YESNO_NO_X)*Q.CHIP_SIZE+"px -"+e.y*Q.CHIP_SIZE+"px"),this._ynWrapperElement.style.display="block"):this._ynWrapperElement.style.display="none",this._msgWrapperElement.textContent="";var i=this._message.split("\n");i.forEach((function(e,s){var a;t._wwa.isClassicMode()?a=t.createClassicTextElement(e):(a=document.createElement("span")).textContent=i[s],t._msgWrapperElement.appendChild(a),t._msgWrapperElement.appendChild(document.createElement("br"))})),this._isVisible?(this._element.style.left=this._x+"px",this._element.style.top=this._y+"px"):(this._element.style.left="-999999px",this._element.style.top="-999999px"),this._isSave?this._saveElement.style.display="block":this._saveElement.style.display="none",this._element.style.width=this._width+"px",this._element.style.minHeight=this._height+"px"},t.prototype.createSaveDom=function(){var t,e,i,s,a,o,r,n,_,h,c,l=this;e=document.createElement("div"),h=(n=document.getElementById("disp-energy")).style.backgroundPosition,c=n.style.backgroundImage;for(var u=0;u<Q.QUICK_SAVE_MAX;u++)t=this._saveDataList[u],(i=document.createElement("div")).classList.add("savedata"),i.setAttribute("save_id",u),i.addEventListener("click",(function(t){l.setSaveID(0|t.currentTarget.getAttribute("save_id")),l._save_close=!0,t.preventDefault()})),(s=document.createElement("div")).classList.add("ss"),i.appendChild(s),(a=document.createElement("div")).classList.add("wide-cell-row"),a.style.backgroundPosition=h,a.style.backgroundImage=c,i.appendChild(a),e.appendChild(i),t.flag&&(s.appendChild(t.cvs),(o=document.createElement("span")).innerText=t.date.toLocaleString(),s.appendChild(o),(r=document.createElement("div")).classList.add("status-icon"),r.style.backgroundImage=c,r.style.backgroundPosition="-120px -80px",a.appendChild(r),(_=document.createElement("div")).classList.add("status-value-box"),_.innerText=t.getStatusEnergy(),a.appendChild(_));this._saveElement.textContent="",this._saveElement.appendChild(e),this.setSaveID(this._save_select_id),this._isSave=!0,this._save_counter=0,this._save_close=!1},t.prototype.deleteSaveDom=function(){this._saveElement.textContent="",this._isSave=!1},t.prototype.setSaveID=function(t){this._save_select_id=t;for(var e,i=document.querySelectorAll(".savedata"),s=0;s<Q.QUICK_SAVE_MAX;s++)e=i[s],t===s?e.classList.add("select"):e.classList.remove("select")},t.prototype.save=function(t,e){return!!this._saveDataList[this._save_select_id]&&this._saveDataList[this._save_select_id].save(t,e)},t.prototype.load=function(){return this._saveDataList[this._save_select_id]?this._saveDataList[this._save_select_id].load():null},t.prototype.hasSaveData=function(){for(var t=0;t<Q.QUICK_SAVE_MAX;t++)if(this._saveDataList[t].flag)return!0;return!1},t.prototype.saveUpdate=function(){this._save_counter>0&&this._save_counter--},t.prototype.isSaveClose=function(){return this._save_close},t.prototype.cursor_wait=function(){this._save_counter=Q.CONTROLL_WAIT_FRAME},t.prototype.saveControll=function(t){if(!(this._save_counter>0)){switch(t){case d.DOWN:this._save_select_id-=2,this.cursor_wait();break;case d.UP:this._save_select_id+=2,this.cursor_wait();break;case d.LEFT:this._save_select_id--,this.cursor_wait();break;case d.RIGHT:this._save_select_id++,this.cursor_wait()}this.setSaveID((this._save_select_id+Q.QUICK_SAVE_MAX)%Q.QUICK_SAVE_MAX)}},t}(),Lt=function(){function t(){this.flag=!1,this.date=void 0,this.cvs=void 0,this.ctx=void 0,this.quickSaveData=null,this.cvs=document.createElement("canvas"),this.cvs.width=Q.QUICK_SAVE_THUMNAIL_WIDTH,this.cvs.height=Q.QUICK_SAVE_THUMNAIL_HEIGHT,this.ctx=this.cvs.getContext("2d")}return t.prototype.save=function(t,e){return this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height),this.ctx.drawImage(t,0,0,t.width,t.height,0,0,this.cvs.width,this.cvs.height),this.quickSaveData=e,this.flag=!0,this.date=new Date,!0},t.prototype.getStatusEnergy=function(){return this.flag?this.quickSaveData.statusEnergy:-1},t.prototype.load=function(){return this.quickSaveData},t}(),Bt=function(){function t(t,e,i){this.id=t,this.imgFileName=e,this.parent=i,this.elem=document.createElement("div"),this.elem.classList.add("est"),this.elem.setAttribute("id","wwa-est-"+t),this.imgElem=document.createElement("div"),this.imgElem.classList.add("est-img-wrapper"),this.imgElem.style.backgroundImage="url("+this.imgFileName.replace("(","\\(").replace(")","\\)")+")",this.statusElem=document.createElement("div"),this.statusElem.classList.add("est-status-wrapper"),this.energyElem=document.createElement("div"),this.energyElem.classList.add("est-energy"),this.energyDispElem=document.createElement("span"),this.energyDispElem.classList.add("est-energy-disp"),this.energyElem.appendChild(this.energyDispElem),this.statusElem.appendChild(this.energyElem),this.strengthElem=document.createElement("div"),this.strengthElem.classList.add("est-strength"),this.strengthDispElem=document.createElement("span"),this.strengthDispElem.classList.add("est-strength-disp"),this.strengthElem.appendChild(this.strengthDispElem),this.statusElem.appendChild(this.strengthElem),this.defenceElem=document.createElement("div"),this.defenceElem.classList.add("est-defence"),this.defenceDispElem=document.createElement("span"),this.defenceDispElem.classList.add("est-defence-disp"),this.defenceElem.appendChild(this.defenceDispElem),this.statusElem.appendChild(this.defenceElem),this.damageElem=document.createElement("div"),this.damageElem.classList.add("est-damage"),this.damageDispElem=document.createElement("span"),this.damageDispElem.classList.add("est-damage-disp"),this.damageElem.appendChild(this.damageDispElem),this.statusElem.appendChild(this.damageElem),this.elem.appendChild(this.imgElem),this.elem.appendChild(this.statusElem)}return t.prototype.hide=function(){this.elem.style.display="none"},t.prototype.show=function(){this.elem.style.display="block"},t.prototype.setResult=function(t,e,i){this.imgElem.style.backgroundPosition="-"+t.x+"px -"+t.y+"px",this.energyDispElem.textContent="生命力 "+e.energy,this.strengthDispElem.textContent="攻撃力 "+e.strength,this.defenceDispElem.textContent="防御力 "+e.defence,i.isNoEffect?this.damageDispElem.textContent="攻撃無効":i.isOverMaxTurn?this.damageDispElem.textContent="長期戦が予想されます":this.damageDispElem.textContent="予測ダメージ "+i.damage},t}(),xt=function(){function t(t,e,i){var s,a=this;this._wwa=t,this._imgFileName=e,this._parent=i,this._element=document.createElement("div"),this._element.setAttribute("id","wwa-battle-estimate"),this._element.style.display="none",this._edes=[];for(var o=0;o<Q.BATTLE_ESTIMATE_MONSTER_TYPE_MAX;o++)s=new Bt(o,this._imgFileName,this._element),this._edes.push(s),this._element.appendChild(s.elem);this._element.addEventListener("click",(function(){a._wwa.hideBattleEstimateWindow()})),this._parent.appendChild(this._element)}return t.prototype.update=function(t,e){for(var i=0;i<Q.BATTLE_ESTIMATE_MONSTER_TYPE_MAX;i++)if(i>=e.length)this._edes[i].hide();else{var s=this._wwa.getObjectAttributeById(e[i],Q.ATR_X),a=this._wwa.getObjectAttributeById(e[i],Q.ATR_Y),o=new g(s,a),r=this._wwa.getObjectAttributeById(e[i],Q.ATR_ENERGY),n=this._wwa.getObjectAttributeById(e[i],Q.ATR_STRENGTH),_=this._wwa.getObjectAttributeById(e[i],Q.ATR_DEFENCE),h=new y(r,n,_,0),c=Ut(t,h);this._edes[i].setResult(o,h,c),this._edes[i].show()}},t.prototype.show=function(){this._element.style.display="block"},t.prototype.hide=function(){this._element.style.display="none"},t}(),Wt=function(t,e,i){this.isNoEffect=t,this.isOverMaxTurn=e,this.damage=i};function Ut(t,e){var i=e.energy,s=t.strength-e.defence,a=Math.max(0,e.strength-t.defence),o=0,r=0;if(!(s>0))return new Wt(!0,!1,0);for(;;){if(o++,(i-=s)<=0)return new Wt(!1,!1,r);if(r+=a,o>1e4)return new Wt(!1,!0,0)}}!function(t){t[t.SAVE=0]="SAVE",t[t.LOAD=1]="LOAD"}(Rt||(Rt={}));var Yt=function(){function t(t,e){var i=this;this._wwa=t,this._parent=e,this._element=document.createElement("div"),this._element.setAttribute("id","wwa-password-window"),this._element.style.display="none",this._descriptionElement=document.createElement("div"),this._descriptionElement.classList.add("wwa-password-description"),this._passwordBoxElement=document.createElement("textarea"),this._passwordBoxElement.setAttribute("cols","50"),this._passwordBoxElement.setAttribute("rows","16"),this._passwordBoxElement.addEventListener("focus",(function(t){i._passwordBoxElement.select()})),this._buttonWrapperElement=document.createElement("div"),this._buttonWrapperElement.classList.add("wwa-password-submit"),this._okButtonElement=document.createElement("button"),this._okButtonElement.textContent="OK",this._okButtonElement.addEventListener("click",(function(){i._wwa.hidePasswordWindow()})),this._cancelButtonElement=document.createElement("button"),this._cancelButtonElement.textContent="キャンセル",this._cancelButtonElement.addEventListener("click",(function(){i._wwa.hidePasswordWindow(!0)})),this._buttonWrapperElement.appendChild(this._okButtonElement),this._buttonWrapperElement.appendChild(this._cancelButtonElement),this._mode=Rt.LOAD,this._element.appendChild(this._descriptionElement),this._element.appendChild(this._passwordBoxElement),this._element.appendChild(this._buttonWrapperElement),this._parent.appendChild(this._element),this.update()}return Object.defineProperty(t.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode=t,t===Rt.LOAD&&(this.password="")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"password",{get:function(){return this._passwordBoxElement.value},set:function(t){this._passwordBoxElement.value=t},enumerable:!0,configurable:!0}),t.prototype.show=function(t){void 0!==t&&(this.mode=t),this._isVisible=!0,this.update()},t.prototype.hide=function(){this._isVisible=!1,this.update()},t.prototype.update=function(){var t="";if(this._mode===Rt.LOAD){t="下のボックスに前回のプレイで取得した\n復帰用パスワードを入力してください。\nテキストは、Ctrl+Cでコピー、Ctrl+Vで貼り付けできます。\n現在、Java版WWAで取得したパスワードはご利用になれません。\n作成者がマップの内容を変更した場合は\nそれ以前に取得したパスワードは使えなくなります。";try{this._passwordBoxElement.removeAttribute("readonly")}catch(t){}this._cancelButtonElement.style.display="inline"}else t="下記テキストがデータ復帰用のパスワードになっています。\nコピーしてメモ帳などのテキストエディタに貼り付けて\n保存してください。ボックスをクリックで全体を選択、\n「Ctrl+C」でコピー、「Ctrl+V」で貼り付けできます。\n通常数万文字程度ありますので、ご注意ください。",this._passwordBoxElement.setAttribute("readonly","readonly"),this._cancelButtonElement.style.display="none";var e=t.split("\n");this._descriptionElement.textContent="";for(var i=0;i<e.length;i++){var s=document.createElement("span");s.textContent=e[i],this._descriptionElement.appendChild(s),this._descriptionElement.appendChild(document.createElement("br"))}this._isVisible?this._element.style.display="block":this._element.style.display="none"},t}();function Ft(t,e){var i,s=document.createElement("style");s.type="text/css",s.setAttribute("id",Q.WWA_STYLE_TAG_ID),(i="head",document.getElementsByTagName(i))[0].appendChild(s),t.innerHTML='\n        <canvas id="wwa-map" class="wwa-canvas" width="440" height="440">\n            このブラウザは、Canvas要素をサポートしていません。\n        </canvas>\n        <canvas id="wwa-map-sub" class="wwa-canvas" width="440" height="440"></canvas>\n        <div id="wwa-sidebar">\n            <div class="wide-cell-row" id="disp-energy"><div class="status-icon"></div><div class="status-value-box">0</div></div>\n            <div class="wide-cell-row" id="disp-strength"><div class="status-icon"></div><div class="status-value-box"> 0 </div></div>\n            <div class="wide-cell-row" id="disp-defence"><div class="status-icon"></div><div class="status-value-box">0</div></div>\n            <div class="wide-cell-row" id="disp-gold"><div class="status-icon"></div><div class="status-value-box">0</div></div>\n            <div class="item-cell" id="item0"><div class="item-click-border"></div><div class="item-disp"></div></div>\n            <div class="item-cell" id="item1"><div class="item-click-border"></div><div class="item-disp"></div></div>\n            <div class="item-cell" id="item2"><div class="item-click-border"></div><div class="item-disp"></div></div>\n            <div class="item-cell" id="item3"><div class="item-click-border"></div><div class="item-disp"></div></div>\n            <div class="item-cell" id="item4"><div class="item-click-border"></div><div class="item-disp"></div></div>\n            <div class="item-cell" id="item5"><div class="item-click-border"></div><div class="item-disp"></div></div>\n            <div class="item-cell" id="item6"><div class="item-click-border"></div><div class="item-disp"></div></div>\n            <div class="item-cell" id="item7"><div class="item-click-border"></div><div class="item-disp"></div></div>\n            <div class="item-cell" id="item8"><div class="item-click-border"></div><div class="item-disp"></div></div>\n            <div class="item-cell" id="item9"><div class="item-click-border"></div><div class="item-disp"></div></div>\n            <div class="item-cell" id="item10"><div class="item-click-border"></div><div class="item-disp"></div></div>\n            <div class="item-cell" id="item11"><div class="item-click-border"></div><div class="item-disp"></div></div>\n            <div class="wide-cell-row" id="cell-load">Password</div><div class="wide-button" id="button-load"></div>\n            <div class="wide-cell-row" id="cell-save">Quick Save</div><div class="wide-button" id="button-save"></div>\n            <div class="wide-cell-row" id="cell-restart">Restart Game</div><div class="wide-button" id="button-restart"></div>\n            <div class="wide-cell-row" id="cell-gotowwa">Goto WWA</div><div class="wide-button" id="button-gotowwa"></div>\n        </div>\n        <div id="wwa-controller"></div>\n        <div id="wwa-fader"></div>\n'+(null!==e?'\n        <div id="wwa-cover">\n            <div id="version"></div>\n            <div id="progress-message-container">開始しています...</div>\n            <div id="progress-bar-bg"></div>\n            <div id="progress-bar" class="progress-bar"></div>\n            <div id="progress-bar-audio" class="progress-bar"></div>\n            <div id="progress-disp">---</div>\n        </div>\n    ':'\n        <div id="wwa-cover">\n            <canvas id="progress-panel" width="'+Q.SCREEN_WIDTH+'" height="'+Q.SCREEN_HEIGHT+'"></canvas>\n        </div>')+'\n        <div id="wwa-audio-wrapper"></div>',null!==e&&(_t("wwa-cover").style.backgroundImage="url("+e+")",_t("wwa-cover").style.backgroundRepeat="no-repeat",_t("wwa-cover").style.backgroundPosition="0 0")}var kt,Gt=function(){function t(){this.allClear()}return t.prototype.update=function(){this.counter>0&&this.counter--},t.prototype.cursor_wait=function(){this.counter=Q.CONTROLL_WAIT_FRAME},t.prototype.allClear=function(){this.col=0,this.row=0,this.counter=0},t.prototype.controll=function(e){if(!(this.counter>0))switch(e){case d.DOWN:this.row<t.ROW_MAX-1&&(this.row++,this.openView(),this.cursor_wait());break;case d.UP:this.row>0&&(this.row--,this.openView(),this.cursor_wait());break;case d.LEFT:this.col>0&&(this.col--,this.openView(),this.cursor_wait());break;case d.RIGHT:this.col<t.COL_MAX-1&&(this.col++,this.openView(),this.cursor_wait())}},t.prototype.ok=function(){this.close();var e=null;(e=ht(t.CLICK_DOM_QUERY_TABLE[this.row][this.col])).classList.contains("item-click-border")||this.allClear();var i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});return e.dispatchEvent(i)},t.prototype.ng=function(){this.close()},t.prototype.close=function(){var e,i,s=null;for(e=0;e<t.COL_MAX;e++)for(i=0;i<t.ROW_MAX;i++)(s=_t(t.DOM_ID_TABLE[i][e])).classList.contains("onpress")&&s.classList.remove("onpress")},t.prototype.openView=function(){this.close();_t(t.DOM_ID_TABLE[this.row][this.col]).classList.add("onpress")},t.prototype.init=function(){this.allClear(),this.openView()},t.ROW_MAX=8,t.COL_MAX=3,t.DOM_ID_TABLE=[["item0","item1","item2"],["item3","item4","item5"],["item6","item7","item8"],["item9","item10","item11"],["cell-load","cell-load","cell-load"],["cell-save","cell-save","cell-save"],["cell-restart","cell-restart","cell-restart"],["cell-gotowwa","cell-gotowwa","cell-gotowwa"]],t.CLICK_DOM_QUERY_TABLE=[["#item0 .item-click-border","#item1 .item-click-border","#item2 .item-click-border"],["#item3 .item-click-border","#item4 .item-click-border","#item5 .item-click-border"],["#item6 .item-click-border","#item7 .item-click-border","#item8 .item-click-border"],["#item9 .item-click-border","#item10 .item-click-border","#item11 .item-click-border"],["#button-load","#button-load","#button-load"],["#button-save","#button-save","#button-save"],["#button-restart","#button-restart","#button-restart"],["#button-gotowwa"," #button-gotowwa","#button-gotowwa"]],t}(),Ht=function(){function t(t){this.idx=t}return t.prototype.play=function(){},t.prototype.pause=function(){},t.prototype.isBgm=function(){return this.idx>=X.BGM_LB},t.prototype.hasData=function(){return!1},t.prototype.isError=function(){return!0},t}(),Kt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),Xt=function(t){function e(e,i,s,a){var o=t.call(this,e)||this;return o.audioContext=s,o.audioGain=a,o.audioBuffer=null,o.bufferSources=[],o.isLoaded=!1,o.pos=0,o._load(e,i),o}return Kt(e,t),e.prototype._load=function(t,e){var i=this,s=this.audioContext,a=new XMLHttpRequest,o=0;a.responseType="arraybuffer",a.addEventListener("load",(function(r){var n=a.status;if(0!==n&&200!==n)return console.warn("サウンド "+t+" 番の音声ファイルが見つかりません！ HTTPエラー番号: "+n),void i._cancelLoad();s.decodeAudioData(a.response,(function(s){if(0===s.length){if(!(o>10))return setTimeout((function(){i._load(t,e)}),100),void o++;console.log("error audio file!  "+e+" buffer size "+s.length)}i._setData(s)}))})),a.open("GET",e,!0),a.send("")},e.prototype._setData=function(t){this.audioBuffer=t,this.isLoaded=!0},e.prototype._cancelLoad=function(){this.audioBuffer=null,this.isLoaded=!0},e.prototype.play=function(){var t=this;this.pos=0;var e=this.audioContext.createBufferSource();this.bufferSources.push(e),e.buffer=this.audioBuffer,this.isBgm()&&(e.loop=!0),e.connect(this.audioGain);var i=e.duration;(!isFinite(i)||i<0||"number"!=typeof i)&&(i=0),e.start(0,this.pos*i),e.onended=function(){var i=t.bufferSources.indexOf(e);-1!==i&&t.bufferSources.splice(i,1);try{e.stop(),e.disconnect(t.audioGain),e.buffer=null}catch(t){}e.onended=null},this.audioGain.connect(this.audioContext.destination)},e.prototype.pause=function(){var t=this;this.bufferSources.forEach((function(e){try{e.stop(),e.disconnect(t.audioGain),e.buffer=null}catch(t){}e.onended=null})),this.bufferSources.length=0},e.prototype.hasData=function(){return null!==this.audioBuffer},e.prototype.isLoading=function(){return!this.isLoaded},e.prototype.isError=function(){return this.isLoaded&&null===this.audioBuffer},e}(Ht),jt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),Jt=function(t){function e(e,i,s){var a=t.call(this,e)||this;return a._mainElement=a._createElement(i),a._mainElement.addEventListener("error",(function(){console.warn("サウンド "+e+" 番の音声ファイルが見つかりません！")})),a._subElement=a.isBgm()?null:a._createElement(i),a._currentElement=a._mainElement,a._nextIsSub=!0,s.appendChild(a._mainElement),a}return jt(e,t),e.prototype._createElement=function(t){var e=new Audio(t);return e.preload="auto",e.loop=this.isBgm(),e},e.prototype.play=function(){this._currentElement.currentTime=0,this._currentElement.play(),this.isBgm()||(this._currentElement=this._nextIsSub?this._subElement:this._mainElement,this._nextIsSub=!this._nextIsSub)},e.prototype.pause=function(){this._currentElement.pause()},e.prototype.hasData=function(){return this._mainElement.readyState>=2},e.prototype.isError=function(){return null!==this._mainElement.error},e}(Ht),Vt=function(t,e){for(var i=new Array(t),s=0;s<i.length;s++)i[s]=new Array(e);return i};function Zt(t,e){var i=function(t){return t[kt.CHECK]+256*t[kt.CHECK+1]}(t),s=function(t,e){var i,s=0;if(t[kt.VERSION]>=29){for(var a=2;a<e;a++)s+=(i=t[a],((i%=256)>=128?i-256:i)*(a%8+1));s=s%65536&65535}return s}(t,e);if(i!==s)throw new Error("マップデータが壊れているようです。\n チェックサムの値は"+i+"ですが、実際の和は"+s+"でした。")}!function(t){t[t.CHECK=0]="CHECK",t[t.VERSION=2]="VERSION",t[t.OLD_MAP_COUNT=3]="OLD_MAP_COUNT",t[t.OLD_OBJ_COUNT=4]="OLD_OBJ_COUNT",t[t.OLD_PLAYER_X=5]="OLD_PLAYER_X",t[t.OLD_PLAYER_Y=6]="OLD_PLAYER_Y",t[t.STATUS_ENERGY=10]="STATUS_ENERGY",t[t.STATUS_STRENGTH=12]="STATUS_STRENGTH",t[t.STATUS_DEFENCE=14]="STATUS_DEFENCE",t[t.STATUS_GOLD=16]="STATUS_GOLD",t[t.OLD_GAMEOVER_X=18]="OLD_GAMEOVER_X",t[t.OLD_GAMEOVER_Y=19]="OLD_GAMEOVER_Y",t[t.OLD_ITEMBOX_TOP=20]="OLD_ITEMBOX_TOP",t[t.STATUS_ENERGY_MAX=32]="STATUS_ENERGY_MAX",t[t.MAP_COUNT=34]="MAP_COUNT",t[t.OBJ_COUNT=36]="OBJ_COUNT",t[t.PLAYER_X=38]="PLAYER_X",t[t.PLAYER_Y=40]="PLAYER_Y",t[t.GAMEOVER_X=42]="GAMEOVER_X",t[t.GAMEOVER_Y=44]="GAMEOVER_Y",t[t.MAP_SIZE=46]="MAP_SIZE",t[t.MESSAGE_NUM=48]="MESSAGE_NUM",t[t.ITEMBOX_TOP=60]="ITEMBOX_TOP",t[t.MAPDATA_TOP=90]="MAPDATA_TOP",t[t.OLD_MAPDATA_TOP=100]="OLD_MAPDATA_TOP"}(kt||(kt={}));var Qt,zt,qt=function(){function t(){}return t.ITEMBOX_SIZE=12,t.MAP_ATR_MAX=60,t.OBJ_ATR_MAX=60,t.OLD_MAP_ATR_MAX=40,t.OLD_OBJ_ATR_MAX=40,t.ATR_CROP1=1,t.ATR_CROP2=2,t.ATR_TYPE=3,t.ATR_JUMP_X=16,t.ATR_JUMP_Y=17,t.MAP_LOCALGATE=2,t.OBJECT_LOCALGATE=18,t.SYSTEM_MESSAGE_NUM=20,t.IMGPOS_DEFAULT_YESNO_X=3,t.IMGPOS_DEFAULT_YESNO_Y=1,t.IMGPOS_DEFAULT_PLAYER_X=2,t.IMGPOS_DEFAULT_PLAYER_Y=0,t.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_X=0,t.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_Y=0,t.IMGPOS_DEFAULT_STATUS_X=3,t.IMGPOS_DEFAULT_STATUS_Y=2,t.IMGRELPOS_ENERGY_ICON_X=0,t.IMGRELPOS_STRENGTH_ICON_X=1,t.IMGRELPOS_DEFENCE_ICON_X=2,t.IMGRELPOS_GOLD_ICON_X=3,t.IMGPOS_DEFAULT_WIDE_CELL_X=4,t.IMGPOS_DEFAULT_WIDE_CELL_Y=3,t.IMGPOS_DEFAULT_ITEMBOX_X=1,t.IMGPOS_DEFAULT_ITEMBOX_Y=2,t.IMGPOS_DEFAULT_FRAME_X=0,t.IMGPOS_DEFAULT_FRAME_Y=1,t.IMGPOS_DEFAULT_BATTLE_EFFECT_X=3,t.IMGPOS_DEFAULT_BATTLE_EFFECT_Y=3,t.DEFAULT_DISABLE_SAVE=!1,t.DEFAULT_OLDMAP=!1,t.DEFAULT_OBJECT_NO_COLLAPSE=!1,t.DEFAULT_FRAME_COLOR_R=255,t.DEFAULT_FRAME_COLOR_G=255,t.DEFAULT_FRAME_COLOR_B=255,t.DEFAULT_FRAMEOUT_COLOR_R=96,t.DEFAULT_FRAMEOUT_COLOR_G=96,t.DEFAULT_FRAMEOUT_COLOR_B=96,t.DEFAULT_STR_COLOR_R=0,t.DEFAULT_STR_COLOR_G=0,t.DEFAULT_STR_COLOR_B=0,t.DEFAULT_STATUS_COLOR_R=0,t.DEFAULT_STATUS_COLOR_G=0,t.DEFAULT_STATUS_COLOR_B=0,t.DEFAULT_MOVES=0,t}();!function(t){t[t.MAP=1]="MAP",t[t.OBJECT=0]="OBJECT"}(Qt||(Qt={})),function(t){t[t.INIT=0]="INIT",t[t.MAP_LOAD=1]="MAP_LOAD",t[t.OBJ_LOAD=2]="OBJ_LOAD",t[t.MAP_ATTR=3]="MAP_ATTR",t[t.OBJ_ATTR=4]="OBJ_ATTR",t[t.RAND_PARTS=5]="RAND_PARTS",t[t.MESSAGE=6]="MESSAGE"}(zt||(zt={}));var $t=function(){function t(t,e,i){this.byteMapData=t,this.eventEmitter=i,Zt(t,e),this.wwaData={version:void 0,gameoverX:void 0,gameoverY:void 0,playerX:void 0,playerY:void 0,mapPartsMax:void 0,objPartsMax:void 0,isOldMap:void 0,statusEnergyMax:void 0,statusEnergy:void 0,statusStrength:void 0,statusDefence:void 0,statusGold:void 0,itemBox:void 0,mapWidth:void 0,messageNum:void 0,map:void 0,mapObject:void 0,mapCompressed:void 0,mapObjectCompressed:void 0,mapAttribute:void 0,objectAttribute:void 0,worldPassword:void 0,message:void 0,worldName:void 0,worldPassNumber:void 0,charCGName:void 0,mapCGName:void 0,systemMessage:void 0,moves:void 0,yesnoImgPosX:void 0,yesnoImgPosY:void 0,playerImgPosX:void 0,playerImgPosY:void 0,clickableItemSignImgPosX:void 0,clickableItemSignImgPosY:void 0,disableSaveFlag:void 0,compatibleForOldMapFlag:void 0,objectNoCollapseDefaultFlag:void 0,delPlayerFlag:void 0,bgm:void 0,effectCoords:void 0,effectWaits:void 0,imgStatusEnergyX:void 0,imgStatusEnergyY:void 0,imgStatusStrengthX:void 0,imgStatusStrengthY:void 0,imgStatusDefenceX:void 0,imgStatusDefenceY:void 0,imgStatusGoldX:void 0,imgStatusGoldY:void 0,imgWideCellX:void 0,imgWideCellY:void 0,imgItemboxX:void 0,imgItemboxY:void 0,imgFrameX:void 0,imgFrameY:void 0,imgBattleEffectX:void 0,imgBattleEffectY:void 0,imgClickX:void 0,imgClickY:void 0,frameColorR:void 0,frameColorG:void 0,frameColorB:void 0,frameOutColorR:void 0,frameOutColorG:void 0,frameOutColorB:void 0,fontColorR:void 0,fontColorG:void 0,fontColorB:void 0,statusColorR:void 0,statusColorG:void 0,statusColorB:void 0,checkOriginalMapString:void 0,checkString:void 0,isItemEffectEnabled:void 0,frameCount:void 0,gamePadButtonItemTable:void 0}}return t.prototype.extractAllData=function(){var t,e;return this.wwaData.version=this.byteMapData[kt.VERSION],this._extractInitialParameters(),this.wwaData.version>=29?this.currentPosition=kt.MAPDATA_TOP:this.currentPosition=kt.OLD_MAPDATA_TOP,this.wwaData.map=this._getFieldDataFromBits(Qt.MAP,this.wwaData.mapPartsMax).concat(),this.wwaData.mapObject=this._getFieldDataFromBits(Qt.OBJECT,this.wwaData.objPartsMax).concat(),t=this.wwaData.version>29?qt.MAP_ATR_MAX:qt.OLD_MAP_ATR_MAX,e=this.wwaData.version>29?qt.OBJ_ATR_MAX:qt.OLD_OBJ_ATR_MAX,this.wwaData.mapAttribute=this._getPartsDataFromBits(Qt.MAP,this.wwaData.mapPartsMax,t).concat(),this.wwaData.objectAttribute=this._getPartsDataFromBits(Qt.OBJECT,this.wwaData.objPartsMax,e).concat(),this.wwaData.version<=29&&(this._convertAttributeV2toV3(Qt.MAP),this._convertAttributeV2toV3(Qt.OBJECT)),this._replaceAllRandomObjects(),this.wwaData},t.prototype._convertAttributeV2toV3=function(t){var e,i,s;if(t==Qt.MAP)e=this.wwaData.mapPartsMax,i=this.wwaData.mapAttribute,s=qt.MAP_LOCALGATE;else{if(t!=Qt.OBJECT)throw new Error("謎のパーツ種別が指定されました");e=this.wwaData.objPartsMax,i=this.wwaData.objectAttribute,s=qt.OBJECT_LOCALGATE}for(var a=0;a<e;a++){for(var o=9;o>=0;o--){var r=255&i[a][20+2*o],n=i[a][20+2*o]>>8,_=255&i[a][20+2*o+1],h=i[a][20+2*o+1]>>8;250===_?_=9e3:_>100&&(_+=9840),250===h?h=9e3:h>100&&(h+=9840),i[a][20+4*o]=r,i[a][20+4*o+3]=n,i[a][20+4*o+1]=_,i[a][20+4*o+2]=h}i[a][qt.ATR_TYPE]===s&&(i[a][qt.ATR_JUMP_X]>100&&(i[a][qt.ATR_JUMP_X]+=9840),i[a][qt.ATR_JUMP_Y]>100&&(i[a][qt.ATR_JUMP_Y]+=9840))}},t.prototype._get1ByteNumber=function(t){return this.byteMapData[t]},t.prototype._get2BytesNumber=function(t){return this.byteMapData[t]+256*this.byteMapData[t+1]},t.prototype._extractInitialParameters=function(){this.wwaData.version>29?(this.wwaData.gameoverX=this._get2BytesNumber(kt.GAMEOVER_X),this.wwaData.gameoverY=this._get2BytesNumber(kt.GAMEOVER_Y),this.wwaData.playerX=this._get2BytesNumber(kt.PLAYER_X),this.wwaData.playerY=this._get2BytesNumber(kt.PLAYER_Y),this.wwaData.mapPartsMax=this._get2BytesNumber(kt.MAP_COUNT),this.wwaData.objPartsMax=this._get2BytesNumber(kt.OBJ_COUNT),this.wwaData.isOldMap=!1):(this.wwaData.gameoverX=this._get1ByteNumber(kt.OLD_GAMEOVER_X),this.wwaData.gameoverY=this._get1ByteNumber(kt.OLD_GAMEOVER_Y),this.wwaData.playerX=this._get1ByteNumber(kt.OLD_PLAYER_X),this.wwaData.playerY=this._get1ByteNumber(kt.OLD_PLAYER_Y),this.wwaData.mapPartsMax=this._get1ByteNumber(kt.OLD_MAP_COUNT),this.wwaData.objPartsMax=this._get1ByteNumber(kt.OLD_OBJ_COUNT),this.wwaData.isOldMap=!0),this.wwaData.statusEnergyMax=this._get2BytesNumber(kt.STATUS_ENERGY_MAX),this.wwaData.statusEnergy=this._get2BytesNumber(kt.STATUS_ENERGY),this.wwaData.statusStrength=this._get2BytesNumber(kt.STATUS_STRENGTH),this.wwaData.statusDefence=this._get2BytesNumber(kt.STATUS_DEFENCE),this.wwaData.statusGold=this._get2BytesNumber(kt.STATUS_GOLD),this._extractInitialItemData(),this.wwaData.mapWidth=this._get2BytesNumber(kt.MAP_SIZE),this.wwaData.messageNum=this._get2BytesNumber(kt.MESSAGE_NUM),this.wwaData.version<28?this.wwaData.mapWidth=71:this.wwaData.version<=29&&(this.wwaData.mapWidth=101)},t.prototype._extractInitialItemData=function(){var t=this.wwaData.version>29?kt.ITEMBOX_TOP:kt.OLD_ITEMBOX_TOP;this.wwaData.itemBox=new Array(qt.ITEMBOX_SIZE);for(var e=0;e<qt.ITEMBOX_SIZE;e++)this.wwaData.itemBox[e]=this._get1ByteNumber(t+e)},t.prototype._getFieldDataFromBits=function(t,e){var i,s,a;for(a=Vt(this.wwaData.mapWidth,this.wwaData.mapWidth),i=0;i<this.wwaData.mapWidth;i++)for(s=0;s<this.wwaData.mapWidth;s++)this.wwaData.version>29?(a[i][s]=this._get2BytesNumber(this.currentPosition),this.currentPosition+=2):(a[i][s]=this._get1ByteNumber(this.currentPosition),this.currentPosition+=1),(i*this.wwaData.mapWidth+s)%200==0&&this.emitProgress(i*this.wwaData.mapWidth+s,this.wwaData.mapWidth*this.wwaData.mapWidth,t===Qt.MAP?zt.MAP_LOAD:zt.OBJ_LOAD),a[i][s]>=e&&(a[i][s]=0);return this.emitProgress(this.wwaData.mapWidth*this.wwaData.mapWidth,this.wwaData.mapWidth*this.wwaData.mapWidth,t===Qt.MAP?zt.MAP_LOAD:zt.OBJ_LOAD),a},t.prototype._getPartsDataFromBits=function(t,e,i){var s,a,o;for(o=Vt(e,i),s=0;s<e;s++)for(a=0;a<i;a++)(s*this.wwaData.mapWidth+a)%200==0&&this.emitProgress(s*i+a,e*i,t===Qt.MAP?zt.MAP_ATTR:zt.OBJ_ATTR),a!==qt.ATR_CROP1&&a!==qt.ATR_CROP2?(o[s][a]=this._get2BytesNumber(this.currentPosition),this.currentPosition+=2):(o[s][a]=0,this.currentPosition+=2);return this.emitProgress(e*i,e*i,t===Qt.MAP?zt.MAP_ATTR:zt.OBJ_ATTR),o},t.prototype._replaceAllRandomObjects=function(){this.emitProgress(this.wwaData.mapWidth*this.wwaData.mapWidth,this.wwaData.mapWidth*this.wwaData.mapWidth,zt.RAND_PARTS)},t.prototype.emitProgress=function(t,e,i){this.eventEmitter.dispatch("progress",{current:t,total:e,stage:i})},t}();var te=function(){function t(t,e,i,s){this.wwaData=t,this.compressedMapData=e,this.startPosition=i,this.eventEmitter=s,this.OLDVER_MESSAGE_MAX=400}return t.prototype.load=function(){var t=this.wwaData;this.currentPos=this.startPosition,t.version>=30&&(t.worldPassword=this.getMessageFromData()),t.version<=29&&(t.messageNum=this.OLDVER_MESSAGE_MAX),t.message=new Array(t.messageNum);for(var e=0;e<t.message.length;e++)t.message[e]=this.getMessageFromData(),e%200==0&&this.eventEmitter.dispatch("progress",{current:e,total:t.message.length,stage:zt.MESSAGE});for(;t.messageNum<10;)t.message.push(""),t.messageNum++;this.eventEmitter.dispatch("progress",{current:t.message.length,total:t.message.length,stage:zt.MESSAGE}),t.worldName=this.getMessageFromData(),t.version<=29?t.worldPassword=this.getMessageFromData():this.getMessageFromData(),""===t.worldPassword?t.worldPassNumber=0:t.version>=29?t.worldPassNumber=(parseInt(t.worldPassword)/10-1197)/17-2357:t.worldPassNumber=parseInt(t.worldPassword),t.charCGName=this.getMessageFromData(),t.mapCGName=this.getMessageFromData(),t.systemMessage=new Array(qt.SYSTEM_MESSAGE_NUM);for(e=0;e<qt.SYSTEM_MESSAGE_NUM;e++)t.version>=30?t.systemMessage[e]=this.getMessageFromData():t.systemMessage[e]="";return t.yesnoImgPosX=qt.IMGPOS_DEFAULT_YESNO_X,t.yesnoImgPosY=qt.IMGPOS_DEFAULT_YESNO_Y,t.playerImgPosX=qt.IMGPOS_DEFAULT_PLAYER_X,t.playerImgPosY=qt.IMGPOS_DEFAULT_PLAYER_Y,t.clickableItemSignImgPosX=qt.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_X,t.clickableItemSignImgPosY=qt.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_Y,t.disableSaveFlag=qt.DEFAULT_DISABLE_SAVE,t.isOldMap=qt.DEFAULT_OLDMAP,t.objectNoCollapseDefaultFlag=qt.DEFAULT_OBJECT_NO_COLLAPSE,t.delPlayerFlag=!1,t.bgm=0,t.effectCoords=[],t.effectWaits=0,t.imgStatusEnergyX=qt.IMGPOS_DEFAULT_STATUS_X+qt.IMGRELPOS_ENERGY_ICON_X,t.imgStatusEnergyY=qt.IMGPOS_DEFAULT_STATUS_Y,t.imgStatusStrengthX=qt.IMGPOS_DEFAULT_STATUS_X+qt.IMGRELPOS_STRENGTH_ICON_X,t.imgStatusStrengthY=qt.IMGPOS_DEFAULT_STATUS_Y,t.imgStatusDefenceX=qt.IMGPOS_DEFAULT_STATUS_X+qt.IMGRELPOS_DEFENCE_ICON_X,t.imgStatusDefenceY=qt.IMGPOS_DEFAULT_STATUS_Y,t.imgStatusGoldX=qt.IMGPOS_DEFAULT_STATUS_X+qt.IMGRELPOS_GOLD_ICON_X,t.imgStatusGoldY=qt.IMGPOS_DEFAULT_STATUS_Y,t.imgWideCellX=qt.IMGPOS_DEFAULT_WIDE_CELL_X,t.imgWideCellY=qt.IMGPOS_DEFAULT_WIDE_CELL_Y,t.imgItemboxX=qt.IMGPOS_DEFAULT_ITEMBOX_X,t.imgItemboxY=qt.IMGPOS_DEFAULT_ITEMBOX_Y,t.imgFrameX=qt.IMGPOS_DEFAULT_FRAME_X,t.imgFrameY=qt.IMGPOS_DEFAULT_FRAME_Y,t.imgBattleEffectX=qt.IMGPOS_DEFAULT_BATTLE_EFFECT_X,t.imgBattleEffectY=qt.IMGPOS_DEFAULT_BATTLE_EFFECT_Y,t.imgClickX=0,t.imgClickY=0,t.frameColorR=qt.DEFAULT_FRAME_COLOR_R,t.frameColorG=qt.DEFAULT_FRAME_COLOR_G,t.frameColorB=qt.DEFAULT_FRAME_COLOR_B,t.frameOutColorR=qt.DEFAULT_FRAMEOUT_COLOR_R,t.frameOutColorG=qt.DEFAULT_FRAMEOUT_COLOR_G,t.frameOutColorB=qt.DEFAULT_FRAMEOUT_COLOR_B,t.fontColorR=qt.DEFAULT_STR_COLOR_R,t.fontColorG=qt.DEFAULT_STR_COLOR_G,t.fontColorB=qt.DEFAULT_STR_COLOR_B,t.statusColorR=qt.DEFAULT_STATUS_COLOR_R,t.statusColorG=qt.DEFAULT_STATUS_COLOR_G,t.statusColorB=qt.DEFAULT_STATUS_COLOR_B,t.moves=qt.DEFAULT_MOVES,t},t.prototype.getMessageFromData=function(){var t="",e=0;for(e=0;e<1500&&(0!=this.compressedMapData[this.currentPos+2*e]||0!=this.compressedMapData[this.currentPos+2*e+1]);e++)t+=String.fromCharCode((this.compressedMapData[this.currentPos+2*e+1]<<8)+this.compressedMapData[this.currentPos+2*e]);return this.currentPos+=2*e+2,t},t}(),ee=function(){function t(t){this.fileName=t}return t.prototype.request=function(t){var e=this,i=new XMLHttpRequest;try{i.open("GET",this.fileName,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){try{if(i.readyState===XMLHttpRequest.DONE){if(200!==i.status&&304!==i.status)throw 404===i.status?new Error("マップデータ「"+e.fileName+"」が見つかりませんでした。\nHTTPステータスコードは "+i.status+"です。"):403===i.status?new Error("マップデータ「"+e.fileName+"」を読み取る権限がないようです。\n管理者の方へ: マップデータのパーミッションを確認してください。\nHTTPステータスコードは "+i.status+"です。"):new Error("マップデータ「"+e.fileName+"」の読み込みに失敗しました。\nHTTPステータスコードは "+i.status+"です。");t(void 0,i.response)}}catch(e){t(e)}},i.send(null)}catch(e){t(new Error("ロードエラー: ローカルテストの場合は、ブラウザが対応していない可能性があります。\n"+e.message))}},t}(),ie=function(){function t(t,e){this.fileName=t,this.eventEmitter=e}return t.prototype.requestAndLoadMapData=function(){var t=this;new ee(this.fileName).request((function(e,i){if(e){var s=e.name||"",a=e.message||"";t.eventEmitter.dispatch("error",{name:s,message:a})}else if(i){var o=t.loadMapData(i);t.eventEmitter.dispatch("mapData",o)}else t.eventEmitter.dispatch("error",{name:"マップデータ取得に失敗しました",message:"mapdata is empty"})}))},t.prototype.loadMapData=function(t){try{var e=new Uint8Array(t),i=function(t){var e,i,s=new Uint8Array(t.length);for(e=0,i=0;e<t.length&&(0!==t[e]||0!==t[e+1]||0!==t[e+2]);e++){if(s[i++]=t[e],t[e]===t[e+1]){for(var a=t[e+2],o=0;o<a;o++)s[i++]=t[e];e+=2}if(i+255>=s.length){var r=new Uint8Array(s.length+65e3);r.set(s),s=r}}return console.log("EXTRACT DATA = "+i+" "+e),{byteMapData:s,byteMapLength:i,compressedEndPosition:e+3}}(e),s=i.byteMapData,a=i.byteMapLength,o=i.compressedEndPosition,r=new $t(s,a,this.eventEmitter).extractAllData();return new te(r,e,o,this.eventEmitter).load()}catch(t){throw t}},t}(),se=function(){function t(t){this.target=null!=t?t:document.createElement("div")}return t.prototype.dispatch=function(t,e){var i;"function"==typeof window.CustomEvent?i=new CustomEvent(t,{detail:e}):(i=document.createEvent("CustomEvent")).initCustomEvent(t,!1,!1,e),this.target.dispatchEvent(i)},t.prototype.addListener=function(t,e){var i=function(t){return e(t.detail)};return this.target.addEventListener(t,i),i},t.prototype.removeListener=function(t,e){this.target.removeEventListener(t,e)},t}();function ae(t,e,i){var s=new q;return s.current=t,s.total=e,s.stage=i,s}var oe=function(){function t(t,e,i,r,h,l,E){var m,f=this;void 0===e&&(e=!1),void 0===E&&(E=""),this._useLookingAround=!0,this.audioExtension="",this.soundLoadedCheckTimer=void 0,this.mainCaller=function(){return f._main()},this.soundCheckCaller=function(){return f.checkAllSoundLoaded()},this._checkTurnKeyPressed=function(){return f._keyStore.checkHitKey(a.KEY_ESC)||f._keyStore.checkHitKey(a.KEY_SHIFT)||f._keyStore.checkHitKey(a.KEY_N)},this._saveDataList=[],window.addEventListener("click",(function(t){f._isActive=!1})),_t("wwa-wrapper").addEventListener("click",(function(t){t.stopPropagation(),f._isActive=!0})),this._isActive=!0,null===i?(this._hasTitleImg=!1,this._cvsCover=_t("progress-panel"),(m=this._cvsCover.getContext("2d")).fillStyle="rgb(0, 0, 0)"):this._hasTitleImg=!0;try{this._hasTitleImg?_t("version").textContent="WWA Wing Ver.3.4.2":this._setLoadingMessage(m,0)}catch(t){}var I=window.AudioContext||window.webkitAudioContext;I&&(this.audioContext=new I,this.audioGain=this.audioContext.createGain(),this.audioGain.gain.setValueAtTime(1,this.audioContext.currentTime));var T=new Audio;"no"!==T.canPlayType("audio/mpeg")&&""!==T.canPlayType("audio/mpeg")?this.audioExtension="mp3":this.audioExtension="m4a",this.userDevice=new U,this._isURLGateEnable=e,this._isClassicModeEnable=r,this._mainCallCounter=0,this._animationCounter=0,this._statusPressCounter=new y(0,0,0,0),E?"/"!==E[E.length-1]&&(E+="/"):E="./audio/",this._audioDirectory=E,this._bottomButtonType=l?u.GOTO_WWA:u.BATTLE_REPORT;var S=(new Date).getTime();if(!!location.href.match(/^file/))switch(this.userDevice.device){case N.GAME:switch(this.userDevice.os){case P.NINTENDO:Q.BATTLE_INTERVAL_FRAME_NUM=5}this._bottomButtonType=u.GAME_END;break;default:alert("【警告】直接HTMLファイルを開いているようです。\nこのプログラムは正常に動作しない可能性があります。\nマップデータの確認を行う場合には同梱の「wwa-server.exe」をご利用ください。\n"+(this.userDevice.browser===M.FIREFOX?"Firefoxの場合も、バージョン68以降はローカルのHTMLファイルを直接開いた場合、通常起動できないことを確認しております。":""))}switch(this.userDevice.device){case N.VR:case N.GAME:this._usePassword=!1;break;default:this._usePassword=!0}switch(_t("cell-save").textContent=z.QUICK_SAVE,this._usePassword?_t("cell-load").textContent=z.PASSWORD:_t("cell-load").textContent=z.EMPTY_LOAD,this._bottomButtonType){case u.GOTO_WWA:_t("cell-gotowwa").textContent=z.GOTO_WWA;break;case u.BATTLE_REPORT:_t("cell-gotowwa").textContent=z.BATTLE_REPORT;break;case u.GAME_END:_t("cell-gotowwa").textContent=z.GAME_END}this._loadHandler=function(t){f._wwaData=t,f._wwaData.isItemEffectEnabled=h;try{f._hasTitleImg?_t("version").textContent+=" (Map data Ver. "+Math.floor(f._wwaData.version/10)+"."+ +f._wwaData.version%10+")":f._setLoadingMessage(m,1)}catch(t){}var e=_t("wwa-wrapper").getAttribute("data-wwa-mapdata").split("/");e.pop(),e.push(f._wwaData.mapCGName),f._wwaData.mapCGName=e.join("/"),f.initCSSRule(),f._setProgressBar(ae(0,4,J.GAME_INIT)),f._setLoadingMessage(m,2);var i=new Image;i.src=f._wwaData.mapCGName,i.addEventListener("error",(function(){f._setErrorMessage("画像ファイル「"+f._wwaData.mapCGName+"」が見つかりませんでした。\n管理者の方へ: データがアップロードされているか、\nパーミッションを確かめてください。",m)})),f._restartData=JSON.parse(JSON.stringify(f._wwaData));var r=f._wwaData.mapCGName.replace("(","\\(").replace(")","\\)"),l=function(t){t.style.backgroundImage="url("+r+")"};Array.prototype.forEach.call(ct("div.item-cell"),(function(t){t.style.backgroundPosition="-"+f._wwaData.imgItemboxX*Q.CHIP_SIZE+"px -"+f._wwaData.imgItemboxY*Q.CHIP_SIZE+"px",t.style.backgroundImage="url("+r+")"})),Array.prototype.forEach.call(ct("div.wide-cell-row"),(function(t){t.style.backgroundPosition="-160px -120px",t.style.backgroundImage="url("+r+")"})),Array.prototype.forEach.call(ct(".item-cell>.item-click-border"),(function(t){t.style.backgroundImage="url('"+Q.ITEM_BORDER_IMG_DATA_URL+"')",t.style.backgroundPosition="0 0",t.style.display="none",t.style.cursor="pointer"})),Array.prototype.forEach.call(ct(".item-cell>.item-disp"),l),Array.prototype.forEach.call(ct("div.wide-cell-row>.status-icon"),l),f.setStatusIconCoord(K.ENERGY,new g(f._wwaData.imgStatusEnergyX,f._wwaData.imgStatusEnergyY)),f.setStatusIconCoord(K.STRENGTH,new g(f._wwaData.imgStatusStrengthX,f._wwaData.imgStatusStrengthY)),f.setStatusIconCoord(K.DEFENCE,new g(f._wwaData.imgStatusDefenceX,f._wwaData.imgStatusDefenceY)),f.setStatusIconCoord(K.GOLD,new g(f._wwaData.imgStatusGoldX,f._wwaData.imgStatusGoldY)),f._setProgressBar(ae(1,4,J.GAME_INIT)),f._setLoadingMessage(m,3),f._mapIDTableCreate(),f._replaceAllRandomObjects();var u=(new Date).getTime();console.log("Loading Complete!"+(u-S)+"ms"),f._cvs=_t("wwa-map"),f._cvsSub=_t("wwa-map-sub");var E=f._cvs.getContext("2d"),I=f._cvsSub.getContext("2d");E.fillStyle="rgba( 255, 255, 255, 0.5)",E.fillRect(0,0,440,440);var T=new w(f,f._wwaData.playerX,f._wwaData.playerY);f._camera=new mt(T),f._itemMenu=new Gt;var O=new y(f._wwaData.statusEnergy,f._wwaData.statusStrength,f._wwaData.statusDefence,f._wwaData.statusGold);f._player=new ft(f,T,f._camera,O,f._wwaData.statusEnergyMax,f._wwaData.moves),f._objectMovingDataManager=new Tt(f,f._player),f._camera.setPlayer(f._player),f._keyStore=new n,f._mouseStore=new c,f._gamePadStore=new p,f._messageQueue=[],f._yesNoJudge=A.UNSELECTED,f._yesNoJudgeInNextFrame=A.UNSELECTED,f._yesNoChoiceCallInfo=R.NONE,f._prevFrameEventExected=!1,f._lastMessage=new Ot("",!1,!1,[]),f._execMacroListInNextFrame=[],f._passwordLoadExecInNextFrame=!1,f._messageWindow=new bt(f,50,180,340,0,"",f._wwaData.mapCGName,!1,!0,!1,_t("wwa-wrapper")),f._scoreWindow=new Mt(f,new g(50,50),!1,_t("wwa-wrapper")),f.clearFaces();var C=_t("wwa-wrapper").getAttribute("data-wwa-looking-around");if(f._useLookingAround=!(C&&C.match(/false/i)),f._setProgressBar(ae(2,4,J.GAME_INIT)),f._setLoadingMessage(m,4),window.addEventListener("keydown",(function(t){if(f._isActive){switch(f.userDevice.os){case P.NINTENDO:return t.preventDefault(),void t.stopPropagation()}f._keyStore.setPressInfo(t.keyCode),t.keyCode!==a.KEY_F5?f._player.isWaitingMessage()?t.keyCode!==a.KEY_DOWN&&t.keyCode!==a.KEY_LEFT&&t.keyCode!==a.KEY_RIGHT&&t.keyCode!==a.KEY_UP&&t.keyCode!==a.KEY_SHIFT&&t.keyCode!==a.KEY_ENTER&&t.keyCode!==a.KEY_ESC&&t.keyCode!==a.KEY_SPACE||t.preventDefault():f._player.isWaitingPasswordWindow()||t.keyCode!==a.KEY_DOWN&&t.keyCode!==a.KEY_LEFT&&t.keyCode!==a.KEY_RIGHT&&t.keyCode!==a.KEY_UP&&t.keyCode!==a.KEY_SHIFT&&t.keyCode!==a.KEY_ENTER&&t.keyCode!==a.KEY_1&&t.keyCode!==a.KEY_2&&t.keyCode!==a.KEY_3&&t.keyCode!==a.KEY_A&&t.keyCode!==a.KEY_C&&t.keyCode!==a.KEY_D&&t.keyCode!==a.KEY_E&&t.keyCode!==a.KEY_M&&t.keyCode!==a.KEY_N&&t.keyCode!==a.KEY_Q&&t.keyCode!==a.KEY_S&&t.keyCode!==a.KEY_W&&t.keyCode!==a.KEY_X&&t.keyCode!==a.KEY_Y&&t.keyCode!==a.KEY_Z&&t.keyCode!==a.KEY_ESC&&t.keyCode!==a.KEY_F1&&t.keyCode!==a.KEY_F2&&t.keyCode!==a.KEY_F3&&t.keyCode!==a.KEY_F4&&t.keyCode!==a.KEY_F6&&t.keyCode!==a.KEY_F7&&t.keyCode!==a.KEY_F8&&t.keyCode!==a.KEY_F12&&t.keyCode!==a.KEY_SPACE||t.preventDefault():t.preventDefault()}})),window.addEventListener("keyup",(function(t){if(f._isActive){switch(f.userDevice.os){case P.NINTENDO:return t.preventDefault(),void t.stopPropagation()}f._keyStore.setReleaseInfo(t.keyCode),t.keyCode===a.KEY_F5?t.preventDefault():t.keyCode!==a.KEY_DOWN&&t.keyCode!==a.KEY_LEFT&&t.keyCode!==a.KEY_RIGHT&&t.keyCode!==a.KEY_UP&&t.keyCode!==a.KEY_SHIFT&&t.keyCode!==a.KEY_ENTER&&t.keyCode!==a.KEY_1&&t.keyCode!==a.KEY_2&&t.keyCode!==a.KEY_3&&t.keyCode!==a.KEY_A&&t.keyCode!==a.KEY_C&&t.keyCode!==a.KEY_D&&t.keyCode!==a.KEY_E&&t.keyCode!==a.KEY_M&&t.keyCode!==a.KEY_N&&t.keyCode!==a.KEY_Q&&t.keyCode!==a.KEY_S&&t.keyCode!==a.KEY_W&&t.keyCode!==a.KEY_X&&t.keyCode!==a.KEY_Y&&t.keyCode!==a.KEY_Z&&t.keyCode!==a.KEY_ESC&&t.keyCode!==a.KEY_F1&&t.keyCode!==a.KEY_F3&&t.keyCode!==a.KEY_F4&&t.keyCode!==a.KEY_F6&&t.keyCode!==a.KEY_F7&&t.keyCode!==a.KEY_F8&&t.keyCode!==a.KEY_F9&&t.keyCode!==a.KEY_F12&&t.keyCode!==a.KEY_SPACE||f._player.isWaitingMessage()||f._player.isWaitingPasswordWindow()||t.preventDefault()}})),window.addEventListener("blur",(function(t){f._keyStore.allClear(),f._mouseStore.clear()})),window.addEventListener("contextmenu",(function(t){f._keyStore.allClear(),f._mouseStore.clear()})),window.addEventListener("help",(function(t){f._isActive&&t.preventDefault()})),f._mouseControllerElement=_t("wwa-controller"),f._mouseControllerElement.addEventListener("mousedown",(function(t){if(f._isActive&&1===t.which){if(f._mouseStore.getMouseState()!==o.NONE)return void t.preventDefault();var e=lt(t.clientX,t.clientY),i=f._player.getDrawingCenterPosition(),s=e.substract(i),a=Math.abs(s.x),r=Math.abs(s.y),n=void 0,_=!1;if(a<Q.CHIP_SIZE&&r<Q.CHIP_SIZE){switch(i.x/Q.CHIP_SIZE|0){case 0:_=!0,n=d.LEFT;break;case Q.H_PARTS_NUM_IN_WINDOW-1:_=!0,n=d.RIGHT}switch(i.y/Q.CHIP_SIZE|0){case 0:_=!0,n=d.UP;break;case Q.V_PARTS_NUM_IN_WINDOW-1:_=!0,n=d.DOWN}}_||(s.y>0&&r>a?n=d.DOWN:s.y<0&&r>a?n=d.UP:s.x>0&&r<a?n=d.RIGHT:s.x<0&&r<a&&(n=d.LEFT)),f._mouseStore.setPressInfo(n,0)}})),f._mouseControllerElement.addEventListener("mouseleave",(function(t){f._mouseStore.clear()})),f._mouseControllerElement.addEventListener("mouseup",(function(t){f._isActive&&1===t.which&&(f._mouseStore.setReleaseInfo(),t.preventDefault())})),window.TouchEvent){if(f.audioContext){var D=function(){f.audioContext.createBufferSource().start(0),f._mouseControllerElement.removeEventListener("touchstart",D),D=null};f._mouseControllerElement.addEventListener("touchstart",D)}f._mouseControllerElement.addEventListener("touchstart",(function(t){if(f._isActive)if(f._mouseStore.getMouseState()===o.NONE){for(var e=t.changedTouches,i=e.length,s=0;s<i;s++){var a=e[s],r=lt(a.clientX,a.clientY),n=f._player.getDrawingCenterPosition(),_=r.substract(n),h=Math.abs(_.x),c=Math.abs(_.y),l=void 0,u=!1;if(h<Q.CHIP_SIZE&&c<Q.CHIP_SIZE){switch(n.x/Q.CHIP_SIZE|0){case 0:u=!0,l=d.LEFT;break;case Q.H_PARTS_NUM_IN_WINDOW-1:u=!0,l=d.RIGHT}switch(n.y/Q.CHIP_SIZE|0){case 0:u=!0,l=d.UP;break;case Q.V_PARTS_NUM_IN_WINDOW-1:u=!0,l=d.DOWN}}u||(_.y>0&&c>h?l=d.DOWN:_.y<0&&c>h?l=d.UP:_.x>0&&c<h?l=d.RIGHT:_.x<0&&c<h&&(l=d.LEFT)),f._mouseStore.setPressInfo(l,a.identifier)}t.cancelable&&t.preventDefault()}else t.preventDefault()}));var v=function(t){if(f._isActive)for(var e=0;e<t.changedTouches.length;e++)if(f._mouseStore.getTouchID()===t.changedTouches[e].identifier){f._mouseStore.setReleaseInfo(),t.preventDefault();break}};f._mouseControllerElement.addEventListener("touchend",v),f._mouseControllerElement.addEventListener("touchcancel",v)}_t("button-load").addEventListener("click",(function(){(f._player.isControllable()||f._messageWindow.isItemMenuChoice())&&f.onselectbutton(b.QUICK_LOAD)})),_t("button-save").addEventListener("click",(function(){(f._player.isControllable()||f._messageWindow.isItemMenuChoice())&&f.onselectbutton(b.QUICK_SAVE)})),_t("button-restart").addEventListener("click",(function(){(f._player.isControllable()||f._messageWindow.isItemMenuChoice())&&f.onselectbutton(b.RESTART_GAME)})),_t("button-gotowwa").addEventListener("click",(function(){(f._player.isControllable()||f._messageWindow.isItemMenuChoice())&&f.onselectbutton(b.GOTO_WWA,!1,!1)})),Array.prototype.forEach.call(ct(".wide-cell-row"),(function(t){t.addEventListener("click",(function(){f._displayHelp()}))}));var M=new g(f._wwaData.imgFrameX,f._wwaData.imgFrameY);f._battleEstimateWindow=new xt(f,f._wwaData.mapCGName,_t("wwa-wrapper")),f._passwordWindow=new Yt(f,_t("wwa-wrapper")),f._monsterWindow=new Nt(f,new g(50,180),340,60,!1,_t("wwa-wrapper"),f._wwaData.mapCGName),f._setProgressBar(ae(3,4,J.GAME_INIT)),f._isLoadedSound=!1,f._temporaryInputDisable=!1,f._paintSkipByDoorOpen=!1,f._clearFacesInNextFrame=!1,f._useConsole=!1;var L=f;f._cgManager=new Et(E,I,f._wwaData.mapCGName,M,(function(){f._isSkippedSoundMessage=!0;var t=function(){switch(f.userDevice.device){case N.PC:f.setMessageQueue("ゲームを開始します。\n画面をクリックしてください。",!1,!0);break;case N.SP:f.setMessageQueue("ゲームを開始します。\n画面にふれてください。",!1,!0)}};if("ON"===f._wwaData.systemMessage[F.LOAD_SE])return f._isLoadedSound=!0,t(),f._setLoadingMessage(m,J.AUDIO),f.loadSound(),void window.requestAnimationFrame(f.soundCheckCaller);if("OFF"===f._wwaData.systemMessage[F.LOAD_SE])return f._isLoadedSound=!1,t(),void f.openGameWindow();if(f._isSkippedSoundMessage=!1,f._hasTitleImg||m.clearRect(0,0,Q.SCREEN_WIDTH,Q.SCREEN_HEIGHT),f._usePassword){f._messageWindow.setMessage(""===f._wwaData.systemMessage[F.LOAD_SE]?"効果音・ＢＧＭデータをロードしますか？":f._wwaData.systemMessage[F.LOAD_SE]),f._messageWindow.show(),f._setProgressBar(ae(4,4,J.GAME_INIT));var e=setInterval((function(){L._keyStore.update(),L._gamePadStore.update(),L._yesNoJudgeInNextFrame===A.UNSELECTED&&(L._keyStore.getKeyState(a.KEY_ENTER)===s.KEYDOWN||L._keyStore.getKeyState(a.KEY_Y)===s.KEYDOWN||L._gamePadStore.buttonTrigger(_.BUTTON_INDEX_A)?L._yesNoJudgeInNextFrame=A.YES:(L._keyStore.getKeyState(a.KEY_N)===s.KEYDOWN||L._keyStore.getKeyState(a.KEY_ESC)===s.KEYDOWN||L._gamePadStore.buttonTrigger(_.BUTTON_INDEX_B))&&(L._yesNoJudgeInNextFrame=A.NO)),L._yesNoJudgeInNextFrame===A.YES?(clearInterval(e),L._messageWindow.update(),L._yesNoJudge=L._yesNoJudgeInNextFrame,L._messageWindow.setInputDisable(),setTimeout((function(){L._player.setDelayFrame(),L._messageWindow.hide(),L._yesNoJudge=A.UNSELECTED,L._yesNoJudgeInNextFrame=A.UNSELECTED,L._isLoadedSound=!0,f._setLoadingMessage(m,J.AUDIO),L.loadSound(),window.requestAnimationFrame(f.soundCheckCaller)}),Q.YESNO_PRESS_DISP_FRAME_NUM*Q.DEFAULT_FRAME_INTERVAL)):L._yesNoJudgeInNextFrame===A.NO&&(clearInterval(e),L._messageWindow.update(),L._yesNoJudge=L._yesNoJudgeInNextFrame,L._messageWindow.setInputDisable(),setTimeout((function(){L._player.setDelayFrame(),L._messageWindow.hide(),L._yesNoJudge=A.UNSELECTED,L._yesNoJudgeInNextFrame=A.UNSELECTED,L._isLoadedSound=!1,L.openGameWindow()}),Q.YESNO_PRESS_DISP_FRAME_NUM*Q.DEFAULT_FRAME_INTERVAL))}),Q.DEFAULT_FRAME_INTERVAL)}else clearInterval(e),L._player.setDelayFrame(),L._messageWindow.hide(),L._yesNoJudge=A.UNSELECTED,L._yesNoJudgeInNextFrame=A.UNSELECTED,L._isLoadedSound=!0,L.loadSound(),window.requestAnimationFrame(f.soundCheckCaller)}))};var O=new se;O.addListener("mapData",(function(t){return f._loadHandler(t)})),O.addListener("progress",(function(t){return f._setProgressBar(t)})),O.addListener("error",(function(t){return f._setErrorMessage("下記のエラーが発生しました。: \n"+t.message,m)})),new ie(t,O).requestAndLoadMapData()}return t.prototype._setProgressBar=function(t){this._hasTitleImg&&(t.stage<=Q.LOAD_STAGE_MAX_EXCEPT_AUDIO?(_t("progress-message-container").textContent=t.stage===Q.LOAD_STAGE_MAX_EXCEPT_AUDIO?"World Name: "+this._wwaData.worldName:at[t.stage],_t("progress-bar").style.width=(1*t.stage+t.current/t.total*1)/(Q.LOAD_STAGE_MAX_EXCEPT_AUDIO+1)*Q.MAP_WINDOW_WIDTH+"px",_t("progress-disp").textContent=((1*t.stage+t.current/t.total*1)/(Q.LOAD_STAGE_MAX_EXCEPT_AUDIO+1)*100).toFixed(2)+"%"):(this._usePassword?_t("progress-message-container").textContent="効果音/BGMを読み込んでいます。(スペースキーでスキップ）":_t("progress-message-container").textContent="ゲームデータを読み込んでいます。",_t("progress-bar-audio").style.width=t.current*Q.MAP_WINDOW_WIDTH/t.total+"px",_t("progress-disp").textContent=(t.current/t.total*100).toFixed(2)+"%"))},t.prototype._setLoadingMessage=function(t,e){if(!this._hasTitleImg)if(e<=0)t.font=tt.TITLE+"px "+Q.LOADING_FONT,t.fillText(ot[0],$.TITLE_X,$.TITLE_Y),t.font=tt.FOOTER+"px "+Q.LOADING_FONT,t.fillText("WWA Wing Ver.3.4.2",$.FOOTER_X,$.COPYRIGHT_Y);else if(e<=ot.length)t.font=tt.LOADING+"px "+Q.LOADING_FONT,e>=2&&(t.clearRect($.LOADING_X,$.LOADING_Y+$.LINE*(e-3),Q.SCREEN_WIDTH-$.LOADING_X,$.LINE),t.fillText(ot[e-1]+" Complete!",$.LOADING_X,$.LOADING_Y+$.LINE*(e-2))),e<ot.length&&t.fillText(ot[e],$.LOADING_X,$.LOADING_Y+$.LINE*(e-1)),1==e&&(t.font=tt.FOOTER+"px "+Q.LOADING_FONT,t.fillText("World Name  "+this._wwaData.worldName,$.FOOTER_X,$.WORLD_Y),t.fillText(" (Map data Ver. "+Math.floor(this._wwaData.version/10)+"."+this._wwaData.version%10+")",$.FOOTER_X,$.WORLD_Y+$.LINE));else{var i;i=this._isSkippedSoundMessage?$.LOADING_Y+$.LINE*(ot.length-1):$.FOOTER_Y,e<=J.AUDIO?t.fillText("Now Sound data Loading .....",$.LOADING_X,i):(t.clearRect($.LOADING_X,i-$.LINE,Q.SCREEN_WIDTH-$.LOADING_X,$.LINE),t.fillText("Now Sound data Loading ..... Complete!",$.LOADING_X,i))}},t.prototype._setErrorMessage=function(t,e){this._hasTitleImg?alert(t):(e.clearRect(0,0,Q.SCREEN_WIDTH,Q.SCREEN_HEIGHT),e.font=tt.ERRROR+"px "+Q.LOADING_FONT,t.split("\n").forEach((function(t,i){e.fillText(t,$.ERROR_X,$.ERROR_Y+$.LINE*i)})))},t.prototype.createWWAAudioInstance=function(t,e){if(void 0===e&&(e=!1),0!==t&&t!==X.NO_SOUND){var i=this.audioContext;if(void 0===this._audioInstances[t]){var s=this._audioDirectory+t+"."+this.audioExtension;this._audioInstances[t]=i?new Xt(t,s,this.audioContext,this.audioGain):new Jt(t,s,_t("wwa-audio-wrapper"))}}},t.prototype.loadSound=function(){this._audioInstances=new Array(Q.SOUND_MAX+1),this.createWWAAudioInstance(X.DECISION),this.createWWAAudioInstance(X.ATTACK);for(var t=1;t<this._wwaData.mapPartsMax;t++){var e=this._wwaData.mapAttribute[t][Q.ATR_SOUND];this.createWWAAudioInstance(e)}for(t=1;t<this._wwaData.objPartsMax;t++)if(this._wwaData.objectAttribute[t][Q.ATR_TYPE]!==Q.OBJECT_RANDOM){e=this._wwaData.objectAttribute[t][Q.ATR_SOUND];this.createWWAAudioInstance(e)}this._wwaData.bgm=0,this._soundLoadSkipFlag=!1},t.prototype.checkAllSoundLoaded=function(){var t=0,e=0;if(!this._hasTitleImg)var i=this._cvsCover.getContext("2d");this._keyStore.update(),this._keyStore.getKeyState(a.KEY_SPACE)===s.KEYDOWN&&(this._soundLoadSkipFlag=!0);for(var o=1;o<=Q.SOUND_MAX;o++){var r=this._audioInstances[o];void 0===r||r.isError()||(e++,r.hasData()&&t++)}if(t<e&&!this._soundLoadSkipFlag)return this._setProgressBar(ae(t,e,J.AUDIO)),void window.requestAnimationFrame(this.soundCheckCaller);this._setProgressBar(ae(Q.SOUND_MAX,Q.SOUND_MAX,J.AUDIO)),this._setLoadingMessage(i,J.FINISH),this.openGameWindow()},t.prototype._setSoundLoadedCheckTimer=function(t){var e=this,i=this._audioInstances[t];i.isError()||(this.soundLoadedCheckTimer=window.setInterval((function(){e._wwaData.bgm===t?i.hasData()?(i.play(),e._wwaData.bgm=t,e._clearSoundLoadedCheckTimer()):i.isError()&&e._clearSoundLoadedCheckTimer():e._clearSoundLoadedCheckTimer()}),100))},t.prototype._clearSoundLoadedCheckTimer=function(){this.soundLoadedCheckTimer&&(clearInterval(this.soundLoadedCheckTimer),this.soundLoadedCheckTimer=void 0)},t.prototype.playSound=function(t){if(this._isLoadedSound){if(t<0||t>Q.SOUND_MAX)throw new Error("サウンド番号が範囲外です。");if(!(t>=X.BGM_LB&&this._wwaData.bgm===t))if((t===X.NO_SOUND||t>=X.BGM_LB)&&0!==this._wwaData.bgm&&(this._audioInstances[this._wwaData.bgm].hasData()&&this._audioInstances[this._wwaData.bgm].pause(),this._wwaData.bgm=0),0!==t&&t!==X.NO_SOUND)this._audioInstances[t].hasData()?t>=X.BGM_LB?(this._audioInstances[t].play(),this._wwaData.bgm=t):this._audioInstances[t].play():t>=X.BGM_LB&&(this._wwaData.bgm=t,this._setSoundLoadedCheckTimer(t))}else t===X.NO_SOUND?this._wwaData.bgm=0:t>=X.BGM_LB&&(this._wwaData.bgm=t)},t.prototype.openGameWindow=function(){var t=this,e=this._player.getPosition();_t("wwa-cover").style.opacity="0",0!==this.getObjectIdByPosition(e)&&this._player.setPartsAppearedFlag(),setTimeout((function(){_t("wwa-wrapper").removeChild(_t("wwa-cover")),t._main()}),Q.SPLASH_SCREEN_DISP_MILLS)},t.prototype.onselectitem=function(t){if(this._player.canUseItem(t)){if(_t("item"+(t-1)).classList.add("onpress"),this.playSound(X.DECISION),"BLANK"===this._wwaData.message[Y.USE_ITEM]){this._player.readyToUseItem(t);var e=this._player.useItem(),i=this.getObjectAttributeById(e,Q.ATR_STRING);this.setMessageQueue(this.getMessageById(i),!1,!1,e,S.OBJECT,this._player.getPosition().getPartsCoord())}else this.setMessageQueue(""===this._wwaData.message[Y.USE_ITEM]?"このアイテムを使用します。\nよろしいですか?":this._wwaData.message[Y.USE_ITEM],!0,!0),this._yesNoChoiceCallInfo=R.CALL_BY_ITEM_USE,this._yesNoUseItemPos=t;return!0}return!1},t.prototype.onselectbutton=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1);var s=_t(G[t]);if(this.playSound(X.DECISION),this._itemMenu.close(),s.classList.add("onpress"),t===b.QUICK_LOAD)this._messageWindow.hasSaveData()&&!e?(this._messageWindow.createSaveDom(),this._usePassword?(this.setMessageQueue("読み込むデータを選んでください。\n→Ｎｏでデータ復帰用パスワードの\n　入力選択ができます。",!0,!0),this._yesNoChoiceCallInfo=R.CALL_BY_QUICK_LOAD):(this.setMessageQueue("読み込むデータを選んでください。",!0,!0),this._yesNoChoiceCallInfo=R.CALL_BY_QUICK_LOAD)):this.onpasswordloadcalled();else if(t===b.QUICK_SAVE)this._wwaData.disableSaveFlag?this.setMessageQueue("ここではセーブ機能は\n使用できません。",!1,!0):(this._messageWindow.createSaveDom(),this._usePassword?(this.setMessageQueue("データの一時保存先を選んでください。\n→Ｎｏでデータ復帰用パスワードの\n　表示選択ができます。",!0,!0),this._yesNoChoiceCallInfo=R.CALL_BY_QUICK_SAVE):(this.setMessageQueue("データの一時保存を選んでください。",!0,!0),this._yesNoChoiceCallInfo=R.CALL_BY_QUICK_SAVE));else if(t===b.RESTART_GAME)this.setMessageQueue("初めからスタートしなおしますか？",!0,!0),this._yesNoChoiceCallInfo=R.CALL_BY_RESTART_GAME;else if(t===b.GOTO_WWA)if(i)this._bottomButtonType!==u.GOTO_WWA&&_t(G[b.GOTO_WWA]).classList.remove("onpress"),this.setMessageQueue("ＷＷＡの公式サイトを開きますか？",!0,!0),this._yesNoChoiceCallInfo=R.CALL_BY_GOTO_WWA;else switch(this._bottomButtonType){case u.GOTO_WWA:this._yesNoChoiceCallInfo=R.CALL_BY_GOTO_WWA,this.setMessageQueue("ＷＷＡの公式サイトを開きますか？",!0,!0);break;case u.GAME_END:this._yesNoChoiceCallInfo=R.CALL_BY_END_GAME,this.setMessageQueue("ＷＷＡゲームを終了しますか？",!0,!0);break;case u.BATTLE_REPORT:this.launchBattleEstimateWindow()}},t.prototype.onpasswordloadcalled=function(){this._usePassword?(_t(G[b.QUICK_LOAD]).classList.add("onpress"),this.setMessageQueue("データ復帰用のパスワードを入力しますか？",!0,!0),this._yesNoChoiceCallInfo=R.CALL_BY_PASSWORD_LOAD):this.setMessageQueue("セーブデータがありません。",!1,!0)},t.prototype.onpasswordsavecalled=function(){_t(G[b.QUICK_SAVE]).classList.add("onpress"),this._wwaData.disableSaveFlag?this.setMessageQueue("ここではセーブ機能は\n使用できません。",!1,!0):this._usePassword&&(this.setMessageQueue("データ復帰用のパスワードを表示しますか？",!0,!0),this._yesNoChoiceCallInfo=R.CALL_BY_PASSWORD_SAVE)},t.prototype.onitemmenucalled=function(){this.setMessageQueue("右のメニューを選択してください。",!1,!0),this._messageWindow.setItemMenuChoice(!0),this.playSound(X.DECISION),this._itemMenu.openView()},t.prototype.onchangespeed=function(t){var e,i;switch(e=t===L.UP?this._player.speedUp():this._player.speedDown(),i="移動速度を【"+Z[e]+"】に切り替えました。\n"+(e===Q.MAX_SPEED_INDEX?"戦闘も速くなります。\n":"")+"("+(Q.MAX_SPEED_INDEX+1)+"段階中"+(e+1)+"）",this.userDevice.os){case P.NINTENDO:i+="速度を落とすには-ボタン, 速度を上げるには+ボタンを押してください。";break;default:i+="速度を落とすにはIキー, 速度を上げるにはPキーを押してください。"}this.setMessageQueue(i,!1,!0)},t.prototype._main=function(){var t=this;if(this._temporaryInputDisable=!1,this._stopUpdateByLoadFlag=!1,this._keyStore.update(),this._mouseStore.update(),this._gamePadStore.update(),this._waitFrame-- >0)window.requestAnimationFrame(this.mainCaller);else{this._waitFrame=0,void 0!==this._yesNoJudgeInNextFrame&&(this._yesNoJudge=this._yesNoJudgeInNextFrame,this._yesNoJudgeInNextFrame=void 0),this._clearFacesInNextFrame&&(this.clearFaces(),this._clearFacesInNextFrame=!1);for(var e=0;e<this._execMacroListInNextFrame.length;e++)this._execMacroListInNextFrame[e].execute();""===this._lastMessage.message&&this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0),this._execMacroListInNextFrame=[],this._player.mainFrameCount();this._player.getPosition();var i=this._player.getDir();if(this._player.isControllable())this._player.isDelayFrame()?this._player.updateDelayFrame():this._actionGamePadButtonItemMacro()||(this._keyStore.getKeyStateForControllPlayer(a.KEY_LEFT)===s.KEYDOWN?this._checkTurnKeyPressed()?this._player.setDir(d.LEFT):(this._player.controll(d.LEFT),this._objectMovingDataManager.update()):this._keyStore.getKeyStateForControllPlayer(a.KEY_UP)===s.KEYDOWN?this._checkTurnKeyPressed()?this._player.setDir(d.UP):(this._player.controll(d.UP),this._objectMovingDataManager.update()):this._keyStore.getKeyStateForControllPlayer(a.KEY_RIGHT)===s.KEYDOWN?this._checkTurnKeyPressed()?this._player.setDir(d.RIGHT):(this._player.controll(d.RIGHT),this._objectMovingDataManager.update()):this._keyStore.getKeyStateForControllPlayer(a.KEY_DOWN)===s.KEYDOWN?this._checkTurnKeyPressed()?this._player.setDir(d.DOWN):(this._player.controll(d.DOWN),this._objectMovingDataManager.update()):this._mouseStore.getMouseStateForControllPlayer(d.LEFT)===o.MOUSEDOWN?this._mouseStore.touchIDIsSetDir()?this._player.setDir(d.LEFT):(this._player.controll(d.LEFT),this._objectMovingDataManager.update()):this._mouseStore.getMouseStateForControllPlayer(d.UP)===o.MOUSEDOWN?this._mouseStore.touchIDIsSetDir()?this._player.setDir(d.UP):(this._player.controll(d.UP),this._objectMovingDataManager.update()):this._mouseStore.getMouseStateForControllPlayer(d.RIGHT)===o.MOUSEDOWN?this._mouseStore.touchIDIsSetDir()?this._player.setDir(d.RIGHT):(this._player.controll(d.RIGHT),this._objectMovingDataManager.update()):this._mouseStore.getMouseStateForControllPlayer(d.DOWN)===o.MOUSEDOWN?this._mouseStore.touchIDIsSetDir()?this._player.setDir(d.DOWN):(this._player.controll(d.DOWN),this._objectMovingDataManager.update()):this._keyStore.checkHitKey(v[i])?this._checkTurnKeyPressed()?this._player.setDir(i):(this._player.controll(i),this._objectMovingDataManager.update()):this._keyStore.checkHitKey(a.KEY_LEFT)?this._checkTurnKeyPressed()?this._player.setDir(d.LEFT):(this._player.controll(d.LEFT),this._objectMovingDataManager.update()):this._keyStore.checkHitKey(a.KEY_UP)?this._checkTurnKeyPressed()?this._player.setDir(d.UP):(this._player.controll(d.UP),this._objectMovingDataManager.update()):this._keyStore.checkHitKey(a.KEY_RIGHT)?this._checkTurnKeyPressed()?this._player.setDir(d.RIGHT):(this._player.controll(d.RIGHT),this._objectMovingDataManager.update()):this._keyStore.checkHitKey(a.KEY_DOWN)?this._checkTurnKeyPressed()?this._player.setDir(d.DOWN):(this._player.controll(d.DOWN),this._objectMovingDataManager.update()):this._mouseStore.checkClickMouse(d.LEFT)?this._mouseStore.touchIDIsSetDir()?this._player.setDir(d.LEFT):(this._player.controll(d.LEFT),this._objectMovingDataManager.update()):this._mouseStore.checkClickMouse(d.UP)?this._mouseStore.touchIDIsSetDir()?this._player.setDir(d.UP):(this._player.controll(d.UP),this._objectMovingDataManager.update()):this._mouseStore.checkClickMouse(d.RIGHT)?this._mouseStore.touchIDIsSetDir()?this._player.setDir(d.RIGHT):(this._player.controll(d.RIGHT),this._objectMovingDataManager.update()):this._mouseStore.checkClickMouse(d.DOWN)?this._mouseStore.touchIDIsSetDir()?this._player.setDir(d.DOWN):(this._player.controll(d.DOWN),this._objectMovingDataManager.update()):this._gamePadStore.crossPressed(_.BUTTON_CROSS_KEY_LEFT)?this._gamePadStore.buttonPressed(_.BUTTON_INDEX_B)?this._player.setDir(d.LEFT):(this._player.controll(d.LEFT),this._objectMovingDataManager.update()):this._gamePadStore.crossPressed(_.BUTTON_CROSS_KEY_UP)?this._gamePadStore.buttonPressed(_.BUTTON_INDEX_B)?this._player.setDir(d.UP):(this._player.controll(d.UP),this._objectMovingDataManager.update()):this._gamePadStore.crossPressed(_.BUTTON_CROSS_KEY_RIGHT)?this._gamePadStore.buttonPressed(_.BUTTON_INDEX_B)?this._player.setDir(d.RIGHT):(this._player.controll(d.RIGHT),this._objectMovingDataManager.update()):this._gamePadStore.crossPressed(_.BUTTON_CROSS_KEY_DOWN)?this._gamePadStore.buttonPressed(_.BUTTON_INDEX_B)?this._player.setDir(d.DOWN):(this._player.controll(d.DOWN),this._objectMovingDataManager.update()):this._keyStore.getKeyState(a.KEY_1)===s.KEYDOWN?this.onselectitem(1):this._keyStore.getKeyState(a.KEY_2)===s.KEYDOWN?this.onselectitem(2):this._keyStore.getKeyState(a.KEY_3)===s.KEYDOWN?this.onselectitem(3):this._keyStore.getKeyState(a.KEY_Q)===s.KEYDOWN?this.onselectitem(4):this._keyStore.getKeyState(a.KEY_W)===s.KEYDOWN?this.onselectitem(5):this._keyStore.getKeyState(a.KEY_E)===s.KEYDOWN?this.onselectitem(6):this._keyStore.getKeyState(a.KEY_A)===s.KEYDOWN?this.onselectitem(7):this._keyStore.getKeyState(a.KEY_S)===s.KEYDOWN?this.onselectitem(8):this._keyStore.getKeyState(a.KEY_D)===s.KEYDOWN?this.onselectitem(9):this._keyStore.getKeyState(a.KEY_Z)===s.KEYDOWN?this.onselectitem(10):this._keyStore.getKeyState(a.KEY_X)===s.KEYDOWN?this.onselectitem(11):this._keyStore.getKeyState(a.KEY_C)===s.KEYDOWN?this.onselectitem(12):this._keyStore.getKeyState(a.KEY_I)||this._gamePadStore.buttonTrigger(_.BUTTON_INDEX_MINUS)?this.onchangespeed(L.DOWN):this._keyStore.checkHitKey(a.KEY_P)||this._keyStore.checkHitKey(a.KEY_F2)||this._gamePadStore.buttonTrigger(_.BUTTON_INDEX_PLUS)?this.onchangespeed(L.UP):this._keyStore.getKeyState(a.KEY_F1)===s.KEYDOWN||this._keyStore.getKeyState(a.KEY_M)===s.KEYDOWN||this._gamePadStore.buttonTrigger(_.BUTTON_INDEX_A)?this.launchBattleEstimateWindow():this._keyStore.checkHitKey(a.KEY_F3)?(this.playSound(X.DECISION),this.onselectbutton(b.QUICK_LOAD,!0)):this._keyStore.checkHitKey(a.KEY_F4)?(this.playSound(X.DECISION),this.onpasswordsavecalled()):this._keyStore.checkHitKey(a.KEY_F5)||this._gamePadStore.buttonTrigger(_.BUTTON_INDEX_A,_.BUTTON_INDEX_ZR)?this.onselectbutton(b.QUICK_LOAD):this._keyStore.checkHitKey(a.KEY_F6)||this._gamePadStore.buttonTrigger(_.BUTTON_INDEX_A,_.BUTTON_INDEX_ZL)?this.onselectbutton(b.QUICK_SAVE):this._keyStore.checkHitKey(a.KEY_F7)||this._gamePadStore.buttonTrigger(_.BUTTON_INDEX_A,_.BUTTON_INDEX_R)?this.onselectbutton(b.RESTART_GAME):this._keyStore.checkHitKey(a.KEY_F8)?this.onselectbutton(b.GOTO_WWA,!1,!0):this._keyStore.checkHitKey(a.KEY_F9)||this._gamePadStore.buttonTrigger(_.BUTTON_INDEX_X)?(this._player.isControllable()||this._messageWindow.isItemMenuChoice())&&this.onitemmenucalled():(this._keyStore.checkHitKey(a.KEY_F12)||this._gamePadStore.buttonTrigger(_.BUTTON_INDEX_Y))&&this._displayHelp()),this._keyStore.memorizeKeyStateOnControllableFrame(),this._mouseStore.memorizeMouseStateOnControllableFrame();else if(this._player.isJumped())this._camera.isResetting()||this._player.processAfterJump();else if(this._player.isMoving())this._player.move(),this._objectMovingDataManager.update();else if(this._player.isWaitingMessage())if(this._messageWindow.isVisible()||this._messageWindow.show(),this._messageWindow.isYesNoChoice())this._messageWindow.isSaveChoice()&&(this._messageWindow.saveUpdate(),this._keyStore.checkHitKey(a.KEY_LEFT)||this._gamePadStore.crossPressed(_.BUTTON_CROSS_KEY_LEFT)?this._messageWindow.saveControll(d.LEFT):this._keyStore.checkHitKey(a.KEY_UP)||this._gamePadStore.crossPressed(_.BUTTON_CROSS_KEY_UP)?this._messageWindow.saveControll(d.UP):this._keyStore.checkHitKey(a.KEY_RIGHT)||this._gamePadStore.crossPressed(_.BUTTON_CROSS_KEY_RIGHT)?this._messageWindow.saveControll(d.RIGHT):(this._keyStore.checkHitKey(a.KEY_DOWN)||this._gamePadStore.crossPressed(_.BUTTON_CROSS_KEY_DOWN))&&this._messageWindow.saveControll(d.DOWN)),this._messageWindow.isInputDisable()||(this._yesNoJudge===A.UNSELECTED&&(this._keyStore.getKeyState(a.KEY_ENTER)===s.KEYDOWN||this._keyStore.getKeyState(a.KEY_Y)===s.KEYDOWN||this._gamePadStore.buttonTrigger(_.BUTTON_INDEX_A)?this._yesNoJudge=A.YES:(this._keyStore.getKeyState(a.KEY_N)===s.KEYDOWN||this._keyStore.getKeyState(a.KEY_ESC)===s.KEYDOWN||this._gamePadStore.buttonTrigger(_.BUTTON_INDEX_B))&&(this._yesNoJudge=A.NO)),(this._yesNoJudge===A.YES||this._yesNoJudge===A.NO)&&(this.playSound(X.DECISION),this._yesNoDispCounter=Q.YESNO_PRESS_DISP_FRAME_NUM,this._messageWindow.setInputDisable(),this._messageWindow.update()));else if(this._messageWindow.isItemMenuChoice()){if(this._itemMenu.update(),this._keyStore.checkHitKey(a.KEY_LEFT)||this._gamePadStore.crossPressed(_.BUTTON_CROSS_KEY_LEFT)?this._itemMenu.controll(d.LEFT):this._keyStore.checkHitKey(a.KEY_UP)||this._gamePadStore.crossPressed(_.BUTTON_CROSS_KEY_UP)?this._itemMenu.controll(d.UP):this._keyStore.checkHitKey(a.KEY_RIGHT)||this._gamePadStore.crossPressed(_.BUTTON_CROSS_KEY_RIGHT)?this._itemMenu.controll(d.RIGHT):(this._keyStore.checkHitKey(a.KEY_DOWN)||this._gamePadStore.crossPressed(_.BUTTON_CROSS_KEY_DOWN))&&this._itemMenu.controll(d.DOWN),this._keyStore.getKeyState(a.KEY_ENTER)===s.KEYDOWN||this._keyStore.getKeyState(a.KEY_Y)===s.KEYDOWN||this._gamePadStore.buttonTrigger(_.BUTTON_INDEX_A))this._setNextMessage(),this._messageWindow.setItemMenuChoice(!1),this._itemMenu.ok();else if(this._mouseStore.checkClickMouse(d.LEFT)||this._mouseStore.checkClickMouse(d.UP)||this._mouseStore.checkClickMouse(d.RIGHT)||this._mouseStore.checkClickMouse(d.DOWN)||this._keyStore.getKeyState(a.KEY_N)===s.KEYDOWN||this._keyStore.getKeyState(a.KEY_ESC)===s.KEYDOWN||this._gamePadStore.buttonTrigger(_.BUTTON_INDEX_B)){for(e=0;e<G.length;e++){(c=_t(G[e])).classList.contains("onpress")&&c.classList.remove("onpress")}this._itemMenu.ng(),this._setNextMessage(),this.playSound(X.DECISION),this._messageWindow.setItemMenuChoice(!1)}}else{var r=this._keyStore.getKeyStateForMessageCheck(a.KEY_ENTER),n=this._keyStore.getKeyStateForMessageCheck(a.KEY_SPACE),h=this._keyStore.getKeyStateForMessageCheck(a.KEY_ESC);if(r===s.KEYDOWN||r===s.KEYPRESS_MESSAGECHANGE||n===s.KEYDOWN||n===s.KEYPRESS_MESSAGECHANGE||h===s.KEYDOWN||h===s.KEYPRESS_MESSAGECHANGE||this._mouseStore.getMouseState()===o.MOUSEDOWN||this._gamePadStore.buttonTrigger(_.BUTTON_INDEX_A,_.BUTTON_INDEX_B)){for(e=0;e<G.length;e++){var c;(c=_t(G[e])).classList.contains("onpress")&&c.classList.remove("onpress")}this._setNextMessage()}}else this._player.isWatingEstimateWindow()?(this._keyStore.getKeyState(a.KEY_ENTER)===s.KEYDOWN||this._keyStore.getKeyState(a.KEY_SPACE)===s.KEYDOWN||this._gamePadStore.buttonTrigger(_.BUTTON_INDEX_A,_.BUTTON_INDEX_B))&&this.hideBattleEstimateWindow():this._player.isFighting()?(this._player.fight(),this._monsterWindow.update(this._monster)):this._player.isWaitingMoveMacro()&&(this._player.isMoveObjectAutoExecTime()&&(this.moveObjects(!1),this._player.resetMoveObjectAutoExecTimer()),this._objectMovingDataManager.update());if(this._prevFrameEventExected=!1,this._player.getPosition().isJustPosition()&&this._camera.getPosition().isScreenTopPosition()){if(!(this._player.isJumped()||this._player.isWaitingMessage()||this._player.isWatingEstimateWindow()||this._player.isWaitingMoveMacro()||this._player.isFighting())){this._player.isPartsAppearedTime()&&this._player.clearPartsAppearedFlag(),this._replaceRandomObjectsInScreen();var l=this.checkMap();l||this.checkObject(),this._prevFrameEventExected=l}this._player.isWaitingMessage()&&this._messageWindow.isYesNoChoice()&&this._yesNoJudge!==A.UNSELECTED&&!this._player.isWaitingMoveMacro()&&!this._player.isFighting()&&this._execChoiceWindowRunningEvent()}this._passwordLoadExecInNextFrame&&(this._stopUpdateByLoadFlag=!0,this._loadType=B.PASSWORD,this._player.clearPasswordWindowWaiting(),this._passwordLoadExecInNextFrame=!1),this._drawAll(),this._mainCallCounter++,this._mainCallCounter%=1e9,this._player.isWaitingMessage()&&this._isClassicModeEnable||(this._animationCounter=(this._animationCounter+1)%(2*Q.ANIMATION_REP_HALF_FRAME)),this._camera.isResetting()&&this._camera.advanceTransitionStepNum(),this._player.isWaitingMessage()||(this._player.decrementLookingAroundTimer(),this._statusPressCounter.energy>0&&0==--this._statusPressCounter.energy&&_t("disp-energy").classList.remove("onpress"),this._statusPressCounter.strength>0&&0==--this._statusPressCounter.strength&&_t("disp-strength").classList.remove("onpress"),this._statusPressCounter.defence>0&&0==--this._statusPressCounter.defence&&_t("disp-defence").classList.remove("onpress"),this._statusPressCounter.gold>0&&0==--this._statusPressCounter.gold&&_t("disp-gold").classList.remove("onpress")),this._player.isWaitingMoveMacro()&&this._player.decrementMoveObjectAutoExecTimer(),this._stopUpdateByLoadFlag?this._fadeout((function(){t._loadType===B.QUICK_LOAD?t._quickLoad():t._loadType===B.RESTART_GAME?t._restartGame():t._loadType===B.PASSWORD&&(t._applyQuickLoad(t._passwordSaveExtractData),t._passwordSaveExtractData=void 0),setTimeout(t.mainCaller,Q.DEFAULT_FRAME_INTERVAL,t)})):window.requestAnimationFrame(this.mainCaller)}},t.prototype.vibration=function(t){this._gamePadStore.vibration(t)},t.prototype._drawAll=function(){var t,e,i=this._camera.getPosition().getPartsCoord(),s=this._camera.getPosition().getOffsetCoord(),a=Q.MAP_WINDOW_HEIGHT,o=this._player.getPosition().getPartsCoord();if(this._paintSkipByDoorOpen)this._paintSkipByDoorOpen=!1;else{if(this._cgManager.clearCanvas(0,0,Q.MAP_WINDOW_WIDTH,Q.MAP_WINDOW_HEIGHT),this._cgManager.drawBase(0,0,Q.MAP_WINDOW_WIDTH,Q.MAP_WINDOW_HEIGHT),this._camera.isResetting()){if(null!==this._camera.getPreviousPosition())var r=this._camera.getPreviousPosition().getPartsCoord(),n=this._camera.getPreviousPosition().getOffsetCoord();if(a=this._camera.getTransitionStepNum()*Q.CHIP_SIZE,this._drawMap(r,n,a,!0),this._drawPlayer(r,n,a,!0),this._drawObjects(r,n,a,!0),this._camera.isFinalStep())var _=255,h=setInterval((function(){var t=_t("wwa-fader");if((_-=3*Q.FADEOUT_SPEED)<=0)return clearInterval(h),t.style.backgroundColor="transparent",t.removeAttribute("style"),void(t.style.display="none");t.style.opacity=_/255+""}),20)}this._drawMap(i,s,a),this._drawPlayer(i,s,a),this._drawObjects(i,s,a),this._player.isFighting()&&!this._player.isBattleStartFrame()&&(t=this._player.isTurn()?this._monster.position.x:o.x,e=this._player.isTurn()?this._monster.position.y:o.y,this._cgManager.drawCanvas(this._wwaData.imgBattleEffectX,this._wwaData.imgBattleEffectY,Q.CHIP_SIZE*(t-i.x)-s.x,Q.CHIP_SIZE*(e-i.y)-s.y,!1)),this._drawEffect(),this._drawFaces(),this._drawFrame()}},t.prototype._drawMap=function(t,e,i,s){if(void 0===s&&(s=!1),void 0!==t){var a,o,r=Math.max(0,t.x-1),n=Math.min(this._wwaData.mapWidth-1,t.x+Q.H_PARTS_NUM_IN_WINDOW),_=Math.max(0,t.y-1),h=Math.min(this._wwaData.mapWidth-1,t.y+Q.V_PARTS_NUM_IN_WINDOW);if(o=!1,a=0,s)for(var c=r;c<=n;c++)for(var l=_;l<=h;l++){var u=this._wwaData.map[l][c],d=this._wwaData.mapAttribute[u][Q.ATR_X]/Q.CHIP_SIZE,p=this._wwaData.mapAttribute[u][Q.ATR_Y]/Q.CHIP_SIZE,E=Q.CHIP_SIZE*(c-t.x)-e.x,m=Q.CHIP_SIZE*(l-t.y)-e.y;this._cgManager.drawCanvasWithLowerYLimit(d,p,E,m,i)}else{for(c=r;c<=n;c++)for(l=_;l<=h;l++){u=this._wwaData.map[l][c];this._cgManager.mapCache[a]!==u&&(this._cgManager.mapCache[a]=u,o=!0),a++}if(i!==this._cgManager.mapCacheYLimit&&(this._cgManager.mapCacheYLimit=i,o=!0),t.x===this._cgManager.cpPartsLog.x&&t.y===this._cgManager.cpPartsLog.y||(this._cgManager.cpPartsLog.x=t.x,this._cgManager.cpPartsLog.y=t.y,o=!0),o){this._cgManager.clearBackCanvas();for(c=r;c<=n;c++)for(l=_;l<=h;l++){u=this._wwaData.map[l][c],d=this._wwaData.mapAttribute[u][Q.ATR_X]/Q.CHIP_SIZE,p=this._wwaData.mapAttribute[u][Q.ATR_Y]/Q.CHIP_SIZE,E=Q.CHIP_SIZE*(c-t.x)-e.x,m=Q.CHIP_SIZE*(l-t.y)-e.y;this._cgManager.copyBackCanvasWithUpperYLimit(d,p,E,m,i)}}this._cgManager.drawBackCanvas()}}},t.prototype._drawPlayer=function(t,e,i,s){if(void 0===s&&(s=!1),void 0!==t&&!this._wwaData.delPlayerFlag){var a,o=this._player.getPosition().getPartsCoord(),r=this._player.getPosition().getOffsetCoord(),n=D[this._player.getDir()],_=(o.x-t.x)*Q.CHIP_SIZE+r.x-e.x,h=(o.y-t.y)*Q.CHIP_SIZE+r.y-e.y;Math.abs(r.x),Math.abs(r.y),this._player.getDir();a=this._useLookingAround&&this._player.isLookingAround()&&!this._player.isWaitingMessage()?this._wwaData.playerImgPosX+[2,3,4,5,0,1,6,7][Math.floor(this._mainCallCounter%64/8)]:this._player.isMovingImage()?this._wwaData.playerImgPosX+n+1:this._wwaData.playerImgPosX+n,s?this._cgManager.drawCanvasWithLowerYLimit(a,this._wwaData.playerImgPosY,_,h,i):this._cgManager.drawCanvasWithUpperYLimit(a,this._wwaData.playerImgPosY,_,h,i)}},t.prototype._drawObjects=function(t,e,i,s){if(void 0===s&&(s=!1),void 0!==t)for(var a,o=Math.max(0,t.x-1),r=Math.min(this._wwaData.mapWidth-1,t.x+Q.H_PARTS_NUM_IN_WINDOW),n=Math.max(0,t.y-1),_=Math.min(this._wwaData.mapWidth-1,t.y+Q.V_PARTS_NUM_IN_WINDOW),h=o;h<=r;h++)for(var c=n;c<=_;c++)if(!(this._player.isFighting()&&this._player.isTurn()&&this._player.getPosition().getPartsCoord().equals(this._monster.position)&&new g(h,c).equals(this._monster.position))){var l=this._wwaData.mapObject[c][h];if(a=new g(0,0),this._wwaData.objectAttribute[l][Q.ATR_MOVE]!==x.STATIC){var u=this._objectMovingDataManager.getOffsetByBeforePartsCoord(new g(h,c));null!==u&&(a=u)}var d=this._animationCounter>Q.ANIMATION_REP_HALF_FRAME||0===this._wwaData.objectAttribute[l][Q.ATR_X2]&&0===this._wwaData.objectAttribute[l][Q.ATR_Y2],p=this._wwaData.objectAttribute[l][d?Q.ATR_X:Q.ATR_X2]/Q.CHIP_SIZE,E=this._wwaData.objectAttribute[l][d?Q.ATR_Y:Q.ATR_Y2]/Q.CHIP_SIZE,m=Q.CHIP_SIZE*(h-t.x)+a.x-e.x,y=Q.CHIP_SIZE*(c-t.y)+a.y-e.y,w=this._wwaData.objectAttribute[l][Q.ATR_TYPE],f=this._wwaData.objectAttribute[l][Q.ATR_NUMBER];0===l||this._checkNoDrawObject(new g(h,c),w,f)||(s?this._cgManager.drawCanvasWithLowerYLimit(p,E,m,y,i):this._cgManager.drawCanvasWithUpperYLimit(p,E,m,y,i))}},t.prototype._drawEffect=function(){if(0!==this._wwaData.effectCoords.length&&0!==this._wwaData.effectWaits)for(var t=Math.floor(this._mainCallCounter%(this._wwaData.effectCoords.length*this._wwaData.effectWaits)/this._wwaData.effectWaits),e=0;e<Q.V_PARTS_NUM_IN_WINDOW;e++)for(var i=0;i<Q.H_PARTS_NUM_IN_WINDOW;i++)this._wwaData.effectCoords[t]&&this._cgManager.drawCanvas(this._wwaData.effectCoords[t].x,this._wwaData.effectCoords[t].y,i*Q.CHIP_SIZE,e*Q.CHIP_SIZE,!1)},t.prototype._drawFaces=function(){for(var t=0;t<this._faces.length;t++)this._cgManager.drawCanvasWithSize(this._faces[t].srcPos.x,this._faces[t].srcPos.y,this._faces[t].srcSize.x,this._faces[t].srcSize.y,this._faces[t].destPos.x,this._faces[t].destPos.y,!1)},t.prototype._drawFrame=function(){this._cgManager.drawFrame()},t.prototype._checkNoDrawObject=function(t,e,i){var s=this._player.getPosition(),a=s.getPartsCoord();return!(!s.isJustPosition()||a.x!==t.x||a.y!==t.y||this._wwaData.objectNoCollapseDefaultFlag)&&(e===Q.OBJECT_DOOR&&0===i||(e===Q.OBJECT_STATUS||e===Q.OBJECT_MESSAGE||e===Q.OBJECT_ITEM||e===Q.OBJECT_SELL||e===Q.OBJECT_BUY||e===Q.OBJECT_SELL||e===Q.OBJECT_LOCALGATE))},t.prototype.getMapWidth=function(){if(void 0===this._wwaData)throw new Error("マップデータがロードされていません");return this._wwaData.mapWidth},t.prototype.getMapIdByPosition=function(t){var e=t.getPartsCoord();return this._wwaData.map[e.y][e.x]},t.prototype.getObjectIdByPosition=function(t){var e=t.getPartsCoord();return this._wwaData.mapObject[e.y][e.x]},t.prototype.getMapTypeByPosition=function(t){var e=t.getPartsCoord(),i=this._wwaData.map[e.y][e.x];return this._wwaData.mapAttribute[i][Q.ATR_TYPE]},t.prototype.getObjectTypeByPosition=function(t){var e=t.getPartsCoord(),i=this._wwaData.mapObject[e.y][e.x];return this._wwaData.objectAttribute[i][Q.ATR_TYPE]},t.prototype.getMapAttributeByPosition=function(t,e){var i=t.getPartsCoord(),s=this._wwaData.map[i.y][i.x];return this._wwaData.mapAttribute[s][e]},t.prototype.isCurrentPosMapPartsIncludingMessage=function(t){return 0!==this.getMapAttributeByPosition(t,Q.ATR_STRING)},t.prototype.getObjectAttributeByPosition=function(t,e){var i=t.getPartsCoord(),s=this._wwaData.mapObject[i.y][i.x];return this._wwaData.objectAttribute[s][e]},t.prototype.getMapAttributeById=function(t,e){return this._wwaData.mapAttribute[t][e]},t.prototype.getObjectAttributeById=function(t,e){return this._wwaData.objectAttribute[t][e]},t.prototype.getObjectCropXById=function(t){return this._wwaData.objectAttribute[t][Q.ATR_X]},t.prototype.getObjectCropYById=function(t){return this._wwaData.objectAttribute[t][Q.ATR_Y]},t.prototype.getMessageById=function(t){return this._wwaData.message[t]},t.prototype.getSystemMessageById=function(t){return this._wwaData.systemMessage[t]},t.prototype.checkMap=function(t){var e=this._player.getPosition().getPartsCoord();t=null!=t?t:e;var i=this._wwaData.map[t.y][t.x],s=this._wwaData.mapAttribute[i][Q.ATR_TYPE],a=t.x===e.x&&t.y===e.y,o=!1;return(!a||this._player.getLastExecPartsIDOnSamePosition(S.MAP)!==i)&&(s===Q.MAP_STREET?o=this._execMapStreetEvent(t,i,s):s===Q.MAP_WALL?o=this._execMapWallEvent(t,i,s):s===Q.MAP_LOCALGATE?o=this._execMapLocalGateEvent(t,i,s):s===Q.MAP_URLGATE&&(o=this._execMapUrlGateEvent(t,i,s)),a&&!this._player.isJumped()&&this._player.setLastExecInfoOnSamePosition(S.MAP,i),o)},t.prototype.checkObject=function(t){var e=this._player.getPosition().getPartsCoord();t=null!=t?t:e;var i=this._wwaData.mapObject[t.y][t.x],s=this._wwaData.objectAttribute[i][Q.ATR_TYPE],a=t.x===e.x&&t.y===e.y;a&&this._player.getLastExecPartsIDOnSamePosition(S.OBJECT)===i||(s===Q.OBJECT_NORMAL?this._execObjectNormalEvent(t,i,s):s===Q.OBJECT_MESSAGE?this._execObjectMessageEvent(t,i,s):s===Q.OBJECT_MONSTER?this._execObjectMonsterEvent(t,i,s):s===Q.OBJECT_ITEM?this._execObjectItemEvent(t,i,s):s===Q.OBJECT_DOOR?this._execObjectDoorEvent(t,i,s):s===Q.OBJECT_STATUS?this._execObjectStatusEvent(t,i,s):s===Q.OBJECT_BUY?this._execObjectBuyEvent(t,i,s):s===Q.OBJECT_SELL?this._execObjectSellEvent(t,i,s):s===Q.OBJECT_URLGATE?this._execObjectUrlGateEvent(t,i,s):s===Q.OBJECT_SCORE?this._execObjectScoreEvent(t,i,s):s===Q.OBJECT_SELECT?this._execObjectYesNoChoiceEvent(t,i,s):s===Q.OBJECT_LOCALGATE&&this._execObjectLocalGateEvent(t,i,s),a&&!this._player.isJumped()&&this._player.setLastExecInfoOnSamePosition(S.OBJECT,i))},t.prototype._execMapStreetEvent=function(t,e,i){var s=this._wwaData.mapAttribute[e][Q.ATR_ITEM];if(0!==s&&!this._player.hasItem(s))return!1;this.appearParts(t,I.MAP);var a=this._wwaData.mapAttribute[e][Q.ATR_STRING],o=this._wwaData.message[a];this._waitFrame+=this._wwaData.mapAttribute[e][Q.ATR_NUMBER]*Q.WAIT_TIME_FRAME_NUM,this._temporaryInputDisable=!0;var r=this.setMessageQueue(o,!1,!1,e,S.MAP,t.clone());return this.playSound(this._wwaData.mapAttribute[e][Q.ATR_SOUND]),0!==a&&r},t.prototype._execMapWallEvent=function(t,e,i){var s=this.getObjectIdByPosition(t.convertIntoPosition(this)),a=this.getObjectAttributeById(s,Q.ATR_TYPE);if(0===s||a===Q.OBJECT_NORMAL||a===Q.OBJECT_DOOR&&(!this._player.hasItem(this.getObjectAttributeById(s,Q.ATR_ITEM))||this.getObjectAttributeById(a,Q.ATR_MODE)===Q.PASSABLE_OBJECT)){this.appearParts(t,I.MAP);var o=this._wwaData.mapAttribute[e][Q.ATR_STRING],r=this._wwaData.message[o];return this.setMessageQueue(r,!1,!1,e,S.MAP,t.clone()),this.playSound(this._wwaData.mapAttribute[e][Q.ATR_SOUND]),!1}return!1},t.prototype._execMapLocalGateEvent=function(t,e,i){var s=this._player.getPosition().getPartsCoord(),a=this._wwaData.mapAttribute[e][Q.ATR_JUMP_X],o=this._wwaData.mapAttribute[e][Q.ATR_JUMP_Y];return a>Q.RELATIVE_COORD_LOWER&&(a=t.x+a-Q.RELATIVE_COORD_BIAS),o>Q.RELATIVE_COORD_LOWER&&(o=t.y+o-Q.RELATIVE_COORD_BIAS),this.appearParts(t,I.MAP),0<=a&&0<=o&&a<this._wwaData.mapWidth&&o<this._wwaData.mapWidth&&(a!==s.x||o!==s.y)&&(this._player.jumpTo(new w(this,a,o,0,0)),this.playSound(this._wwaData.mapAttribute[e][Q.ATR_SOUND]),!0)},t.prototype._execMapUrlGateEvent=function(t,e,i){var s=this._wwaData.mapAttribute[e][Q.ATR_STRING];return!this._isURLGateEnable||("BLANK"!==this._wwaData.message[Y.ASK_LINK]?(this.setMessageQueue(""===this._wwaData.message[Y.ASK_LINK]?"他のページにリンクします。\nよろしいですか？":this._wwaData.message[Y.ASK_LINK],!0,!0),this._yesNoChoicePartsCoord=t,this._yesNoChoicePartsID=e,this._yesNoChoiceCallInfo=R.CALL_BY_MAP_PARTS,this._yesNoURL=this._wwaData.message[s].split(/\s/g)[0],!0):void(location.href=ut(this._wwaData.message[s].split(/\s/g)[0])))},t.prototype._execObjectNormalEvent=function(t,e,i){},t.prototype._execObjectMessageEvent=function(t,e,i){var s=this._wwaData.objectAttribute[e][Q.ATR_STRING],a=this._wwaData.message[s],o=this._player.getPosition().getPartsCoord(),r=this._wwaData.objectAttribute[e][Q.ATR_SOUND];t.x!==o.x||t.y!==o.y||this._wwaData.objectNoCollapseDefaultFlag||this.setPartsOnPosition(S.OBJECT,0,t),this.setMessageQueue(a,!1,!1,e,S.OBJECT,t),this._waitFrame+=this._wwaData.objectAttribute[e][Q.ATR_NUMBER]*Q.WAIT_TIME_FRAME_NUM,this._temporaryInputDisable=!0,this.appearParts(t,I.OBJECT,e),this.playSound(r)},t.prototype._execObjectStatusEvent=function(t,e,i){var s=new y(this._wwaData.objectAttribute[e][Q.ATR_ENERGY],this._wwaData.objectAttribute[e][Q.ATR_STRENGTH],this._wwaData.objectAttribute[e][Q.ATR_DEFENCE],this._wwaData.objectAttribute[e][Q.ATR_GOLD]),a=this._wwaData.objectAttribute[e][Q.ATR_STRING],o=this._wwaData.message[a],r=this._player.getStatusWithoutEquipments();if(s.strength>Q.STATUS_MINUS_BORDER&&r.strength<s.strength-Q.STATUS_MINUS_BORDER||s.defence>Q.STATUS_MINUS_BORDER&&r.defence<s.defence-Q.STATUS_MINUS_BORDER||s.gold>Q.STATUS_MINUS_BORDER&&r.gold<s.gold-Q.STATUS_MINUS_BORDER)return this.setPartsOnPosition(S.OBJECT,0,t),this._keyStore.allClear(),void this._mouseStore.clear();s.energy=s.energy>Q.STATUS_MINUS_BORDER?Q.STATUS_MINUS_BORDER-s.energy:s.energy,s.strength=s.strength>Q.STATUS_MINUS_BORDER?Q.STATUS_MINUS_BORDER-s.strength:s.strength,s.defence=s.defence>Q.STATUS_MINUS_BORDER?Q.STATUS_MINUS_BORDER-s.defence:s.defence,s.gold=s.gold>Q.STATUS_MINUS_BORDER?Q.STATUS_MINUS_BORDER-s.gold:s.gold,this._player.addStatusAll(s),this.setStatusChangedEffect(s),this._player.isDead()&&0!==this._wwaData.objectAttribute[e][Q.ATR_ENERGY]?this.gameover():(this.setMessageQueue(o,!1,!1,e,S.OBJECT,t.clone()),this.setPartsOnPosition(S.OBJECT,0,t),this.appearParts(t,I.OBJECT,e),this.playSound(this._wwaData.objectAttribute[e][Q.ATR_SOUND]))},t.prototype._execObjectMonsterEvent=function(t,e,i){var s=this,a=new g(this._wwaData.objectAttribute[e][Q.ATR_X],this._wwaData.objectAttribute[e][Q.ATR_Y]),o=new y(this._wwaData.objectAttribute[e][Q.ATR_ENERGY],this._wwaData.objectAttribute[e][Q.ATR_STRENGTH],this._wwaData.objectAttribute[e][Q.ATR_DEFENCE],this._wwaData.objectAttribute[e][Q.ATR_GOLD]),r=this._wwaData.message[this._wwaData.objectAttribute[e][Q.ATR_STRING]],n=this._wwaData.objectAttribute[e][Q.ATR_ITEM];this._monster=new At(e,t,a,o,r,n,(function(){s._monsterWindow.hide()})),this._player.startBattleWith(this._monster)},t.prototype._execObjectBuyEvent=function(t,e,i){var s=this._wwaData.objectAttribute[e][Q.ATR_STRING],a=this._wwaData.message[s],o=this._player.getPosition().getPartsCoord();t.x!==o.x||t.y!==o.y||this._wwaData.objectNoCollapseDefaultFlag||this.setPartsOnPosition(S.OBJECT,0,t),this.setMessageQueue(a,!0,!1,e,S.OBJECT,t.clone()),this._yesNoChoicePartsCoord=t,this._yesNoChoicePartsID=e,this._yesNoChoiceCallInfo=R.CALL_BY_OBJECT_PARTS,this.playSound(this._wwaData.objectAttribute[e][Q.ATR_SOUND])},t.prototype._execObjectSellEvent=function(t,e,i){var s=this._wwaData.objectAttribute[e][Q.ATR_STRING],a=this._wwaData.message[s],o=this._player.getPosition().getPartsCoord();t.x!==o.x||t.y!==o.y||this._wwaData.objectNoCollapseDefaultFlag||this.setPartsOnPosition(S.OBJECT,0,t),this.setMessageQueue(a,!0,!1,e,S.OBJECT,t.clone()),this._yesNoChoicePartsCoord=t,this._yesNoChoicePartsID=e,this._yesNoChoiceCallInfo=R.CALL_BY_OBJECT_PARTS,this.playSound(this._wwaData.objectAttribute[e][Q.ATR_SOUND])},t.prototype._execObjectItemEvent=function(t,e,i){var s=this._wwaData.objectAttribute[e][Q.ATR_STRING],a=this._wwaData.message[s];try{var o=this._camera.getPosition().getScreenTopPosition().getPartsCoord(),r=(t.x-o.x)*Q.CHIP_SIZE,n=(t.y-o.y)*Q.CHIP_SIZE;this._player.addItem(e,this._wwaData.objectAttribute[e][Q.ATR_NUMBER],!1,this._wwaData.isItemEffectEnabled?{screenPixelCoord:new g(r,n),itemBoxBackgroundImageCoord:new g(this._wwaData.imgItemboxX*Q.CHIP_SIZE,this._wwaData.imgItemboxY*Q.CHIP_SIZE)}:void 0),this.setPartsOnPosition(S.OBJECT,0,t),0!==this._wwaData.objectAttribute[e][Q.ATR_MODE]||(this.setMessageQueue(a,!1,!1,e,S.OBJECT,t.clone()),this.appearParts(t,I.OBJECT,e))}catch(t){"BLANK"!==this._wwaData.systemMessage[F.FULL_ITEM]&&this.setMessageQueue(""===this._wwaData.systemMessage[F.FULL_ITEM]?"これ以上、アイテムを持てません。":this._wwaData.systemMessage[F.FULL_ITEM],!1,!0)}this.playSound(this._wwaData.objectAttribute[e][Q.ATR_SOUND])},t.prototype._execObjectDoorEvent=function(t,e,i){var s=this._wwaData.objectAttribute[e][Q.ATR_ITEM],a=this._wwaData.objectAttribute[e][Q.ATR_STRING],o=this._wwaData.message[a];this._player.hasItem(s)&&(0===this._wwaData.objectAttribute[e][Q.ATR_MODE]&&this._player.removeItemByPartsID(s),this.playSound(this._wwaData.objectAttribute[e][Q.ATR_SOUND]),this.setMessageQueue(o,!1,!1,e,S.OBJECT,t.clone()),this.setPartsOnPosition(S.OBJECT,0,t),this.appearParts(t,I.OBJECT,e),this._paintSkipByDoorOpen=!0)},t.prototype._execObjectYesNoChoiceEvent=function(t,e,i){var s=this._wwaData.objectAttribute[e][Q.ATR_STRING],a=this._wwaData.message[s],o=this._player.getPosition().getPartsCoord();t.x!==o.x||t.y!==o.y||this._wwaData.objectNoCollapseDefaultFlag||this.setPartsOnPosition(S.OBJECT,0,t),this.setMessageQueue(a,!0,!1,e,S.OBJECT,t.clone()),this._yesNoChoicePartsCoord=t,this._yesNoChoicePartsID=e,this._yesNoChoiceCallInfo=R.CALL_BY_OBJECT_PARTS,this.playSound(this._wwaData.objectAttribute[e][Q.ATR_SOUND])},t.prototype._execObjectLocalGateEvent=function(t,e,i){var s=this._player.getPosition().getPartsCoord();t.x!==s.x||t.y!==s.y||this._wwaData.objectNoCollapseDefaultFlag||this.setPartsOnPosition(S.OBJECT,0,t);var a=this._wwaData.objectAttribute[e][Q.ATR_JUMP_X],o=this._wwaData.objectAttribute[e][Q.ATR_JUMP_Y];a>Q.RELATIVE_COORD_LOWER&&(a=s.x+a-Q.RELATIVE_COORD_BIAS),o>Q.RELATIVE_COORD_LOWER&&(o=s.y+o-Q.RELATIVE_COORD_BIAS),this.appearParts(t,I.OBJECT,e),0<=a&&0<=o&&a<this._wwaData.mapWidth&&o<this._wwaData.mapWidth&&(a!==s.x||o!==s.y)&&(this._player.jumpTo(new w(this,a,o,0,0)),this.playSound(this._wwaData.objectAttribute[e][Q.ATR_SOUND]))},t.prototype._execObjectUrlGateEvent=function(t,e,i){var s=this._wwaData.objectAttribute[e][Q.ATR_STRING];this._isURLGateEnable&&("BLANK"!==this._wwaData.message[Y.ASK_LINK]?(this.setMessageQueue(""===this._wwaData.message[Y.ASK_LINK]?"他のページにリンクします。\nよろしいですか？":this._wwaData.message[Y.ASK_LINK],!0,!0),this._yesNoChoicePartsCoord=t,this._yesNoChoicePartsID=e,this._yesNoChoiceCallInfo=R.CALL_BY_OBJECT_PARTS,this._yesNoURL=this._wwaData.message[s].split(/\s/g)[0]):location.href=ut(this._wwaData.message[s].split(/\s/g)[0]))},t.prototype._execObjectScoreEvent=function(t,e,i){var s=this._wwaData.objectAttribute[e][Q.ATR_STRING],a=0===s?"スコアを表示します。":this._wwaData.message[s];if(this.getMessageQueueByRawMessage(a,e,S.OBJECT,t).reduce((function(t,e){return t||!!e.message}),!1)){var o=this._player.getStatus().calculateScore({energy:this._wwaData.objectAttribute[e][Q.ATR_ENERGY],strength:this._wwaData.objectAttribute[e][Q.ATR_STRENGTH],defence:this._wwaData.objectAttribute[e][Q.ATR_DEFENCE],gold:this._wwaData.objectAttribute[e][Q.ATR_GOLD]});this._scoreWindow.update(o),this._scoreWindow.show()}this.setMessageQueue(a,!1,!1,e,S.OBJECT,t),this.playSound(this._wwaData.objectAttribute[e][Q.ATR_SOUND])},t.prototype._execChoiceWindowRunningEvent=function(){var t,e;if(0==--this._yesNoDispCounter)if(this._yesNoJudge===A.YES){if(this._yesNoChoiceCallInfo===R.CALL_BY_MAP_PARTS)(t=this._wwaData.mapAttribute[this._yesNoChoicePartsID][Q.ATR_TYPE])===Q.MAP_URLGATE&&(location.href=ut(this._yesNoURL));else if(this._yesNoChoiceCallInfo===R.CALL_BY_OBJECT_PARTS)if((t=this._wwaData.objectAttribute[this._yesNoChoicePartsID][Q.ATR_TYPE])===Q.OBJECT_BUY)this._player.hasItem(this._wwaData.objectAttribute[this._yesNoChoicePartsID][Q.ATR_ITEM])?(this._player.removeItemByPartsID(this._wwaData.objectAttribute[this._yesNoChoicePartsID][Q.ATR_ITEM]),e=this._wwaData.objectAttribute[this._yesNoChoicePartsID][Q.ATR_GOLD],this._player.earnGold(e),this.setStatusChangedEffect(new y(0,0,0,e)),this.appearParts(this._yesNoChoicePartsCoord,I.OBJECT,this._yesNoChoicePartsID)):"BLANK"!==this._wwaData.message[Y.NO_ITEM]&&this._messageQueue.push(new Ot(""===this._wwaData.message[Y.NO_ITEM]?"アイテムを持っていない。":this._wwaData.message[Y.NO_ITEM],!0));else if(t===Q.OBJECT_SELL)if(this._player.hasGold(this._wwaData.objectAttribute[this._yesNoChoicePartsID][Q.ATR_GOLD]))if(this._player.canHaveMoreItems()||0===this._wwaData.objectAttribute[this._yesNoChoicePartsID][Q.ATR_ITEM]){if(0!==this._wwaData.objectAttribute[this._yesNoChoicePartsID][Q.ATR_ITEM]){var i=this._yesNoChoicePartsCoord,s=this._camera.getPosition().getScreenTopPosition().getPartsCoord(),a=(i.x-s.x)*Q.CHIP_SIZE,o=(i.y-s.y)*Q.CHIP_SIZE;this._player.addItem(this._wwaData.objectAttribute[this._yesNoChoicePartsID][Q.ATR_ITEM],0,!1,this._wwaData.isItemEffectEnabled?{screenPixelCoord:new g(a,o),itemBoxBackgroundImageCoord:new g(this._wwaData.imgItemboxX*Q.CHIP_SIZE,this._wwaData.imgItemboxY*Q.CHIP_SIZE)}:void 0)}var r=new y(this._wwaData.objectAttribute[this._yesNoChoicePartsID][Q.ATR_ENERGY],this._wwaData.objectAttribute[this._yesNoChoicePartsID][Q.ATR_STRENGTH],this._wwaData.objectAttribute[this._yesNoChoicePartsID][Q.ATR_DEFENCE],-this._wwaData.objectAttribute[this._yesNoChoicePartsID][Q.ATR_GOLD]);this._player.getStatusWithoutEquipments();if(r.energy=r.energy>Q.STATUS_MINUS_BORDER?Q.STATUS_MINUS_BORDER-r.energy:r.energy,this.setStatusChangedEffect(r),this._player.addStatusAll(r),this._player.isDead()&&0!==this._wwaData.objectAttribute[this._yesNoChoicePartsID][Q.ATR_ENERGY])return void this.gameover();this.appearParts(this._yesNoChoicePartsCoord,I.OBJECT,this._yesNoChoicePartsID)}else"BLANK"!==this._wwaData.systemMessage[F.FULL_ITEM]&&this._messageQueue.push(new Ot(""===this._wwaData.systemMessage[F.FULL_ITEM]?"これ以上、アイテムを持てません。":this._wwaData.systemMessage[F.FULL_ITEM],!0));else"BLANK"!==this._wwaData.message[Y.NO_MONEY]&&this._messageQueue.push(new Ot(""===this._wwaData.message[Y.NO_MONEY]?"所持金がたりない。":this._wwaData.message[Y.NO_MONEY],!0));else t===Q.OBJECT_SELECT?this.appearParts(this._yesNoChoicePartsCoord,I.CHOICE_YES,this._yesNoChoicePartsID):t===Q.OBJECT_URLGATE&&(location.href=ut(this._yesNoURL));else this._yesNoChoiceCallInfo===R.CALL_BY_ITEM_USE?this._player.readyToUseItem(this._yesNoUseItemPos):this._yesNoChoiceCallInfo===R.CALL_BY_QUICK_LOAD?(this._messageWindow.deleteSaveDom(),_t(G[b.QUICK_LOAD]).classList.remove("onpress"),this._messageWindow.load()&&(this._stopUpdateByLoadFlag=!0,this._loadType=B.QUICK_LOAD)):this._yesNoChoiceCallInfo===R.CALL_BY_QUICK_SAVE?(this._messageWindow.deleteSaveDom(),_t(G[b.QUICK_SAVE]).classList.remove("onpress"),this._quickSave()):this._yesNoChoiceCallInfo===R.CALL_BY_RESTART_GAME?(_t(G[b.RESTART_GAME]).classList.remove("onpress"),this._stopUpdateByLoadFlag=!0,this._loadType=B.RESTART_GAME):this._yesNoChoiceCallInfo===R.CALL_BY_END_GAME?(window.history.back(-1),_t(G[b.GOTO_WWA]).classList.remove("onpress")):this._yesNoChoiceCallInfo===R.CALL_BY_GOTO_WWA?(location.href=ut(Q.WWA_HOME),_t(G[b.GOTO_WWA]).classList.remove("onpress")):this._yesNoChoiceCallInfo===R.CALL_BY_PASSWORD_LOAD?(_t(G[b.QUICK_LOAD]).classList.remove("onpress"),this._player.setPasswordWindowWating(),this._passwordWindow.show(Rt.LOAD)):this._yesNoChoiceCallInfo===R.CALL_BY_PASSWORD_SAVE&&(_t(G[b.QUICK_SAVE]).classList.remove("onpress"),this._player.setPasswordWindowWating(),this._passwordWindow.password=this._quickSave(!0),this._passwordWindow.show(Rt.SAVE));this._yesNoJudge=A.UNSELECTED,this._setNextMessage(),this._yesNoChoicePartsCoord=void 0,this._yesNoChoicePartsID=void 0,this._yesNoUseItemPos=void 0,this._yesNoChoiceCallInfo=R.NONE,this._messageWindow.setYesNoChoice(!1)}else if(this._yesNoJudge===A.NO){if(this._yesNoChoiceCallInfo===R.CALL_BY_MAP_PARTS)t=this._wwaData.mapAttribute[this._yesNoChoicePartsID][Q.ATR_TYPE],Q.MAP_URLGATE;else if(this._yesNoChoiceCallInfo===R.CALL_BY_OBJECT_PARTS)(t=this._wwaData.objectAttribute[this._yesNoChoicePartsID][Q.ATR_TYPE])===Q.OBJECT_BUY||t===Q.OBJECT_SELL||(t===Q.OBJECT_SELECT?this.appearParts(this._yesNoChoicePartsCoord,I.CHOICE_NO,this._yesNoChoicePartsID):Q.OBJECT_URLGATE);else if(this._yesNoChoiceCallInfo===R.CALL_BY_ITEM_USE){_t("item"+(this._yesNoUseItemPos-1)).classList.remove("onpress")}else if(this._yesNoChoiceCallInfo===R.CALL_BY_QUICK_LOAD){if(this._messageWindow.deleteSaveDom(),this._usePassword)return this._yesNoJudge=A.UNSELECTED,void this.onpasswordloadcalled();_t(G[b.QUICK_LOAD]).classList.remove("onpress")}else if(this._yesNoChoiceCallInfo===R.CALL_BY_QUICK_SAVE){if(this._messageWindow.deleteSaveDom(),this._usePassword)return this._yesNoJudge=A.UNSELECTED,void this.onpasswordsavecalled();_t(G[b.QUICK_SAVE]).classList.remove("onpress")}else this._yesNoChoiceCallInfo===R.CALL_BY_RESTART_GAME?_t(G[b.RESTART_GAME]).classList.remove("onpress"):this._yesNoChoiceCallInfo===R.CALL_BY_END_GAME||this._yesNoChoiceCallInfo===R.CALL_BY_GOTO_WWA?_t(G[b.GOTO_WWA]).classList.remove("onpress"):this._yesNoChoiceCallInfo===R.CALL_BY_PASSWORD_LOAD?_t(G[b.QUICK_LOAD]).classList.remove("onpress"):this._yesNoChoiceCallInfo===R.CALL_BY_PASSWORD_SAVE&&_t(G[b.QUICK_SAVE]).classList.remove("onpress");this._yesNoJudge=A.UNSELECTED,this._setNextMessage(),this._yesNoChoicePartsCoord=void 0,this._yesNoChoicePartsID=void 0,this._yesNoUseItemPos=void 0,this._yesNoChoiceCallInfo=R.NONE,this._messageWindow.setYesNoChoice(!1)}},t.prototype.setMessageQueue=function(t,e,i,s,a,o,r){if(void 0===s&&(s=0),void 0===a&&(a=S.OBJECT),void 0===o&&(o=new g(0,0)),void 0===r&&(r=!1),this._messageQueue=this._messageQueue.concat(this.getMessageQueueByRawMessage(t,s,a,o)),this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0),0!==this._messageQueue.length){for(var n=this._messageQueue.shift(),_=0;_<n.macro.length;_++)this._execMacroListInNextFrame.push(n.macro[_]);if(this._lastMessage=n,""!==n.message)return this._messageWindow.setMessage(n.message),this._messageWindow.setYesNoChoice(e),this._messageWindow.setPositionByPlayerPosition(0!==this._faces.length,this._scoreWindow.isVisible(),i,this._player.getPosition(),this._camera.getPosition()),this._player.setMessageWaiting(),!0;0===this._messageQueue.length?this._hideMessageWindow(r):this._setNextMessage()}return!1},t.prototype.getMessageQueueByRawMessage=function(t,e,i,s,a){void 0===a&&(a=!1);var o=t.split(/\n\<c\>/i)[0].split(/\<c\>/i)[0].replace(/\n\<p\>\n/gi,"<P>").replace(/\n\<p\>/gi,"<P>").replace(/\<p\>\n/gi,"<P>").replace(/\<p\>/gi,"<P>"),r=[];if(""!==o)for(var n=o.split(/\<p\>/gi),_=0;_<n.length;_++){for(var h=n[_].split("\n"),c=[],l=[],u=0;u<h.length;u++){var d=h[u].match(/(\$(?:[a-zA-Z_][a-zA-Z0-9_]*)\=(?:.*))/);if(null!==d&&d.length>=2){var p=Dt(this,e,i,s,d[1]);l.push(p)}else h[u].match(/^\$/)||c.push(h[u])}r.push(new Ot(c.join("\n"),a,_===n.length-1,l))}return r},t.prototype.appearParts=function(t,e,i){var s;void 0===i&&(i=0);var a,o,r,n,_,h=e===I.CHOICE_NO?Q.APPERANCE_PARTS_MIN_INDEX_NO:Q.APPERANCE_PARTS_MIN_INDEX,c=e===I.CHOICE_YES?Q.APPERANCE_PARTS_MAX_INDEX_YES:Q.APPERANCE_PARTS_MAX_INDEX;for(e===I.MAP?(i=0===i?this._wwaData.map[t.y][t.x]:i,s=S.MAP):(i=0===i?this._wwaData.mapObject[t.y][t.x]:i,s=S.OBJECT),_=h;_<=c;_++){var l=Q.ATR_APPERANCE_BASE+_*Q.REL_ATR_APPERANCE_UNIT_LENGTH,u=l+Q.REL_ATR_APPERANCE_ID,d=l+Q.REL_ATR_APPERANCE_X,p=l+Q.REL_ATR_APPERANCE_Y,E=l+Q.REL_ATR_APPERANCE_TYPE;if(a=s===S.MAP?this._wwaData.mapAttribute[i][u]:this._wwaData.objectAttribute[i][u],o=s===S.MAP?this._wwaData.mapAttribute[i][E]:this._wwaData.objectAttribute[i][E],r=s===S.MAP?this._wwaData.mapAttribute[i][d]:this._wwaData.objectAttribute[i][d],n=s===S.MAP?this._wwaData.mapAttribute[i][p]:this._wwaData.objectAttribute[i][p],r===Q.PLAYER_COORD?(r=this._player.getPosition().getPartsCoord().x,this._player.resetEventExecutionInfo()):r>Q.RELATIVE_COORD_LOWER&&(r=t.x+r-Q.RELATIVE_COORD_BIAS),n===Q.PLAYER_COORD?(n=this._player.getPosition().getPartsCoord().y,this._player.resetEventExecutionInfo()):n>Q.RELATIVE_COORD_LOWER&&(n=t.y+n-Q.RELATIVE_COORD_BIAS),0!==r||0!==n)try{if(new w(this,r,n,0,0),o===S.MAP){if(a>=this._wwaData.mapPartsMax)throw new Error("背景パーツの範囲外IDが指定されました");var m=new g(r,n);this.setPartsOnPosition(S.MAP,a,m)}else{if(a>=this._wwaData.objPartsMax)throw new Error("物体パーツの範囲外IDが指定されました");m=new g(r,n);this.setPartsOnPosition(S.OBJECT,a,m),this._replaceRandomObject(new g(r,n)),r===this._player.getPosition().getPartsCoord().x&&n===this._player.getPosition().getPartsCoord().y&&this._player.setPartsAppearedFlag()}}catch(t){}}},t.prototype.appearPartsByDirection=function(t,e,i){var s=this._player.getPosition().getPartsCoord(),a=this._player.getDir(),o=O[a],r=C[a];this.appearPartsEval(s,(o>=0?"+":"-")+Math.abs(o)*t,(r>=0?"+":"-")+Math.abs(r)*t,e,i)},t.prototype.appearPartsEval=function(t,e,i,s,a){var o,r,n=this._player.getPosition().getPartsCoord();if("P"===e||"p"===e)o=n.x;else if("+"===e[0])o=t.x+parseInt(e.substr(1));else if("-"===e[0])o=t.x-parseInt(e.substr(1));else if(o=parseInt(e),isNaN(o))throw new Error("座標として解釈できない文字が含まれています。");if("P"===i||"p"===i)r=n.y;else if("+"===i[0])r=t.y+parseInt(i.substr(1));else if("-"===i[0])r=t.y-parseInt(i.substr(1));else if(r=parseInt(i),isNaN(r))throw new Error("座標として解釈できない文字が含まれています。");try{new w(this,o,r,0,0);if(a===S.MAP){if(s>=this._wwaData.mapPartsMax)throw new Error("背景パーツの範囲外IDが指定されました");var _=new g(o,r);this.setPartsOnPosition(S.MAP,s,_)}else{if(s>=this._wwaData.objPartsMax)throw new Error("物体パーツの範囲外IDが指定されました");_=new g(o,r);this.setPartsOnPosition(S.OBJECT,s,_),this._replaceRandomObject(new g(o,r)),o===this._player.getPosition().getPartsCoord().x&&r===this._player.getPosition().getPartsCoord().y&&this._player.setPartsAppearedFlag()}}catch(t){}},t.prototype._replaceRandomObject=function(t){var e,i,s=this._wwaData.mapObject[t.y][t.x];if(this._wwaData.objectAttribute[s][Q.ATR_TYPE]===Q.OBJECT_RANDOM){for(var a=0;a<Q.RANDOM_ITERATION_MAX;a++){if(i=Math.floor(10*Math.random()),(e=this._wwaData.objectAttribute[s][Q.ATR_RANDOM_BASE+i])>=this._wwaData.objPartsMax){e=0;break}if(this._wwaData.objectAttribute[e][Q.ATR_TYPE]!==Q.OBJECT_RANDOM)break;s=e}this.setPartsOnPosition(S.OBJECT,e,t)}},t.prototype._replaceRandomObjectsInScreen=function(){for(var t=this._camera.getPosition().getPartsCoord(),e=Math.max(0,t.x-1),i=Math.min(this._wwaData.mapWidth-1,t.x+Q.H_PARTS_NUM_IN_WINDOW),s=Math.max(0,t.y-1),a=Math.min(this._wwaData.mapWidth-1,t.y+Q.V_PARTS_NUM_IN_WINDOW),o=e;o<=i;o++)for(var r=s;r<a;r++)this._replaceRandomObject(new g(o,r))},t.prototype._replaceAllRandomObjects=function(){for(var t=0;t<this._wwaData.mapWidth;t++)for(var e=0;e<this._wwaData.mapWidth;e++)this._replaceRandomObject(new g(t,e))},t.prototype.gameover=function(){var t=this._wwaData.gameoverX,e=this._wwaData.gameoverY;this._messageWindow.isVisible()&&(this._yesNoJudge=A.UNSELECTED,this._messageQueue=[],this._player.setDelayFrame(),this._messageWindow.hide(),this._yesNoChoicePartsCoord=void 0,this._yesNoChoicePartsID=void 0,this._yesNoUseItemPos=void 0,this._yesNoChoiceCallInfo=R.NONE,this._messageWindow.setYesNoChoice(!1)),this._waitFrame=0,this._temporaryInputDisable=!0,this._execMacroListInNextFrame=[],this._player.jumpTo(new w(this,t,e,0,0))},t.prototype.setYesNoInput=function(t){this._yesNoJudgeInNextFrame=t},t.prototype.getYesNoState=function(){return void 0!==this._yesNoJudgeInNextFrame?this._yesNoJudgeInNextFrame:this._yesNoJudge},t.prototype.setStatusChangedEffect=function(t){this._wwaData.isItemEffectEnabled&&(0!==t.strength&&(_t("disp-strength").classList.add("onpress"),this._statusPressCounter.strength=Q.STATUS_CHANGED_EFFECT_FRAME_NUM),0!==t.defence&&(_t("disp-defence").classList.add("onpress"),this._statusPressCounter.defence=Q.STATUS_CHANGED_EFFECT_FRAME_NUM),t instanceof y&&(0!==t.energy&&(_t("disp-energy").classList.add("onpress"),this._statusPressCounter.energy=Q.STATUS_CHANGED_EFFECT_FRAME_NUM),0!==t.gold&&(_t("disp-gold").classList.add("onpress"),this._statusPressCounter.gold=Q.STATUS_CHANGED_EFFECT_FRAME_NUM)))},t.prototype.setPartsOnPosition=function(t,e,i){var s,a,o=i.y<<st.BITSHIFT|i.x;t===S.MAP?(s=this._wwaData.map[i.y][i.x],e=this.loadMapPartsID(e),s=this.loadMapPartsID(s),this._wwaData.map[i.y][i.x]=e,-1!==(a=this._mapIDTable[s].indexOf(o))&&this._mapIDTable[s].splice(a,1),-1===(a=this._mapIDTable[e].indexOf(o))&&this._mapIDTable[e].push(o)):(s=this._wwaData.mapObject[i.y][i.x],e=this.loadMapPartsObjectID(e),s=this.loadMapPartsObjectID(s),this._wwaData.mapObject[i.y][i.x]=e,-1!==(a=this._mapObjectIDTable[s].indexOf(o))&&this._mapObjectIDTable[s].splice(a,1),-1===(a=this._mapObjectIDTable[e].indexOf(o))&&this._mapObjectIDTable[e].push(o))},t.prototype._countSamePartsLength=function(t,e){var i;for(i=e+1;i<t.length&&t[i]===t[i-1];i++);return i-e},t.prototype._compressMap=function(t){for(var e=[],i=0;i<t.length;i++){e[i]=[];for(var s=0;s<t[i].length;){var a=this._countSamePartsLength(t[i],s);e[i].push([t[i][s],a]),s+=a}}return e},t.prototype._decompressMap=function(t){for(var e=[],i=0;i<t.length;i++){e[i]=[],0;for(var s=0;s<t[i].length;s++)for(var a=t[i][s][1],o=0;o<a;o++)e[i].push(t[i][s][0])}return e},t.prototype._generateMapDataHash=function(t){var e="A",i=0,s=0,a=0;for(a=0;a<t.map.length;a++){for(s=0;s<t.map[a].length;)i=this._countSamePartsLength(t.map[a],s),e+=t.map[a][s]+"|"+i+"/",s+=i;for(s=0;s<t.mapObject[a].length;)i=this._countSamePartsLength(t.mapObject[a],s),e+=t.mapObject[a][s]+"|"+i+"/",s+=i}for(var o=0;o<t.mapAttribute.length;o++)for(var r=0;r<t.mapAttribute[o].length;r++)e+=t.mapAttribute[o][r]+"/";for(var n=0;n<t.objectAttribute.length;n++)for(var _=0;_<t.objectAttribute[n].length;_++)e+=t.objectAttribute[n][_]+"/";return e+="Z",nt.MD5(e).toString()},t.prototype._generateSaveDataHash=function(t){var e=this._generateMapDataHash(t),i=[];for(var s in t)"map"!==s&&"mapObject"!==s&&"mapCompressed"!==s&&"mapObjectCompressed"!==s&&"mapAttribute"!==s&&"objectAttribute"!==s&&"checkString"!==s&&i.push(s);i.sort();for(var a=0;a<i.length;a++)e+=dt(t[i[a]]);return nt.MD5(e).toString()},t.prototype._quickSave=function(t){void 0===t&&(t=!1);var e=JSON.parse(JSON.stringify(this._wwaData)),i=this._player.getPosition().getPartsCoord(),s=this._player.getStatusWithoutEquipments();if(e.itemBox=this._player.getCopyOfItemBox(),e.playerX=i.x,e.playerY=i.y,e.statusEnergyMax=this._player.getEnergyMax(),e.statusEnergy=s.energy,e.statusStrength=s.strength,e.statusDefence=s.defence,e.statusGold=s.gold,e.moves=this._player.getMoveCount(),e.frameCount=this._player.getFrameCount(),t&&(e.checkOriginalMapString=this._generateMapDataHash(this._restartData),e.mapCompressed=this._compressMap(e.map),e.mapObjectCompressed=this._compressMap(e.mapObject),e.checkString=this._generateSaveDataHash(e),e.frameCount=this._player.getFrameCount(),e.map=void 0,e.mapObject=void 0),e.message=void 0,e.mapAttribute=void 0,e.objectAttribute=void 0,t){var a=JSON.stringify(e);return nt.AES.encrypt(nt.enc.Utf8.parse(a),"^ /"+(231*this._wwaData.worldPassNumber+8310+e.checkOriginalMapString)+"P+>A[]").toString()}return this._messageWindow.save(this._cvs,e),_t("cell-load").textContent="Quick Load",""},t.prototype._decodePassword=function(t){var e,i=this._generateMapDataHash(this._restartData);try{var s=nt.AES.decrypt(t,"^ /"+(231*this._wwaData.worldPassNumber+8310+i)+"P+>A[]").toString(nt.enc.Utf8)}catch(t){throw new Error("データが破損しています。\n"+t.message)}try{e=JSON.parse(s)}catch(t){throw new Error("マップデータ以外のものが暗号化されたか、マップデータに何かが不足しているようです。\nJSON PARSE FAILED")}return e},t.prototype._quickLoad=function(t,e,i){if(void 0===t&&(t=!1),void 0===e&&(e=null),void 0===i&&(i=!0),!t&&void 0===this._messageWindow.hasSaveData()&&null===e)throw new Error("セーブデータがありません。");var s;if((s=null!==e?this._decodePassword(e):JSON.parse(JSON.stringify(t?this._restartData:this._messageWindow.load()))).message=JSON.parse(JSON.stringify(this._restartData.message)),s.mapAttribute=JSON.parse(JSON.stringify(this._restartData.mapAttribute)),s.objectAttribute=JSON.parse(JSON.stringify(this._restartData.objectAttribute)),void 0===s.map&&(s.map=this._decompressMap(s.mapCompressed),s.mapCompressed=void 0),void 0===s.mapObject&&(s.mapObject=this._decompressMap(s.mapObjectCompressed),s.mapObjectCompressed=void 0),null!==e){var a=this._generateSaveDataHash(s);if(s.checkString!==a)throw new Error("データが壊れているようです。\nInvalid hash (ALL DATA)= "+s.checkString+" "+this._generateSaveDataHash(s));var o=this._generateMapDataHash(this._restartData);if(s.checkOriginalMapString!==o)throw new Error("管理者によってマップが変更されたようです。\nInvalid hash (ORIGINAL MAP)= "+s.checkString+" "+this._generateSaveDataHash(s));console.log("Valid Password!")}return i&&this._applyQuickLoad(s),s},t.prototype._applyQuickLoad=function(t){this._player.setEnergyMax(t.statusEnergyMax),this._player.setEnergy(t.statusEnergy),this._player.setStrength(t.statusStrength),this._player.setDefence(t.statusDefence),this._player.setGold(t.statusGold),this._player.setMoveCount(t.moves),this._player.setFrameCount(t.frameCount),this._player.clearItemBox();for(var e=0;e<t.itemBox.length;e++)this._player.addItem(t.itemBox[e],e+1,!0);this._player.systemJumpTo(new w(this,t.playerX,t.playerY,0,0)),0===t.bgm?this.playSound(X.NO_SOUND):this.playSound(t.bgm),this.setImgClick(new g(t.imgClickX,t.imgClickY)),0!==this.getObjectIdByPosition(this._player.getPosition())&&this._player.setPartsAppearedFlag(),this._wwaData=t,this._mapIDTableCreate(),this._replaceAllRandomObjects(),this.setStatusIconCoord(K.ENERGY,new g(t.imgStatusEnergyX,t.imgStatusEnergyY)),this.setStatusIconCoord(K.STRENGTH,new g(t.imgStatusStrengthX,t.imgStatusStrengthY)),this.setStatusIconCoord(K.DEFENCE,new g(t.imgStatusDefenceX,t.imgStatusDefenceY)),this.setStatusIconCoord(K.GOLD,new g(t.imgStatusGoldX,t.imgStatusGoldY)),this.setWideCellCoord(new g(t.imgWideCellX,t.imgWideCellY)),this.setItemboxBackgroundPosition({x:t.imgItemboxX,y:t.imgItemboxY}),this.setFrameCoord(new g(t.imgFrameX,t.imgFrameY)),this.updateCSSRule()},t.prototype._mapIDTableCreate=function(){var t;for(this._mapIDTable=[],this._mapObjectIDTable=[],t=0;t<this._wwaData.mapPartsMax;t++)this._mapIDTable[t]=[];for(t=0;t<this._wwaData.objPartsMax;t++)this._mapObjectIDTable[t]=[];for(var e=0;e<this._wwaData.mapWidth;e++)for(var i=0;i<this._wwaData.mapWidth;i++){var s=i<<st.BITSHIFT|e;t=this._wwaData.map[i][e],this._mapIDTable[t]instanceof Array||(this._mapIDTable[t]=[]),this._mapIDTable[t].push(s),t=this._wwaData.mapObject[i][e],this._mapObjectIDTable[t]instanceof Array||(this._mapObjectIDTable[t]=[]),this._mapObjectIDTable[t].push(s)}},t.prototype._restartGame=function(){this._quickLoad(!0)},t.prototype._fadeout=function(t){var e=0,i=Q.MAP_WINDOW_WIDTH,s=Q.FADEOUT_SPEED,a=_t("wwa-fader");a.style.display="block";var o=setInterval((function(){if(e+=s,(i-=2*s)<=0||2*e>Q.MAP_WINDOW_WIDTH)return a.removeAttribute("style"),a.style.display="block",a.style.borderWidth="0",a.style.width=Q.MAP_WINDOW_WIDTH+"px",a.style.height=Q.MAP_WINDOW_HEIGHT+"px",a.style.backgroundColor="#808080",clearInterval(o),void t();a.style.width=i+"px",a.style.height=i+"px",a.style.borderWidth=e+"px"}),20)},t.prototype.moveObjects=function(t){var e,i,s,a=this._camera.getPosition(),o=(this._player.getPosition(),a.getPartsCoord(),a.getPartsCoord().x),r=a.getPartsCoord().y;if(this.getMapAttributeByPosition(this._player.getPosition(),Q.ATR_TYPE)!==Q.MAP_LOCALGATE&&this.getObjectAttributeByPosition(this._player.getPosition(),Q.ATR_TYPE)!==Q.OBJECT_LOCALGATE){for(e=new Array(Q.V_PARTS_NUM_IN_WINDOW+2),this.hoge=new Array(Q.V_PARTS_NUM_IN_WINDOW+2),s=-1;s<=Q.V_PARTS_NUM_IN_WINDOW;s++)for(e[s+1]=new Array(Q.H_PARTS_NUM_IN_WINDOW+2),this.hoge[s+1]=new Array(Q.H_PARTS_NUM_IN_WINDOW+2),i=-1;i<=Q.H_PARTS_NUM_IN_WINDOW;i++)if(r+s<0||r+s>=this._wwaData.mapWidth||o+i<0||o+i>=this._wwaData.mapWidth)e[s+1][i+1]=0,this.hoge[s+1][i+1]=0;else{try{var n=(_=new w(this,o+i,r+s,0,0)).getPartsCoord()}catch(t){e[s+1][i+1]=0,this.hoge[s+1][i+1]=0;continue}this._wwaData.mapObject[n.y][n.x];e[s+1][i+1]=this._wwaData.mapObject[n.y][n.x],this.hoge[s+1][i+1]=-this._wwaData.mapObject[n.y][n.x]}for(i=-1;i<=Q.H_PARTS_NUM_IN_WINDOW;i++)if(!(o+i<0||o+i>=this._wwaData.mapWidth))for(s=-1;s<=Q.V_PARTS_NUM_IN_WINDOW;s++)if(!(r+s<0||r+s>=this._wwaData.mapWidth)){try{var _;n=(_=new w(this,o+i,r+s,0,0)).getPartsCoord()}catch(t){continue}var h=this._wwaData.mapObject[n.y][n.x];if(0!==h&&this._wwaData.objectAttribute[h][Q.ATR_MOVE]!==x.STATIC&&this._wwaData.objectAttribute[h][Q.ATR_TYPE]!==Q.OBJECT_LOCALGATE&&this._wwaData.objectAttribute[h][Q.ATR_TYPE]!==Q.OBJECT_RANDOM&&(this._wwaData.objectAttribute[h][Q.ATR_MOVE]===x.CHASE_PLAYER||this._wwaData.objectAttribute[h][Q.ATR_MOVE]===x.RUN_OUT||this._wwaData.objectAttribute[h][Q.ATR_MOVE]===x.HANG_AROUND)){var c=this._wwaData.objectAttribute[h][Q.ATR_MOVE];if(c!==x.HANG_AROUND){var l,u=this._getCandidateCoord(t,_,c),d=new g(u.x,n.y),p=new g(n.x,u.y),E=null;if(this._objectCanMoveTo(t,u,e))this._setObjectsInNextFrame(n,u,o,r,e,h);else{var m=this._getSecondCandidateMoveMode(t,n,u,d,p,this._wwaData.objectAttribute[h][Q.ATR_TYPE]===Q.OBJECT_MONSTER,e);m===W.MODE_X?this._setObjectsInNextFrame(n,d,o,r,e,h):m===W.MODE_Y?this._setObjectsInNextFrame(n,p,o,r,e,h):null!==(E=this._getThirdCandidate(t,_,u,c,e))&&this._wwaData.version>=31?this._setObjectsInNextFrame(n,E,o,r,e,h):(l=this._getRandomMoveCoord(t,_,e),this._setObjectsInNextFrame(n,l,o,r,e,h))}}else l=this._getRandomMoveCoord(t,_,e),this._setObjectsInNextFrame(n,l,o,r,e,h)}}}},t.prototype._getCandidateCoord=function(t,e,i){var s=e.getPartsCoord();this._player.getPosition().getOffsetCoord(),this._player.getPosition().getPartsCoord();try{var a=t?this._player.getPosition().getNextJustPosition().getPartsCoord():this._player.getPosition().getPartsCoord()}catch(t){throw new Error("予期せぬ方向への移動のようです。")}var o=s.clone(),r=0,n=0;return i===x.CHASE_PLAYER?(r=s.x>a.x?-1:s.x<a.x?1:0,n=s.y>a.y?-1:s.y<a.y?1:0):i===x.RUN_OUT&&(r=s.x>a.x?1:s.x<a.x?-1:0,n=s.y>a.y?1:s.y<a.y?-1:0),o.x+=r,o.y+=n,o.x=Math.min(this._wwaData.mapWidth-1,Math.max(0,o.x)),o.y=Math.min(this._wwaData.mapWidth-1,Math.max(0,o.y)),o},t.prototype._getSecondCandidateMoveMode=function(t,e,i,s,a,o,r){return!t||(this._player.getDir()!==d.UP&&this._player.getDir()!==d.DOWN||!o)&&(this._player.getDir()!==d.LEFT&&this._player.getDir()!==d.RIGHT||o)?this._objectCanMoveTo(t,s,r)?W.MODE_X:this._objectCanMoveTo(t,a,r)?W.MODE_Y:W.UNDECIDED:this._objectCanMoveTo(t,a,r)?W.MODE_Y:this._objectCanMoveTo(t,s,r)?W.MODE_X:W.UNDECIDED},t.prototype._getThirdCandidate=function(t,e,i,s,a){var o,r=s===x.CHASE_PLAYER?1:s===x.RUN_OUT?-1:0,n=t?this._player.getPosition().getNextJustPosition().getPartsCoord():this._player.getPosition().getPartsCoord(),_=e.getPartsCoord();if(n.x!==_.x){if(o=new g(i.x,_.y+1*r),this._objectCanMoveTo(t,o,a))return o;if(o=new g(i.x,_.y-1*r),this._objectCanMoveTo(t,o,a))return o;if(o=new g(_.x,_.y+1*r),this._objectCanMoveTo(t,o,a))return o;if(o=new g(_.x,_.y-1*r),this._objectCanMoveTo(t,o,a))return o}if(n.y!==_.y){if(o=new g(_.x+1*r,i.y),this._objectCanMoveTo(t,o,a))return o;if(o=new g(_.x-1*r,i.y),this._objectCanMoveTo(t,o,a))return o;if(o=new g(_.x+1*r,_.y),this._objectCanMoveTo(t,o,a))return o;if(o=new g(_.x-1*r,_.y),this._objectCanMoveTo(t,o,a))return o}return null},t.prototype._getRandomMoveCoord=function(t,e,i){for(var s=e.getPartsCoord(),a=s.clone(),o=this._wwaData.version<31?Q.RANDOM_MOVE_ITERATION_NUM_BEFORE_V31:Q.RANDOM_MOVE_ITERATION_NUM,r=0;r<o;r++){var n=Math.floor(8*Math.random());if(a.x=s.x+O[n],a.y=s.y+C[n],this._objectCanMoveTo(t,a,i))return a}return s},t.prototype.isPrevFrameEventExecuted=function(){return this._prevFrameEventExected},t.prototype._objectCanMoveTo=function(t,e,i){if(e.x<0||e.y<0||this._wwaData.mapWidth<=e.x||this._wwaData.mapWidth<=e.y)return!1;var s=this._wwaData.map[e.y][e.x],a=this._wwaData.mapObject[e.y][e.x],o=this._wwaData.mapAttribute[s][Q.ATR_TYPE],r=this._camera.getPosition(),n=r.getPartsCoord().x,_=r.getPartsCoord().y;if(0===s&&!this.isOldMap()||o===Q.MAP_WALL)return!1;var h=e.x-n+1,c=e.y-_+1;if(0<=h&&0<=c&&h<i.length&&c<i.length){if(0!==i[c][h])return!1}else if(0!==a)return!1;if(t){if(this._player.getPosition().getNextJustPosition().getPartsCoord().equals(e))return!1}else if(this._player.getPosition().getPartsCoord().equals(e))return!1;return!0},t.prototype._setObjectsInNextFrame=function(t,e,i,s,a,o){var r=e.x-i+1,n=e.y-s+1;0<=e.x&&e.x<=this._wwaData.mapWidth&&0<=e.y&&e.y<=this._wwaData.mapWidth&&(0<=r&&r<a.length&&0<=n&&n<a.length&&(a[t.y-s+1][t.x-i+1]=0,a[e.y-s+1][e.x-i+1]=o,this.hoge[e.y-s+1][e.x-i+1]=o),this._objectMovingDataManager.add(o,t.convertIntoPosition(this),e.convertIntoPosition(this),t.getDirectionTo(e)))},t.prototype.launchBattleEstimateWindow=function(){var t=this._camera.getPosition().getPartsCoord(),e=Math.max(0,t.x),i=Math.min(this._wwaData.mapWidth-1,t.x+Q.H_PARTS_NUM_IN_WINDOW-1),s=Math.max(0,t.y),a=Math.min(this._wwaData.mapWidth-1,t.y+Q.V_PARTS_NUM_IN_WINDOW-1),o=[];this.playSound(X.DECISION);for(var r=e;r<=i;r++)for(var n=s;n<=a;n++){var _=this._wwaData.mapObject[n][r];this._wwaData.objectAttribute[_][Q.ATR_TYPE]===Q.OBJECT_MONSTER&&-1===o.indexOf(_)&&o.push(_)}return this._bottomButtonType===u.BATTLE_REPORT&&_t(G[b.GOTO_WWA]).classList.add("onpress"),0===o.length?(_t(G[b.GOTO_WWA]).classList.remove("onpress"),this.hideBattleEstimateWindow(),!1):(this._battleEstimateWindow.update(this._player.getStatus(),o),this._battleEstimateWindow.show(),this._player.setEstimateWindowWating(),!0)},t.prototype.hideBattleEstimateWindow=function(){this._battleEstimateWindow.hide(),this._player.clearEstimateWindowWaiting(),_t(G[b.GOTO_WWA]).classList.remove("onpress")},t.prototype.hidePasswordWindow=function(t){if(void 0===t&&(t=!1),this._passwordWindow.hide(),t||this._passwordWindow.mode===Rt.SAVE)this._player.clearPasswordWindowWaiting();else{try{var e=this._quickLoad(!1,this._passwordWindow.password,!1)}catch(t){return this._player.clearPasswordWindowWaiting(),void alert("パスワードが正常ではありません。\nエラー詳細:\n"+t.message)}this._passwordLoadExecInNextFrame=!0,this._passwordSaveExtractData=e}},t.prototype._displayHelp=function(){if(this._player.isControllable()){var t="";switch(this.userDevice.device){case N.GAME:switch(this.userDevice.os){case P.NINTENDO:t="　【操作方法】\nＡ：Ｙｅｓ,戦闘結果予測の表示\nＢ：Ｎｏ\nＸ：メニュー\nＹ：このリストの表示\nＲ：初めからスタート\nＺＬ：データの一時保存\nＺＲ：一時保存データの読み込み\n＋: 移動速度を上げる\n－: 移動速度を落とす\n　WWA Wing バージョン:3.4.2\n　マップデータ バージョン: "+Math.floor(this._wwaData.version/10)+"."+this._wwaData.version%10;break;case P.PLAY_STATION:t="　【操作方法】\n〇：Ｙｅｓ,戦闘結果予測の表示\n×：Ｎｏ\n△：メニュー\n□：このリストの表示\nＲ１：初めからスタート\nＬ２：データの一時保存\nＲ２：一時保存データの読み込み\nOPTIONS: 移動速度を上げる\nSHARE: 移動速度を落とす\n　　現在の移動回数："+this._player.getMoveCount()+"\n　　プレイ時間："+this._player.getPlayTimeText()+"\n　WWA Wing バージョン:3.4.2\n　マップデータ バージョン: "+Math.floor(this._wwaData.version/10)+"."+this._wwaData.version%10;break;case P.XBOX:t="　【操作方法】\nＢ：Ｙｅｓ,戦闘結果予測の表示\nＡ：Ｎｏ\nＹ：メニュー\nＸ：このリストの表示\nＲＢ：初めからスタート\nＬＴ：データの一時保存\nＲＴ：一時保存データの読み込み\nMENU: 移動速度を上げる\nWINDOW: 移動速度を落とす\n　　現在の移動回数："+this._player.getMoveCount()+"\n　　プレイ時間："+this._player.getPlayTimeText()+"\n　WWA Wing バージョン:3.4.2\n　マップデータ バージョン: "+Math.floor(this._wwaData.version/10)+"."+this._wwaData.version%10;break;default:return}break;case N.SP:case N.VR:return;case N.PC:t="　【操作方法】\nＦ１、Ｍ：戦闘結果予測の表示\nＦ３：復帰用パスワード入力\nＦ４：復帰用パスワード表示\nＦ５：一時保存データの読み込み\nＦ６：データの一時保存\nＦ７：初めからスタート\nＦ８：ＷＷＡ公式ページにリンク\nＦ１２：このリストの表示\nキーボードの「１２３、ＱＷＥ、ＡＳＤ、ＺＸＣ」は右のアイテムボックスに対応。\n「Ｅｎｔｅｒ、Ｙ」はＹｅｓ,\n「Ｅｓｃ、Ｎ」はＮｏに対応。\n　　　Ｉ: 移動速度を落とす／\nＦ２、Ｐ: 移動速度を上げる\n　　現在の移動回数："+this._player.getMoveCount()+"\n　　プレイ時間："+this._player.getPlayTimeText()+"\n　WWA Wing バージョン:3.4.2\n　マップデータ バージョン: "+Math.floor(this._wwaData.version/10)+"."+this._wwaData.version%10;break;default:return}t&&this.setMessageQueue(t,!1,!0)}},t.prototype._setNextMessage=function(t){if(void 0===t&&(t=!1),this._clearFacesInNextFrame=!0,this._scoreWindow.isVisible()&&this._scoreWindow.hide(),this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0),0===this._messageQueue.length)this._hideMessageWindow();else{var e=this._messageQueue.shift(),i=e.message,s=e.macro;this._lastMessage=e;for(var a=0;a<s.length;a++)this._execMacroListInNextFrame.push(s[a]);""!==i?(this._player.setDelayFrame(),this._messageWindow.hide(),this._messageWindow.setMessage(i),this._messageWindow.setPositionByPlayerPosition(0!==this._faces.length,this._scoreWindow.isVisible(),t,this._player.getPosition(),this._camera.getPosition()),this._messageWindow.show(),this._player.setMessageWaiting()):0===this._messageQueue.length?this._hideMessageWindow():this._setNextMessage()}},t.prototype._hideMessageWindow=function(t){void 0===t&&(t=!0);var e=0;this._player.isReadyToUseItem()&&(e=this._player.useItem());var i=this.getObjectAttributeById(e,Q.ATR_STRING);this.clearFaces(),0===i?(t&&(this._player.setDelayFrame(),this._messageWindow.hide(),this._keyStore.allClear(),this._mouseStore.clear()),this._player.clearMessageWaiting()):this.setMessageQueue(this.getMessageById(i),!1,!1,e,S.OBJECT,this._player.getPosition().getPartsCoord(),!0)},t.prototype.loadMapPartsObjectID=function(t){return(t|=0)<0||t>=this._wwaData.objPartsMax?0:t},t.prototype.loadMapPartsID=function(t){return(t|=0)<0||t>=this._wwaData.mapPartsMax?0:t},t.prototype.replaceParts=function(t,e,i,s){void 0===i&&(i=S.OBJECT),void 0===s&&(s=!1);var a,o,r,n,_,h,c,l,u=this._camera.getPosition().getPartsCoord(),d=s?Math.max(0,u.x):0,p=s?Math.min(this._wwaData.mapWidth-1,u.x+Q.H_PARTS_NUM_IN_WINDOW-1):this._wwaData.mapWidth-1,E=s?Math.max(0,u.y):0,m=s?Math.min(this._wwaData.mapWidth-1,u.y+Q.V_PARTS_NUM_IN_WINDOW)-1:this._wwaData.mapWidth-1;if(s=0!==d||p!==this._wwaData.mapWidth-1||0!==E||m!==this._wwaData.mapWidth-1,i===S.OBJECT)if(t=this.loadMapPartsObjectID(t),e=this.loadMapPartsObjectID(e),n=this._mapObjectIDTable[t].concat(),(c=this._mapObjectIDTable[t]).length=0,l=this._mapObjectIDTable[e],o=n.length,s)for(r=0;r<o;r++)_=(a=n[r])&st.BITMASK,h=a>>>st.BITSHIFT&st.BITMASK,d<=_&&_<=p&&E<=h&&h<=m?(this._wwaData.mapObject[h][_]=e,l.push(a)):c.push(a);else{for(r=0;r<o;r++)_=(a=n[r])&st.BITMASK,h=a>>>st.BITSHIFT&st.BITMASK,this._wwaData.mapObject[h][_]=e;Array.prototype.push.apply(l,n)}else if(t=this.loadMapPartsID(t),e=this.loadMapPartsID(e),n=this._mapIDTable[t].concat(),(c=this._mapIDTable[t]).length=0,l=this._mapIDTable[e],o=n.length,s)for(r=0;r<o;r++)_=(a=n[r])&st.BITMASK,h=a>>>st.BITSHIFT&st.BITMASK,d<=_&&_<=p&&E<=h&&h<=m?(this._wwaData.map[h][_]=e,l.push(a)):c.push(a);else{for(r=0;r<o;r++)_=(a=n[r])&st.BITMASK,h=a>>>st.BITSHIFT&st.BITMASK,this._wwaData.map[h][_]=e;Array.prototype.push.apply(l,n)}},t.prototype.getYesNoImgCoord=function(){return new g(this._wwaData.yesnoImgPosX,this._wwaData.yesnoImgPosY)},t.prototype.setYesNoImgCoord=function(t){return this._wwaData.yesnoImgPosX=t.x,this._wwaData.yesnoImgPosY=t.y,t},t.prototype.getPlayerImgCoord=function(){return new g(this._wwaData.playerImgPosX,this._wwaData.playerImgPosY)},t.prototype.setPlayerImgCoord=function(t){return this._wwaData.playerImgPosX=t.x,this._wwaData.playerImgPosY=t.y,t},t.prototype.setPlayerEnergyMax=function(t){return this._player.setEnergyMax(t)},t.prototype.getMapPartsNum=function(){return this._wwaData.mapPartsMax},t.prototype.getObjectPartsNum=function(){return this._wwaData.objPartsMax},t.prototype.setMoveMacroWaitingToPlayer=function(t){this._reservedMoveMacroTurn=t},t.prototype.disableSave=function(t){return this._wwaData.disableSaveFlag=t},t.prototype.isOldMap=function(){return this._wwaData.isOldMap},t.prototype.setOldMap=function(t){return this._wwaData.isOldMap=t},t.prototype.setObjectNotCollapseOnPartsOnPlayer=function(t){return this._wwaData.objectNoCollapseDefaultFlag=t},t.prototype.setGameOverPosition=function(t){if(t.x<0||t.x>=this.getMapWidth()||t.y<0||t.y>=this.getMapWidth())throw new Error("マップの範囲外が指定されています!");return this._wwaData.gameoverX=t.x,this._wwaData.gameoverY=t.y,t},t.prototype.setPlayerStatus=function(t,e){if(t===H.ENERGY)this._player.setEnergy(e);else if(t===H.STRENGTH)this._player.setStrength(e);else if(t===H.DEFENCE)this._player.setDefence(e);else if(t===H.GOLD)this._player.setGold(e);else{if(t!==H.MOVES)throw new Error("未定義のステータスタイプです");this._player.setMoveCount(e)}},t.prototype.setDelPlayer=function(t){return this._wwaData.delPlayerFlag=t},t.prototype.setPlayerGetItem=function(t,e){try{this._player.addItem(e,t,!0)}catch(t){}},t.prototype.setStatusIconCoord=function(t,e){var i=e.x*Q.CHIP_SIZE,s=e.y*Q.CHIP_SIZE,a=function(t){ht(t+">.status-icon").style.backgroundPosition="-"+i+"px -"+s+"px"};switch(t){case K.ENERGY:this._wwaData.imgStatusEnergyX=e.x,this._wwaData.imgStatusEnergyY=e.y,a("#disp-energy");break;case K.STRENGTH:this._wwaData.imgStatusStrengthX=e.x,this._wwaData.imgStatusStrengthY=e.y,a("#disp-strength");break;case K.DEFENCE:this._wwaData.imgStatusDefenceX=e.x,this._wwaData.imgStatusDefenceY=e.y,a("#disp-defence");break;case K.GOLD:this._wwaData.imgStatusGoldX=e.x,this._wwaData.imgStatusGoldY=e.y,a("#disp-gold");break;default:throw new Error("種別が不正です。")}return e.clone()},t.prototype.setWideCellCoord=function(t){this._wwaData.imgWideCellX=t.x,this._wwaData.imgWideCellY=t.y;var e=t.x*Q.CHIP_SIZE,i=t.y*Q.CHIP_SIZE;return Array.prototype.forEach.call(ct("div.wide-cell-row"),(function(t){t.style.backgroundPosition="-"+e+"px -"+i+"px"})),t.clone()},t.prototype.setFrameCoord=function(t){return this._wwaData.imgFrameX=t.x,this._wwaData.imgFrameY=t.y,this._cgManager.setFrameImage(t),t.clone()},t.prototype.setBattleEffectCoord=function(t){return this._wwaData.imgBattleEffectX=t.x,this._wwaData.imgBattleEffectY=t.y,t.clone()},t.prototype.canInput=function(){return!this._temporaryInputDisable},t.prototype.setEffect=function(t,e){this._wwaData.effectWaits=t,this._wwaData.effectCoords=e},t.prototype.stopEffect=function(){this._wwaData.effectCoords=[]},t.prototype.setImgClick=function(t){if(this._wwaData.imgClickX=t.x,this._wwaData.imgClickY=t.y,t.equals(new g(0,0)))Array.prototype.forEach.call(ct(".item-cell>.item-click-border"),(function(t){t.style.backgroundImage="url('"+Q.ITEM_BORDER_IMG_DATA_URL+"')",t.style.backgroundPosition="0 0"}));else{var e=this._wwaData.mapCGName.replace("(","\\(").replace(")","\\)");Array.prototype.forEach.call(ct(".item-cell>.item-click-border"),(function(i){i.style.backgroundImage="url('"+e+"')",i.style.backgroundPosition="-"+t.x*Q.CHIP_SIZE+"px -"+t.y*Q.CHIP_SIZE+"px"}))}},t.prototype.addFace=function(t){this._faces.push(t)},t.prototype.clearFaces=function(){this._faces=[]},t.prototype.updateItemEffectEnabled=function(t){this._wwaData.isItemEffectEnabled=t},t.prototype.initCSSRule=function(){this._styleElm=_t(Q.WWA_STYLE_TAG_ID),this._sheet=this._styleElm.sheet,this.updateCSSRule()},t.prototype.updateCSSRule=function(){if(void 0===this._stylePos)this._stylePos=new Array(2);else if(void 0!==this._sheet.addRule)for(var t=0;t<this._stylePos.length;t++)this._sheet.removeRule(this._stylePos[this._styleElm[t]]);else for(t=0;t<this._stylePos.length;t++)this._sheet.deleteRule(this._stylePos[this._styleElm[t]]);var e="div.wwa-message-window, div#wwa-text-message-window, div#wwa-battle-estimate, div#wwa-password-window",i=this._isClassicModeEnable?1:.9,s="\nbackground-color: rgba("+this._wwaData.frameColorR+",  "+this._wwaData.frameColorG+", "+this._wwaData.frameColorB+", "+i+");\nborder-color: rgba("+this._wwaData.frameOutColorR+", "+this._wwaData.frameOutColorG+", "+this._wwaData.frameOutColorB+", 1);\ncolor: rgba("+this._wwaData.fontColorR+", "+this._wwaData.fontColorG+", "+this._wwaData.fontColorB+", 1);\nwhite-space: pre-wrap;\n",a="\ncolor: rgba("+this._wwaData.statusColorR+", "+this._wwaData.statusColorG+", "+this._wwaData.statusColorB+",1);\nfont-weight: bold;\n";void 0!==this._sheet.addRule?(this._stylePos[it.MESSAGE_WINDOW]=this._sheet.addRule(e,s),this._stylePos[it.SIDEBAR]=this._sheet.addRule("div#wwa-sidebar",a)):(this._stylePos[it.MESSAGE_WINDOW]=this._sheet.insertRule(e+" { "+s+" }",0),this._stylePos[it.SIDEBAR]=this._sheet.insertRule("div#wwa-sidebar { "+a+" }",1))},t.prototype.changeStyleRule=function(t,e,i,s){t===et.COLOR_FRAME?(this._wwaData.frameColorR=e,this._wwaData.frameColorG=i,this._wwaData.frameColorB=s):t===et.COLOR_FRAMEOUT?(this._wwaData.frameOutColorR=e,this._wwaData.frameOutColorG=i,this._wwaData.frameOutColorB=s):t===et.COLOR_STR?(this._wwaData.fontColorR=e,this._wwaData.fontColorG=i,this._wwaData.fontColorB=s):t===et.COLOR_STATUS_STR&&(this._wwaData.statusColorR=e,this._wwaData.statusColorG=i,this._wwaData.statusColorB=s),this.updateCSSRule()},t.prototype.showMonsterWindow=function(){this._monsterWindow.show()},t.prototype.isClassicMode=function(){return this._isClassicModeEnable},t.prototype.isConsoleOutputMode=function(){return this._useConsole},t.prototype.setItemboxBackgroundPosition=function(t){this._wwaData.imgItemboxX=t.x,this._wwaData.imgItemboxY=t.y,Array.prototype.forEach.call(ct("div.item-cell"),(function(e){e.style.backgroundPosition="-"+t.x*Q.CHIP_SIZE+"px -"+t.y*Q.CHIP_SIZE+"px"}))},t.prototype._actionGamePadButtonItemMacro=function(){if(!this._wwaData.gamePadButtonItemTable)return!1;var t,e,i,s;for(t=this._wwaData.gamePadButtonItemTable.length,e=0;e<t;e++)if(i=this._wwaData.gamePadButtonItemTable[e]){switch(s=!1,e){case _.BUTTON_CROSS_KEY_LEFT:this._gamePadStore.crossPressed(_.BUTTON_CROSS_KEY_LEFT)&&(s=!0);break;case _.BUTTON_CROSS_KEY_RIGHT:this._gamePadStore.crossPressed(_.BUTTON_CROSS_KEY_RIGHT)&&(s=!0);break;case _.BUTTON_CROSS_KEY_UP:this._gamePadStore.crossPressed(_.BUTTON_CROSS_KEY_UP)&&(s=!0);break;case _.BUTTON_CROSS_KEY_DOWN:this._gamePadStore.crossPressed(_.BUTTON_CROSS_KEY_DOWN)&&(s=!0)}if(this._gamePadStore.buttonTrigger(e)&&(s=!0),s&&this.onselectitem(i))return!0}return!1},t.prototype.setGamePadButtonItemTable=function(t,e){var i,s;if(!this._wwaData.gamePadButtonItemTable)for(s in this._wwaData.gamePadButtonItemTable=[],_)i=_[s],this._wwaData.gamePadButtonItemTable[i]=0;this._wwaData.gamePadButtonItemTable.length>t&&(this._wwaData.gamePadButtonItemTable[t]=e)},t}(),re=!1;function ne(){Array.prototype.forEach.call(ct("a.wwa-copyright"),(function(t){t.addEventListener("click",(function(){re=!0}))})),window.addEventListener("beforeunload",(function(t){var e="このページを離れますか？";if(re)return re=!1,t.returnValue=e,e}));var t=_t("wwa-wrapper").getAttribute("data-wwa-title-img");Ft(_t("wwa-wrapper"),t);var e=_t("wwa-wrapper").getAttribute("data-wwa-mapdata"),i=_t("wwa-wrapper").getAttribute("data-wwa-audio-dir"),s=!0;_t("wwa-wrapper").getAttribute("data-wwa-urlgate-enable").match(/^false$/i)&&(s=!1);var a=_t("wwa-wrapper").getAttribute("data-wwa-classic-mode-enable"),o=!1;null!==a&&a.match(/^true$/i)&&(o=!0);var r=!0,n=_t("wwa-wrapper").getAttribute("data-wwa-item-effect-enable");null!==n&&n.match(/^false$/i)&&(r=!1);var _=!1,h=_t("wwa-wrapper").getAttribute("data-wwa-use-go-to-wwa");null!==h&&h.match(/^true$/i)&&(_=!0),new oe(e,s,t,o,r,_,i)}"complete"===document.readyState?setTimeout(ne):window.addEventListener("load",(function(){setTimeout(ne)}))}]);